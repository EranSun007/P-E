import{j as e,r as Bs,be as Gs,W as _e,aK as bs,bf as Je,ax as Te,bg as ls,x as Qe,l as Xe,az as ce,b0 as be,aF as is,a0 as $s,aN as Ys,N as Hs,T as cs,X as ws,ba as ss,L as ds,bd as ts,bh as qe,bi as as,aI as Ks,a6 as qs,bj as xs,aE as gs}from"./chunk-WPKCbDK8.js";import{a as d,k as Js,L as Qs}from"./chunk-BKwDNIOR.js";import{C as X,h as Z,i as L,j as ee,I as U,B as m,n as Ss,o as Cs,p as ks,A as Ds,L as p,t as Ie,W as xe,l as M,D as De,N as Me,O as rs,d as Xs,M as us,Q as Ne,f as Ye,H as Zs,J as Ls,K as et,m as st,P as Fe,v as Pe,w as ze}from"./index-B5nMAt-E.js";import{a as ns,c as tt,g as at}from"./chunk-uiVOWrDz.js";import{D as ge,a as ue,b as je,c as pe,e as Ae,d as fe}from"./chunk-g5LiUroS.js";import{S as Y,a as H,b as K,c as q,d as A}from"./chunk-CRMqQcWA.js";import{B as J}from"./chunk-zVvAqB5a.js";import{C as We}from"./chunk-BRlPmrL-.js";import{T as rt,a as nt,b as js,c as Ue,d as lt,e as Re}from"./chunk-BxZBiOpp.js";import{T as it}from"./chunk-6GuMELXD.js";import{b as Q,p as P,r as ct,u as He,v as ps}from"./chunk-DGs6foQ1.js";import{A as dt,a as ot,b as mt,c as ht,d as xt,e as gt,f as ut,g as jt,h as pt}from"./chunk-Cdp4fw9y.js";import{P as ft}from"./chunk-BZGnY1WQ.js";import{S as Es}from"./chunk--9cM2e_y.js";import{a as fs,T as vt}from"./chunk-H2KHWgoL.js";import"./chunk-BwuEqr1N.js";import"./chunk-BdHZTqfh.js";import"./chunk-CQRLWZyN.js";import"./chunk-CBOE_DJY.js";const vs=({workItem:r,onAddInsight:u,onMarkComplete:D,onReactivate:c,onEdit:x,isLoading:l=!1})=>{const[j,n]=d.useState(!1),[h,y]=d.useState(""),[C,E]=d.useState("keep"),[N,_]=d.useState(!1),k=Array.isArray(r.insights)?r.insights:typeof r.insights=="string"?JSON.parse(r.insights||"[]"):[],g=k.length>0?k[k.length-1]:null,i=async()=>{h.trim()&&(await u(r.id,{text:h.trim(),type:C}),y(""),E("keep"),n(!1))},b=I=>I==="keep"?"bg-green-100 text-green-800 border-green-200":"bg-amber-100 text-amber-800 border-amber-200",O=I=>I==="keep"?e.jsx(Te,{className:"h-3 w-3"}):e.jsx(ls,{className:"h-3 w-3"}),T=r.status==="completed";return e.jsxs(X,{className:T?"opacity-75":"",children:[e.jsx(Z,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(L,{className:"flex items-center gap-2 text-base",children:[e.jsx(Bs,{className:"h-4 w-4 text-gray-500"}),r.name]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-500",children:[r.project_name&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Gs,{className:"h-3 w-3"}),r.project_name]}),r.sprint_name&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),r.sprint_name]}),r.effort_estimation&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:"h-3 w-3"}),"Est: ",r.effort_estimation]})]})]}),e.jsx(J,{variant:"outline",className:T?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800",children:T?"Completed":"Active"})]})}),e.jsxs(ee,{className:"space-y-3",children:[g&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-amber-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-700",children:g.text}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(J,{variant:"outline",className:`text-xs ${b(g.type)}`,children:[O(g.type),e.jsx("span",{className:"ml-1",children:g.type})]}),e.jsx("span",{className:"text-xs text-gray-400",children:Q(P(g.date),"MMM d, yyyy")})]})]})]})}),j&&e.jsxs("div",{className:"p-3 border rounded-lg space-y-2",children:[e.jsx(U,{placeholder:"What did you learn or observe?",value:h,onChange:I=>y(I.target.value),disabled:l}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Y,{value:C,onValueChange:E,children:[e.jsx(H,{className:"w-32",children:e.jsx(K,{})}),e.jsxs(q,{children:[e.jsx(A,{value:"keep",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-3 w-3 text-green-600"}),"Keep"]})}),e.jsx(A,{value:"improve",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ls,{className:"h-3 w-3 text-amber-600"}),"Improve"]})})]})]}),e.jsx(m,{size:"sm",onClick:i,disabled:!h.trim()||l,children:"Save"}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>{n(!1),y("")},children:"Cancel"})]})]}),k.length>1&&e.jsxs(Ss,{open:N,onOpenChange:_,children:[e.jsx(Cs,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",className:"w-full justify-start",children:[N?e.jsx(Qe,{className:"h-4 w-4 mr-2"}):e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"View History (",k.length," insights)"]})}),e.jsx(ks,{className:"space-y-2 mt-2",children:k.slice(0,-1).reverse().map((I,a)=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded text-sm",children:[e.jsx("p",{className:"text-gray-700",children:I.text}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(J,{variant:"outline",className:`text-xs ${b(I.type)}`,children:I.type}),e.jsx("span",{className:"text-xs text-gray-400",children:Q(P(I.date),"MMM d, yyyy")})]})]},I.id||a))})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",children:[!T&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>n(!0),disabled:j||l,children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Add Insight"]}),x&&e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>x(r),disabled:l,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>D(r.id),disabled:l,children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Mark Complete"]})]}),T&&c&&e.jsx(m,{size:"sm",variant:"outline",onClick:()=>c(r.id),disabled:l,children:"Reactivate"})]})]})]})},ys=({open:r,onOpenChange:u,onSubmit:D,teamMemberId:c,initialData:x=null,isLoading:l=!1})=>{const{projects:j}=d.useContext(Ds),[n,h]=d.useState({name:"",project_id:"",effort_value:"",effort_unit:"hours",sprint_name:"",initialInsight:"",insightType:"keep"}),[y,C]=d.useState({}),E=i=>{if(!i)return{value:"",unit:"hours"};const b=i.match(/^(\d+(?:\.\d+)?)\s*(hours?|days?)$/i);if(b){const O=b[2].toLowerCase().startsWith("day")?"days":"hours";return{value:b[1],unit:O}}return{value:"",unit:"hours"}};d.useEffect(()=>{if(r){if(x){const{value:i,unit:b}=E(x.effort_estimation);h({name:x.name||"",project_id:x.project_id||"",effort_value:i,effort_unit:b,sprint_name:x.sprint_name||"",initialInsight:"",insightType:"keep"})}else h({name:"",project_id:"",effort_value:"",effort_unit:"hours",sprint_name:"",initialInsight:"",insightType:"keep"});C({})}},[r,x]);const N=(i,b)=>{h(O=>({...O,[i]:b})),y[i]&&C(O=>({...O,[i]:""}))},_=()=>{const i={};return n.name.trim()||(i.name="Work item name is required"),C(i),Object.keys(i).length===0},k=async i=>{if(i.preventDefault(),!_())return;const b={team_member_id:c,name:n.name.trim(),project_id:n.project_id&&n.project_id!=="none"?n.project_id:null,effort_estimation:n.effort_value?`${n.effort_value} ${n.effort_unit}`:null,sprint_name:n.sprint_name.trim()||null},O=n.initialInsight.trim()?{text:n.initialInsight.trim(),type:n.insightType}:null;await D(b,O)},g=!!x;return e.jsx(ge,{open:r,onOpenChange:u,children:e.jsxs(ue,{className:"sm:max-w-lg",children:[e.jsxs(je,{children:[e.jsx(pe,{children:g?"Edit Work Item":"Add Work Item"}),e.jsx(Ae,{children:g?"Update the work item details below.":"Add a new work item to track current work for this team member."})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:"Work Item Name *"}),e.jsx(U,{id:"name",placeholder:"e.g., Implement user authentication",value:n.name,onChange:i=>N("name",i.target.value),disabled:l,className:y.name?"border-destructive":""}),y.name&&e.jsx("p",{className:"text-sm text-destructive",children:y.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"project",children:"Project (Epic)"}),e.jsxs(Y,{value:n.project_id,onValueChange:i=>N("project_id",i),disabled:l,children:[e.jsx(H,{children:e.jsx(K,{placeholder:"Select a project"})}),e.jsxs(q,{children:[e.jsx(A,{value:"none",children:"No project"}),j.map(i=>e.jsx(A,{value:i.id,children:i.name},i.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"sprint_name",children:"Sprint Name"}),e.jsx(U,{id:"sprint_name",placeholder:"e.g., Sprint 42, 2026-Q1-W3",value:n.sprint_name,onChange:i=>N("sprint_name",i.target.value),disabled:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Effort Estimation"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{id:"effort_value",type:"number",min:"0",step:"0.5",placeholder:"e.g., 8",value:n.effort_value,onChange:i=>N("effort_value",i.target.value),disabled:l,className:"w-24"}),e.jsxs(Y,{value:n.effort_unit,onValueChange:i=>N("effort_unit",i),disabled:l,children:[e.jsx(H,{className:"w-28",children:e.jsx(K,{})}),e.jsxs(q,{children:[e.jsx(A,{value:"hours",children:"hours"}),e.jsx(A,{value:"days",children:"days"})]})]})]})]}),!g&&e.jsxs("div",{className:"space-y-2 p-3 border rounded-lg bg-gray-50",children:[e.jsx(p,{htmlFor:"initialInsight",children:"Initial Insight (optional)"}),e.jsx(U,{id:"initialInsight",placeholder:"Any initial observations or notes?",value:n.initialInsight,onChange:i=>N("initialInsight",i.target.value),disabled:l}),e.jsxs("div",{className:"flex items-center gap-4 pt-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Type:"}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"insightType",value:"keep",checked:n.insightType==="keep",onChange:()=>N("insightType","keep"),disabled:l,className:"w-4 h-4"}),e.jsx(Te,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Keep"})]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"insightType",value:"improve",checked:n.insightType==="improve",onChange:()=>N("insightType","improve"),disabled:l,className:"w-4 h-4"}),e.jsx(ls,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm",children:"Improve"})]})]})]})]}),e.jsxs(fe,{children:[e.jsx(m,{variant:"outline",onClick:()=>u(!1),disabled:l,children:"Cancel"}),e.jsx(m,{onClick:k,disabled:l,children:l?"Saving...":g?"Update Work Item":"Create Work Item"})]})]})})},Ns=({duty:r,onAddInsight:u,onComplete:D,onEdit:c,onDelete:x,isLoading:l=!1})=>{const[j,n]=d.useState(!1),[h,y]=d.useState(""),[C,E]=d.useState(!1),N=r.insights||[],_=r.status==="completed",g=(()=>{if(r.duration_days)return r.duration_days;if(r.start_date){const T=P(r.start_date),I=r.end_date?P(r.end_date):new Date;return ct(I,T)+1}return null})(),i=()=>{if(!r.start_date)return"No date";const T=Q(P(r.start_date),"MMM d");if(!r.end_date)return`${T} - ongoing`;const I=Q(P(r.end_date),"MMM d, yyyy");return`${T} - ${I}`},b=async()=>{h.trim()&&(await u(r.id,h.trim()),y(""),n(!1))},O=async()=>{await D(r.id,{end_date:new Date().toISOString().split("T")[0],bugs_at_end:r.bugs_at_end,bugs_solved:r.bugs_solved,escalations:r.escalations})};return e.jsxs(X,{className:_?"opacity-75":"",children:[e.jsx(Z,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(L,{className:"flex items-center gap-2 text-base",children:[e.jsx(is,{className:"h-4 w-4 text-indigo-600"}),"DevOps Duty"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),i()]}),g&&e.jsxs(J,{variant:"outline",className:"text-xs",children:[g," day",g!==1?"s":""]})]})]}),e.jsx(J,{variant:"outline",className:_?"bg-green-100 text-green-800":"bg-indigo-100 text-indigo-800",children:_?"Completed":"Active"})]})}),e.jsxs(ee,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx($s,{className:"h-4 w-4 text-red-500"}),"Bugs"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:r.bugs_at_start||0}),e.jsx(Ys,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:r.bugs_at_end||0}),(r.bugs_solved>0||r.bugs_at_start>r.bugs_at_end)&&e.jsxs(J,{variant:"outline",className:"text-xs bg-green-100 text-green-800",children:[r.bugs_solved||r.bugs_at_start-r.bugs_at_end," solved"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(Hs,{className:"h-4 w-4 text-amber-500"}),"Escalations"]}),e.jsx("div",{className:"text-sm text-gray-600",children:r.escalations||0})]})]}),r.notes&&e.jsx("div",{className:"text-sm text-gray-600 p-2 bg-gray-50 rounded",children:r.notes}),N.length>0&&e.jsxs(Ss,{open:C,onOpenChange:E,children:[e.jsx(Cs,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",className:"w-full justify-start",children:[C?e.jsx(Qe,{className:"h-4 w-4 mr-2"}):e.jsx(Xe,{className:"h-4 w-4 mr-2"}),e.jsx(Je,{className:"h-4 w-4 mr-1 text-amber-500"}),N.length," Insight",N.length!==1?"s":""]})}),e.jsx(ks,{className:"space-y-2 mt-2",children:N.map((T,I)=>e.jsxs("div",{className:"p-2 bg-amber-50 rounded text-sm text-gray-700 flex items-start gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0"}),T]},I))})]}),j&&e.jsxs("div",{className:"p-3 border rounded-lg space-y-2",children:[e.jsx(U,{placeholder:"What did you learn from this duty?",value:h,onChange:T=>y(T.target.value),disabled:l,onKeyDown:T=>{T.key==="Enter"&&(T.preventDefault(),b())}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{size:"sm",onClick:b,disabled:!h.trim()||l,children:"Save"}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>{n(!1),y("")},children:"Cancel"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",children:[!_&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>n(!0),disabled:j||l,children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Add Insight"]}),c&&e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>c(r),disabled:l,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(m,{size:"sm",variant:"outline",onClick:O,disabled:l,children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Complete"]})]}),_&&c&&e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>c(r),disabled:l,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Edit"]}),x&&e.jsxs(dt,{children:[e.jsx(ot,{asChild:!0,children:e.jsx(m,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",disabled:l,children:e.jsx(cs,{className:"h-4 w-4"})})}),e.jsxs(mt,{children:[e.jsxs(ht,{children:[e.jsx(xt,{children:"Delete DevOps Duty?"}),e.jsx(gt,{children:"This will permanently delete this DevOps duty record and all associated insights. This action cannot be undone."})]}),e.jsxs(ut,{children:[e.jsx(jt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>x(r.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]})},_s=({open:r,onOpenChange:u,onSubmit:D,teamMemberId:c,initialData:x=null,isLoading:l=!1})=>{const[j,n]=d.useState({start_date:"",end_date:"",bugs_at_start:"",bugs_at_end:"",bugs_solved:"",escalations:"",notes:""}),[h,y]=d.useState([]),[C,E]=d.useState(""),[N,_]=d.useState({});d.useEffect(()=>{if(r){if(x)n({start_date:x.start_date?x.start_date.split("T")[0]:"",end_date:x.end_date?x.end_date.split("T")[0]:"",bugs_at_start:x.bugs_at_start?.toString()||"",bugs_at_end:x.bugs_at_end?.toString()||"",bugs_solved:x.bugs_solved?.toString()||"",escalations:x.escalations?.toString()||"",notes:x.notes||""}),y(x.insights||[]);else{const a=new Date().toISOString().split("T")[0];n({start_date:a,end_date:"",bugs_at_start:"",bugs_at_end:"",bugs_solved:"",escalations:"",notes:""}),y([])}E(""),_({})}},[r,x]);const k=(a,w)=>{n(f=>({...f,[a]:w})),N[a]&&_(f=>({...f,[a]:""}))},g=()=>{C.trim()&&(y(a=>[...a,C.trim()]),E(""))},i=a=>{y(w=>w.filter((f,W)=>W!==a))},b=()=>{const a={};return j.start_date||(a.start_date="Start date is required"),_(a),Object.keys(a).length===0},O=async a=>{if(a.preventDefault(),!b())return;const w={team_member_id:c,start_date:j.start_date,end_date:j.end_date||null,bugs_at_start:parseInt(j.bugs_at_start,10)||0,bugs_at_end:parseInt(j.bugs_at_end,10)||0,bugs_solved:parseInt(j.bugs_solved,10)||0,escalations:parseInt(j.escalations,10)||0,notes:j.notes.trim()||null,insights:h,status:j.end_date?"completed":"active"};await D(w)},T=!!x,I=j.bugs_at_start&&j.bugs_at_end?Math.max(0,parseInt(j.bugs_at_start,10)-parseInt(j.bugs_at_end,10)):null;return e.jsx(ge,{open:r,onOpenChange:u,children:e.jsxs(ue,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsx(pe,{children:T?"Edit DevOps Duty":"Add DevOps Duty"}),e.jsx(Ae,{children:T?"Update the DevOps duty details below.":"Track a DevOps duty period with bug metrics and learnings."})]}),e.jsxs("form",{onSubmit:O,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(U,{id:"start_date",type:"date",value:j.start_date,onChange:a=>k("start_date",a.target.value),disabled:l,className:N.start_date?"border-destructive":""}),N.start_date&&e.jsx("p",{className:"text-sm text-destructive",children:N.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"end_date",children:"End Date"}),e.jsx(U,{id:"end_date",type:"date",value:j.end_date,onChange:a=>k("end_date",a.target.value),disabled:l}),e.jsx("p",{className:"text-xs text-gray-500",children:"Leave empty for ongoing duty"})]})]}),e.jsxs("div",{className:"space-y-3 p-3 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700",children:"Bug Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"bugs_at_start",children:"Bugs at Start"}),e.jsx(U,{id:"bugs_at_start",type:"number",min:"0",placeholder:"e.g., 45",value:j.bugs_at_start,onChange:a=>k("bugs_at_start",a.target.value),disabled:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"bugs_at_end",children:"Bugs at End"}),e.jsx(U,{id:"bugs_at_end",type:"number",min:"0",placeholder:"e.g., 38",value:j.bugs_at_end,onChange:a=>k("bugs_at_end",a.target.value),disabled:l})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"bugs_solved",children:"Bugs Solved"}),e.jsx(U,{id:"bugs_solved",type:"number",min:"0",placeholder:I!==null?`Suggested: ${I}`:"e.g., 7",value:j.bugs_solved,onChange:a=>k("bugs_solved",a.target.value),disabled:l}),I!==null&&!j.bugs_solved&&e.jsxs(m,{type:"button",variant:"ghost",size:"sm",className:"text-xs",onClick:()=>k("bugs_solved",I.toString()),children:["Use suggested: ",I]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"escalations",children:"Escalations"}),e.jsx(U,{id:"escalations",type:"number",min:"0",placeholder:"e.g., 2",value:j.escalations,onChange:a=>k("escalations",a.target.value),disabled:l})]})]})]}),e.jsxs("div",{className:"space-y-3 p-3 border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-amber-500"}),"Insights & Learnings"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{placeholder:"What did you learn from this duty?",value:C,onChange:a=>E(a.target.value),disabled:l,onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),g())}}),e.jsx(m,{type:"button",variant:"outline",onClick:g,disabled:!C.trim()||l,children:e.jsx(ce,{className:"h-4 w-4"})})]}),h.length>0&&e.jsx("div",{className:"space-y-2",children:h.map((a,w)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-gray-50 rounded text-sm",children:[e.jsx("span",{className:"flex-1",children:a}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>i(w),disabled:l,children:e.jsx(ws,{className:"h-3 w-3"})})]},w))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"notes",children:"Notes"}),e.jsx(Ie,{id:"notes",placeholder:"Any additional notes about this duty period...",value:j.notes,onChange:a=>k("notes",a.target.value),disabled:l,rows:3})]})]}),e.jsxs(fe,{children:[e.jsx(m,{variant:"outline",onClick:()=>u(!1),disabled:l,children:"Cancel"}),e.jsx(m,{onClick:O,disabled:l,children:l?"Saving...":T?"Update Duty":"Create Duty"})]})]})})},yt=({teamMemberId:r})=>{const[u,D]=d.useState([]),[c,x]=d.useState([]),[l,j]=d.useState(!0),[n,h]=d.useState(!1),[y,C]=d.useState(!1),[E,N]=d.useState(!1),[_,k]=d.useState(null),[g,i]=d.useState(!1),[b,O]=d.useState(!1),[T,I]=d.useState(null),[a,w]=d.useState(!1),[f,W]=d.useState(!1),v=async()=>{if(r)try{const o=await xe.listByTeamMember(r);D(Array.isArray(o)?o:[])}catch(o){M.error("Error loading work items",{error:String(o)}),D([])}},z=async()=>{if(r)try{const o=await De.listByTeamMember(r);x(Array.isArray(o)?o:[])}catch(o){M.error("Error loading DevOps duties",{error:String(o)}),x([])}},G=async()=>{if(r)try{j(!0),await Promise.all([v(),z()])}finally{j(!1)}};d.useEffect(()=>{G()},[r]);const ae=u.filter(o=>o.status==="active"),le=u.filter(o=>o.status==="completed"),Oe=c.filter(o=>o.status==="active"),de=c.filter(o=>o.status==="completed"),we=async(o,F)=>{try{h(!0);const se=await xe.create(o);F&&se.id&&await xe.addInsight(se.id,F),await v(),C(!1)}catch(se){M.error("Error creating work item",{error:String(se)})}finally{h(!1)}},Ve=async(o,F)=>{try{h(!0),await xe.addInsight(o,F),await v()}catch(se){M.error("Error adding insight",{error:String(se)})}finally{h(!1)}},re=async o=>{try{h(!0),await xe.update(o,{status:"completed"}),await v()}catch(F){M.error("Error marking work item complete",{error:String(F)})}finally{h(!1)}},ie=async o=>{try{h(!0),await xe.update(o,{status:"active"}),await v()}catch(F){M.error("Error reactivating work item",{error:String(F)})}finally{h(!1)}},Se=o=>{k(o),N(!0)},Ce=async o=>{if(_)try{h(!0),await xe.update(_.id,o),await v(),N(!1),k(null)}catch(F){M.error("Error updating work item",{error:String(F)})}finally{h(!1)}},V=async o=>{try{h(!0),await De.create(o),await z(),i(!1)}catch(F){M.error("Error creating DevOps duty",{error:String(F)})}finally{h(!1)}},oe=async(o,F)=>{try{h(!0),await De.addInsight(o,F),await z()}catch(se){M.error("Error adding insight to DevOps duty",{error:String(se)})}finally{h(!1)}},ne=async(o,F)=>{try{h(!0),await De.complete(o,F),await z()}catch(se){M.error("Error completing DevOps duty",{error:String(se)})}finally{h(!1)}},ve=o=>{I(o),O(!0)},R=async o=>{if(T)try{h(!0),await De.update(T.id,o),await z(),O(!1),I(null)}catch(F){M.error("Error updating DevOps duty",{error:String(F)})}finally{h(!1)}},ke=async o=>{try{h(!0),await De.delete(o),await z()}catch(F){M.error("Error deleting DevOps duty",{error:String(F)})}finally{h(!1)}};return l?e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5"}),"Current Work"]})}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ds,{className:"h-6 w-6 animate-spin text-gray-400"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5"}),"Current Work"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{onClick:()=>C(!0),size:"sm",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Work Item"]}),e.jsxs(m,{onClick:()=>i(!0),size:"sm",variant:"outline",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Add DevOps Duty"]})]})]})}),e.jsxs(ee,{children:[ae.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ss,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No active work items"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add work items to track current development tasks"})]}):e.jsx("div",{className:"space-y-4",children:ae.map(o=>e.jsx(vs,{workItem:o,onAddInsight:Ve,onMarkComplete:re,onEdit:Se,isLoading:n},o.id))}),le.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:"w-full justify-start text-gray-500",onClick:()=>w(!a),children:[a?e.jsx(Qe,{className:"h-4 w-4 mr-2"}):e.jsx(Xe,{className:"h-4 w-4 mr-2"}),a?"Hide":"Show"," Completed Items (",le.length,")"]}),a&&e.jsx("div",{className:"space-y-4 mt-4",children:le.map(o=>e.jsx(vs,{workItem:o,onAddInsight:Ve,onMarkComplete:re,onReactivate:ie,isLoading:n},o.id))})]}),(Oe.length>0||de.length>0)&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[e.jsx(is,{className:"h-4 w-4 text-indigo-600"}),"DevOps Duties"]}),Oe.length>0&&e.jsx("div",{className:"space-y-4",children:Oe.map(o=>e.jsx(Ns,{duty:o,onAddInsight:oe,onComplete:ne,onEdit:ve,onDelete:ke,isLoading:n},o.id))}),de.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:"w-full justify-start text-gray-500",onClick:()=>W(!f),children:[f?e.jsx(Qe,{className:"h-4 w-4 mr-2"}):e.jsx(Xe,{className:"h-4 w-4 mr-2"}),f?"Hide":"Show"," Completed Duties (",de.length,")"]}),f&&e.jsx("div",{className:"space-y-4 mt-4",children:de.map(o=>e.jsx(Ns,{duty:o,onAddInsight:oe,onComplete:ne,onEdit:ve,onDelete:ke,isLoading:n},o.id))})]})]})]})]}),e.jsx(ys,{open:y,onOpenChange:C,onSubmit:we,teamMemberId:r,isLoading:n}),e.jsx(ys,{open:E,onOpenChange:o=>{N(o),o||k(null)},onSubmit:Ce,teamMemberId:r,initialData:_,isLoading:n}),e.jsx(_s,{open:g,onOpenChange:i,onSubmit:V,teamMemberId:r,isLoading:n}),e.jsx(_s,{open:b,onOpenChange:o=>{O(o),o||I(null)},onSubmit:R,teamMemberId:r,initialData:T,isLoading:n})]})},Nt=({open:r,onOpenChange:u,onSubmit:D,initialData:c=null,isLoading:x=!1})=>{const l=new Date().getFullYear(),j=[l-1,l,l+1],[n,h]=d.useState({title:"",description:"",year:l.toString(),progress:0}),[y,C]=d.useState({});d.useEffect(()=>{r&&(h(c?{title:c.title||"",description:c.description||"",year:(c.year||l).toString(),progress:c.progress||0}:{title:"",description:"",year:l.toString(),progress:0}),C({}))},[r,c,l]);const E=(g,i)=>{h(b=>({...b,[g]:i})),y[g]&&C(b=>({...b,[g]:""}))},N=()=>{const g={};return n.title.trim()||(g.title="Goal title is required"),C(g),Object.keys(g).length===0},_=async g=>{if(g.preventDefault(),!N())return;const i={title:n.title.trim(),description:n.description.trim()||null,year:parseInt(n.year,10),progress:n.progress};await D(i)},k=!!c;return e.jsx(ge,{open:r,onOpenChange:u,children:e.jsxs(ue,{className:"sm:max-w-lg",children:[e.jsx(je,{children:e.jsx(pe,{children:k?"Edit Developer Goal":"Add Developer Goal"})}),e.jsxs("form",{onSubmit:_,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"title",children:"Goal Title *"}),e.jsx(U,{id:"title",placeholder:"e.g., Lead CAP Plugin Development",value:n.title,onChange:g=>E("title",g.target.value),disabled:x,className:y.title?"border-destructive":""}),y.title&&e.jsx("p",{className:"text-sm text-destructive",children:y.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",children:"Description"}),e.jsx(Ie,{id:"description",placeholder:"Describe the goal and success criteria...",value:n.description,onChange:g=>E("description",g.target.value),disabled:x,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"year",children:"Year"}),e.jsxs(Y,{value:n.year,onValueChange:g=>E("year",g),disabled:x||k,children:[e.jsx(H,{children:e.jsx(K,{})}),e.jsx(q,{children:j.map(g=>e.jsx(A,{value:g.toString(),children:g},g))})]})]}),k&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(p,{children:["Progress: ",n.progress,"%"]}),e.jsx(Es,{value:[n.progress],onValueChange:g=>E("progress",g[0]),max:100,step:5,disabled:x}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]})]}),e.jsxs(fe,{children:[e.jsx(m,{variant:"outline",onClick:()=>u(!1),disabled:x,children:"Cancel"}),e.jsx(m,{onClick:_,disabled:x,children:x?"Saving...":k?"Update Goal":"Create Goal"})]})]})})},_t=({teamMemberId:r})=>{const u=new Date().getFullYear(),[D,c]=d.useState([]),[x,l]=d.useState(u.toString()),[j,n]=d.useState(!0),[h,y]=d.useState(!1),[C,E]=d.useState(!1),[N,_]=d.useState(null),[k,g]=d.useState({}),i=[u-1,u,u+1],b=async()=>{if(r)try{n(!0);const v=await Me.list(r,parseInt(x,10));c(Array.isArray(v)?v:[])}catch(v){M.error("Error loading developer goals",{error:String(v)}),c([])}finally{n(!1)}};d.useEffect(()=>{b()},[r,x]);const O=async v=>{try{y(!0),await Me.create({...v,team_member_id:r}),await b(),E(!1)}catch(z){M.error("Error creating goal",{error:String(z)})}finally{y(!1)}},T=async v=>{if(N)try{y(!0),await Me.update(N.id,v),await b(),E(!1),_(null)}catch(z){M.error("Error updating goal",{error:String(z)})}finally{y(!1)}},I=async v=>{if(confirm("Are you sure you want to delete this goal?"))try{y(!0),await Me.delete(v),await b()}catch(z){M.error("Error deleting goal",{error:String(z)})}finally{y(!1)}},a=(v,z)=>{g(G=>({...G,[v]:z}))},w=async v=>{const z=k[v];if(z!==void 0)try{y(!0),await Me.update(v,{progress:z}),await b(),g(G=>{const ae={...G};return delete ae[v],ae})}catch(G){M.error("Error updating progress",{error:String(G)})}finally{y(!1)}},f=v=>{_(v),E(!0)},W=()=>{_(null),E(!0)};return j?e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5"}),"Developer Goals"]})}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(ds,{className:"h-6 w-6 animate-spin text-gray-400"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5"}),"Developer Goals"]}),e.jsxs(Y,{value:x,onValueChange:l,children:[e.jsx(H,{className:"w-24",children:e.jsx(K,{})}),e.jsx(q,{children:i.map(v=>e.jsx(A,{value:v.toString(),children:v},v))})]})]})}),e.jsxs(ee,{children:[D.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ts,{className:"h-10 w-10 text-gray-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["No goals for ",x]})]}):e.jsx("div",{className:"space-y-4",children:D.map(v=>{const z=k[v.id]??v.progress;return e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:v.title}),v.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:v.description})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>f(v),disabled:h,children:e.jsx(be,{className:"h-3 w-3"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>I(v.id),disabled:h,children:e.jsx(cs,{className:"h-3 w-3 text-red-500"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{value:z,className:"flex-1 h-2"}),e.jsxs("span",{className:"text-xs font-medium w-10 text-right",children:[z,"%"]})]}),e.jsx(Es,{value:[z],onValueChange:G=>a(v.id,G[0]),onValueCommit:()=>w(v.id),max:100,step:5,disabled:h,className:"cursor-pointer"})]})]},v.id)})}),e.jsxs(m,{variant:"outline",size:"sm",className:"w-full mt-4",onClick:W,disabled:h,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Goal"]})]})]}),e.jsx(Nt,{open:C,onOpenChange:v=>{E(v),v||_(null)},onSubmit:N?T:O,initialData:N,isLoading:h})]})},Ke=({value:r,onChange:u,disabled:D})=>{const[c,x]=d.useState(0);return e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(l=>e.jsx("button",{type:"button",className:"p-0.5 focus:outline-none disabled:opacity-50",onClick:()=>!D&&u(l),onMouseEnter:()=>!D&&x(l),onMouseLeave:()=>x(0),disabled:D,children:e.jsx(qe,{className:`h-6 w-6 ${(c||r)>=l?"fill-amber-400 text-amber-400":"text-gray-300"}`})},l))})},bt=({open:r,onOpenChange:u,onSubmit:D,initialData:c=null,workItems:x=[],isLoading:l=!1})=>{const j=new Date().getFullYear(),[n,h]=d.useState({year:j.toString(),summary:"",strengths:"",areas_for_improvement:"",main_points:[],self_technical_rating:null,self_collaboration_rating:null,technical_rating:null,collaboration_rating:null,highlighted_work_items:[]}),[y,C]=d.useState(""),[E,N]=d.useState({});d.useEffect(()=>{r&&(h(c?{year:(c.year||j).toString(),summary:c.summary||"",strengths:c.strengths||"",areas_for_improvement:c.areas_for_improvement||"",main_points:Array.isArray(c.main_points)?c.main_points:[],self_technical_rating:c.self_technical_rating||null,self_collaboration_rating:c.self_collaboration_rating||null,technical_rating:c.technical_rating||null,collaboration_rating:c.collaboration_rating||null,highlighted_work_items:Array.isArray(c.highlighted_work_items)?c.highlighted_work_items:[]}:{year:j.toString(),summary:"",strengths:"",areas_for_improvement:"",main_points:[],self_technical_rating:null,self_collaboration_rating:null,technical_rating:null,collaboration_rating:null,highlighted_work_items:[]}),C(""),N({}))},[r,c,j]);const _=(a,w)=>{h(f=>({...f,[a]:w}))},k=()=>{y.trim()&&(h(a=>({...a,main_points:[...a.main_points,y.trim()]})),C(""))},g=a=>{h(w=>({...w,main_points:w.main_points.filter((f,W)=>W!==a)}))},i=a=>{h(w=>{const f=w.highlighted_work_items;return f.includes(a)?{...w,highlighted_work_items:f.filter(W=>W!==a)}:f.length>=5?w:{...w,highlighted_work_items:[...f,a]}})},b=async a=>{a.preventDefault();const w={year:parseInt(n.year,10),summary:n.summary.trim()||null,strengths:n.strengths.trim()||null,areas_for_improvement:n.areas_for_improvement.trim()||null,main_points:n.main_points,self_technical_rating:n.self_technical_rating,self_collaboration_rating:n.self_collaboration_rating,technical_rating:n.technical_rating,collaboration_rating:n.collaboration_rating,highlighted_work_items:n.highlighted_work_items};await D(w)},O=!!c,I=(()=>{const a=[n.self_technical_rating,n.self_collaboration_rating,n.technical_rating,n.collaboration_rating].filter(w=>w!=null);return a.length===0?null:(a.reduce((w,f)=>w+f,0)/a.length).toFixed(1)})();return e.jsx(ge,{open:r,onOpenChange:u,children:e.jsxs(ue,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(je,{children:e.jsx(pe,{children:O?"Edit Performance Evaluation":"Create Performance Evaluation"})}),e.jsxs("form",{onSubmit:b,className:"space-y-6 py-4",children:[!O&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Year"}),e.jsxs(Y,{value:n.year,onValueChange:a=>_("year",a),disabled:l,children:[e.jsx(H,{className:"w-32",children:e.jsx(K,{})}),e.jsxs(q,{children:[e.jsx(A,{value:j.toString(),children:j}),e.jsx(A,{value:(j-1).toString(),children:j-1})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px flex-1 bg-gray-200"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Self-Assessment"}),e.jsx("div",{className:"h-px flex-1 bg-gray-200"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Developer's self-evaluation of their performance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Technical Rating"}),e.jsx(Ke,{value:n.self_technical_rating,onChange:a=>_("self_technical_rating",a),disabled:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Collaboration Rating"}),e.jsx(Ke,{value:n.self_collaboration_rating,onChange:a=>_("self_collaboration_rating",a),disabled:l})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px flex-1 bg-gray-200"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Manager Assessment"}),e.jsx("div",{className:"h-px flex-1 bg-gray-200"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Manager's evaluation of the developer's performance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Technical Rating"}),e.jsx(Ke,{value:n.technical_rating,onChange:a=>_("technical_rating",a),disabled:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Collaboration Rating"}),e.jsx(Ke,{value:n.collaboration_rating,onChange:a=>_("collaboration_rating",a),disabled:l})]})]})]}),I&&e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Overall Rating: "}),e.jsx("span",{className:"font-bold text-lg",children:I}),e.jsx("span",{className:"text-gray-500",children:" / 5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"summary",children:"Summary"}),e.jsx(Ie,{id:"summary",placeholder:"Summarize the overall performance...",value:n.summary,onChange:a=>_("summary",a.target.value),disabled:l,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"strengths",children:"Strengths"}),e.jsx(Ie,{id:"strengths",placeholder:"Key strengths demonstrated...",value:n.strengths,onChange:a=>_("strengths",a.target.value),disabled:l,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"areas_for_improvement",children:"Areas for Improvement"}),e.jsx(Ie,{id:"areas_for_improvement",placeholder:"Areas where improvement is needed...",value:n.areas_for_improvement,onChange:a=>_("areas_for_improvement",a.target.value),disabled:l,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Main Points"}),e.jsxs("div",{className:"space-y-2",children:[n.main_points.map((a,w)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"flex-1 text-sm",children:a}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(w),disabled:l,children:e.jsx(ws,{className:"h-4 w-4"})})]},w)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{placeholder:"Add a main point...",value:y,onChange:a=>C(a.target.value),onKeyPress:a=>a.key==="Enter"&&(a.preventDefault(),k()),disabled:l}),e.jsx(m,{type:"button",variant:"outline",onClick:k,disabled:l||!y.trim(),children:e.jsx(ce,{className:"h-4 w-4"})})]})]})]}),x.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{children:["Key Contributions (",n.highlighted_work_items.length,"/5)"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select up to 5 work items to highlight"}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 border rounded",children:x.map(a=>{const w=n.highlighted_work_items.includes(a.id);return e.jsx(J,{variant:w?"default":"outline",className:`cursor-pointer ${!w&&n.highlighted_work_items.length>=5?"opacity-50 cursor-not-allowed":""}`,onClick:()=>i(a.id),children:a.name},a.id)})})]})]}),e.jsxs(fe,{children:[e.jsx(m,{variant:"outline",onClick:()=>u(!1),disabled:l,children:"Cancel"}),e.jsx(m,{onClick:b,disabled:l,children:l?"Saving...":O?"Update Evaluation":"Create Evaluation"})]})]})})},Ee=({rating:r,size:u="sm"})=>{const D=[],c=Math.floor(r||0),x=(r||0)%1>=.5;for(let l=1;l<=5;l++)l<=c?D.push(e.jsx(qe,{className:`${u==="sm"?"h-4 w-4":"h-5 w-5"} fill-amber-400 text-amber-400`},l)):l===c+1&&x?D.push(e.jsx(qe,{className:`${u==="sm"?"h-4 w-4":"h-5 w-5"} text-amber-400`,style:{fill:"url(#half-star-gradient)"}},l)):D.push(e.jsx(qe,{className:`${u==="sm"?"h-4 w-4":"h-5 w-5"} text-gray-300`},l));return e.jsx("div",{className:"flex gap-0.5",children:D})},wt=({teamMemberId:r})=>{const u=new Date().getFullYear(),[D,c]=d.useState([]),[x,l]=d.useState(u.toString()),[j,n]=d.useState([]),[h,y]=d.useState(!0),[C,E]=d.useState(!1),[N,_]=d.useState(!1),k=[u,u-1],g=async()=>{if(r)try{y(!0);const[f,W]=await Promise.all([rs.list(r),xe.listByTeamMember(r)]);c(Array.isArray(f)?f:[]),n(Array.isArray(W)?W:[])}catch(f){M.error("Error loading performance data",{error:String(f)}),c([]),n([])}finally{y(!1)}};d.useEffect(()=>{g()},[r]);const i=D.find(f=>f.year===parseInt(x,10)),b=parseInt(x,10)<u,O=(f,W,v,z)=>{const G=[f,W,v,z].filter(ae=>ae!=null);return G.length===0?null:G.reduce((ae,le)=>ae+le,0)/G.length},T=async f=>{try{E(!0),await rs.create({...f,team_member_id:r}),await g(),_(!1)}catch(W){M.error("Error creating evaluation",{error:String(W)})}finally{E(!1)}},I=async f=>{if(i)try{E(!0),await rs.update(i.id,f),await g(),_(!1)}catch(W){M.error("Error updating evaluation",{error:String(W)})}finally{E(!1)}},a=i?O(i.self_technical_rating,i.self_collaboration_rating,i.technical_rating,i.collaboration_rating):null,w=i?.highlighted_work_items?.map(f=>j.find(W=>W.id===f)).filter(Boolean)||[];return h?e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5"}),"Performance Evaluation"]})}),e.jsx(ee,{children:e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(ds,{className:"h-6 w-6 animate-spin text-gray-400"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(X,{children:[e.jsxs(Z,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5 shrink-0"}),"Performance"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Y,{value:x,onValueChange:l,children:[e.jsx(H,{className:"w-20 h-8",children:e.jsx(K,{})}),e.jsx(q,{children:k.map(f=>e.jsx(A,{value:f.toString(),children:f},f))})]}),i&&!b&&e.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>_(!0),disabled:C,children:e.jsx(be,{className:"h-4 w-4"})})]})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ee,{rating:a,size:"sm"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",a.toFixed(1),")"]})]})]}),e.jsx(ee,{children:i?e.jsxs("div",{className:"space-y-4",children:[b&&e.jsx(J,{variant:"secondary",className:"mb-2",children:"Read-only (Previous Year)"}),e.jsxs("div",{className:"space-y-4",children:[(i.self_technical_rating||i.self_collaboration_rating)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"Self-Assessment"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Technical"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{rating:i.self_technical_rating}),e.jsxs("span",{className:"text-sm",children:["(",i.self_technical_rating||"-",")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Collaboration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{rating:i.self_collaboration_rating}),e.jsxs("span",{className:"text-sm",children:["(",i.self_collaboration_rating||"-",")"]})]})]})]})]}),(i.technical_rating||i.collaboration_rating)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"Manager Assessment"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Technical"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{rating:i.technical_rating}),e.jsxs("span",{className:"text-sm",children:["(",i.technical_rating||"-",")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Collaboration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{rating:i.collaboration_rating}),e.jsxs("span",{className:"text-sm",children:["(",i.collaboration_rating||"-",")"]})]})]})]})]}),a&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Overall"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{rating:a}),e.jsxs("span",{className:"text-sm font-medium",children:["(",a.toFixed(2),")"]})]})]})})]}),i.summary&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Summary"}),e.jsx("p",{className:"text-sm text-gray-700",children:i.summary})]}),i.strengths&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Strengths"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-line",children:i.strengths})]}),i.areas_for_improvement&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Areas for Improvement"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-line",children:i.areas_for_improvement})]}),i.main_points?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Main Points"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-1",children:i.main_points.map((f,W)=>e.jsx("li",{children:f},W))})]}),w.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 mb-2",children:["Key Contributions (",w.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:w.map(f=>e.jsx(J,{variant:"outline",className:"text-xs",children:f.name},f.id))})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(as,{className:"h-10 w-10 text-gray-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-gray-500 text-sm mb-4",children:["No evaluation for ",x]}),!b&&e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>_(!0),disabled:C,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Create Evaluation"]})]})})]}),e.jsx(bt,{open:N,onOpenChange:_,onSubmit:i?I:T,initialData:i,workItems:j,isLoading:C})]})};function $t(){const[r]=Js(),u=r.get("id"),{isPresentationMode:D}=Xs(),[c,x]=d.useState(null),[l,j]=d.useState([]),[n,h]=d.useState([]),{tasks:y,projects:C,teamMembers:E,stakeholders:N,refreshAll:_}=d.useContext(Ds),[k,g]=d.useState(!0),[i,b]=d.useState(!1),[O,T]=d.useState(null),[I,a]=d.useState(!1),w=()=>!c||!E?0:E.findIndex(s=>s.id===c.id),f=()=>c?D?ns(c.name,w(),"Team Member"):c.name:"",W=()=>c?D?tt(c.notes):c.notes:"",v=()=>c?D?at(w(),"TM"):c.name.split(" ").map(s=>s[0]).join(""):"",z=s=>{if(!D)return E.find(B=>String(B.id)===String(s))?.name||"Unknown";const t=E.findIndex(S=>String(S.id)===String(s));return ns("",t,"Team Member")},G=s=>{if(!D)return N.find(B=>String(B.id)===String(s))?.name||"Unknown";const t=N.findIndex(S=>String(S.id)===String(s));return ns("",t,"Stakeholder")},[ae,le]=d.useState(!1),[Oe,de]=d.useState(!1),[we,Ve]=d.useState(null),[re,ie]=d.useState({text:"",referenced_entity:{type:"team_member",id:""}}),[Se,Ce]=d.useState(null),[V,oe]=d.useState({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),[ne,ve]=d.useState({description:"",due_date:"",linked_task_id:"",linked_project_id:"",status:"open"}),[R,ke]=d.useState("none"),[o,F]=d.useState("");d.useState(()=>{try{return JSON.parse(localStorage.getItem("discussedNotes")||"{}")}catch{return{}}});const[se,Be]=d.useState(!1),[$,me]=d.useState({name:"",role:"",email:"",phone:"",department:"",skills:[],notes:""}),[As,Ge]=d.useState(!1),[Ze,os]=d.useState(null),[te,$e]=d.useState({date:"",mood:"good",next_meeting_date:""});d.useEffect(()=>{u&&he()},[u]);const he=async()=>{g(!0);try{const s=await us.get(u);x(s),await _();const t=await Ne.list(),S=(Array.isArray(t)?t:[]).filter(B=>String(B.team_member_id)===String(u));j(S),await Le()}catch(s){M.error("Error loading team member data",{error:String(s)})}finally{g(!1)}},Le=async()=>{try{const s=await Ye.listByTeamMember(u);h(Array.isArray(s)?s:[])}catch(s){M.error("Error loading time off",{error:String(s)}),h([])}},Ts=async()=>{try{await Ne.create({...V,notes:Array.isArray(V.notes)?V.notes:[],team_member_id:u}),le(!1),he()}catch(s){M.error("Error creating 1:1 meeting",{error:String(s)})}},Is=async()=>{if(we)try{const s={...we,action_items:[...we.action_items||[],ne]};await Ne.update(we.id,s),de(!1),he()}catch(s){M.error("Error adding action item",{error:String(s)})}},Os=async s=>{if(!re.text)return;let t=null;R!=="none"&&o&&(t={type:R,id:o});const S=l.find(es=>es.id===s);if(!S)return;const B={text:re.text,referenced_entity:t,created_by:u,timestamp:new Date().toISOString()},ye=Array.isArray(S.notes)?[...S.notes,B]:[B];await Ne.update(s,{...S,notes:ye}),ie({text:"",referenced_entity:{type:"team_member",id:""}}),Ce(null),he()},ms=async(s,t,S)=>{try{const B=l.find(es=>es.id===s);if(!B)return;const ye=[...B.action_items];ye[t]={...ye[t],status:S},await Ne.update(s,{...B,action_items:ye}),he()}catch(B){M.error("Error updating action item status",{error:String(B)})}},Ms=async s=>{try{await Ne.delete(s),he()}catch(t){M.error("Error deleting meeting",{error:String(t)})}},Fs=()=>{c&&(me({name:c.name||"",role:c.role||"",email:c.email||"",phone:c.phone||"",department:c.department||"",skills:Array.isArray(c.skills)?c.skills:[],notes:c.notes||""}),Be(!0))},Ps=async()=>{try{await us.update(u,{name:$.name,email:$.email||null,role:$.role||null,phone:$.phone||null,department:$.department||null,skills:Array.isArray($.skills)?$.skills:[],notes:$.notes||null}),Be(!1),he()}catch(s){M.error("Error updating team member",{error:String(s)})}},zs=s=>{os(s),$e({date:s.date||"",mood:s.mood||"good",next_meeting_date:s.next_meeting_date||""}),Ge(!0)},Ws=async()=>{if(Ze)try{await Ne.update(Ze.id,{...Ze,date:te.date,mood:te.mood,next_meeting_date:te.next_meeting_date||null}),Ge(!1),os(null),he()}catch(s){M.error("Error updating meeting",{error:String(s)})}},Us=async s=>{a(!0);try{O?await Ye.update(O.id,s):await Ye.create(s),await Le(),b(!1),T(null)}catch(t){M.error("Error saving time off",{error:String(t)})}finally{a(!1)}},hs=async s=>{try{await Ye.delete(s),await Le()}catch(t){M.error("Error deleting time off",{error:String(t)})}};if(k)return e.jsx("div",{className:"p-6",children:"Loading..."});if(!c)return e.jsx("div",{className:"p-6",children:"Team member not found"});const Rs=s=>({open:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[s]||"bg-gray-100 text-gray-800",Vs=s=>({great:"",good:"",neutral:"",concerned:""})[s]||"";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(Qs,{to:"/team",children:e.jsxs(m,{variant:"ghost",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Back to Team"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Zs,{className:"h-16 w-16",children:c.avatar&&!D?e.jsx(Ls,{src:c.avatar,alt:f()}):e.jsx(et,{children:v()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:f()}),e.jsx("p",{className:"text-gray-500",children:c.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(yt,{teamMemberId:u}),e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{children:"1:1 Meetings"}),e.jsxs(m,{onClick:()=>le(!0),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"New 1:1"]})]})}),e.jsx(ee,{children:l.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(qs,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No 1:1 meetings recorded yet"})]}):e.jsx("div",{className:"space-y-6",children:l.sort((s,t)=>new Date(t.date)-new Date(s.date)).map(s=>e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[Q(P(s.date),"PPP"),e.jsx("span",{className:"text-xl",children:Vs(s.mood)})]}),e.jsxs(st,{children:["Next meeting: ",s.next_meeting_date?Q(P(s.next_meeting_date),"PPP"):"Not scheduled"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{Ve(s),de(!0)},children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Action Item"]}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>zs(s),title:"Edit meeting",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>Ms(s.id),title:"Delete meeting",children:e.jsx(cs,{className:"h-5 w-5 text-red-500"})})]})]})}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[Array.isArray(s.notes)&&s.notes.filter(t=>t.text&&t.text!=="{}"&&(!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(u))).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),D?e.jsx("p",{className:"text-gray-400 italic",children:"[Meeting notes hidden]"}):e.jsx("ul",{className:"list-disc pl-5",children:s.notes.filter(t=>t.text&&t.text!=="{}"&&(!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(u))).map((t,S)=>e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{children:t.text}),t.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[t.referenced_entity.type==="team_member"&&z(t.referenced_entity.id),t.referenced_entity.type==="stakeholder"&&G(t.referenced_entity.id),t.referenced_entity.type==="project"&&C.find(B=>String(B.id)===String(t.referenced_entity.id))?.name]})]},S))})]}),e.jsxs("div",{className:"mt-2 flex gap-2 items-end",children:[e.jsx(U,{className:"flex-1",placeholder:"Note text...",value:Se===s.id?re.text:"",onChange:t=>{Ce(s.id),ie(S=>({...S,text:t.target.value}))}}),e.jsxs(Y,{value:Se===s.id?R:"none",onValueChange:t=>{Ce(s.id),ke(t),F(""),ie(S=>({...S,referenced_entity:t==="none"?null:{type:t,id:""}}))},children:[e.jsx(H,{className:"w-32",children:e.jsx(K,{placeholder:"No tag"})}),e.jsxs(q,{children:[e.jsx(A,{value:"none",children:"No tag"}),e.jsx(A,{value:"team_member",children:"Team Members"}),e.jsx(A,{value:"stakeholder",children:"Stakeholders"}),e.jsx(A,{value:"project",children:"Projects"})]})]}),R!=="none"&&Se===s.id&&e.jsxs(Y,{value:o,onValueChange:t=>{F(t),ie(S=>({...S,referenced_entity:{type:R,id:t}}))},children:[e.jsx(H,{className:"w-40",children:e.jsx(K,{placeholder:"Select name"})}),e.jsxs(q,{children:[R==="team_member"&&E.filter(t=>t.id.toString()!==u?.toString()).map(t=>e.jsx(A,{value:t.id,children:t.name},t.id)),R==="stakeholder"&&N.map(t=>e.jsx(A,{value:t.id,children:t.name},t.id)),R==="project"&&C.map(t=>e.jsx(A,{value:t.id,children:t.name},t.id))]})]}),e.jsx(m,{onClick:()=>{Ce(s.id),Os(s.id)},disabled:!re.text||R!=="none"&&!o||Se!==s.id,children:"Add"})]}),s.topics_discussed?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Topics Discussed"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.topics_discussed.map((t,S)=>e.jsx(J,{variant:"secondary",children:t},S))})]}),s.action_items?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Action Items"}),D?e.jsx("p",{className:"text-gray-400 italic",children:"[Action items hidden]"}):e.jsxs(rt,{children:[e.jsx(nt,{children:e.jsxs(js,{children:[e.jsx(Ue,{children:"Description"}),e.jsx(Ue,{children:"Due Date"}),e.jsx(Ue,{children:"Status"}),e.jsx(Ue,{children:"Links"}),e.jsx(Ue,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(lt,{children:s.action_items.map((t,S)=>e.jsxs(js,{children:[e.jsx(Re,{children:t.description}),e.jsx(Re,{children:t.due_date?Q(P(t.due_date),"MMM d, yyyy"):"No due date"}),e.jsx(Re,{children:e.jsx(J,{className:Rs(t.status),children:t.status})}),e.jsx(Re,{children:(t.linked_task_id||t.linked_project_id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[t.linked_task_id&&e.jsxs(J,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(xs,{className:"h-3 w-3"}),"Task"]}),t.linked_project_id&&e.jsxs(J,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(xs,{className:"h-3 w-3"}),"Project"]})]})}),e.jsx(Re,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ms(s.id,S,"completed"),disabled:t.status==="completed",children:e.jsx(Te,{className:"h-4 w-4 text-green-500"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ms(s.id,S,"in_progress"),disabled:t.status==="in_progress",children:e.jsx(bs,{className:"h-4 w-4 text-blue-500"})})]})})]},S))})]})]})]})})]},s.id))})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{children:"Team Member Info"}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:Fs,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Edit"]})]})}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[c.department&&e.jsxs("div",{children:[e.jsx(p,{children:"Department"}),e.jsx("p",{className:"text-gray-600",children:c.department})]}),c.skills?.length>0&&e.jsxs("div",{children:[e.jsx(p,{children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:c.skills.map((s,t)=>e.jsx(J,{variant:"secondary",children:s},t))})]}),c.notes&&e.jsxs("div",{children:[e.jsx(p,{children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:W()})]})]})})]}),e.jsxs(X,{children:[e.jsx(Z,{children:e.jsx(L,{children:"Quick Stats"})}),e.jsx(ee,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Last 1:1"}),e.jsx("p",{className:"text-gray-600",children:l[0]?Q(P(l[0].date),"PPP"):"No meetings yet"})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Open Action Items"}),e.jsx("p",{className:"text-gray-600",children:l.reduce((s,t)=>s+(t.action_items?.filter(S=>S.status!=="completed").length||0),0)})]})]})})]}),e.jsx(_t,{teamMemberId:u}),e.jsx(wt,{teamMemberId:u}),e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"h-5 w-5 text-blue-600"}),"Time Off"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{T(null),b(!0)},children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Add"]})]})}),e.jsx(ee,{children:n.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(gs,{className:"h-8 w-8 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No time off recorded"})]}):e.jsxs("div",{className:"space-y-3",children:[n.filter(s=>He(P(s.start_date))||He(P(s.end_date))).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Upcoming"}),e.jsx("div",{className:"space-y-2",children:n.filter(s=>He(P(s.start_date))||He(P(s.end_date))).sort((s,t)=>new Date(s.start_date)-new Date(t.start_date)).map(s=>e.jsx(fs,{timeOff:s,compact:!0,showTeamMember:!1,onEdit:t=>{T(t),b(!0)},onDelete:hs},s.id))})]}),n.filter(s=>ps(P(s.end_date))).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase mb-2",children:"Past"}),e.jsx("div",{className:"space-y-2",children:n.filter(s=>ps(P(s.end_date))).sort((s,t)=>new Date(t.start_date)-new Date(s.start_date)).slice(0,3).map(s=>e.jsx(fs,{timeOff:s,compact:!0,showTeamMember:!1,onEdit:t=>{T(t),b(!0)},onDelete:hs},s.id))})]})]})})]})]})]})]}),e.jsx(ge,{open:ae,onOpenChange:le,children:e.jsxs(ue,{className:"sm:max-w-lg",children:[e.jsxs(je,{children:[e.jsx(pe,{children:"New 1:1 Meeting"}),e.jsxs(Ae,{children:["Record a new one-on-one meeting with ",c?.name||"this team member","."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Date"}),e.jsxs(Fe,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),V.date?Q(P(V.date),"PPP"):"Select date"]})}),e.jsx(ze,{className:"w-auto p-0",children:e.jsx(We,{mode:"single",selected:V.date?P(V.date):void 0,onSelect:s=>oe(t=>({...t,date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Mood"}),e.jsxs(Y,{value:V.mood,onValueChange:s=>oe(t=>({...t,mood:s})),children:[e.jsx(H,{children:e.jsx(K,{})}),e.jsxs(q,{children:[e.jsx(A,{value:"great",children:"Great "}),e.jsx(A,{value:"good",children:"Good "}),e.jsx(A,{value:"neutral",children:"Neutral "}),e.jsx(A,{value:"concerned",children:"Concerned "})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Notes"}),Array.isArray(V.notes)&&V.notes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mb-2",children:V.notes.map((s,t)=>e.jsxs("li",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{children:s.text}),s.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[s.referenced_entity.type==="team_member"&&E.find(S=>S.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="stakeholder"&&N.find(S=>S.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="project"&&C.find(S=>S.id===s.referenced_entity.id)?.name]}),e.jsx(m,{variant:"ghost",size:"xs",className:"ml-2",onClick:()=>oe(S=>({...S,notes:S.notes.filter((B,ye)=>ye!==t)})),children:"Remove"})]},t))}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(U,{className:"flex-1",placeholder:"Note text...",value:re.text,onChange:s=>ie(t=>({...t,text:s.target.value}))}),e.jsxs(Y,{value:R,onValueChange:s=>{ke(s),F(""),ie(t=>({...t,referenced_entity:{type:s,id:""}}))},children:[e.jsx(H,{className:"w-32",children:e.jsx(K,{placeholder:"No tag"})}),e.jsxs(q,{children:[e.jsx(A,{value:"none",children:"No tag"}),e.jsx(A,{value:"team_member",children:"Team Members"}),e.jsx(A,{value:"stakeholder",children:"Stakeholders"}),e.jsx(A,{value:"project",children:"Projects"})]})]}),R!=="none"&&e.jsxs(Y,{value:o,onValueChange:s=>{F(s),ie(t=>({...t,referenced_entity:{type:R,id:s}}))},children:[e.jsx(H,{className:"w-40",children:e.jsx(K,{placeholder:"Select name"})}),e.jsxs(q,{children:[R==="team_member"&&E.filter(s=>s.id!==u).map(s=>e.jsx(A,{value:s.id,children:s.name},s.id)),R==="stakeholder"&&N.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id)),R==="project"&&C.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id))]})]}),e.jsx(m,{onClick:()=>{re.text&&(oe(s=>({...s,notes:[...Array.isArray(s.notes)?s.notes:[],{text:re.text,referenced_entity:R==="none"?{}:{type:R,id:o},created_by:u,timestamp:new Date().toISOString()}]})),ie({text:"",referenced_entity:{type:"team_member",id:""}}),ke("none"),F(""))},disabled:!re.text||R!=="none"&&!o,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Next Meeting Date"}),e.jsxs(Fe,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),V.next_meeting_date?Q(P(V.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(ze,{className:"w-auto p-0",children:e.jsx(We,{mode:"single",selected:V.next_meeting_date?P(V.next_meeting_date):void 0,onSelect:s=>oe(t=>({...t,next_meeting_date:s?.toISOString()}))})})]})]})]}),e.jsxs(fe,{children:[e.jsx(m,{variant:"outline",onClick:()=>le(!1),children:"Cancel"}),e.jsx(m,{onClick:Ts,children:"Create Meeting"})]})]})}),e.jsx(ge,{open:Oe,onOpenChange:de,children:e.jsxs(ue,{className:"sm:max-w-lg",children:[e.jsxs(je,{children:[e.jsx(pe,{children:"Add Action Item"}),e.jsx(Ae,{children:"Create a new action item to track follow-up tasks from this meeting."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Description"}),e.jsx(U,{value:ne.description,onChange:s=>ve(t=>({...t,description:s.target.value})),placeholder:"What needs to be done?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Due Date"}),e.jsxs(Fe,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),ne.due_date?Q(P(ne.due_date),"PPP"):"Set due date"]})}),e.jsx(ze,{className:"w-auto p-0",children:e.jsx(We,{mode:"single",selected:ne.due_date?P(ne.due_date):void 0,onSelect:s=>ve(t=>({...t,due_date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Link to Task (Optional)"}),e.jsxs(Y,{value:ne.linked_task_id,onValueChange:s=>ve(t=>({...t,linked_task_id:s})),children:[e.jsx(H,{children:e.jsx(K,{placeholder:"Select a task"})}),e.jsxs(q,{children:[e.jsx(A,{value:null,children:"None"}),y.map(s=>e.jsx(A,{value:s.id,children:s.title},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Link to Project (Optional)"}),e.jsxs(Y,{value:ne.linked_project_id,onValueChange:s=>ve(t=>({...t,linked_project_id:s})),children:[e.jsx(H,{children:e.jsx(K,{placeholder:"Select a project"})}),e.jsxs(q,{children:[e.jsx(A,{value:null,children:"None"}),C.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs(fe,{children:[e.jsx(m,{variant:"outline",onClick:()=>de(!1),children:"Cancel"}),e.jsx(m,{onClick:Is,children:"Add Action Item"})]})]})}),e.jsx(ge,{open:se,onOpenChange:Be,children:e.jsxs(ue,{className:"sm:max-w-lg",children:[e.jsxs(je,{children:[e.jsx(pe,{children:"Edit Team Member"}),e.jsx(Ae,{children:"Update team member information."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-name",children:"Name"}),e.jsx(U,{id:"edit-name",value:$.name,onChange:s=>me(t=>({...t,name:s.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-role",children:"Role / Position"}),e.jsx(U,{id:"edit-role",value:$.role,onChange:s=>me(t=>({...t,role:s.target.value})),placeholder:"e.g. Product Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-department",children:"Department"}),e.jsx(U,{id:"edit-department",value:$.department,onChange:s=>me(t=>({...t,department:s.target.value})),placeholder:"e.g. Engineering"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-email",children:"Email"}),e.jsx(U,{id:"edit-email",type:"email",value:$.email,onChange:s=>me(t=>({...t,email:s.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-phone",children:"Phone"}),e.jsx(U,{id:"edit-phone",type:"tel",value:$.phone,onChange:s=>me(t=>({...t,phone:s.target.value})),placeholder:"Phone number"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-skills",children:"Skills"}),e.jsx(it,{value:$.skills||[],onChange:s=>me(t=>({...t,skills:s})),placeholder:"Enter skills, press Enter or comma to add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Enter or comma after each skill"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(Ie,{id:"edit-notes",value:$.notes,onChange:s=>me(t=>({...t,notes:s.target.value})),placeholder:"Additional information",rows:3})]})]}),e.jsxs(fe,{children:[e.jsx(m,{variant:"outline",onClick:()=>Be(!1),children:"Cancel"}),e.jsx(m,{onClick:Ps,children:"Update"})]})]})}),e.jsx(ge,{open:As,onOpenChange:Ge,children:e.jsxs(ue,{className:"sm:max-w-lg",children:[e.jsxs(je,{children:[e.jsx(pe,{children:"Edit 1:1 Meeting"}),e.jsx(Ae,{children:"Update meeting details."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Date"}),e.jsxs(Fe,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),te.date?Q(P(te.date),"PPP"):"Select date"]})}),e.jsx(ze,{className:"w-auto p-0",children:e.jsx(We,{mode:"single",selected:te.date?P(te.date):void 0,onSelect:s=>$e(t=>({...t,date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Mood"}),e.jsxs(Y,{value:te.mood,onValueChange:s=>$e(t=>({...t,mood:s})),children:[e.jsx(H,{children:e.jsx(K,{})}),e.jsxs(q,{children:[e.jsx(A,{value:"great",children:"Great "}),e.jsx(A,{value:"good",children:"Good "}),e.jsx(A,{value:"neutral",children:"Neutral "}),e.jsx(A,{value:"concerned",children:"Concerned "})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Next Meeting Date"}),e.jsxs(Fe,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(m,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),te.next_meeting_date?Q(P(te.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(ze,{className:"w-auto p-0",children:e.jsx(We,{mode:"single",selected:te.next_meeting_date?P(te.next_meeting_date):void 0,onSelect:s=>$e(t=>({...t,next_meeting_date:s?.toISOString()}))})})]})]})]}),e.jsxs(fe,{children:[e.jsx(m,{variant:"outline",onClick:()=>Ge(!1),children:"Cancel"}),e.jsx(m,{onClick:Ws,children:"Update Meeting"})]})]})}),e.jsx(vt,{open:i,onOpenChange:s=>{b(s),s||T(null)},onSubmit:Us,initialData:O,preselectedTeamMemberId:u,isLoading:I})]})}export{$t as default};
