import{j as e,Y as M,J as le,a$ as re,al as ne,am as ie,a0 as oe,ar as ce,g as de,N as me,as as he,at as xe,aa as ge,au as ue}from"./chunk-8WlaufA8.js";import{j as je,a as c}from"./chunk-pjYta8vt.js";import{E as w,T as pe,e as ve,B as p,A as ye,b as fe,I as m,g as Ne,i as be,p as we,q as Ce,s as Ae,j as ke,k as $,h as _e,l as Pe,L as o,m as De}from"./index-BK5E59O8.js";import{A as Se}from"./chunk-B6BcMUO9.js";import{A as Fe}from"./chunk-Dm0CwYXu.js";import{T as Te}from"./chunk-DSRmHbBO.js";import{B as x,D as Le,a as Me,b as $e,c as Ee,d as ze}from"./chunk-Cg2ZZDgQ.js";import{S as E,a as z,b as I,c as B,d as h}from"./chunk-DktN3Kjy.js";import{D as Ie,a as Be,b as Re,d as R}from"./chunk-DvQYMAQ6.js";import{T as Ue}from"./chunk-UjCvYLMJ.js";import{A as Ve}from"./chunk-cjCmUzJ1.js";import"./chunk-BQPSriyy.js";import"./chunk-BdHZTqfh.js";import"./chunk-Bw8oe1_L.js";function ra(){const U=je(),[Oe,V]=c.useState([]),[k,O]=c.useState([]),[v,q]=c.useState([]),[qe,H]=c.useState({}),[d,Q]=c.useState(""),[Y,g]=c.useState(!1),[y,_]=c.useState(null),[G,P]=c.useState(!0),[D,f]=c.useState(null),[r,N]=c.useState({name:"",role:"",email:"",phone:"",department:"",organization:"",collaboration_context:"",relationship_type:"cross_team",availability:"full_time",skills:[],notes:"",avatar:""});c.useEffect(()=>{C()},[]);const C=async()=>{P(!0),f(null);try{const[a,t,s]=await Promise.all([w.list().catch(()=>[]),pe.list().catch(()=>[]),ve.list().catch(()=>[])]);V(t||[]),q(s||[]);let n={};try{n=await Se.getAgendaSummaryForAllPeers?.()||{}}catch(u){console.error("Failed to load agenda data:",u)}H(n);const l=(a||[]).map(u=>{const b=(t||[]).filter(j=>(j.metadata?.meeting?.participants||[]).includes(u.name));let A=null;b.length>0&&(A=b.reduce((j,te)=>{const L=new Date(te.created_date);return!j||L>j?L:j},null));const se=n[u.id]||{count:0,recentItems:[],hasUnresolved:!1};return{...u,tasks:b,taskCount:b.length,lastActivity:A?A.toISOString():null,agenda:se}});O(l)}catch(a){console.error("Failed to load peers:",a),f("Failed to load peers. Please try again.")}finally{P(!1)}},S=()=>{N({name:"",role:"",email:"",phone:"",department:"",organization:"",collaboration_context:"",relationship_type:"cross_team",availability:"full_time",skills:[],notes:"",avatar:""}),_(null),g(!0)},J=a=>{a&&(N({name:a.name||"",role:a.role||"",email:a.email||"",phone:a.phone||"",department:a.department||"",organization:a.organization||"",collaboration_context:a.collaboration_context||"",relationship_type:a.relationship_type||"cross_team",availability:a.availability||"full_time",skills:Array.isArray(a.skills)?a.skills:[],notes:a.notes||"",avatar:a.avatar||""}),_(a),g(!0))},i=(a,t)=>{if(a==="skills"){const s=Array.isArray(t)?t:[];N(n=>({...n,[a]:s}))}else N(s=>({...s,[a]:t}))},K=async()=>{try{y?await w.update(y.id,r):await w.create(r),g(!1),await C()}catch(a){console.error("Failed to save peer:",a),f("Failed to save peer. Please try again.")}},W=async a=>{try{await w.delete(a),await C()}catch(t){console.error("Failed to delete peer:",t),f("Failed to delete peer. Please try again.")}},F=d?k.filter(a=>a.name.toLowerCase().includes(d.toLowerCase())||(a.role||"").toLowerCase().includes(d.toLowerCase())||(a.department||"").toLowerCase().includes(d.toLowerCase())||(a.organization||"").toLowerCase().includes(d.toLowerCase())||(a.collaboration_context||"").toLowerCase().includes(d.toLowerCase())||(a.relationship_type||"").toLowerCase().includes(d.toLowerCase())||Array.isArray(a.skills)&&a.skills.some(t=>t.toLowerCase().includes(d.toLowerCase()))):k,X=a=>a.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2),Z=a=>{const t=["bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-purple-100 text-purple-800","bg-pink-100 text-pink-800","bg-yellow-100 text-yellow-800","bg-indigo-100 text-indigo-800","bg-red-100 text-red-800","bg-orange-100 text-orange-800"],s=a.split("").reduce((n,l)=>n+l.charCodeAt(0),0)%t.length;return t[s]},ee=a=>{if(!a)return"No recent activity";const t=new Date(a),n=new Date-t,l=Math.floor(n/(1e3*60*60*24));return l===0?"Today":l===1?"Yesterday":l<7?`${l} days ago`:l<30?`${Math.floor(l/7)} week${Math.floor(l/7)>1?"s":""} ago`:l<365?`${Math.floor(l/30)} month${Math.floor(l/30)>1?"s":""} ago`:`${Math.floor(l/365)} year${Math.floor(l/365)>1?"s":""} ago`},ae=a=>{const t={full_time:"bg-green-100 text-green-800",part_time:"bg-blue-100 text-blue-800",contractor:"bg-orange-100 text-orange-800",remote:"bg-purple-100 text-purple-800"},s={full_time:"Full-time",part_time:"Part-time",contractor:"Contractor",remote:"Remote"};return e.jsx(x,{className:t[a]||"bg-gray-100 text-gray-800",children:s[a]||a})},T=a=>{U(De("PeerProfile")+`?id=${a}`)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Peers"}),e.jsxs(p,{onClick:S,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Add Peer"]})]}),D&&e.jsx(ye,{variant:"destructive",className:"mb-6",children:e.jsx(fe,{children:D})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(m,{placeholder:"Search peers by name, role, organization, department, context, or skills...",value:d,onChange:a=>Q(a.target.value),className:"pl-9"})]}),G?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading peers..."})]}):F.length===0?e.jsx("div",{className:"text-center p-12 border border-dashed rounded-lg",children:d?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No peers found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search term"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No peers yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add peers to track cross-team and external collaborators"}),e.jsxs(p,{onClick:S,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Add First Peer"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:F.map(a=>{const t=Z(a.name);return e.jsxs(Ne,{className:"overflow-hidden",children:[e.jsxs(be,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 cursor-pointer group",onClick:()=>T(a.id),children:[e.jsxs(we,{className:`h-12 w-12 ${a.avatar?"":t} ring-2 ring-white transition-transform group-hover:scale-105`,children:[a.avatar?e.jsx(Ce,{src:a.avatar,alt:a.name}):null,e.jsx(Ae,{children:X(a.name)})]}),e.jsxs("div",{children:[e.jsx(ke,{className:"group-hover:text-indigo-600 transition-colors",children:a.name}),a.role&&e.jsx($,{className:"mt-1",children:a.role}),a.organization&&e.jsxs($,{className:"mt-1 flex items-center gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),a.organization]})]})]}),e.jsxs(Ie,{children:[e.jsx(Be,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ne,{className:"h-4 w-4"})})}),e.jsxs(Re,{align:"end",children:[e.jsxs(R,{onClick:()=>J(a),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(R,{onClick:()=>W(a.id),className:"text-red-600",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[a.department&&e.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),a.department]}),a.relationship_type&&e.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),a.relationship_type.replace(/_/g," ")]}),a.collaboration_context&&e.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),a.collaboration_context]}),a.availability&&ae(a.availability),a.agenda&&e.jsx(Fe,{count:a.agenda.count,unresolvedCount:a.agenda.hasUnresolved?a.agenda.count:0,hasUnresolved:a.agenda.hasUnresolved,onClick:()=>T(a.id),memberName:a.name,size:"sm"})]})]}),e.jsxs(_e,{className:"space-y-4",children:[Array.isArray(a.skills)&&a.skills.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(he,{className:"h-3.5 w-3.5"}),"Skills"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Array.isArray(a.skills)&&a.skills.map((s,n)=>e.jsx(x,{variant:"outline",className:"text-xs",children:s},n))})]}),a.notes&&e.jsx("p",{className:"text-sm text-gray-600",children:a.notes}),Array.isArray(a.tasks)&&a.tasks.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Recent Meetings"}),e.jsx("div",{className:"space-y-2",children:a.tasks.filter(s=>s.type==="meeting").sort((s,n)=>new Date(n.created_date)-new Date(s.created_date)).slice(0,2).map(s=>e.jsx("div",{className:"p-2 bg-gray-50 rounded-md text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"truncate",children:s.title}),e.jsxs(x,{variant:"outline",className:"ml-2 flex items-center gap-1 whitespace-nowrap",children:[e.jsx(xe,{className:"h-3 w-3"}),s.status]})]})},s.id))})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),ee(a.lastActivity)]}),a.taskCount>0&&e.jsxs("span",{children:[a.taskCount," meetings"]})]}),v.length>0&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-2",children:"Add to team member agendas:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[v.slice(0,2).map(s=>e.jsx(Ve,{teamMemberId:s.id,teamMemberName:s.name,sourceItem:{title:`Peer: ${a.name}`,description:`${a.role?`${a.role} - `:""}${a.organization||""}${a.collaboration_context?` | Context: ${a.collaboration_context}`:""}${a.notes?` | ${a.notes}`:""}`,type:"peer",id:a.id,relationship_type:a.relationship_type,department:a.department},variant:"ghost",size:"xs",showAgendaAction:!0,showPersonalFileAction:!0},s.id)),v.length>2&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",v.length-2," more"]})]})]})]}),a.email&&e.jsx(Pe,{className:"border-t pt-4",children:e.jsxs("a",{href:`mailto:${a.email}`,className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),a.email]})})]},a.id)})})]}),e.jsx(Le,{open:Y,onOpenChange:g,children:e.jsxs(Me,{className:"sm:max-w-md",children:[e.jsx($e,{children:e.jsx(Ee,{children:y?"Edit Peer":"Add Peer"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",children:"Name"}),e.jsx(m,{id:"name",value:r.name,onChange:a=>i("name",a.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"role",children:"Role / Position"}),e.jsx(m,{id:"role",value:r.role,onChange:a=>i("role",a.target.value),placeholder:"e.g. Product Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"department",children:"Department"}),e.jsx(m,{id:"department",value:r.department,onChange:a=>i("department",a.target.value),placeholder:"e.g. Engineering"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"organization",children:"Group"}),e.jsx(m,{id:"organization",value:r.organization,onChange:a=>i("organization",a.target.value),placeholder:"e.g. Acme Corp"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email",children:"Email"}),e.jsx(m,{id:"email",type:"email",value:r.email,onChange:a=>i("email",a.target.value),placeholder:"Email address"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"phone",children:"Phone"}),e.jsx(m,{id:"phone",type:"tel",value:r.phone,onChange:a=>i("phone",a.target.value),placeholder:"Phone number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"relationship_type",children:"Relationship Type"}),e.jsxs(E,{value:r.relationship_type,onValueChange:a=>i("relationship_type",a),children:[e.jsx(z,{children:e.jsx(I,{placeholder:"Select relationship type"})}),e.jsxs(B,{children:[e.jsx(h,{value:"cross_team",children:"Cross-team"}),e.jsx(h,{value:"external_partner",children:"External Partner"}),e.jsx(h,{value:"client_contact",children:"Client Contact"}),e.jsx(h,{value:"contractor",children:"Contractor"}),e.jsx(h,{value:"other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"collaboration_context",children:"Collaboration Context"}),e.jsx(m,{id:"collaboration_context",value:r.collaboration_context,onChange:a=>i("collaboration_context",a.target.value),placeholder:"e.g. Project Apollo, Vendor Management"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"availability",children:"Availability"}),e.jsxs(E,{value:r.availability,onValueChange:a=>i("availability",a),children:[e.jsx(z,{children:e.jsx(I,{placeholder:"Select availability"})}),e.jsxs(B,{children:[e.jsx(h,{value:"full_time",children:"Full-time"}),e.jsx(h,{value:"part_time",children:"Part-time"}),e.jsx(h,{value:"contractor",children:"Contractor"}),e.jsx(h,{value:"remote",children:"Remote"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"skills",children:"Skills"}),e.jsx(Ue,{value:r.skills||[],onChange:a=>i("skills",a),placeholder:"Enter skills, press Enter or comma to add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Enter or comma after each skill"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"avatar",children:"Avatar URL (optional)"}),e.jsx(m,{id:"avatar",value:r.avatar,onChange:a=>i("avatar",a.target.value),placeholder:"https://example.com/avatar.jpg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"notes",children:"Notes"}),e.jsx(Te,{id:"notes",value:r.notes,onChange:a=>i("notes",a.target.value),placeholder:"Additional information about this peer",rows:3})]})]}),e.jsxs(ze,{children:[e.jsx(p,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(p,{onClick:K,children:y?"Update":"Add"})]})]})})]})}export{ra as default};
