import{j as e,U as ye,c2 as Z,a$ as ve,T as ee,az as se,b0 as Ne,c3 as be,L as ae,c4 as Se}from"./chunk-WPKCbDK8.js";import{a as o}from"./chunk-BKwDNIOR.js";import{ae as I,C as te,g as q,h as ne,i as re,j as ie,af as M,B as _,I as U,ag as T,A as Ce,ah as B,L as j,ai as z,t as _e,m as we}from"./index-B5nMAt-E.js";import{T as ke,a as De,b as Te}from"./chunk-CqsX0BiM.js";import{B as O}from"./chunk-zVvAqB5a.js";import{D as le,a as ce,b as V,c as K,e as $,d as G}from"./chunk-g5LiUroS.js";import{A as Ae,b as Fe,c as Ee,d as Le,e as Ie,f as Me,g as Oe,h as Ue}from"./chunk-Cdp4fw9y.js";import{S as A,a as F,b as E,c as L,d as k}from"./chunk-CRMqQcWA.js";import{g as de,l as Re,h as oe}from"./chunk-DRrmMohU.js";import{A as Ve,a as Ke,b as $e,c as Be}from"./chunk-CiXz4qex.js";import{e as Pe,C as He,u as qe,a as Y,s as ze,K as Ge,P as Ye,D as Je,c as Qe,S as We,v as Xe,d as Ze}from"./chunk-Sjx62m6H.js";import{C as es}from"./chunk-BJfv4D2P.js";import{b as ss,p as as}from"./chunk-DGs6foQ1.js";import"./chunk-BwuEqr1N.js";function ts({value:s,onValueChange:c}){return e.jsx(ke,{value:s,onValueChange:c,children:e.jsx(De,{children:I.map(t=>e.jsx(Te,{value:t.id,children:t.label},t.id))})})}const J={not_started:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",blocked:"bg-red-100 text-red-800",done:"bg-green-100 text-green-800"},Q={not_started:"Not Started",in_progress:"In Progress",blocked:"Blocked",done:"Done"};function ns({item:s,onClick:c}){const t=()=>{c&&c(s)};return e.jsxs(te,{className:q("shadow-sm hover:shadow-md transition-shadow",c&&"cursor-pointer"),onClick:t,children:[e.jsx(ne,{className:"pb-3",children:e.jsx(re,{className:"text-sm font-medium line-clamp-2",children:s.name})}),e.jsxs(ie,{className:"space-y-2",children:[e.jsx("div",{children:e.jsx(O,{className:q("text-xs",J[s.sync_status]||J.not_started),children:Q[s.sync_status]||Q.not_started})}),s.assigned_to_name&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:s.assigned_to_name})]}),s.subtask_count>0&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:[s.subtask_count," subtask",s.subtask_count!==1?"s":""]})]})]})]})}function rs({itemsByCategory:s,onItemClick:c}){return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:M.map(t=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-sm uppercase tracking-wide text-gray-600",children:t.label}),e.jsx(O,{variant:"secondary",children:(s[t.id]||[]).length})]}),e.jsxs("div",{className:"space-y-3 flex-1 min-h-[200px] bg-gray-50 rounded-lg p-3",children:[(s[t.id]||[]).map(d=>e.jsx(ns,{item:d,onClick:c},d.id)),(s[t.id]||[]).length===0&&e.jsx("p",{className:"text-sm text-gray-400 text-center py-8",children:"No items"})]})]},t.id))})}function is({subtask:s,onToggle:c,onDelete:t}){const{attributes:d,listeners:g,setNodeRef:x,transform:p,transition:f,isDragging:u}=Pe({id:s.id}),r={transform:He.Transform.toString(p),transition:f,opacity:u?.5:1};return e.jsxs("div",{ref:x,style:r,className:"flex items-center gap-2 p-2 bg-white border rounded hover:bg-gray-50",children:[e.jsx("button",{...d,...g,className:"cursor-grab touch-none text-gray-400 hover:text-gray-600",type:"button",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(es,{checked:s.completed,onCheckedChange:()=>c(s.id),id:`subtask-${s.id}`}),e.jsx("label",{htmlFor:`subtask-${s.id}`,className:`flex-1 text-sm cursor-pointer ${s.completed?"line-through text-gray-400":""}`,children:s.title}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6 text-gray-400 hover:text-red-500",onClick:()=>t(s.id),type:"button",children:e.jsx(ee,{className:"h-3 w-3"})})]})}function ls({subtasks:s,onToggle:c,onDelete:t,onReorder:d,onAdd:g}){const[x,p]=o.useState(""),f=qe(Y(Ye),Y(Ge,{coordinateGetter:ze})),u=h=>{const{active:y,over:v}=h;if(y.id!==v?.id){const n=s.findIndex(m=>m.id===y.id),l=s.findIndex(m=>m.id===v.id),i=Ze(s,n,l);d(i.map(m=>m.id))}},r=h=>{h.key==="Enter"&&x.trim()&&(h.preventDefault(),g(x.trim()),p(""))};return e.jsxs("div",{className:"space-y-2",children:[s.length>0?e.jsx(Je,{sensors:f,collisionDetection:Qe,onDragEnd:u,children:e.jsx(We,{items:s.map(h=>h.id),strategy:Xe,children:e.jsx("div",{className:"space-y-1",children:s.map(h=>e.jsx(is,{subtask:h,onToggle:c,onDelete:t},h.id))})})}):e.jsx("p",{className:"text-sm text-gray-500 py-2",children:"No subtasks yet"}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",children:[e.jsx(se,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),e.jsx(U,{value:x,onChange:h=>p(h.target.value),onKeyDown:r,placeholder:"Add subtask and press Enter...",className:"border-0 shadow-none focus-visible:ring-0 h-8"})]})]})}function W({itemId:s,isNewItem:c}){const[t,d]=o.useState([]),[g,x]=o.useState(!1);o.useEffect(()=>{s&&!c?p():d([])},[s,c]);const p=async()=>{try{x(!0);const n=await T.listSubtasks(s);d(n||[])}catch(n){console.error("Failed to load subtasks:",n),d([])}finally{x(!1)}},f=o.useCallback(async n=>{const l=t.find(i=>i.id===n);if(l){d(i=>i.map(m=>m.id===n?{...m,completed:!m.completed}:m));try{await T.updateSubtask(s,n,{completed:!l.completed})}catch(i){console.error("Failed to toggle subtask:",i),d(m=>m.map(b=>b.id===n?{...b,completed:l.completed}:b))}}},[s,t]),u=o.useCallback(async n=>{const l=t.find(i=>i.id===n);d(i=>i.filter(m=>m.id!==n));try{await T.deleteSubtask(s,n)}catch(i){console.error("Failed to delete subtask:",i),l&&d(m=>[...m,l].sort((b,S)=>b.sort_order-S.sort_order))}},[s,t]),r=o.useCallback(async n=>{const l=n.map((i,m)=>({...t.find(S=>S.id===i),sort_order:m}));d(l);try{await T.reorderSubtasks(s,n)}catch(i){console.error("Failed to reorder subtasks:",i),await p()}},[s,t]),h=o.useCallback(async n=>{try{const l=await T.createSubtask(s,{title:n});d(i=>[...i,l])}catch(l){console.error("Failed to add subtask:",l)}},[s]),y=t.filter(n=>n.completed).length,v=t.length;return c?e.jsx("div",{className:"text-sm text-gray-500 italic py-4 border-t",children:"Save the item first to add subtasks"}):e.jsx(Ve,{type:"single",collapsible:!0,defaultValue:"subtasks",className:"border-t",children:e.jsxs(Ke,{value:"subtasks",className:"border-b-0",children:[e.jsx($e,{className:"py-3 hover:no-underline",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Subtasks"}),v>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",y,"/",v,")"]})]})}),e.jsx(Be,{children:g?e.jsx("p",{className:"text-sm text-gray-500 py-2",children:"Loading..."}):e.jsx(ls,{subtasks:t,onToggle:f,onDelete:u,onReorder:r,onAdd:h})})]})})}function cs(){const s=de();return Re(s.id,3).map(t=>({id:t.id,label:oe(t.id,!0)}))}function ds(){const s=de();return s.currentSprint?.id||`${s.id}a`}function os({open:s,onOpenChange:c,item:t,onSave:d,onDelete:g}){const{teamMembers:x}=o.useContext(Ce),{currentTeam:p}=B(),[f,u]=o.useState("view"),[r,h]=o.useState({name:"",category:"goal",team_department:"all",sync_status:"not_started",assigned_to:"",sprint_id:"",description:""}),[y,v]=o.useState(!1),[n,l]=o.useState({}),[i,m]=o.useState(!1),[b,S]=o.useState(!1),N=cs();o.useEffect(()=>{s&&(t?(h({name:t.name||"",category:t.category||"goal",team_department:t.team_department||"all",sync_status:t.sync_status||"not_started",assigned_to:t.assigned_to||"",sprint_id:t.sprint_id||"",description:t.description||""}),u("view")):(h({name:"",category:M[0].id,team_department:p!=="all"?p:I[1].id,sync_status:"not_started",assigned_to:"",sprint_id:ds(),description:""}),u("edit")),v(!1),l({}))},[s,t?.id,p]);const w=(a,C)=>{h(D=>({...D,[a]:C})),v(!0),n[a]&&l(D=>({...D,[a]:""}))},me=()=>{const a={};return r.name.trim()||(a.name="Title is required"),r.category||(a.category="Category is required"),r.team_department||(a.team_department="Team is required"),l(a),Object.keys(a).length===0},P=async a=>{if(a?.preventDefault(),!!me()){m(!0);try{const C={name:r.name.trim(),category:r.category,team_department:r.team_department,sync_status:r.sync_status,assigned_to:r.assigned_to||null,sprint_id:r.sprint_id||null,description:r.description.trim()||null};await d(C),c(!1)}catch(C){console.error("Failed to save sync item:",C)}finally{m(!1)}}},H=a=>{!a&&y&&f==="edit"?S(!0):c(a)},he=()=>{S(!1),v(!1),c(!1)},xe=async()=>{g&&t?.id&&await g(t.id)},R=(a,C)=>a.find(fe=>fe.id===C)?.label||C||"None",ue=a=>a?x?.find(D=>D.id===a)?.name||"Unknown":"Unassigned",pe=a=>a?oe(a,!0):"None",je=()=>e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(K,{className:"text-xl",children:r.name}),e.jsx($,{children:"Sync item details"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-sm text-muted-foreground",children:"Category"}),e.jsx("p",{className:"mt-1 font-medium",children:R(M,r.category)})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm text-muted-foreground",children:"Team"}),e.jsx("p",{className:"mt-1 font-medium",children:R(I,r.team_department)})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("p",{className:"mt-1 font-medium",children:R(z,r.sync_status)})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-sm text-muted-foreground",children:"Assigned To"}),e.jsx("p",{className:"mt-1 font-medium",children:ue(r.assigned_to)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(j,{className:"text-sm text-muted-foreground",children:"Sprint"}),e.jsx("p",{className:"mt-1 font-medium",children:pe(r.sprint_id)})]})]}),r.description&&e.jsxs("div",{children:[e.jsx(j,{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"mt-1 whitespace-pre-wrap",children:r.description})]})]}),e.jsx(W,{itemId:t?.id,isNewItem:!t}),e.jsxs(G,{className:"gap-2",children:[g&&e.jsxs(_,{variant:"destructive",onClick:xe,className:"mr-auto",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Delete"]}),e.jsx(_,{variant:"outline",onClick:()=>c(!1),children:"Close"}),e.jsxs(_,{onClick:()=>u("edit"),children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Edit"]})]})]}),ge=()=>e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(K,{children:t?"Edit Sync Item":"Create Sync Item"}),e.jsx($,{children:t?"Update the sync item details.":"Add a new sync item to track."})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"name",children:"Title *"}),e.jsx(U,{id:"name",placeholder:"Enter sync item title",value:r.name,onChange:a=>w("name",a.target.value),disabled:i,className:n.name?"border-destructive":""}),n.name&&e.jsx("p",{className:"text-sm text-destructive",children:n.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"category",children:"Category *"}),e.jsxs(A,{value:r.category,onValueChange:a=>w("category",a),disabled:i,children:[e.jsx(F,{className:n.category?"border-destructive":"",children:e.jsx(E,{placeholder:"Select category"})}),e.jsx(L,{children:M.map(a=>e.jsx(k,{value:a.id,children:a.label},a.id))})]}),n.category&&e.jsx("p",{className:"text-sm text-destructive",children:n.category})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"team_department",children:"Team *"}),e.jsxs(A,{value:r.team_department,onValueChange:a=>w("team_department",a),disabled:i,children:[e.jsx(F,{className:n.team_department?"border-destructive":"",children:e.jsx(E,{placeholder:"Select team"})}),e.jsx(L,{children:I.filter(a=>a.id!=="all").map(a=>e.jsx(k,{value:a.id,children:a.label},a.id))})]}),n.team_department&&e.jsx("p",{className:"text-sm text-destructive",children:n.team_department})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"sync_status",children:"Status"}),e.jsxs(A,{value:r.sync_status,onValueChange:a=>w("sync_status",a),disabled:i,children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Select status"})}),e.jsx(L,{children:z.map(a=>e.jsx(k,{value:a.id,children:a.label},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"assigned_to",children:"Assigned To"}),e.jsxs(A,{value:r.assigned_to||"unassigned",onValueChange:a=>w("assigned_to",a==="unassigned"?"":a),disabled:i,children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Select team member"})}),e.jsxs(L,{children:[e.jsx(k,{value:"unassigned",children:"Unassigned"}),(x||[]).map(a=>e.jsx(k,{value:a.id,children:a.name},a.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"sprint_id",children:"Sprint"}),e.jsxs(A,{value:r.sprint_id||"none",onValueChange:a=>w("sprint_id",a==="none"?"":a),disabled:i,children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Select sprint"})}),e.jsxs(L,{children:[e.jsx(k,{value:"none",children:"No Sprint"}),N.map(a=>e.jsx(k,{value:a.id,children:a.label},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"description",children:"Description"}),e.jsx(_e,{id:"description",placeholder:"Add additional details or context...",value:r.description,onChange:a=>w("description",a.target.value),disabled:i,rows:3})]})]}),e.jsx(W,{itemId:t?.id,isNewItem:!t}),e.jsxs(G,{children:[e.jsx(_,{variant:"outline",onClick:()=>H(!1),disabled:i,children:"Cancel"}),e.jsx(_,{onClick:P,disabled:i,children:i?"Saving...":t?"Update":"Create"})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(le,{open:s,onOpenChange:H,children:e.jsx(ce,{className:"sm:max-w-[600px]",children:f==="view"?je():ge()})}),e.jsx(Ae,{open:b,onOpenChange:S,children:e.jsxs(Fe,{children:[e.jsxs(Ee,{children:[e.jsx(Le,{children:"Discard changes?"}),e.jsx(Ie,{children:"You have unsaved changes. Are you sure you want to discard them?"})]}),e.jsxs(Me,{children:[e.jsx(Oe,{children:"Keep Editing"}),e.jsx(Ue,{onClick:he,children:"Discard"})]})]})})]})}function X(s,c){return s.find(d=>d.id===c)?.label||c||"Unknown"}function ms({item:s,onRestore:c}){const t=s.archived_at?ss(as(s.archived_at),"MMM d, yyyy"):"Unknown date";return e.jsxs(te,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(ne,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx(re,{className:"text-base font-medium line-clamp-1",children:s.name}),e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>c(s.id),className:"shrink-0",children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Restore"]})]}),s.description&&e.jsx(we,{className:"line-clamp-2",children:s.description})]}),e.jsx(ie,{className:"pt-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(O,{variant:"secondary",children:X(M,s.category)}),e.jsx(O,{variant:"outline",children:X(I,s.team_department)}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:["Archived: ",t]})]})})]})}function hs({open:s,onOpenChange:c}){const{loadArchivedItems:t,archivedItems:d,restoreItem:g}=B(),[x,p]=o.useState(""),[f,u]=o.useState(""),[r,h]=o.useState(!1);o.useEffect(()=>{s&&(h(!0),t({from_date:x||void 0,to_date:f||void 0}).finally(()=>h(!1)))},[s,x,f,t]);const y=o.useCallback(async l=>{try{await g(l)}catch(i){console.error("Failed to restore item:",i)}},[g]),v=l=>{l||(p(""),u("")),c(l)},n=d?.length||0;return e.jsx(le,{open:s,onOpenChange:v,children:e.jsxs(ce,{className:"sm:max-w-[600px]",children:[e.jsxs(V,{children:[e.jsx(K,{children:"Archived Items"}),e.jsx($,{children:r?"Loading archived items...":n===0?"No archived items found":`Showing ${n} archived item${n===1?"":"s"}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"from_date",children:"From Date"}),e.jsx(U,{id:"from_date",type:"date",value:x,onChange:l=>p(l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"to_date",children:"To Date"}),e.jsx(U,{id:"to_date",type:"date",value:f,onChange:l=>u(l.target.value)})]})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto space-y-3",children:r?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ae,{className:"h-6 w-6 animate-spin text-indigo-600"})}):n===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No archived items match the selected filters."}):d.map(l=>e.jsx(ms,{item:l,onRestore:y},l.id))})]})})}function ks(){const{itemsByCategory:s,currentTeam:c,setCurrentTeam:t,archivedCount:d,loading:g,createItem:x,updateItem:p,deleteItem:f}=B(),[u,r]=o.useState(null),[h,y]=o.useState(!1),[v,n]=o.useState(!1),l=N=>{r(N),y(!0)},i=()=>{r(null),y(!0)},m=async N=>{u?await p(u.id,N):await x(N)},b=async N=>{await f(N),y(!1)},S=N=>{y(N),N||r(null)};return g?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ae,{className:"h-8 w-8 animate-spin text-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Team Sync"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Track team goals, blockers, and dependencies"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{variant:"outline",onClick:()=>n(!0),children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Archive",d>0&&e.jsx(O,{variant:"secondary",className:"ml-2",children:d})]}),e.jsx(ts,{value:c,onValueChange:t}),e.jsxs(_,{onClick:i,children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Add"]})]})]}),e.jsx(rs,{itemsByCategory:s,onItemClick:l}),e.jsx(os,{open:h,onOpenChange:S,item:u,onSave:m,onDelete:u?b:void 0}),e.jsx(hs,{open:v,onOpenChange:n})]})}export{ks as default};
