import{j as e,_ as D,N as $,ac as J,ad as q,ae as W,h as X}from"./chunk-CDfVSsCp.js";import{a as o}from"./chunk-pjYta8vt.js";import{A as Y,u as Z,B as d,I as c,C as E,L as i,S as L,l as z,g as ee,h as ae,f as se}from"./index-CjGPc2b_.js";import{a as ne,b as le,c as te}from"./chunk-uiVOWrDz.js";import{B as N,D as re,e as ie,f as ce,g as oe,S as B,a as U,b as F,c as I,d as u,h as de}from"./chunk-2Vqr1Avx.js";import{A as me,a as ge,b as xe,c as pe}from"./chunk-BaBIjyPE.js";import"./chunk-DGzW4aIb.js";function Se(){const{stakeholders:v,loading:P,refreshAll:M}=o.useContext(Y),{isPresentationMode:h}=Z(),[C,G]=o.useState([]),[V,x]=o.useState(!1),[b,K]=o.useState(""),[S,f]=o.useState(null),[p,_]=o.useState(null),[m,y]=o.useState("flat"),[t,r]=o.useState({name:"",role:"",email:"",phone:"",company:"",influence_level:"medium",engagement_level:"active",contact_info:"",notes:"",tags:[],department:"",stakeholder_group:""});o.useEffect(()=>{G(Array.isArray(v)?v:[])},[v]);const T=async()=>{f(null);try{await M()}catch(a){z.error("Failed to refresh stakeholders",{error:String(a)}),f("Failed to load stakeholders")}},H=()=>{r({name:"",role:"",email:"",phone:"",company:"",influence_level:"medium",engagement_level:"active",contact_info:"",notes:"",tags:[],department:"",stakeholder_group:""}),_(null),x(!0)},O=a=>{r({name:a.name||"",role:a.role||"",email:a.email||"",phone:a.phone||"",company:a.company||a.organization||"",influence_level:a.influence_level||a.influence||"medium",engagement_level:a.engagement_level||"active",contact_info:a.contact_info||"",notes:a.notes||a.description||"",tags:Array.isArray(a.tags)?a.tags:[],department:a.department||"",stakeholder_group:a.stakeholder_group||""}),_(a),x(!0)},R=async()=>{try{p?await L.update(p.id,t):await L.create(t),x(!1),T()}catch(a){z.error(`Failed to ${p?"update":"create"} stakeholder`,{error:String(a)}),f(`Failed to ${p?"update":"create"} stakeholder`)}};if(P)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading stakeholders..."})]})});const j=(C||[]).filter(a=>{if(!a)return!1;const s=(b||"").toLowerCase(),g=(a.name||"").toLowerCase(),n=(a.role||"").toLowerCase(),l=(a.company||a.organization||"").toLowerCase(),k=(a.department||"").toLowerCase(),Q=(a.stakeholder_group||"").toLowerCase();return g.includes(s)||n.includes(s)||l.includes(s)||k.includes(s)||Q.includes(s)}),w=m==="department"?(a=>{const s={};return a.forEach(n=>{const l=n.department||"Unassigned";s[l]||(s[l]=[]),s[l].push(n)}),Object.keys(s).sort((n,l)=>n==="Unassigned"?1:l==="Unassigned"?-1:n.localeCompare(l)).map(n=>({label:n,items:s[n]}))})(j):m==="group"?(a=>{const s={};return a.forEach(n=>{const l=n.stakeholder_group||"Unassigned";s[l]||(s[l]=[]),s[l].push(n)}),Object.keys(s).sort((n,l)=>n==="Unassigned"?1:l==="Unassigned"?-1:n.localeCompare(l)).map(n=>({label:n,items:s[n]}))})(j):null,A=(a,s)=>{const g=h?ne(a.name,s,"Stakeholder"):a.name||"Unnamed Stakeholder",n=h?le(a.email):a.email,l=h?te(a.notes||a.description):a.notes||a.description;return e.jsxs(E,{children:[e.jsxs(ee,{children:[e.jsx(ae,{children:g}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(N,{className:(a.influence_level||a.influence)==="high"?"bg-red-100 text-red-800":(a.influence_level||a.influence)==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800",children:[a.influence_level||a.influence||"medium"," influence"]}),e.jsx(N,{className:a.engagement_level==="active"?"bg-green-100 text-green-800":a.engagement_level==="passive"?"bg-gray-100 text-gray-800":"bg-orange-100 text-orange-800",children:a.engagement_level||"active"})]})]}),e.jsxs(se,{children:[a.role&&e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:a.role}),(a.company||a.organization)&&e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:a.company||a.organization}),a.department&&e.jsxs("p",{className:"text-sm text-gray-500 mb-1",children:["Dept: ",a.department]}),a.stakeholder_group&&e.jsxs("p",{className:"text-sm text-gray-500 mb-1",children:["Group: ",a.stakeholder_group]}),a.email&&e.jsx("p",{className:h?"text-sm text-gray-400 mb-1":"text-sm text-blue-600 mb-1",children:n}),(a.notes||a.description)&&e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:l}),e.jsx(d,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>O(a),children:"Edit"})]})]},a.id||Math.random())};return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Stakeholders"}),e.jsxs(d,{onClick:H,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add Stakeholder"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(c,{placeholder:"Search stakeholders...",value:b,onChange:a=>K(a.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-1 border rounded-md p-1",children:[e.jsxs(d,{size:"sm",variant:m==="flat"?"default":"ghost",onClick:()=>y("flat"),children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Flat"]}),e.jsxs(d,{size:"sm",variant:m==="department"?"default":"ghost",onClick:()=>y("department"),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Dept"]}),e.jsxs(d,{size:"sm",variant:m==="group"?"default":"ghost",onClick:()=>y("group"),children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Group"]})]})]}),S&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 text-red-600 rounded-md",children:S}),C.length===0?e.jsxs(E,{className:"text-center p-12",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No stakeholders yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first stakeholder to get started"}),e.jsxs(d,{onClick:()=>x(!0),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add First Stakeholder"]})]}):m==="flat"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map((a,s)=>a&&A(a,s))}):e.jsx(me,{type:"multiple",defaultValue:w.map(a=>a.label),className:"space-y-4",children:w.map(a=>e.jsxs(ge,{value:a.label,className:"border rounded-lg px-4",children:[e.jsx(xe,{className:"hover:no-underline",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:a.label}),e.jsx(N,{variant:"secondary",children:a.items.length})]})}),e.jsx(pe,{children:a.items.length===0?e.jsxs("p",{className:"text-gray-500 text-sm py-4",children:["No stakeholders in this ",m==="department"?"department":"group"]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 py-4",children:a.items.map(s=>{const g=j.findIndex(n=>n.id===s.id);return A(s,g)})})})]},a.label))}),e.jsx(re,{open:V,onOpenChange:x,children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsx(oe,{children:p?"Edit Stakeholder":"Add New Stakeholder"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Name"}),e.jsx(c,{value:t.name,onChange:a=>r(s=>({...s,name:a.target.value})),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Role"}),e.jsx(c,{value:t.role,onChange:a=>r(s=>({...s,role:a.target.value})),placeholder:"Job title or role"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Company"}),e.jsx(c,{value:t.company,onChange:a=>r(s=>({...s,company:a.target.value})),placeholder:"Company name"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Email"}),e.jsx(c,{type:"email",value:t.email,onChange:a=>r(s=>({...s,email:a.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Phone"}),e.jsx(c,{type:"tel",value:t.phone,onChange:a=>r(s=>({...s,phone:a.target.value})),placeholder:"Phone number"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Influence Level"}),e.jsxs(B,{value:t.influence_level,onValueChange:a=>r(s=>({...s,influence_level:a})),children:[e.jsx(U,{children:e.jsx(F,{placeholder:"Select influence level"})}),e.jsxs(I,{children:[e.jsx(u,{value:"low",children:"Low"}),e.jsx(u,{value:"medium",children:"Medium"}),e.jsx(u,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Engagement Level"}),e.jsxs(B,{value:t.engagement_level,onValueChange:a=>r(s=>({...s,engagement_level:a})),children:[e.jsx(U,{children:e.jsx(F,{placeholder:"Select engagement level"})}),e.jsxs(I,{children:[e.jsx(u,{value:"active",children:"Active"}),e.jsx(u,{value:"passive",children:"Passive"}),e.jsx(u,{value:"resistant",children:"Resistant"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Department"}),e.jsx(c,{value:t.department,onChange:a=>r(s=>({...s,department:a.target.value})),placeholder:"e.g., Engineering, Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Group"}),e.jsx(c,{value:t.stakeholder_group,onChange:a=>r(s=>({...s,stakeholder_group:a.target.value})),placeholder:"e.g., Executive, Partner"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Contact Info"}),e.jsx(c,{value:t.contact_info,onChange:a=>r(s=>({...s,contact_info:a.target.value})),placeholder:"Additional contact information"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Notes"}),e.jsx(c,{value:t.notes,onChange:a=>r(s=>({...s,notes:a.target.value})),placeholder:"Additional notes about this stakeholder"})]})]}),e.jsxs(de,{children:[e.jsx(d,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(d,{onClick:R,children:p?"Update Stakeholder":"Create Stakeholder"})]})]})})]})})}export{Se as default};
