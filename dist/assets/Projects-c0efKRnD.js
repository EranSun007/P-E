import{j as e,_ as Q,f as oe,af as he,a6 as xe,h as me,ag as ge,ah as je,a2 as ue,d as _,ai as pe,S as ve}from"./chunk-CDfVSsCp.js";import{a as h,j as Ne}from"./chunk-pjYta8vt.js";import{A as fe,B as x,a as be,c as ye,C as T,g as G,h as J,f as E,k as we,L as c,I as P,P as S,l as k}from"./index-CjGPc2b_.js";import{B as j,D as Ce,e as _e,f as Pe,g as Se,i as ke,S as F,a as I,b as O,c as V,d as o,h as De}from"./chunk-2Vqr1Avx.js";import{S as Ae,P as W}from"./chunk-BiA1Y_SF.js";import{S as Me}from"./chunk-Bkk7W5FO.js";import{D as Te,a as Ee,b as Fe,d as X}from"./chunk-BrWpdzOD.js";import{T as Ie}from"./chunk-BRoLf8OO.js";import{P as B,a as $,b as R,C as H}from"./chunk-D56rD7Tk.js";import{T as Oe}from"./chunk-DqGcurv-.js";import{R as Ve,P as Be,b as $e,C as Re,T as He,c as Le}from"./chunk-TEwzFl3b.js";import{f as u,p as m}from"./chunk-DGzW4aIb.js";import"./chunk-BdHZTqfh.js";const Ue=({value:p,onCommit:n})=>{const[g,v]=h.useState(p);return h.useEffect(()=>{v(p)},[p]),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[g,"%"]})]}),e.jsx(Ae,{value:[g],min:0,max:100,step:5,onValueChange:N=>v(N[0]),onValueCommit:N=>n(N[0]),className:"cursor-pointer"})]})};function ts(){const p=Ne(),{projects:n,tasks:g,stakeholders:v,loading:N,refreshAll:Y}=h.useContext(fe),[D,Z]=h.useState({}),[ee,f]=h.useState(!1),[L,w]=h.useState(null),[b,U]=h.useState(null),[t,C]=h.useState({name:"",description:"",status:"not_started",start_date:"",end_date:"",deadline:"",owner:"",budget:"",cost:"",priority_level:"medium",color:A(),tags:[],stakeholder_id:""}),[se,ae]=h.useState({});h.useEffect(()=>{const s=Array.isArray(g)?g:[],a={};(Array.isArray(n)?n:[]).forEach(r=>{a[r.id]=s.filter(i=>i.project===r.name)}),Z(a)},[n,g]);function A(){const s=["indigo","blue","green","amber","red","purple","pink","teal"];return s[Math.floor(Math.random()*s.length)]}const M=async()=>{w(null);try{await Y()}catch(s){k.error("Failed to refresh projects",{error:String(s)}),w("Failed to load projects. Please try again.")}},d=(s,a)=>{if(s==="tags"){const r=Array.isArray(a)?a:[];C(i=>({...i,[s]:r}))}else C(r=>({...r,[s]:a}))},z=()=>{C({name:"",description:"",status:"not_started",start_date:"",end_date:"",deadline:"",owner:"",budget:"",cost:"",priority_level:"medium",color:A(),tags:[],stakeholder_id:""}),U(null),f(!0)},te=s=>{s&&(C({name:s.name||"",description:s.description||"",status:s.status||"not_started",start_date:s.start_date||"",end_date:s.end_date||"",deadline:s.deadline||"",owner:s.owner||"",budget:s.budget||"",cost:s.cost||"",priority_level:s.priority_level||"medium",color:s.color||A(),tags:Array.isArray(s.tags)?s.tags:[],stakeholder_id:s.stakeholder_id||""}),U(s),f(!0))},re=async()=>{try{b?await S.update(b.id,t):await S.create(t),f(!1),await M()}catch(s){k.error("Failed to save project",{error:String(s)}),w("Failed to save project. Please try again.")}},le=async s=>{try{await S.delete(s),await M()}catch(a){k.error("Failed to delete project",{error:String(a)}),w("Failed to delete project. Please try again.")}},ne=async(s,a)=>{try{await S.update(s,{progress_percentage:a}),await M()}catch(r){k.error("Failed to update progress",{error:String(r)})}},q=s=>({indigo:"bg-indigo-500",blue:"bg-blue-500",green:"bg-green-500",amber:"bg-amber-500",red:"bg-red-500",purple:"bg-purple-500",pink:"bg-pink-500",teal:"bg-teal-500"})[s]||"bg-gray-500",ie=s=>{const a={not_started:"bg-gray-100 text-gray-800 border-gray-200",in_progress:"bg-blue-100 text-blue-800 border-blue-200",on_hold:"bg-amber-100 text-amber-800 border-amber-200",completed:"bg-green-100 text-green-800 border-green-200"},r={not_started:"Not Started",in_progress:"In Progress",on_hold:"On Hold",completed:"Completed"};return e.jsx(j,{className:a[s],children:r[s]})},de=s=>{const a=Array.isArray(D[s])?D[s]:[],r={total:a.length,done:0,in_progress:0,todo:0,backlog:0,blocked:0};return a.forEach(i=>{i&&i.status&&(r[i.status]=(r[i.status]||0)+1)}),r},ce=s=>{ae(a=>({...a,[s]:!a[s]}))},K=()=>{const s={not_started:0,in_progress:0,completed:0,on_hold:0};return n.forEach(a=>{s[a.status]=(s[a.status]||0)+1}),[{name:"Not Started",value:s.not_started,color:"#94a3b8"},{name:"In Progress",value:s.in_progress,color:"#60a5fa"},{name:"Completed",value:s.completed,color:"#4ade80"},{name:"On Hold",value:s.on_hold,color:"#fbbf24"}]};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Projects"}),e.jsxs(x,{onClick:z,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"New Project"]})]}),L&&e.jsx(be,{variant:"destructive",className:"mb-6",children:e.jsx(ye,{children:L})}),e.jsxs(T,{className:"mb-6",children:[e.jsx(G,{children:e.jsx(J,{children:"Projects Overview"})}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64",children:e.jsx(Ve,{width:"100%",height:"100%",children:e.jsxs(Be,{children:[e.jsx($e,{data:K(),cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:s,percent:a})=>`${s} ${(a*100).toFixed(0)}%`,children:K().map((s,a)=>e.jsx(Re,{fill:s.color},a))}),e.jsx(He,{}),e.jsx(Le,{})]})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Active Projects"}),e.jsx("span",{children:n.filter(s=>s.status==="in_progress").length})]}),e.jsx(W,{value:n.filter(s=>s.status==="in_progress").length/n.length*100})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Completed Projects"}),e.jsx("span",{children:n.filter(s=>s.status==="completed").length})]}),e.jsx(W,{value:n.filter(s=>s.status==="completed").length/n.length*100,className:"bg-green-100"})]})]})]})]})})]}),N?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading projects..."})]}):n.length===0?e.jsx(T,{className:"bg-gray-50 border-dashed",children:e.jsxs(E,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(oe,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No projects yet"}),e.jsx("p",{className:"text-gray-500 text-center mb-4",children:"Create your first project to organize your tasks"}),e.jsxs(x,{onClick:z,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Create Project"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(s=>{const a=se[s.id]!==!1,r=s.progress_percentage??0,i=de(s.id);return e.jsxs(T,{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1.5 h-full ${q(s.color)}`}),e.jsx(G,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>ce(s.id),children:a?e.jsx(he,{className:"h-4 w-4"}):e.jsx(xe,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx(J,{className:"truncate hover:text-indigo-600 cursor-pointer transition-colors",onClick:()=>p(we("ProjectDetails")+`?id=${s.id}`),children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[ie(s.status),s.stakeholder_id&&e.jsxs(j,{variant:"outline",className:"text-xs",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),(v||[]).find(l=>l.id===s.stakeholder_id)?.name||"Stakeholder"]})]})]})]}),e.jsxs(Te,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(Fe,{align:"end",children:[e.jsxs(X,{onClick:()=>te(s),children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(X,{onClick:()=>le(s.id),className:"text-red-600",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})}),a&&e.jsxs(E,{children:[s.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:s.description}),Array.isArray(s.tags)&&s.tags.length>0&&e.jsx("div",{className:"mb-3 flex flex-wrap gap-1",children:s.tags.map(l=>e.jsx(j,{variant:"outline",className:"text-xs",children:l},l))}),s.start_date&&s.end_date&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-4",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[u(m(s.start_date),"MMM d")," - ",u(m(s.end_date),"MMM d, yyyy")]})]}),s.owner&&e.jsx("div",{className:"mb-4",children:e.jsxs(j,{variant:"outline",className:"text-gray-600",children:["Owner: ",s.owner]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Recent Updates"}),e.jsx(Me,{className:"h-32 rounded-md border p-2",children:D[s.id]?.flatMap(l=>(l.updates||[]).map(y=>({...y,taskTitle:l.title}))).sort((l,y)=>new Date(y.date)-new Date(l.date)).map((l,y)=>e.jsx("div",{className:"mb-2 last:mb-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:l.text}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:u(m(l.date),"MMM d, yyyy")}),e.jsxs("span",{className:"text-xs text-gray-400",children:["in ",l.taskTitle]})]})]})]})},y))})]}),e.jsx(Ue,{value:r,onCommit:l=>ne(s.id,l)}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-4 w-4 text-indigo-500 mr-1"}),e.jsxs("span",{className:"text-sm",children:[i.total," tasks"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[i.done>0&&e.jsxs(j,{variant:"outline",className:"bg-green-50",children:[i.done," done"]}),i.in_progress>0&&e.jsxs(j,{variant:"outline",className:"bg-blue-50",children:[i.in_progress," in progress"]})]})]})]})]},s.id)})})]}),e.jsx(Ce,{open:ee,onOpenChange:f,children:e.jsxs(_e,{className:"sm:max-w-md",children:[e.jsxs(Pe,{children:[e.jsx(Se,{children:b?"Edit Project":"Create New Project"}),e.jsx(ke,{children:b?"Update the project details below.":"Fill in the details to create a new project."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Project Name"}),e.jsx(P,{id:"name",value:t.name,onChange:s=>d("name",s.target.value),placeholder:"Enter project name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx(Ie,{id:"description",value:t.description,onChange:s=>d("description",s.target.value),placeholder:"Enter project description",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"status",children:"Status"}),e.jsxs(F,{value:t.status,onValueChange:s=>d("status",s),children:[e.jsx(I,{children:e.jsx(O,{placeholder:"Select status"})}),e.jsxs(V,{children:[e.jsx(o,{value:"not_started",children:"Not Started"}),e.jsx(o,{value:"in_progress",children:"In Progress"}),e.jsx(o,{value:"on_hold",children:"On Hold"}),e.jsx(o,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"owner",children:"Project Owner"}),e.jsx(P,{id:"owner",value:t.owner,onChange:s=>d("owner",s.target.value),placeholder:"Project owner"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Start Date"}),e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),t.start_date?u(m(t.start_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(R,{className:"w-auto p-0",children:e.jsx(H,{mode:"single",selected:t.start_date?m(t.start_date):void 0,onSelect:s=>d("start_date",s?s.toISOString():"")})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"End Date"}),e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),t.end_date?u(m(t.end_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(R,{className:"w-auto p-0",children:e.jsx(H,{mode:"single",selected:t.end_date?m(t.end_date):void 0,onSelect:s=>d("end_date",s?s.toISOString():"")})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Deadline (Critical Date)"}),e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),t.deadline?u(m(t.deadline),"PPP"):e.jsx("span",{children:"Set deadline (optional)"})]})}),e.jsx(R,{className:"w-auto p-0",children:e.jsx(H,{mode:"single",selected:t.deadline?m(t.deadline):void 0,onSelect:s=>d("deadline",s?s.toISOString():"")})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"priority_level",children:"Priority"}),e.jsxs(F,{value:t.priority_level,onValueChange:s=>d("priority_level",s),children:[e.jsx(I,{children:e.jsx(O,{placeholder:"Select priority"})}),e.jsxs(V,{children:[e.jsx(o,{value:"low",children:"Low"}),e.jsx(o,{value:"medium",children:"Medium"}),e.jsx(o,{value:"high",children:"High"}),e.jsx(o,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"budget",children:"Budget"}),e.jsx(P,{id:"budget",type:"number",step:"0.01",min:"0",value:t.budget,onChange:s=>d("budget",s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"cost",children:"Actual Cost"}),e.jsx(P,{id:"cost",type:"number",step:"0.01",min:"0",value:t.cost,onChange:s=>d("cost",s.target.value),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Project Tags"}),e.jsx(Oe,{value:t.tags||[],onChange:s=>d("tags",s),placeholder:"Add service-related tags..."}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tags for service categorization (e.g., software, consulting, support)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Assigned Stakeholder"}),e.jsxs(F,{value:t.stakeholder_id||"none",onValueChange:s=>d("stakeholder_id",s==="none"?null:s),children:[e.jsx(I,{children:e.jsx(O,{placeholder:"Select stakeholder"})}),e.jsxs(V,{children:[e.jsx(o,{value:"none",children:"No stakeholder assigned"}),(v||[]).map(s=>e.jsxs(o,{value:s.id,children:[s.name,s.company?` (${s.company})`:""]},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Color"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["indigo","blue","green","amber","red","purple","pink","teal"].map(s=>e.jsx("button",{type:"button",className:`w-8 h-8 rounded-full ${q(s)} border-2 ${t.color===s?"border-black":"border-transparent"}`,onClick:()=>d("color",s)},s))})]})]}),e.jsxs(De,{children:[e.jsx(x,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(x,{onClick:re,children:b?"Update Project":"Create Project"})]})]})})]})}export{ts as default};
