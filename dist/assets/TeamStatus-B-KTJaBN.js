import{j as e,ax as E,N as P,a5 as A,l as $,W as y,aI as W,m as H,L as O,D as U}from"./chunk-WPKCbDK8.js";import{a as l}from"./chunk-BKwDNIOR.js";import{z,k as F,C as f,j,n as V,o as _,H as K,K as q,p as G,B as T}from"./index-CnhOL4vI.js";import{g as S,d as J,l as Q,b as R}from"./chunk-DRrmMohU.js";import{T as X,a as Y,b as Z}from"./chunk-3WTxq07n.js";import{B as p}from"./chunk-DIYexMSd.js";import{b as M}from"./chunk-DGs6foQ1.js";import"./chunk-BwuEqr1N.js";const ee=[{id:"all",label:"All Teams"},{id:"metering",label:"Metering"},{id:"reporting",label:"Reporting"}],D=l.createContext(null);function se({children:t}){const[s,n]=l.useState([]),[r,i]=l.useState("metering"),[a,o]=l.useState(null),[d,c]=l.useState(!0),[u,g]=l.useState(null),{isAuthenticated:x}=z(),N=l.useRef(!1),w=l.useRef(null);l.useEffect(()=>{if(!a){const m=S();o(m.currentSprint.id)}},[a]);const L=l.useMemo(()=>{const m=S(),h=J(m.id);return Q(h,2)},[]),k=l.useCallback(async()=>{if(!x||!a){n([]),c(!1);return}try{c(!0),g(null);const m=R(a);if(!m){n([]);return}const h=await F.knowledge.searchInsights({teamDepartment:r==="all"?void 0:r,startDate:m.startDate.toISOString().split("T")[0],endDate:m.endDate.toISOString().split("T")[0],category:"team_summary"});n(h.summaries||[])}catch(m){console.error("Failed to fetch team summaries:",m),g(m.message),n([])}finally{c(!1)}},[x,r,a]);w.current=k;const v=l.useRef(r),b=l.useRef(a);l.useEffect(()=>{if(!x){N.current=!1,v.current=r,b.current=a;return}const m=v.current!==r,h=b.current!==a;v.current=r,b.current=a,!(N.current&&!m&&!h)&&(N.current=!0,w.current?.())},[x,r,a]);const B={summaries:s,currentTeam:r,setCurrentTeam:i,currentWeek:a,setCurrentWeek:o,availableSprints:L,loading:d,error:u,refresh:k};return e.jsx(D.Provider,{value:B,children:t})}function te(){const t=l.useContext(D);if(!t)throw new Error("useTeamStatus must be used within a TeamStatusProvider");return t}function re({summaries:t=[]}){const s=t.reduce((n,r)=>({completed:n.completed+(r.completedCount||0),blockers:n.blockers+(r.blockerCount||0),velocity:n.velocity+(r.completedCount||0)}),{completed:0,blockers:0,velocity:0});return e.jsx(f,{children:e.jsx(j,{className:"py-4",children:e.jsxs("div",{className:"grid grid-cols-3 divide-x",children:[e.jsxs("div",{className:"text-center px-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(E,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold",children:s.completed})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Completed"})]}),e.jsxs("div",{className:"text-center px-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(P,{className:`h-4 w-4 ${s.blockers>0?"text-red-600":"text-muted-foreground"}`}),e.jsx("span",{className:"text-2xl font-bold",children:s.blockers})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Blockers"})]}),e.jsxs("div",{className:"text-center px-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(A,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-2xl font-bold",children:s.velocity})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Velocity"})]})]})})})}function I(t){const{blockerCount:s=0,completedCount:n=0,lastUpdateDays:r=0,itemCount:i=0}=t;return s>=2?{status:"red",reasoning:`${s} blockers - immediate attention needed`}:r>3?{status:"red",reasoning:`No updates in ${r} days`}:s===1?{status:"yellow",reasoning:"1 blocker - monitor progress"}:n===0&&i>0&&r>1?{status:"yellow",reasoning:"Low activity, no completed items"}:{status:"green",reasoning:n>0?`${n} items completed, on track`:"No blockers, steady progress"}}function ne(t){const s={green:"border-l-green-500",yellow:"border-l-yellow-500",red:"border-l-red-500"};return s[t]||s.green}function C(t){const s={green:"text-green-700 border-green-500",yellow:"text-yellow-700 border-yellow-500",red:"text-red-700 border-red-500"};return s[t]||s.green}function ae({member:t,summary:s}){const[n,r]=l.useState(!1),i=l.useMemo(()=>I(s),[s]),a=ne(i.status),o=t?.name?t.name.split(" ").map(d=>d[0]).join("").toUpperCase().slice(0,2):"??";return e.jsx(V,{open:n,onOpenChange:r,children:e.jsxs(f,{className:`border-l-4 ${a} hover:shadow-md transition-shadow`,children:[e.jsxs(_,{className:"w-full text-left p-4 flex items-center gap-3",children:[e.jsx(K,{className:"h-10 w-10",children:e.jsx(q,{className:"text-sm",children:o})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:t?.name||"Unknown"}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.oneLine||"No updates this week"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[s.completedCount>0&&e.jsxs(p,{variant:"secondary",className:"text-xs",children:[s.completedCount," done"]}),s.blockerCount>0&&e.jsxs(p,{variant:"destructive",className:"text-xs",children:[s.blockerCount," blocker",s.blockerCount>1?"s":""]})]}),e.jsx($,{className:`h-4 w-4 text-muted-foreground transition-transform flex-shrink-0 ${n?"rotate-180":""}`})]}),e.jsxs(G,{className:"px-4 pb-4 space-y-3",children:[s.items&&s.items.length>0&&e.jsx("div",{className:"text-sm space-y-2 pl-13",children:s.items.map((d,c)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("span",{children:d.text})]},d.id||c))}),e.jsxs("div",{className:"text-xs text-muted-foreground pt-2 border-t pl-13",children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",i.reasoning]})]})]})})}function le({currentWeek:t,availableSprints:s=[],onWeekChange:n}){const r=t?R(t):null,i=s.findIndex(x=>x.id===t),a=i>0,o=i<s.length-1,d=()=>{a&&n(s[i-1].id)},c=()=>{o&&n(s[i+1].id)};if(!r)return e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Select a week"})]});const g=r.label==="a"?"1-2":"3-4";return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(T,{variant:"outline",size:"icon",onClick:d,disabled:!a,"aria-label":"Previous week",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-center min-w-[220px]",children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Weeks ",g," - Sprint ",r.id]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[M(r.startDate,"MMM d")," - ",M(r.endDate,"MMM d, yyyy")]})]}),e.jsx(T,{variant:"outline",size:"icon",onClick:c,disabled:!o,"aria-label":"Next week",children:e.jsx(H,{className:"h-4 w-4"})})]})}function ie({summaries:t=[]}){const s=t.reduce((n,r)=>{const i=I(r);return n[i.status]=(n[i.status]||0)+1,n},{});return t.length===0?null:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.green>0&&e.jsxs(p,{variant:"outline",className:C("green"),children:[s.green," green"]}),s.yellow>0&&e.jsxs(p,{variant:"outline",className:C("yellow"),children:[s.yellow," yellow"]}),s.red>0&&e.jsxs(p,{variant:"outline",className:C("red"),children:[s.red," red"]})]})}function ce(){const{summaries:t,currentTeam:s,setCurrentTeam:n,currentWeek:r,setCurrentWeek:i,availableSprints:a,loading:o,error:d}=te();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Team Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Weekly health and progress summaries"})]}),e.jsx(le,{currentWeek:r,availableSprints:a,onWeekChange:i})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx(X,{value:s,onValueChange:n,children:e.jsx(Y,{children:ee.map(c=>e.jsx(Z,{value:c.id,children:c.label},c.id))})}),!o&&t.length>0&&e.jsx(ie,{summaries:t})]}),o&&e.jsx(f,{children:e.jsxs(j,{className:"py-12 text-center",children:[e.jsx(O,{className:"h-8 w-8 mx-auto animate-spin text-muted-foreground"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading team summaries..."})]})}),d&&!o&&e.jsx(f,{className:"border-destructive",children:e.jsx(j,{className:"py-8 text-center",children:e.jsxs("p",{className:"text-destructive",children:["Failed to load summaries: ",d]})})}),!o&&!d&&t.length===0&&e.jsx(f,{children:e.jsxs(j,{className:"py-12 text-center",children:[e.jsx(U,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"No team summaries for this week"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Data will appear once daily summaries are stored via MCP"})]})}),!o&&!d&&t.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(re,{summaries:t}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Team Members"}),e.jsx("div",{className:"grid gap-3",children:t.map((c,u)=>e.jsx(ae,{member:c.member||{name:c.memberName||`Member ${u+1}`},summary:c},c.memberId||u))})]})]})]})}function ge(){return e.jsx(se,{children:e.jsx(ce,{})})}export{ge as default};
