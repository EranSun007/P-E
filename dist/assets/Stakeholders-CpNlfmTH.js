import{j as e,ar as D,am as q,aH as W,aI as X,aJ as Y,r as Z}from"./chunk-BlD_ekKQ.js";import{a as o}from"./chunk-BKwDNIOR.js";import{A as ee,d as ae,u as se,B as u,I as g,C as L,L as d,S as z,l as I,h as ne,i as te,j as le}from"./index-BPpXP9wP.js";import{c as k}from"./chunk-NOAukTlf.js";import{a as re,b as ie,c as ce}from"./chunk-uiVOWrDz.js";import{B as S,D as oe,a as de,b as me,c as ge,d as ue}from"./chunk-CmitwiBI.js";import{S as B,a as P,b as U,c as F,d as j}from"./chunk-DBni0BOz.js";import{A as xe,a as he,b as pe,c as je}from"./chunk-CmVL7815.js";import"./chunk-P_BNsj9B.js";function De(){const{stakeholders:N,loading:M,refreshAll:G}=o.useContext(ee),{isPresentationMode:v}=ae(),[h,V]=o.useState([]),[H,p]=o.useState(!1),[f,K]=o.useState(""),[w,C]=o.useState(null),[l,_]=o.useState(null),[c,b]=o.useState("flat"),[r,i]=o.useState({name:"",role:"",email:"",phone:"",company:"",influence_level:"medium",engagement_level:"active",contact_info:"",notes:"",tags:[],department:"",stakeholder_group:""});o.useEffect(()=>{V(Array.isArray(N)?N:[])},[N]);const R=async()=>{C(null);try{await G()}catch(a){I.error("Failed to refresh stakeholders",{error:String(a)}),C("Failed to load stakeholders")}},T=()=>{i({name:"",role:"",email:"",phone:"",company:"",influence_level:"medium",engagement_level:"active",contact_info:"",notes:"",tags:[],department:"",stakeholder_group:""}),_(null),p(!0)},O=a=>{i({name:a.name||"",role:a.role||"",email:a.email||"",phone:a.phone||"",company:a.company||a.organization||"",influence_level:a.influence_level||a.influence||"medium",engagement_level:a.engagement_level||"active",contact_info:a.contact_info||"",notes:a.notes||a.description||"",tags:Array.isArray(a.tags)?a.tags:[],department:a.department||"",stakeholder_group:a.stakeholder_group||""}),_(a),p(!0)},J=async()=>{try{l?await z.update(l.id,r):await z.create(r),p(!1),R()}catch(a){I.error(`Failed to ${l?"update":"create"} stakeholder`,{error:String(a)}),C(`Failed to ${l?"update":"create"} stakeholder`)}};if(M)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading stakeholders..."})]})});const m=(h||[]).filter(a=>{if(!a)return!1;const s=(f||"").toLowerCase(),x=(a.name||"").toLowerCase(),n=(a.role||"").toLowerCase(),t=(a.company||a.organization||"").toLowerCase(),Q=(a.department||"").toLowerCase(),$=(a.stakeholder_group||"").toLowerCase();return x.includes(s)||n.includes(s)||t.includes(s)||Q.includes(s)||$.includes(s)}),E=c==="department"?(a=>{const s={};return a.forEach(n=>{const t=n.department||"Unassigned";s[t]||(s[t]=[]),s[t].push(n)}),Object.keys(s).sort((n,t)=>n==="Unassigned"?1:t==="Unassigned"?-1:n.localeCompare(t)).map(n=>({label:n,items:s[n]}))})(m):c==="group"?(a=>{const s={};return a.forEach(n=>{const t=n.stakeholder_group||"Unassigned";s[t]||(s[t]=[]),s[t].push(n)}),Object.keys(s).sort((n,t)=>n==="Unassigned"?1:t==="Unassigned"?-1:n.localeCompare(t)).map(n=>({label:n,items:s[n]}))})(m):null,A=(a,s)=>{const x=v?re(a.name,s,"Stakeholder"):a.name||"Unnamed Stakeholder",n=v?ie(a.email):a.email,t=v?ce(a.notes||a.description):a.notes||a.description;return e.jsxs(L,{children:[e.jsxs(ne,{children:[e.jsx(te,{children:x}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(S,{className:(a.influence_level||a.influence)==="high"?"bg-red-100 text-red-800":(a.influence_level||a.influence)==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800",children:[a.influence_level||a.influence||"medium"," influence"]}),e.jsx(S,{className:a.engagement_level==="active"?"bg-green-100 text-green-800":a.engagement_level==="passive"?"bg-gray-100 text-gray-800":"bg-orange-100 text-orange-800",children:a.engagement_level||"active"})]})]}),e.jsxs(le,{children:[a.role&&e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:a.role}),(a.company||a.organization)&&e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:a.company||a.organization}),a.department&&e.jsxs("p",{className:"text-sm text-gray-500 mb-1",children:["Dept: ",a.department]}),a.stakeholder_group&&e.jsxs("p",{className:"text-sm text-gray-500 mb-1",children:["Group: ",a.stakeholder_group]}),a.email&&e.jsx("p",{className:v?"text-sm text-gray-400 mb-1":"text-sm text-blue-600 mb-1",children:n}),(a.notes||a.description)&&e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:t}),e.jsx(u,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>O(a),children:"Edit"})]})]},a.id||Math.random())},{updatePageContext:y}=se();return o.useEffect(()=>{const a=k(m,{},l);y({page:"/stakeholders",summary:a,selection:l?{id:l.id,type:"stakeholder"}:null,data:{stakeholderCount:m.length,totalCount:h.length,viewMode:c}})},[m,f,l,h.length,c,y]),o.useEffect(()=>{const a=()=>{const s=k(m,{},l);y({page:"/stakeholders",summary:s,selection:l?{id:l.id,type:"stakeholder"}:null,data:{stakeholderCount:m.length,totalCount:h.length,viewMode:c}})};return window.addEventListener("ai-context-refresh",a),()=>window.removeEventListener("ai-context-refresh",a)},[m,f,l,h.length,c,y]),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Stakeholders"}),e.jsxs(u,{onClick:T,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add Stakeholder"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(g,{placeholder:"Search stakeholders...",value:f,onChange:a=>K(a.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-1 border rounded-md p-1",children:[e.jsxs(u,{size:"sm",variant:c==="flat"?"default":"ghost",onClick:()=>b("flat"),children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Flat"]}),e.jsxs(u,{size:"sm",variant:c==="department"?"default":"ghost",onClick:()=>b("department"),children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Dept"]}),e.jsxs(u,{size:"sm",variant:c==="group"?"default":"ghost",onClick:()=>b("group"),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Group"]})]})]}),w&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 text-red-600 rounded-md",children:w}),h.length===0?e.jsxs(L,{className:"text-center p-12",children:[e.jsx(Z,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No stakeholders yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first stakeholder to get started"}),e.jsxs(u,{onClick:()=>p(!0),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add First Stakeholder"]})]}):c==="flat"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((a,s)=>a&&A(a,s))}):e.jsx(xe,{type:"multiple",defaultValue:E.map(a=>a.label),className:"space-y-4",children:E.map(a=>e.jsxs(he,{value:a.label,className:"border rounded-lg px-4",children:[e.jsx(pe,{className:"hover:no-underline",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:a.label}),e.jsx(S,{variant:"secondary",children:a.items.length})]})}),e.jsx(je,{children:a.items.length===0?e.jsxs("p",{className:"text-gray-500 text-sm py-4",children:["No stakeholders in this ",c==="department"?"department":"group"]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 py-4",children:a.items.map(s=>{const x=m.findIndex(n=>n.id===s.id);return A(s,x)})})})]},a.label))}),e.jsx(oe,{open:H,onOpenChange:p,children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsx(ge,{children:l?"Edit Stakeholder":"Add New Stakeholder"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Name"}),e.jsx(g,{value:r.name,onChange:a=>i(s=>({...s,name:a.target.value})),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Role"}),e.jsx(g,{value:r.role,onChange:a=>i(s=>({...s,role:a.target.value})),placeholder:"Job title or role"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Company"}),e.jsx(g,{value:r.company,onChange:a=>i(s=>({...s,company:a.target.value})),placeholder:"Company name"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Email"}),e.jsx(g,{type:"email",value:r.email,onChange:a=>i(s=>({...s,email:a.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Phone"}),e.jsx(g,{type:"tel",value:r.phone,onChange:a=>i(s=>({...s,phone:a.target.value})),placeholder:"Phone number"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Influence Level"}),e.jsxs(B,{value:r.influence_level,onValueChange:a=>i(s=>({...s,influence_level:a})),children:[e.jsx(P,{children:e.jsx(U,{placeholder:"Select influence level"})}),e.jsxs(F,{children:[e.jsx(j,{value:"low",children:"Low"}),e.jsx(j,{value:"medium",children:"Medium"}),e.jsx(j,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Engagement Level"}),e.jsxs(B,{value:r.engagement_level,onValueChange:a=>i(s=>({...s,engagement_level:a})),children:[e.jsx(P,{children:e.jsx(U,{placeholder:"Select engagement level"})}),e.jsxs(F,{children:[e.jsx(j,{value:"active",children:"Active"}),e.jsx(j,{value:"passive",children:"Passive"}),e.jsx(j,{value:"resistant",children:"Resistant"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Department"}),e.jsx(g,{value:r.department,onChange:a=>i(s=>({...s,department:a.target.value})),placeholder:"e.g., Engineering, Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Group"}),e.jsx(g,{value:r.stakeholder_group,onChange:a=>i(s=>({...s,stakeholder_group:a.target.value})),placeholder:"e.g., Executive, Partner"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Contact Info"}),e.jsx(g,{value:r.contact_info,onChange:a=>i(s=>({...s,contact_info:a.target.value})),placeholder:"Additional contact information"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Notes"}),e.jsx(g,{value:r.notes,onChange:a=>i(s=>({...s,notes:a.target.value})),placeholder:"Additional notes about this stakeholder"})]})]}),e.jsxs(ue,{children:[e.jsx(u,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(u,{onClick:J,children:l?"Update Stakeholder":"Create Stakeholder"})]})]})})]})})}export{De as default};
