import{j as e,_ as J,S as Fe,a3 as P,a4 as w,e as Q,h as B,a5 as Ae,a6 as Ee,a7 as V,a8 as X}from"./chunk-CDfVSsCp.js";import{a as c}from"./chunk-pjYta8vt.js";import{A as Pe,B as b,D as Be,l as k,d as Ie,T as Le,e as I}from"./index-CjGPc2b_.js";import{D as Y,e as Z,f as K,g as ee,B as m}from"./chunk-2Vqr1Avx.js";import Re from"./TaskCreationForm-B8jsWt0K.js";import{f as y,p as i,s as te,b as se,e as ae,d as re,g as ne,h as le,i as ze,j as N,k as D,l as v,m as _,n as We}from"./chunk-DGzW4aIb.js";import"./chunk-KzYfAQy1.js";import"./chunk-BRoLf8OO.js";import"./chunk-D56rD7Tk.js";import"./chunk-BdHZTqfh.js";import"./chunk-DqGcurv-.js";function Ke(){const{tasks:M,teamMembers:T,meetings:O,refreshAll:ie}=c.useContext(Pe),[L,de]=c.useState([]),[R,ce]=c.useState([]),[z,oe]=c.useState([]),[W,$]=c.useState([]),[H,U]=c.useState([]),[f,F]=c.useState(new Date),[g,me]=c.useState(new Date),[o,q]=c.useState(null),[xe,S]=c.useState(!1),[u,he]=c.useState({tasks:!0,leave:!0,duties:!0,dutySchedule:!0,meetings:!0});c.useEffect(()=>{de(Array.isArray(M)?M:[])},[M]),c.useEffect(()=>{ce(Array.isArray(T)?T:[])},[T]),c.useEffect(()=>{oe(Array.isArray(O)?O:[])},[O]),c.useEffect(()=>{(async()=>{try{const a=await Be.list();$(Array.isArray(a)?a:[])}catch(a){k.error("Failed to load DevOps duties",{error:String(a)}),$([])}})()},[]),c.useEffect(()=>{(async()=>{try{const a=te(se(f)),x=ae(re(f,1)),d=await Ie.listByDateRange(y(a,"yyyy-MM-dd"),y(x,"yyyy-MM-dd"));U(Array.isArray(d)?d:[])}catch(a){k.error("Failed to load duty schedules",{error:String(a)}),U([])}})()},[f]);const ue=n=>{he(a=>({...a,[n]:!a[n]}))},ge=async()=>{try{await ie()}catch(n){k.error("Failed to refresh tasks (calendar)",{error:String(n)})}},pe=async n=>{if(!n){S(!1);return}try{await Le.create({...n,due_date:n.due_date||g.toISOString()}),await ge(),S(!1)}catch(a){k.error("Failed to create task (calendar)",{error:String(a)})}},fe=()=>{F(se(f))},je=()=>{F(re(f,1))},ye=n=>{me(n)},G=n=>{q(n)},ve=()=>{const n=[{key:"tasks",label:"Tasks",icon:Fe,activeClass:"bg-purple-100 text-purple-800 border-purple-300",color:"purple"},{key:"leave",label:"Leave",icon:P,activeClass:"bg-red-100 text-red-800 border-red-300",color:"red"},{key:"duties",label:"DevOps",icon:w,activeClass:"bg-indigo-100 text-indigo-800 border-indigo-300",color:"indigo"},{key:"dutySchedule",label:"Rotation",icon:Q,activeClass:"bg-emerald-100 text-emerald-800 border-emerald-300",color:"emerald"},{key:"meetings",label:"Meetings",icon:B,activeClass:"bg-teal-100 text-teal-800 border-teal-300",color:"teal"}];return e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-1",children:"Show:"}),n.map(({key:a,label:x,icon:d,activeClass:j})=>e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>ue(a),className:I("h-8 px-3 text-xs font-medium transition-colors",u[a]?j:"bg-white text-gray-400 border-gray-200"),children:[e.jsx(d,{className:"h-3.5 w-3.5 mr-1.5"}),x]},a))]})},be=()=>e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:y(f,"MMMM yyyy")}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{variant:"outline",size:"icon",onClick:fe,children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(b,{variant:"outline",size:"icon",onClick:()=>F(new Date),children:"Today"}),e.jsx(b,{variant:"outline",size:"icon",onClick:je,children:e.jsx(Ee,{className:"h-4 w-4"})})]})]}),Ne=()=>{const n="EEEE",a=[],x=ne(f);for(let d=0;d<7;d++)a.push(e.jsx("div",{className:"font-medium text-sm py-2 text-center",children:y(le(x,d),n)},d));return e.jsx("div",{className:"grid grid-cols-7 mb-2",children:a})},De=()=>{const n=te(f),a=ae(n),x=ne(n),d=ze(a),j="d",A=[];let t=[],r=x;for(;r<=d;){for(let h=0;h<7;h++){const E=y(r,j),Se=r,we=u.tasks?L.filter(s=>s.due_date&&N(i(s.due_date),r)):[],C=u.leave?R.filter(s=>{if(!s?.leave_from||!s?.leave_to)return!1;try{const l=D(i(s.leave_from)),p=v(i(s.leave_to));return _(r,{start:l,end:p})}catch{return!1}}):[],Ce=u.duties?W.filter(s=>{if(!s.start_date)return!1;try{const l=D(i(s.start_date)),p=s.end_date?v(i(s.end_date)):v(l);return _(r,{start:l,end:p})}catch{return!1}}):[],ke=u.meetings?z.filter(s=>s.scheduled_date&&N(i(s.scheduled_date),r)):[],Me=u.dutySchedule?H.filter(s=>{if(!s.start_date||!s.end_date)return!1;try{const l=D(i(s.start_date)),p=v(i(s.end_date));return _(r,{start:l,end:p})}catch{return!1}}):[];t.push(e.jsxs("div",{className:I("min-h-[120px] p-2 border border-gray-200 relative",!We(r,n)&&"text-gray-400 bg-gray-50",N(r,g)&&"bg-blue-50","hover:bg-blue-50 cursor-pointer"),onClick:()=>ye(Se),children:[e.jsx("div",{className:"font-medium text-right",children:E}),e.jsxs("div",{className:"mt-2 space-y-1 max-h-[90px] overflow-y-auto",children:[we.map(s=>e.jsx("div",{className:I("text-xs p-1 rounded truncate",s.type==="meeting"&&"bg-blue-100 text-blue-800",s.type==="metric"&&"bg-green-100 text-green-800",s.type==="action"&&"bg-purple-100 text-purple-800",s.type==="generic"&&"bg-gray-100 text-gray-800"),onClick:l=>{l.stopPropagation(),G(s)},children:s.title},s.id)),ke.map(s=>e.jsxs("div",{className:"text-xs p-1 rounded truncate bg-teal-100 text-teal-800 flex items-center gap-1",onClick:l=>l.stopPropagation(),children:[e.jsx(B,{className:"h-3 w-3"}),s.title]},s.id)),Ce.map(s=>e.jsxs("div",{className:"text-xs p-1 rounded truncate bg-indigo-100 text-indigo-800 flex items-center gap-1",onClick:l=>l.stopPropagation(),children:[e.jsx(w,{className:"h-3 w-3"}),"DevOps: ",s.team_member_name||"Duty"]},s.id)),Me.map(s=>{const l={devops:{icon:w,bg:"bg-indigo-100",text:"text-indigo-800",label:"DevOps"},dev_on_duty:{icon:X,bg:"bg-teal-100",text:"text-teal-800",label:"DoD"},replacement:{icon:V,bg:"bg-amber-100",text:"text-amber-800",label:"SM"}},p=l[s.duty_type]||l.devops,Te=p.icon;return e.jsxs("div",{className:`text-xs p-1 rounded truncate ${p.bg} ${p.text} flex items-center gap-1`,onClick:Oe=>Oe.stopPropagation(),children:[e.jsx(Te,{className:"h-3 w-3"}),p.label,": ",s.team_member_name]},`schedule-${s.id}`)}),C.length>0&&e.jsxs("div",{className:"pt-1 space-y-1",children:[C.slice(0,2).map(s=>e.jsxs("div",{className:"text-[10px] px-1 py-0.5 rounded bg-red-100 text-red-800 truncate flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),s.leave_title||"Leave",": ",s.name]},s.id)),C.length>2&&e.jsxs("div",{className:"text-[10px] px-1 py-0.5 rounded bg-red-50 text-red-700",children:["+",C.length-2," more"]})]})]}),N(r,new Date)&&e.jsx(m,{className:"absolute top-1 left-1 bg-red-500",children:"Today"})]},r.toString())),r=le(r,1)}A.push(e.jsx("div",{className:"grid grid-cols-7",children:t},r.toString())),t=[]}return e.jsx("div",{className:"mb-4",children:A})},_e=()=>{const n=u.tasks?L.filter(t=>t.due_date&&N(i(t.due_date),g)):[],a=u.leave?R.filter(t=>{if(!t?.leave_from||!t?.leave_to)return!1;try{const r=D(i(t.leave_from)),h=v(i(t.leave_to));return _(g,{start:r,end:h})}catch{return!1}}):[],x=u.duties?W.filter(t=>{if(!t.start_date)return!1;try{const r=D(i(t.start_date)),h=t.end_date?v(i(t.end_date)):v(r);return _(g,{start:r,end:h})}catch{return!1}}):[],d=u.meetings?z.filter(t=>t.scheduled_date&&N(i(t.scheduled_date),g)):[],j=u.dutySchedule?H.filter(t=>{if(!t.start_date||!t.end_date)return!1;try{const r=D(i(t.start_date)),h=v(i(t.end_date));return _(g,{start:r,end:h})}catch{return!1}}):[];return n.length>0||a.length>0||x.length>0||j.length>0||d.length>0?e.jsxs("div",{className:"space-y-2",children:[a.length>0&&e.jsxs("div",{className:"p-3 border rounded-md bg-red-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-red-800 text-sm flex items-center gap-1",children:[e.jsx(P,{className:"h-4 w-4"}),"Team Leave"]}),e.jsx(m,{variant:"secondary",className:"bg-red-100 text-red-800 border-red-200",children:a.length})]}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:a.map(t=>e.jsxs(m,{variant:"outline",className:"text-xs border-red-200 text-red-800",children:[t.leave_title||"Leave",": ",t.name]},t.id))})]}),x.length>0&&e.jsxs("div",{className:"p-3 border rounded-md bg-indigo-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-indigo-800 text-sm flex items-center gap-1",children:[e.jsx(w,{className:"h-4 w-4"}),"DevOps Tracking"]}),e.jsx(m,{variant:"secondary",className:"bg-indigo-100 text-indigo-800 border-indigo-200",children:x.length})]}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:x.map(t=>e.jsx(m,{variant:"outline",className:"text-xs border-indigo-200 text-indigo-800",children:t.team_member_name||"Duty"},t.id))})]}),j.length>0&&e.jsxs("div",{className:"p-3 border rounded-md bg-emerald-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-emerald-800 text-sm flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4"}),"Duty Rotation"]}),e.jsx(m,{variant:"secondary",className:"bg-emerald-100 text-emerald-800 border-emerald-200",children:j.length})]}),e.jsx("div",{className:"mt-2 space-y-1",children:j.map(t=>{const r={devops:{label:"DevOps",icon:w,color:"indigo"},dev_on_duty:{label:"Dev On Duty",icon:X,color:"teal"},replacement:{label:"SM Cover",icon:V,color:"amber"}},h=r[t.duty_type]||r.devops,E=h.icon;return e.jsxs("div",{className:`flex items-center gap-2 text-sm text-${h.color}-800`,children:[e.jsx(E,{className:"h-3 w-3"}),e.jsxs("span",{className:"font-medium",children:[h.label,":"]}),e.jsx("span",{children:t.team_member_name}),t.team&&e.jsx(m,{variant:"outline",className:"text-[10px] ml-auto",children:t.team})]},t.id)})})]}),d.length>0&&e.jsxs("div",{className:"p-3 border rounded-md bg-teal-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium text-teal-800 text-sm flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4"}),"Meetings"]}),e.jsx(m,{variant:"secondary",className:"bg-teal-100 text-teal-800 border-teal-200",children:d.length})]}),e.jsx("div",{className:"mt-2 space-y-1",children:d.map(t=>e.jsx("div",{className:"text-sm text-teal-800",children:t.title},t.id))})]}),n.map(t=>e.jsxs("div",{className:"p-3 border rounded-md hover:bg-gray-50 cursor-pointer",onClick:()=>G(t),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:t.title}),e.jsx(m,{variant:"outline",children:t.type})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description})]},t.id))]}):e.jsxs("div",{className:"text-center p-6",children:[e.jsx("p",{className:"text-gray-500",children:"No events scheduled for this date"}),e.jsxs(b,{onClick:()=>S(!0),variant:"outline",className:"mt-2",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})};return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6",children:[e.jsxs("div",{className:"lg:flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Calendar"}),e.jsxs(b,{onClick:()=>S(!0),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"New Task"]})]}),ve(),be(),Ne(),De()]}),e.jsx("div",{className:"lg:w-80",children:e.jsxs("div",{className:"bg-white rounded-md border p-4 sticky top-4",children:[e.jsx("h2",{className:"font-semibold mb-4 pb-2 border-b",children:y(g,"MMMM d, yyyy")}),_e()]})})]}),e.jsx(Y,{open:xe,onOpenChange:S,children:e.jsxs(Z,{className:"sm:max-w-lg",children:[e.jsx(K,{children:e.jsxs(ee,{children:["Add Task for ",y(g,"MMMM d, yyyy")]})}),e.jsx(Re,{onCreateTask:pe,initialTaskData:{due_date:g.toISOString(),status:"todo",priority:"medium",type:"generic"}})]})}),e.jsx(Y,{open:!!o,onOpenChange:()=>q(null),children:o&&e.jsxs(Z,{className:"sm:max-w-lg",children:[e.jsx(K,{children:e.jsx(ee,{children:"Task Details"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:o.title}),e.jsxs("div",{className:"flex items-center mt-2 space-x-2",children:[e.jsx(m,{children:o.type}),e.jsxs(m,{variant:"outline",children:[o.priority," priority"]}),o.strategic&&e.jsx(m,{variant:"secondary",children:"Strategic"})]})]}),o.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Description"}),e.jsx("p",{children:o.description})]}),o.due_date&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Due Date"}),e.jsx("p",{children:y(i(o.due_date),"PPpp")})]}),o.stakeholders?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Stakeholders"}),e.jsx("p",{children:o.stakeholders.join(", ")})]}),o.tags?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:o.tags.map((n,a)=>e.jsx(m,{variant:"secondary",children:n},a))})]})]})]})})]})})}export{Ke as default};
