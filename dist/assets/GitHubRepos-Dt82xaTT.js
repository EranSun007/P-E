import{j as e,J as w,z as S,a1 as ke,L as f,l as Z,ar as ee,bd as C,bw as R,bx as D,aP as Te,T as se,aD as Ae,by as He,am as Ge}from"./chunk-BlD_ekKQ.js";import{h as Fe,a}from"./chunk-BKwDNIOR.js";import{U as Pe,R as o,C as d,h as k,i as T,m as ae,j as r,a as te,b as Ie,c as le,B as n,I as Le}from"./index-BPpXP9wP.js";import{B as re,D as ne,a as ie,b as ce,c as oe,e as de,d as xe}from"./chunk-CmitwiBI.js";import{T as me,a as he,b as _,c as m,d as je,e as h}from"./chunk-C_wS6JmM.js";import{T as Ee,a as Me,b as A,c as H}from"./chunk-COZz_0DJ.js";import"./chunk-P_BNsj9B.js";function Je(){const ue=Fe(),[G,N]=a.useState(!0),[F,P]=a.useState(!1),[i,pe]=a.useState(null),[ge,fe]=a.useState(null),[I,x]=a.useState(null),[Ne,u]=a.useState(!1),[j,L]=a.useState(""),[E,M]=a.useState([]),[B,U]=a.useState(!1),[ye,z]=a.useState(!1),[t,O]=a.useState(null),[c,ve]=a.useState({pulls:[],issues:[],commits:[]}),[be,$]=a.useState(!1),[we,y]=a.useState(!1),[v,q]=a.useState(null);a.useEffect(()=>{_e()},[]);const _e=async()=>{try{const s=await Pe.getGitHubStatus();fe(s),s.connected?p():N(!1)}catch(s){console.error("Failed to check GitHub status:",s),x("Failed to check GitHub connection"),N(!1)}},p=async()=>{N(!0),x(null);try{const s=await o.listRepos();pe(s)}catch(s){console.error("Failed to load repos:",s),x(s.message||"Failed to load repositories")}finally{N(!1)}},Se=async()=>{P(!0);try{await o.syncAllRepos(),await p()}catch(s){console.error("Sync failed:",s),x("Failed to sync repositories")}finally{P(!1)}},Y=async()=>{if(j.trim()){if(j.includes("/")){J(j);return}U(!0);try{const s=await o.searchRepos(j);M(s)}catch(s){console.error("Search failed:",s),x("Failed to search repositories")}finally{U(!1)}}},J=async s=>{z(!0);try{await o.addRepo(s),await p(),u(!1),L(""),M([])}catch(l){console.error("Failed to add repo:",l),x(l.message||"Failed to add repository")}finally{z(!1)}},Ce=async()=>{if(v)try{await o.removeRepo(v.id),await p(),y(!1),q(null),t?.id===v.id&&O(null)}catch(s){console.error("Failed to delete repo:",s),x("Failed to remove repository")}},K=async s=>{O(s),$(!0);try{const[l,V,g]=await Promise.all([o.getPullRequests(s.id),o.getIssues(s.id),o.getCommits(s.id,20)]);ve({pulls:l,issues:V,commits:g})}catch(l){console.error("Failed to load repo details:",l)}finally{$(!1)}},Re=async s=>{try{await o.syncRepo(s.id),await p(),t?.id===s.id&&K(s)}catch(l){console.error("Sync failed:",l),x("Failed to sync repository")}},De=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-",b=s=>{if(!s)return"-";const l=new Date(s),g=new Date-l,Q=Math.floor(g/6e4),W=Math.floor(g/36e5),X=Math.floor(g/864e5);return Q<60?`${Q}m ago`:W<24?`${W}h ago`:X<30?`${X}d ago`:De(s)};return!G&&!ge?.connected?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(d,{children:[e.jsxs(k,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-6 w-6"}),"GitHub Integration"]}),e.jsx(ae,{children:"Connect your GitHub account to track repository progress"})]}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs(te,{children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx(Ie,{children:"GitHub Not Connected"}),e.jsx(le,{children:"You need to connect your GitHub account before you can track repositories."})]}),e.jsxs(n,{onClick:()=>ue("/settings"),children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Go to Settings to Connect GitHub"]})]})]})})}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(w,{className:"h-8 w-8"}),"GitHub Repositories"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Track your repositories progress, PRs, issues, and commits"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:Se,disabled:F,children:[F?e.jsx(f,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Sync All"]}),e.jsxs(n,{onClick:()=>u(!0),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Add Repository"]})]})]}),I&&e.jsxs(te,{variant:"destructive",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx(le,{children:I})]}),G?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(f,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading repositories..."})]}):e.jsxs(e.Fragment,{children:[i&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsx(d,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:i.total_repos}),e.jsx("p",{className:"text-sm text-gray-500",children:"Repositories"})]})}),e.jsx(d,{children:e.jsxs(r,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-1",children:[e.jsx(C,{className:"h-5 w-5 text-yellow-500"}),i.total_stars]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Stars"})]})}),e.jsx(d,{children:e.jsxs(r,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-1",children:[e.jsx(R,{className:"h-5 w-5 text-green-500"}),i.total_open_prs]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Open PRs"})]})}),e.jsx(d,{children:e.jsxs(r,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-1",children:[e.jsx(D,{className:"h-5 w-5 text-blue-500"}),i.total_open_issues]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Open Issues"})]})}),e.jsx(d,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.merged_prs_last_30_days}),e.jsx("p",{className:"text-sm text-gray-500",children:"Merged PRs (30d)"})]})}),e.jsx(d,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:i.commits_last_30_days}),e.jsx("p",{className:"text-sm text-gray-500",children:"Commits (30d)"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(d,{className:"lg:col-span-1",children:[e.jsx(k,{children:e.jsx(T,{children:"Tracked Repositories"})}),e.jsx(r,{children:i?.repos?.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(w,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No repositories tracked yet"}),e.jsxs(n,{variant:"outline",className:"mt-4",onClick:()=>u(!0),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Add Your First Repo"]})]}):e.jsx("div",{className:"space-y-2",children:i?.repos?.map(s=>e.jsx("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${t?.id===s.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>K(s),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:s.full_name}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:s.description||"No description"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-3 w-3"}),s.stars_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-3 w-3"}),s.open_prs_count]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),s.open_issues_count]})]})]}),s.sync_error&&e.jsx(S,{className:"h-4 w-4 text-yellow-500 flex-shrink-0"})]})},s.id))})})]}),e.jsx(d,{className:"lg:col-span-2",children:t?e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[t.full_name,e.jsx("a",{href:t.html_url,target:"_blank",rel:"noopener noreferrer",className:"text-gray-400 hover:text-gray-600",children:e.jsx(Te,{className:"h-4 w-4"})})]}),e.jsx(ae,{children:t.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>Re(t),children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(n,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>{q(t),y(!0)},children:e.jsx(se,{className:"h-4 w-4"})})]})]}),t.last_synced_at&&e.jsxs("p",{className:"text-xs text-gray-400 flex items-center gap-1 mt-2",children:[e.jsx(Ae,{className:"h-3 w-3"}),"Last synced: ",b(t.last_synced_at)]})]}),e.jsx(r,{children:be?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(f,{className:"h-6 w-6 animate-spin text-gray-400"})}):e.jsxs(Ee,{defaultValue:"pulls",children:[e.jsxs(Me,{children:[e.jsxs(A,{value:"pulls",className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-4 w-4"}),"PRs (",c.pulls.length,")"]}),e.jsxs(A,{value:"issues",className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-4 w-4"}),"Issues (",c.issues.length,")"]}),e.jsxs(A,{value:"commits",className:"flex items-center gap-1",children:[e.jsx(He,{className:"h-4 w-4"}),"Commits (",c.commits.length,")"]})]}),e.jsx(H,{value:"pulls",className:"mt-4",children:c.pulls.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No pull requests"}):e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(_,{children:[e.jsx(m,{children:"PR"}),e.jsx(m,{children:"Author"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Updated"})]})}),e.jsx(je,{children:c.pulls.slice(0,10).map(s=>e.jsxs(_,{children:[e.jsxs(h,{children:[e.jsxs("a",{href:s.html_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:["#",s.pr_number]}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:s.title})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.author_avatar_url&&e.jsx("img",{src:s.author_avatar_url,alt:s.author,className:"w-5 h-5 rounded-full"}),e.jsx("span",{className:"text-sm",children:s.author})]})}),e.jsx(h,{children:e.jsx(re,{variant:"outline",className:s.state==="merged"?"bg-purple-100 text-purple-800":s.state==="open"?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:s.state})}),e.jsx(h,{className:"text-sm text-gray-500",children:b(s.updated_at)})]},s.id))})]})}),e.jsx(H,{value:"issues",className:"mt-4",children:c.issues.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No issues"}):e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(_,{children:[e.jsx(m,{children:"Issue"}),e.jsx(m,{children:"Author"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Updated"})]})}),e.jsx(je,{children:c.issues.slice(0,10).map(s=>e.jsxs(_,{children:[e.jsxs(h,{children:[e.jsxs("a",{href:s.html_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:["#",s.issue_number]}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:s.title})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.author_avatar_url&&e.jsx("img",{src:s.author_avatar_url,alt:s.author,className:"w-5 h-5 rounded-full"}),e.jsx("span",{className:"text-sm",children:s.author})]})}),e.jsx(h,{children:e.jsx(re,{variant:"outline",className:s.state==="open"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.state})}),e.jsx(h,{className:"text-sm text-gray-500",children:b(s.updated_at)})]},s.id))})]})}),e.jsx(H,{value:"commits",className:"mt-4",children:c.commits.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No commits"}):e.jsx("div",{className:"space-y-2",children:c.commits.slice(0,15).map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-2 hover:bg-gray-50 rounded",children:[s.author_avatar_url&&e.jsx("img",{src:s.author_avatar_url,alt:s.author_name,className:"w-6 h-6 rounded-full mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("a",{href:s.html_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm hover:text-blue-600 line-clamp-2",children:s.message?.split(`
`)[0]}),e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-2 mt-1",children:[e.jsx("span",{children:s.author_name}),e.jsx("span",{children:"·"}),e.jsx("span",{children:b(s.committed_at)}),e.jsx("span",{children:"·"}),e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:s.sha?.substring(0,7)})]})]})]},s.id))})})]})})]}):e.jsx(r,{className:"flex items-center justify-center py-20 text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Select a repository to view details"})]})})})]})]}),e.jsx(ne,{open:Ne,onOpenChange:u,children:e.jsxs(ie,{className:"sm:max-w-lg",children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Add Repository"}),e.jsx(de,{children:"Enter a repository name (owner/repo) or search for repositories"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Le,{placeholder:"e.g., facebook/react or search term",value:j,onChange:s=>L(s.target.value),onKeyDown:s=>s.key==="Enter"&&Y()}),e.jsx(n,{onClick:Y,disabled:B||!j.trim(),children:B?e.jsx(f,{className:"h-4 w-4 animate-spin"}):e.jsx(Ge,{className:"h-4 w-4"})})]}),E.length>0&&e.jsx("div",{className:"border rounded-lg max-h-64 overflow-y-auto",children:E.map(s=>e.jsx("div",{className:"p-3 hover:bg-gray-50 border-b last:border-b-0 cursor-pointer",onClick:()=>J(s.full_name),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.full_name}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:s.description||"No description"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(C,{className:"h-4 w-4"}),s.stars]})]})},s.full_name))}),ye&&e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(f,{className:"h-5 w-5 animate-spin mr-2"}),"Adding repository..."]})]}),e.jsx(xe,{children:e.jsx(n,{variant:"outline",onClick:()=>u(!1),children:"Cancel"})})]})}),e.jsx(ne,{open:we,onOpenChange:y,children:e.jsxs(ie,{children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Remove Repository?"}),e.jsxs(de,{children:["This will stop tracking ",v?.full_name," and remove all cached data. This action cannot be undone."]})]}),e.jsxs(xe,{children:[e.jsx(n,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(n,{variant:"destructive",onClick:Ce,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]})})]})})}export{Je as default};
