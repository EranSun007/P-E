import{j as e,aK as X,ax as oe,az as q,p as ce,aP as de,aR as me,aS as he,T as xe,b7 as ge,D as ue,aw as je,b5 as pe,b6 as ve,aY as ye}from"./chunk-WPKCbDK8.js";import{h as fe,a as d}from"./chunk-BKwDNIOR.js";import{g as F,B as N,R as $,T as be,M as Ne,a as Ce,c as we,I as h,C as ke,h as Ae,H as _e,J as Pe,K as De,i as Se,m as K,j as Fe,q as $e,L as c,t as Te,r as Le}from"./index-CnhOL4vI.js";import{A as Me}from"./chunk-Cr8iT9Hq.js";import{B as b}from"./chunk-DIYexMSd.js";import{D as ze,a as Ee,b as Ie,c as Be,d as Re}from"./chunk-D8_EjMoV.js";import{S as Q,a as Y,b as G,c as J,d as x}from"./chunk-BOs1hDSJ.js";import{D as Ue,a as Ve,b as He,d as W}from"./chunk-Di6AD2c4.js";import{T as Oe}from"./chunk-DXrvJpCX.js";import{A as qe}from"./chunk-CdSpngk7.js";import"./chunk-DGs6foQ1.js";import"./chunk-BwuEqr1N.js";import"./chunk-BdHZTqfh.js";import"./chunk-p5_VtM_5.js";function Ke({count:u=0,unresolvedCount:A=0,hasUnresolved:B=!1,onClick:C,memberName:T="",size:j="default",showIcon:L=!0,className:R=""}){if(u===0)return null;const y=typeof C=="function",n=A>0,_=()=>{const m="transition-all duration-200",f={sm:"text-xs px-2 py-0.5",default:"text-xs px-2.5 py-0.5",lg:"text-sm px-3 py-1"};let g="";n?g="bg-orange-100 text-orange-800 border-orange-200 hover:bg-orange-200":g="bg-green-100 text-green-800 border-green-200 hover:bg-green-200";const l=y?"cursor-pointer hover:shadow-sm active:scale-95":"";return F(m,f[j],g,l,R)},M=()=>{if(!L)return null;const m=j==="sm"?"h-3 w-3":"h-3.5 w-3.5";return n?e.jsx(X,{className:F(m,"mr-1")}):e.jsx(oe,{className:F(m,"mr-1")})},p=()=>n?`${A} pending`:`${u} item${u!==1?"s":""}`,v=()=>{const m=u===1?"agenda item":"agenda items",f=n?`${A} pending`:"all resolved";return`${T} has ${u} ${m}, ${f}${y?". Click to view details.":""}`},P=y?N:"div",z=y?{variant:"ghost",size:"sm",onClick:C,className:F("h-auto p-0 hover:bg-transparent",_()),"aria-label":v()}:{className:_(),"aria-label":v()};return e.jsx(P,{...z,children:e.jsxs("div",{className:"flex items-center",children:[M(),e.jsx("span",{className:"font-medium",children:p()})]})})}function ia(){const u=fe(),[A,B]=d.useState([]),[C,T]=d.useState([]),[j,L]=d.useState([]),[R,y]=d.useState({}),[n,_]=d.useState(""),[M,p]=d.useState(!1),[v,P]=d.useState(null),[z,m]=d.useState(!0),[f,g]=d.useState(null),[l,D]=d.useState({name:"",role:"",email:"",phone:"",department:"",organization:"",collaboration_context:"",relationship_type:"cross_team",availability:"full_time",skills:[],notes:"",avatar:""});d.useEffect(()=>{E()},[]);const E=async()=>{m(!0),g(null);try{const[a,t,s]=await Promise.all([$.list().catch(()=>[]),be.list().catch(()=>[]),Ne.list().catch(()=>[])]);B(t||[]),L(s||[]);let i={};try{i=await Me.getAgendaSummaryForAllPeers?.()||{}}catch(w){console.error("Failed to load agenda data:",w)}y(i);const r=(a||[]).map(w=>{const S=(t||[]).filter(k=>(k.metadata?.meeting?.participants||[]).includes(w.name));let I=null;S.length>0&&(I=S.reduce((k,ie)=>{const O=new Date(ie.created_date);return!k||O>k?O:k},null));const ne=i[w.id]||{count:0,recentItems:[],hasUnresolved:!1};return{...w,tasks:S,taskCount:S.length,lastActivity:I?I.toISOString():null,agenda:ne}});T(r)}catch(a){console.error("Failed to load peers:",a),g("Failed to load peers. Please try again.")}finally{m(!1)}},U=()=>{D({name:"",role:"",email:"",phone:"",department:"",organization:"",collaboration_context:"",relationship_type:"cross_team",availability:"full_time",skills:[],notes:"",avatar:""}),P(null),p(!0)},Z=a=>{a&&(D({name:a.name||"",role:a.role||"",email:a.email||"",phone:a.phone||"",department:a.department||"",organization:a.organization||"",collaboration_context:a.collaboration_context||"",relationship_type:a.relationship_type||"cross_team",availability:a.availability||"full_time",skills:Array.isArray(a.skills)?a.skills:[],notes:a.notes||"",avatar:a.avatar||""}),P(a),p(!0))},o=(a,t)=>{if(a==="skills"){const s=Array.isArray(t)?t:[];D(i=>({...i,[a]:s}))}else D(s=>({...s,[a]:t}))},ee=async()=>{try{v?await $.update(v.id,l):await $.create(l),p(!1),await E()}catch(a){console.error("Failed to save peer:",a),g("Failed to save peer. Please try again.")}},ae=async a=>{try{await $.delete(a),await E()}catch(t){console.error("Failed to delete peer:",t),g("Failed to delete peer. Please try again.")}},V=n?C.filter(a=>a.name.toLowerCase().includes(n.toLowerCase())||(a.role||"").toLowerCase().includes(n.toLowerCase())||(a.department||"").toLowerCase().includes(n.toLowerCase())||(a.organization||"").toLowerCase().includes(n.toLowerCase())||(a.collaboration_context||"").toLowerCase().includes(n.toLowerCase())||(a.relationship_type||"").toLowerCase().includes(n.toLowerCase())||Array.isArray(a.skills)&&a.skills.some(t=>t.toLowerCase().includes(n.toLowerCase()))):C,se=a=>a.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2),te=a=>{const t=["bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-purple-100 text-purple-800","bg-pink-100 text-pink-800","bg-yellow-100 text-yellow-800","bg-indigo-100 text-indigo-800","bg-red-100 text-red-800","bg-orange-100 text-orange-800"],s=a.split("").reduce((i,r)=>i+r.charCodeAt(0),0)%t.length;return t[s]},le=a=>{if(!a)return"No recent activity";const t=new Date(a),i=new Date-t,r=Math.floor(i/(1e3*60*60*24));return r===0?"Today":r===1?"Yesterday":r<7?`${r} days ago`:r<30?`${Math.floor(r/7)} week${Math.floor(r/7)>1?"s":""} ago`:r<365?`${Math.floor(r/30)} month${Math.floor(r/30)>1?"s":""} ago`:`${Math.floor(r/365)} year${Math.floor(r/365)>1?"s":""} ago`},re=a=>{const t={full_time:"bg-green-100 text-green-800",part_time:"bg-blue-100 text-blue-800",contractor:"bg-orange-100 text-orange-800",remote:"bg-purple-100 text-purple-800"},s={full_time:"Full-time",part_time:"Part-time",contractor:"Contractor",remote:"Remote"};return e.jsx(b,{className:t[a]||"bg-gray-100 text-gray-800",children:s[a]||a})},H=a=>{u(Le("PeerProfile")+`?id=${a}`)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Peers"}),e.jsxs(N,{onClick:U,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add Peer"]})]}),f&&e.jsx(Ce,{variant:"destructive",className:"mb-6",children:e.jsx(we,{children:f})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(h,{placeholder:"Search peers by name, role, organization, department, context, or skills...",value:n,onChange:a=>_(a.target.value),className:"pl-9"})]}),z?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading peers..."})]}):V.length===0?e.jsx("div",{className:"text-center p-12 border border-dashed rounded-lg",children:n?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No peers found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search term"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No peers yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add peers to track cross-team and external collaborators"}),e.jsxs(N,{onClick:U,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add First Peer"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:V.map(a=>{const t=te(a.name);return e.jsxs(ke,{className:"overflow-hidden",children:[e.jsxs(Ae,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 cursor-pointer group",onClick:()=>H(a.id),children:[e.jsxs(_e,{className:`h-12 w-12 ${a.avatar?"":t} ring-2 ring-white transition-transform group-hover:scale-105`,children:[a.avatar?e.jsx(Pe,{src:a.avatar,alt:a.name}):null,e.jsx(De,{children:se(a.name)})]}),e.jsxs("div",{children:[e.jsx(Se,{className:"group-hover:text-indigo-600 transition-colors",children:a.name}),a.role&&e.jsx(K,{className:"mt-1",children:a.role}),a.organization&&e.jsxs(K,{className:"mt-1 flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),a.organization]})]})]}),e.jsxs(Ue,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(He,{align:"end",children:[e.jsxs(W,{onClick:()=>Z(a),children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(W,{onClick:()=>ae(a.id),className:"text-red-600",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[a.department&&e.jsxs(b,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),a.department]}),a.relationship_type&&e.jsxs(b,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),a.relationship_type.replace(/_/g," ")]}),a.collaboration_context&&e.jsxs(b,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),a.collaboration_context]}),a.availability&&re(a.availability),a.agenda&&e.jsx(Ke,{count:a.agenda.count,unresolvedCount:a.agenda.hasUnresolved?a.agenda.count:0,hasUnresolved:a.agenda.hasUnresolved,onClick:()=>H(a.id),memberName:a.name,size:"sm"})]})]}),e.jsxs(Fe,{className:"space-y-4",children:[Array.isArray(a.skills)&&a.skills.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"Skills"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Array.isArray(a.skills)&&a.skills.map((s,i)=>e.jsx(b,{variant:"outline",className:"text-xs",children:s},i))})]}),a.notes&&e.jsx("p",{className:"text-sm text-gray-600",children:a.notes}),Array.isArray(a.tasks)&&a.tasks.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Recent Meetings"}),e.jsx("div",{className:"space-y-2",children:a.tasks.filter(s=>s.type==="meeting").sort((s,i)=>new Date(i.created_date)-new Date(s.created_date)).slice(0,2).map(s=>e.jsx("div",{className:"p-2 bg-gray-50 rounded-md text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"truncate",children:s.title}),e.jsxs(b,{variant:"outline",className:"ml-2 flex items-center gap-1 whitespace-nowrap",children:[e.jsx(ve,{className:"h-3 w-3"}),s.status]})]})},s.id))})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),le(a.lastActivity)]}),a.taskCount>0&&e.jsxs("span",{children:[a.taskCount," meetings"]})]}),j.length>0&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-2",children:"Add to team member agendas:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[j.slice(0,2).map(s=>e.jsx(qe,{teamMemberId:s.id,teamMemberName:s.name,sourceItem:{title:`Peer: ${a.name}`,description:`${a.role?`${a.role} - `:""}${a.organization||""}${a.collaboration_context?` | Context: ${a.collaboration_context}`:""}${a.notes?` | ${a.notes}`:""}`,type:"peer",id:a.id,relationship_type:a.relationship_type,department:a.department},variant:"ghost",size:"xs",showAgendaAction:!0,showPersonalFileAction:!0},s.id)),j.length>2&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",j.length-2," more"]})]})]})]}),a.email&&e.jsx($e,{className:"border-t pt-4",children:e.jsxs("a",{href:`mailto:${a.email}`,className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(ye,{className:"h-3.5 w-3.5"}),a.email]})})]},a.id)})})]}),e.jsx(ze,{open:M,onOpenChange:p,children:e.jsxs(Ee,{className:"sm:max-w-md",children:[e.jsx(Ie,{children:e.jsx(Be,{children:v?"Edit Peer":"Add Peer"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Name"}),e.jsx(h,{id:"name",value:l.name,onChange:a=>o("name",a.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"role",children:"Role / Position"}),e.jsx(h,{id:"role",value:l.role,onChange:a=>o("role",a.target.value),placeholder:"e.g. Product Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"department",children:"Department"}),e.jsx(h,{id:"department",value:l.department,onChange:a=>o("department",a.target.value),placeholder:"e.g. Engineering"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"organization",children:"Group"}),e.jsx(h,{id:"organization",value:l.organization,onChange:a=>o("organization",a.target.value),placeholder:"e.g. Acme Corp"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:l.email,onChange:a=>o("email",a.target.value),placeholder:"Email address"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"phone",children:"Phone"}),e.jsx(h,{id:"phone",type:"tel",value:l.phone,onChange:a=>o("phone",a.target.value),placeholder:"Phone number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"relationship_type",children:"Relationship Type"}),e.jsxs(Q,{value:l.relationship_type,onValueChange:a=>o("relationship_type",a),children:[e.jsx(Y,{children:e.jsx(G,{placeholder:"Select relationship type"})}),e.jsxs(J,{children:[e.jsx(x,{value:"cross_team",children:"Cross-team"}),e.jsx(x,{value:"external_partner",children:"External Partner"}),e.jsx(x,{value:"client_contact",children:"Client Contact"}),e.jsx(x,{value:"contractor",children:"Contractor"}),e.jsx(x,{value:"other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"collaboration_context",children:"Collaboration Context"}),e.jsx(h,{id:"collaboration_context",value:l.collaboration_context,onChange:a=>o("collaboration_context",a.target.value),placeholder:"e.g. Project Apollo, Vendor Management"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"availability",children:"Availability"}),e.jsxs(Q,{value:l.availability,onValueChange:a=>o("availability",a),children:[e.jsx(Y,{children:e.jsx(G,{placeholder:"Select availability"})}),e.jsxs(J,{children:[e.jsx(x,{value:"full_time",children:"Full-time"}),e.jsx(x,{value:"part_time",children:"Part-time"}),e.jsx(x,{value:"contractor",children:"Contractor"}),e.jsx(x,{value:"remote",children:"Remote"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"skills",children:"Skills"}),e.jsx(Oe,{value:l.skills||[],onChange:a=>o("skills",a),placeholder:"Enter skills, press Enter or comma to add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Enter or comma after each skill"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"avatar",children:"Avatar URL (optional)"}),e.jsx(h,{id:"avatar",value:l.avatar,onChange:a=>o("avatar",a.target.value),placeholder:"https://example.com/avatar.jpg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"notes",children:"Notes"}),e.jsx(Te,{id:"notes",value:l.notes,onChange:a=>o("notes",a.target.value),placeholder:"Additional information about this peer",rows:3})]})]}),e.jsxs(Re,{children:[e.jsx(N,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(N,{onClick:ee,children:v?"Update":"Add"})]})]})})]})}export{ia as default};
