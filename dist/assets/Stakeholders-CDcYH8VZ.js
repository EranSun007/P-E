import{j as e,az as D,p as q,aO as W,aP as X,aQ as Y,D as Z}from"./chunk-WPKCbDK8.js";import{a as c}from"./chunk-BKwDNIOR.js";import{A as ee,d as ae,u as se,B as p,I as g,C as L,L as d,S as z,l as P,h as te,i as ne,j as le}from"./index-B5nMAt-E.js";import{c as k}from"./chunk-DR7VNuLi.js";import{a as re,b as ie,c as oe}from"./chunk-uiVOWrDz.js";import{D as ce,a as de,b as me,c as ge,d as pe}from"./chunk-g5LiUroS.js";import{S as B,a as I,b as U,c as F,d as j}from"./chunk-CRMqQcWA.js";import{B as S}from"./chunk-zVvAqB5a.js";import{A as ue,a as xe,b as he,c as je}from"./chunk-CiXz4qex.js";import"./chunk-DGs6foQ1.js";import"./chunk-BwuEqr1N.js";function ze(){const{stakeholders:N,loading:M,refreshAll:G}=c.useContext(ee),{isPresentationMode:v}=ae(),[x,V]=c.useState([]),[K,h]=c.useState(!1),[f,O]=c.useState(""),[w,C]=c.useState(null),[l,_]=c.useState(null),[o,b]=c.useState("flat"),[r,i]=c.useState({name:"",role:"",email:"",phone:"",company:"",influence_level:"medium",engagement_level:"active",contact_info:"",notes:"",tags:[],department:"",stakeholder_group:""});c.useEffect(()=>{V(Array.isArray(N)?N:[])},[N]);const R=async()=>{C(null);try{await G()}catch(a){P.error("Failed to refresh stakeholders",{error:String(a)}),C("Failed to load stakeholders")}},T=()=>{i({name:"",role:"",email:"",phone:"",company:"",influence_level:"medium",engagement_level:"active",contact_info:"",notes:"",tags:[],department:"",stakeholder_group:""}),_(null),h(!0)},H=a=>{i({name:a.name||"",role:a.role||"",email:a.email||"",phone:a.phone||"",company:a.company||a.organization||"",influence_level:a.influence_level||a.influence||"medium",engagement_level:a.engagement_level||"active",contact_info:a.contact_info||"",notes:a.notes||a.description||"",tags:Array.isArray(a.tags)?a.tags:[],department:a.department||"",stakeholder_group:a.stakeholder_group||""}),_(a),h(!0)},Q=async()=>{try{l?await z.update(l.id,r):await z.create(r),h(!1),R()}catch(a){P.error(`Failed to ${l?"update":"create"} stakeholder`,{error:String(a)}),C(`Failed to ${l?"update":"create"} stakeholder`)}};if(M)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading stakeholders..."})]})});const m=(x||[]).filter(a=>{if(!a)return!1;const s=(f||"").toLowerCase(),u=(a.name||"").toLowerCase(),t=(a.role||"").toLowerCase(),n=(a.company||a.organization||"").toLowerCase(),$=(a.department||"").toLowerCase(),J=(a.stakeholder_group||"").toLowerCase();return u.includes(s)||t.includes(s)||n.includes(s)||$.includes(s)||J.includes(s)}),E=o==="department"?(a=>{const s={};return a.forEach(t=>{const n=t.department||"Unassigned";s[n]||(s[n]=[]),s[n].push(t)}),Object.keys(s).sort((t,n)=>t==="Unassigned"?1:n==="Unassigned"?-1:t.localeCompare(n)).map(t=>({label:t,items:s[t]}))})(m):o==="group"?(a=>{const s={};return a.forEach(t=>{const n=t.stakeholder_group||"Unassigned";s[n]||(s[n]=[]),s[n].push(t)}),Object.keys(s).sort((t,n)=>t==="Unassigned"?1:n==="Unassigned"?-1:t.localeCompare(n)).map(t=>({label:t,items:s[t]}))})(m):null,A=(a,s)=>{const u=v?re(a.name,s,"Stakeholder"):a.name||"Unnamed Stakeholder",t=v?ie(a.email):a.email,n=v?oe(a.notes||a.description):a.notes||a.description;return e.jsxs(L,{children:[e.jsxs(te,{children:[e.jsx(ne,{children:u}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(S,{className:(a.influence_level||a.influence)==="high"?"bg-red-100 text-red-800":(a.influence_level||a.influence)==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800",children:[a.influence_level||a.influence||"medium"," influence"]}),e.jsx(S,{className:a.engagement_level==="active"?"bg-green-100 text-green-800":a.engagement_level==="passive"?"bg-gray-100 text-gray-800":"bg-orange-100 text-orange-800",children:a.engagement_level||"active"})]})]}),e.jsxs(le,{children:[a.role&&e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:a.role}),(a.company||a.organization)&&e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:a.company||a.organization}),a.department&&e.jsxs("p",{className:"text-sm text-gray-500 mb-1",children:["Dept: ",a.department]}),a.stakeholder_group&&e.jsxs("p",{className:"text-sm text-gray-500 mb-1",children:["Group: ",a.stakeholder_group]}),a.email&&e.jsx("p",{className:v?"text-sm text-gray-400 mb-1":"text-sm text-blue-600 mb-1",children:t}),(a.notes||a.description)&&e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:n}),e.jsx(p,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>H(a),children:"Edit"})]})]},a.id||Math.random())},{updatePageContext:y}=se();return c.useEffect(()=>{const a=k(m,{},l);y({page:"/stakeholders",summary:a,selection:l?{id:l.id,type:"stakeholder"}:null,data:{stakeholderCount:m.length,totalCount:x.length,viewMode:o}})},[m,f,l,x.length,o,y]),c.useEffect(()=>{const a=()=>{const s=k(m,{},l);y({page:"/stakeholders",summary:s,selection:l?{id:l.id,type:"stakeholder"}:null,data:{stakeholderCount:m.length,totalCount:x.length,viewMode:o}})};return window.addEventListener("ai-context-refresh",a),()=>window.removeEventListener("ai-context-refresh",a)},[m,f,l,x.length,o,y]),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Stakeholders"}),e.jsxs(p,{onClick:T,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add Stakeholder"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(g,{placeholder:"Search stakeholders...",value:f,onChange:a=>O(a.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-1 border rounded-md p-1",children:[e.jsxs(p,{size:"sm",variant:o==="flat"?"default":"ghost",onClick:()=>b("flat"),children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Flat"]}),e.jsxs(p,{size:"sm",variant:o==="department"?"default":"ghost",onClick:()=>b("department"),children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Dept"]}),e.jsxs(p,{size:"sm",variant:o==="group"?"default":"ghost",onClick:()=>b("group"),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Group"]})]})]}),w&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 text-red-600 rounded-md",children:w}),x.length===0?e.jsxs(L,{className:"text-center p-12",children:[e.jsx(Z,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No stakeholders yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first stakeholder to get started"}),e.jsxs(p,{onClick:()=>h(!0),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add First Stakeholder"]})]}):o==="flat"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((a,s)=>a&&A(a,s))}):e.jsx(ue,{type:"multiple",defaultValue:E.map(a=>a.label),className:"space-y-4",children:E.map(a=>e.jsxs(xe,{value:a.label,className:"border rounded-lg px-4",children:[e.jsx(he,{className:"hover:no-underline",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:a.label}),e.jsx(S,{variant:"secondary",children:a.items.length})]})}),e.jsx(je,{children:a.items.length===0?e.jsxs("p",{className:"text-gray-500 text-sm py-4",children:["No stakeholders in this ",o==="department"?"department":"group"]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 py-4",children:a.items.map(s=>{const u=m.findIndex(t=>t.id===s.id);return A(s,u)})})})]},a.label))}),e.jsx(ce,{open:K,onOpenChange:h,children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsx(ge,{children:l?"Edit Stakeholder":"Add New Stakeholder"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Name"}),e.jsx(g,{value:r.name,onChange:a=>i(s=>({...s,name:a.target.value})),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Role"}),e.jsx(g,{value:r.role,onChange:a=>i(s=>({...s,role:a.target.value})),placeholder:"Job title or role"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Company"}),e.jsx(g,{value:r.company,onChange:a=>i(s=>({...s,company:a.target.value})),placeholder:"Company name"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Email"}),e.jsx(g,{type:"email",value:r.email,onChange:a=>i(s=>({...s,email:a.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Phone"}),e.jsx(g,{type:"tel",value:r.phone,onChange:a=>i(s=>({...s,phone:a.target.value})),placeholder:"Phone number"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Influence Level"}),e.jsxs(B,{value:r.influence_level,onValueChange:a=>i(s=>({...s,influence_level:a})),children:[e.jsx(I,{children:e.jsx(U,{placeholder:"Select influence level"})}),e.jsxs(F,{children:[e.jsx(j,{value:"low",children:"Low"}),e.jsx(j,{value:"medium",children:"Medium"}),e.jsx(j,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Engagement Level"}),e.jsxs(B,{value:r.engagement_level,onValueChange:a=>i(s=>({...s,engagement_level:a})),children:[e.jsx(I,{children:e.jsx(U,{placeholder:"Select engagement level"})}),e.jsxs(F,{children:[e.jsx(j,{value:"active",children:"Active"}),e.jsx(j,{value:"passive",children:"Passive"}),e.jsx(j,{value:"resistant",children:"Resistant"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Department"}),e.jsx(g,{value:r.department,onChange:a=>i(s=>({...s,department:a.target.value})),placeholder:"e.g., Engineering, Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Group"}),e.jsx(g,{value:r.stakeholder_group,onChange:a=>i(s=>({...s,stakeholder_group:a.target.value})),placeholder:"e.g., Executive, Partner"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Contact Info"}),e.jsx(g,{value:r.contact_info,onChange:a=>i(s=>({...s,contact_info:a.target.value})),placeholder:"Additional contact information"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Notes"}),e.jsx(g,{value:r.notes,onChange:a=>i(s=>({...s,notes:a.target.value})),placeholder:"Additional notes about this stakeholder"})]})]}),e.jsxs(pe,{children:[e.jsx(p,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(p,{onClick:Q,children:l?"Update Stakeholder":"Create Stakeholder"})]})]})})]})})}export{ze as default};
