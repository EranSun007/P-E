import{j as e,N as Z,Q as J,X as P,W as I,Y as K,Z as O,_ as ee,$ as se,a0 as H,S as ae,a1 as te,a2 as re}from"./chunk-CDfVSsCp.js";import{a as m}from"./chunk-pjYta8vt.js";import{I as ie,B as d,A as le,a as ne,b as ce,c as oe,T as A,l as b}from"./index-CjGPc2b_.js";import de from"./TaskCreationForm-B8jsWt0K.js";import{T as he}from"./chunk-WlZ0rc9l.js";import{D as _,a as G,b as R,c}from"./chunk-BrWpdzOD.js";import{B as F,S as V,a as $,b as me,c as q,d as u}from"./chunk-2Vqr1Avx.js";import{T as xe,a as ge,b as Q,c as S,d as ue,e as B}from"./chunk-CbeUZ2zF.js";import{f as pe}from"./chunk-DGzW4aIb.js";import"./chunk-KzYfAQy1.js";import"./chunk-BRoLf8OO.js";import"./chunk-D56rD7Tk.js";import"./chunk-BdHZTqfh.js";import"./chunk-DqGcurv-.js";import"./chunk-BaIpbNob.js";import"./chunk-CIxmFPsL.js";function ye({filters:h={status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"},setFilters:x,availableTags:k=[]}){const s={status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none",...h};s.status=Array.isArray(s.status)?s.status:[],s.priority=Array.isArray(s.priority)?s.priority:[],s.type=Array.isArray(s.type)?s.type:[],s.tags=Array.isArray(s.tags)?s.tags:[];const v=()=>{x({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"})},p=s.status.length>0||s.priority.length>0||s.type.length>0||s.tags.length>0||s.strategic!==null||s.search,i=(a,n)=>{const f=s[a]||[];x(N=>f.includes(n)?{...N,[a]:f.filter(C=>C!==n)}:{...N,[a]:[...f,n]})},y=a=>{i("tags",a)},j=a=>{x(n=>({...n,search:a.target.value}))},w=a=>{x(n=>({...n,strategic:a==="all"?null:a==="strategic"}))},g=a=>{x(n=>({...n,groupBy:a}))};return e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ie,{placeholder:"Search tasks...",value:s.search,onChange:j,className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Filters",p&&e.jsx(F,{className:"h-5 w-5 p-0 flex items-center justify-center",children:s.status.length+s.type.length+s.priority.length+s.tags.length+(s.strategic!==null?1:0)})]})}),e.jsxs(R,{className:"w-56",align:"end",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Status"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{checked:s.status.includes("todo"),onCheckedChange:()=>i("status","todo"),children:"Todo"}),e.jsx(c,{checked:s.status.includes("in_progress"),onCheckedChange:()=>i("status","in_progress"),children:"In Progress"}),e.jsx(c,{checked:s.status.includes("blocked"),onCheckedChange:()=>i("status","blocked"),children:"Blocked"}),e.jsx(c,{checked:s.status.includes("done"),onCheckedChange:()=>i("status","done"),children:"Done"})]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Type"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{checked:s.type.includes("generic"),onCheckedChange:()=>i("type","generic"),children:"Generic"}),e.jsx(c,{checked:s.type.includes("meeting"),onCheckedChange:()=>i("type","meeting"),children:"Meeting"}),e.jsx(c,{checked:s.type.includes("metric"),onCheckedChange:()=>i("type","metric"),children:"Metric"}),e.jsx(c,{checked:s.type.includes("action"),onCheckedChange:()=>i("type","action"),children:"Action"})]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Priority"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{checked:s.priority.includes("low"),onCheckedChange:()=>i("priority","low"),children:"Low"}),e.jsx(c,{checked:s.priority.includes("medium"),onCheckedChange:()=>i("priority","medium"),children:"Medium"}),e.jsx(c,{checked:s.priority.includes("high"),onCheckedChange:()=>i("priority","high"),children:"High"}),e.jsx(c,{checked:s.priority.includes("urgent"),onCheckedChange:()=>i("priority","urgent"),children:"Urgent"})]})]}),p&&e.jsx("div",{className:"border-t p-2",children:e.jsxs(d,{variant:"ghost",className:"w-full text-sm h-8 text-blue-600",onClick:v,children:[e.jsx(P,{className:"h-3.5 w-3.5 mr-1"})," Clear filters"]})})]})]}),e.jsxs(V,{value:s.strategic===null?"all":s.strategic?"strategic":"tactical",onValueChange:w,children:[e.jsx($,{className:"w-[130px]",children:e.jsx(me,{placeholder:"Focus"})}),e.jsxs(q,{children:[e.jsx(u,{value:"all",children:"All tasks"}),e.jsx(u,{value:"strategic",children:"Strategic"}),e.jsx(u,{value:"tactical",children:"Tactical"})]})]})]})]}),s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx(I,{className:"h-4 w-4 text-gray-500"}),s.tags.map(a=>e.jsxs(F,{variant:"secondary",className:"flex gap-1 items-center cursor-pointer",onClick:()=>y(a),children:[a,e.jsx(P,{className:"h-3 w-3"})]},a)),e.jsx(d,{variant:"ghost",size:"sm",className:"h-7 text-xs text-blue-600",onClick:()=>x(a=>({...a,tags:[]})),children:"Clear tags"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[k.length>0&&e.jsxs(_,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(I,{className:"h-3.5 w-3.5 mr-1"})," Tags"]})}),e.jsx(R,{children:e.jsx("div",{className:"grid grid-cols-2 gap-1 p-1",children:k.slice(0,10).map(a=>e.jsxs(d,{variant:"ghost",size:"sm",className:`text-xs justify-start ${s.tags.includes(a)?"bg-slate-100":""}`,onClick:()=>y(a),children:[s.tags.includes(a)&&e.jsx(K,{className:"h-3 w-3 mr-1"}),a]},a))})})]}),e.jsx("div",{children:e.jsxs(V,{value:s.groupBy,onValueChange:g,children:[e.jsx($,{className:"text-sm h-9",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"h-3.5 w-3.5 mr-2"}),"Group by"]})}),e.jsxs(q,{children:[e.jsx(u,{value:"none",children:"No grouping"}),e.jsx(u,{value:"type",children:"Type"}),e.jsx(u,{value:"priority",children:"Priority"}),e.jsx(u,{value:"strategic",children:"Strategic/Tactical"})]})]})})]}),p&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:v,className:"text-sm text-blue-600",children:[e.jsx(P,{className:"h-3.5 w-3.5 mr-1"})," Clear all filters"]})]})]})}function ze(){const{tasks:h,loading:x,refreshAll:k}=m.useContext(le),[s,v]=m.useState([]),[p,i]=m.useState(!1),[y,j]=m.useState(null),[w,g]=m.useState(null),[a,n]=m.useState({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"}),[f,N]=m.useState([]);m.useEffect(()=>{v(Array.isArray(h)?h:[])},[h]),m.useEffect(()=>{const t=new Set;(Array.isArray(s)?s:[]).forEach(l=>{Array.isArray(l?.tags)&&l.tags.forEach(r=>t.add(r))}),N(Array.from(t))},[s]);const C=async()=>{g(null);try{await k();const t=Array.isArray(h)?h:[],l=new Set;t.forEach(r=>{Array.isArray(r.tags)&&r.tags.forEach(o=>l.add(o))}),N(Array.from(l))}catch(t){b.error("Failed to refresh tasks",{error:String(t)}),g("Failed to load tasks. Please try again.")}},U=async t=>{if(!t){i(!1),j(null);return}try{y?await A.update(y.id,t):await A.create(t),await C(),i(!1),j(null)}catch(l){b.error("Failed to save task",{error:String(l)}),g("Failed to save task. Please try again.")}},z=async t=>{try{await A.delete(t.id),await C()}catch(l){b.error("Failed to delete task",{error:String(l)}),g("Failed to delete task. Please try again.")}},W=t=>{j(t),i(!0)},L=async(t,l)=>{try{await A.update(t.id,{...t,status:l}),await C()}catch(r){b.error("Failed to update task status",{error:String(r)}),g("Failed to update task status. Please try again.")}},E=(t=>{const l=Array.isArray(t)?t:[],r={...a,status:Array.isArray(a.status)?a.status:[],priority:Array.isArray(a.priority)?a.priority:[],type:Array.isArray(a.type)?a.type:[],tags:Array.isArray(a.tags)?a.tags:[]};return l.filter(o=>{if(r.status.length>0&&!r.status.includes(o.status)||r.type.length>0&&!r.type.includes(o.type)||r.priority.length>0&&!r.priority.includes(o.priority))return!1;if(r.tags.length>0){const T=Array.isArray(o.tags)?o.tags:[];if(!r.tags.some(D=>T.includes(D)))return!1}if(r.strategic!==null&&o.strategic!==r.strategic)return!1;if(r.search){const T=r.search.toLowerCase(),D=(o.title||"").toLowerCase().includes(T),Y=(o.description||"").toLowerCase().includes(T);if(!D&&!Y)return!1}return!0})})(s),X=E.filter(t=>t?.status!=="done"),M=E.filter(t=>t?.status==="done");return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tasks"}),!p&&e.jsxs(d,{onClick:()=>i(!0),className:"mt-4 sm:mt-0",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"New Task"]})]}),w&&e.jsxs(ne,{variant:"destructive",className:"mb-6",children:[e.jsx(ce,{children:"Error"}),e.jsx(oe,{children:w})]}),e.jsx(se,{mode:"wait",children:p?e.jsx(H.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-8",children:e.jsx(de,{onCreateTask:U,initialTaskData:y})}):e.jsxs(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(ye,{filters:a,setFilters:n,availableTags:f}),x?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading tasks..."})]}):e.jsx(e.Fragment,{children:E.length===0?e.jsxs("div",{className:"text-center p-12 border border-dashed rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No tasks found"}),e.jsx("p",{className:"text-gray-500",children:h.length===0?"Create your first task to get started":"Try adjusting your filters to see more tasks"}),h.length>0&&e.jsx(d,{variant:"outline",className:"mt-4",onClick:()=>n({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"}),children:"Clear all filters"})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{children:e.jsx(he,{tasks:X,onEditTask:W,onDeleteTask:z,onStatusChange:L,groupBy:a.groupBy==="none"?null:a.groupBy})}),M.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-gray-600",children:[e.jsx(ae,{className:"h-5 w-5"}),"Completed Tasks (",M.length,")"]}),e.jsx("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:e.jsxs(xe,{children:[e.jsx(ge,{children:e.jsxs(Q,{children:[e.jsx(S,{children:"Task"}),e.jsx(S,{children:"Type"}),e.jsx(S,{children:"Completed Date"}),e.jsx(S,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ue,{children:M.map(t=>e.jsxs(Q,{children:[e.jsxs(B,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t.title}),t.project&&e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["in ",t.project]})]}),t.tags?.length>0&&e.jsx("div",{className:"flex gap-1 mt-1",children:t.tags.map(l=>e.jsx(F,{variant:"secondary",className:"text-xs",children:l},l))})]}),e.jsx(B,{children:e.jsx(F,{variant:"outline",children:t.type})}),e.jsx(B,{children:pe(new Date(t.updated_date),"MMM d, yyyy")}),e.jsx(B,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>L(t,"todo"),title:"Mark as Todo",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>z(t),className:"text-red-500",title:"Delete",children:e.jsx(re,{className:"h-4 w-4"})})]})})]},t.id))})]})})]})]})})]})})]})})}export{ze as default};
