import{j as e,z as ae,aM as be,aN as He,r as Ce,ar as Ue,L as H,ax as ds,U as fe,aO as ms,J as ye,x as ie,aP as us,aQ as hs,a4 as xs,a5 as ps,X as js,y as Ge,k as gs,aR as fs,aS as Se,aJ as Pe,A as pe,ao as De,aT as Te,am as ys,aU as Fe,aV as Ee,T as Ae}from"./chunk-BlD_ekKQ.js";import{a as t}from"./chunk-BKwDNIOR.js";import{C as _,h as J,i as Y,m as te,j as B,a as U,b as we,c as G,L as y,I as P,n as ws,B as h,v as re,w as Me,U as je,k as ge,x as q,y as Le}from"./index-BPpXP9wP.js";import{T as bs,a as Ns,b as vs,c as ks}from"./chunk-COZz_0DJ.js";import{T as Oe,a as _e,b as oe,c as L,d as Be,e as I}from"./chunk-C_wS6JmM.js";import{B as K,D as Q,a as W,b as X,c as Z,e as ee,d as se}from"./chunk-CmitwiBI.js";import{D as ze,a as Ve,b as Je,d as de}from"./chunk-D-Q6W0fT.js";import{R as Cs,a as Ie}from"./chunk-fsVcrzvE.js";import{S as Ss,a as Ps,b as Ds,c as Ts,d as $e}from"./chunk-DBni0BOz.js";import{S as Fs}from"./chunk-DMX850LI.js";import"./chunk-P_BNsj9B.js";function Es(){const[o,w]=t.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[$,N]=t.useState(null),[v,x]=t.useState(null),[j,d]=t.useState(!1),b=(n,m)=>{w(C=>({...C,[n]:m}))},k=async n=>{if(n.preventDefault(),N(null),x(null),o.newPassword!==o.confirmPassword){N("New passwords do not match.");return}if(o.newPassword.length<6){N("New password must be at least 6 characters long.");return}d(!0);try{const m=await re.changePassword(o.currentPassword,o.newPassword);if(!m.success){N(m.error||"Failed to change password.");return}x("Password changed successfully!"),w({currentPassword:"",newPassword:"",confirmPassword:""})}catch(m){N(m.message||"Failed to change password. Please try again.")}finally{d(!1)}};return e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:"Change Password"}),e.jsx(te,{children:"Update your password here. Your new password must be at least 6 characters long."})]}),e.jsxs("form",{onSubmit:k,children:[e.jsxs(B,{className:"space-y-4",children:[$&&e.jsxs(U,{variant:"destructive",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(we,{children:"Error"}),e.jsx(G,{children:$})]}),v&&e.jsxs(U,{children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(we,{children:"Success"}),e.jsx(G,{children:v})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"currentPassword",children:"Current Password"}),e.jsx(P,{id:"currentPassword",type:"password",value:o.currentPassword,onChange:n=>b("currentPassword",n.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"newPassword",children:"New Password"}),e.jsx(P,{id:"newPassword",type:"password",value:o.newPassword,onChange:n=>b("newPassword",n.target.value),required:!0,minLength:6})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(P,{id:"confirmPassword",type:"password",value:o.confirmPassword,onChange:n=>b("confirmPassword",n.target.value),required:!0})]})]}),e.jsx(ws,{children:e.jsxs(h,{type:"submit",disabled:j,children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),j?"Saving...":"Save Changes"]})})]})]})}const ce="https://pe-manager-backend.cfapps.eu01-canary.hana.ondemand.com/api";function As(){const{user:o}=Me(),[w,$]=t.useState([]),[N,v]=t.useState(!0),[x,j]=t.useState(null),[d,b]=t.useState(null),[k,n]=t.useState(!1),[m,C]=t.useState(!1),[D,E]=t.useState(null),[f,S]=t.useState({username:"",password:"",email:"",name:"",role:"user"}),[T,M]=t.useState(""),[p,r]=t.useState(!1),u=o?.role==="admin";t.useEffect(()=>{u&&l()},[u]);const l=async()=>{v(!0),j(null);try{const a=re.getToken(),i=await fetch(`${ce}/users`,{headers:{Authorization:`Bearer ${a}`}});if(!i.ok)throw new Error("Failed to load users");const A=await i.json();$(A)}catch(a){j(a.message)}finally{v(!1)}},g=async()=>{r(!0),j(null);try{const a=re.getToken(),i=await fetch(`${ce}/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(f)}),A=await i.json();if(!i.ok)throw new Error(A.message||"Failed to create user");b(`User "${f.username}" created successfully!`),n(!1),S({username:"",password:"",email:"",name:"",role:"user"}),l()}catch(a){j(a.message)}finally{r(!1)}},z=async a=>{try{const i=re.getToken(),A=await fetch(`${ce}/users/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({is_active:!a.is_active})});if(!A.ok){const F=await A.json();throw new Error(F.message||"Failed to update user")}b(`User "${a.username}" ${a.is_active?"deactivated":"activated"} successfully!`),l()}catch(i){j(i.message)}},V=async()=>{if(!(!D||!T)){r(!0),j(null);try{const a=re.getToken(),i=await fetch(`${ce}/users/${D.id}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({newPassword:T})});if(!i.ok){const A=await i.json();throw new Error(A.message||"Failed to reset password")}b(`Password for "${D.username}" reset successfully!`),C(!1),E(null),M("")}catch(a){j(a.message)}finally{r(!1)}}},ne=a=>{E(a),M(""),C(!0)};return u?e.jsxs(_,{children:[e.jsx(J,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"User Management"]}),e.jsx(te,{children:"Create and manage user accounts for your team"})]}),e.jsxs(h,{onClick:()=>n(!0),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add User"]})]})}),e.jsxs(B,{className:"space-y-4",children:[x&&e.jsxs(U,{variant:"destructive",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(G,{children:x})]}),d&&e.jsxs(U,{children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(G,{children:d})]}),N?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-gray-400"})}):w.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found. Create your first user!"}):e.jsxs(Oe,{children:[e.jsx(_e,{children:e.jsxs(oe,{children:[e.jsx(L,{children:"Username"}),e.jsx(L,{children:"Name"}),e.jsx(L,{children:"Email"}),e.jsx(L,{children:"Role"}),e.jsx(L,{children:"Status"}),e.jsx(L,{children:"Last Login"}),e.jsx(L,{className:"w-[80px]",children:"Actions"})]})}),e.jsx(Be,{children:w.map(a=>e.jsxs(oe,{children:[e.jsx(I,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.role==="admin"?e.jsx(ds,{className:"h-4 w-4 text-amber-500"}):e.jsx(fe,{className:"h-4 w-4 text-gray-400"}),a.username,a.id===o?.id&&e.jsx(K,{variant:"outline",className:"ml-1",children:"You"})]})}),e.jsx(I,{children:a.name||"-"}),e.jsx(I,{children:a.email||"-"}),e.jsx(I,{children:e.jsx(K,{variant:a.role==="admin"?"default":"secondary",children:a.role})}),e.jsx(I,{children:e.jsx(K,{variant:a.is_active?"outline":"destructive",children:a.is_active?"Active":"Inactive"})}),e.jsx(I,{children:a.last_login?new Date(a.last_login).toLocaleDateString():"Never"}),e.jsx(I,{children:e.jsxs(ze,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ms,{className:"h-4 w-4"})})}),e.jsxs(Je,{align:"end",children:[e.jsx(de,{onClick:()=>ne(a),children:"Reset Password"}),a.id!==o?.id&&e.jsx(de,{onClick:()=>z(a),className:a.is_active?"text-red-600":"text-green-600",children:a.is_active?"Deactivate":"Activate"})]})]})})]},a.id))})]})]}),e.jsx(Q,{open:k,onOpenChange:n,children:e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Create New User"}),e.jsx(ee,{children:"Add a new user to the system. They will be able to login with the credentials you provide."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"username",children:"Username *"}),e.jsx(P,{id:"username",value:f.username,onChange:a=>S(i=>({...i,username:a.target.value})),placeholder:"Enter username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"password",children:"Password *"}),e.jsx(P,{id:"password",type:"password",value:f.password,onChange:a=>S(i=>({...i,password:a.target.value})),placeholder:"Enter password (min 6 characters)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",children:"Full Name"}),e.jsx(P,{id:"name",value:f.name,onChange:a=>S(i=>({...i,name:a.target.value})),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"email",children:"Email"}),e.jsx(P,{id:"email",type:"email",value:f.email,onChange:a=>S(i=>({...i,email:a.target.value})),placeholder:"Enter email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"role",children:"Role"}),e.jsxs(Ss,{value:f.role,onValueChange:a=>S(i=>({...i,role:a})),children:[e.jsx(Ps,{children:e.jsx(Ds,{placeholder:"Select role"})}),e.jsxs(Ts,{children:[e.jsx($e,{value:"user",children:"User"}),e.jsx($e,{value:"admin",children:"Admin"})]})]})]})]}),e.jsxs(se,{children:[e.jsx(h,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(h,{onClick:g,disabled:p||!f.username||!f.password,children:p?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create User"})]})]})}),e.jsx(Q,{open:m,onOpenChange:C,children:e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Reset Password"}),e.jsxs(ee,{children:["Set a new password for ",D?.username,". They will need to use this password to login."]})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"newPassword",children:"New Password"}),e.jsx(P,{id:"newPassword",type:"password",value:T,onChange:a=>M(a.target.value),placeholder:"Enter new password (min 6 characters)"})]})}),e.jsxs(se,{children:[e.jsx(h,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(h,{onClick:V,disabled:p||!T||T.length<6,children:p?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Resetting..."]}):"Reset Password"})]})]})})]}):e.jsxs(_,{children:[e.jsx(J,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"User Management"]})}),e.jsx(B,{children:e.jsxs(U,{children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(G,{children:"You must be an administrator to manage users."})]})})]})}function Ls(){const[o,w]=t.useState(null),[$,N]=t.useState(!0),[v,x]=t.useState(!1),[j,d]=t.useState(""),[b,k]=t.useState(!1),[n,m]=t.useState(null),[C,D]=t.useState(null),[E,f]=t.useState(!1);t.useEffect(()=>{S()},[]);const S=async()=>{N(!0),m(null);try{const p=await je.getGitHubStatus();w(p)}catch(p){console.error("Failed to load GitHub status:",p),m("Failed to check GitHub connection status")}finally{N(!1)}},T=async p=>{if(p.preventDefault(),!j.trim()){m("Please enter a GitHub Personal Access Token");return}x(!0),m(null),D(null);try{const r=await je.setGitHubToken(j.trim());w({connected:!0,user:r.user}),d(""),D(`Connected to GitHub as ${r.user.login}`)}catch(r){console.error("Failed to connect GitHub:",r),m(r.message||"Failed to connect to GitHub. Please check your token.")}finally{x(!1)}},M=async()=>{x(!0),m(null);try{await je.deleteGitHubToken(),w({connected:!1}),f(!1),D("Disconnected from GitHub")}catch(p){console.error("Failed to disconnect GitHub:",p),m("Failed to disconnect from GitHub")}finally{x(!1)}};return $?e.jsx(_,{children:e.jsxs(B,{className:"flex items-center justify-center py-8",children:[e.jsx(H,{className:"h-6 w-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading GitHub status..."})]})}):e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"GitHub Integration"]}),e.jsx(te,{children:"Connect your GitHub account to track repository progress, pull requests, issues, and commits"})]}),e.jsxs(B,{className:"space-y-6",children:[n&&e.jsxs(U,{variant:"destructive",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(G,{children:n})]}),C&&e.jsxs(U,{children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(G,{children:C})]}),o?.connected?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o.user?.avatar_url&&e.jsx("img",{src:o.user.avatar_url,alt:o.user.login,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:o.user?.name||o.user?.login}),e.jsxs(K,{variant:"outline",className:"bg-green-100 text-green-800 border-green-300",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),"Connected"]})]}),e.jsxs("a",{href:`https://github.com/${o.user?.login}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1",children:["@",o.user?.login,e.jsx(us,{className:"h-3 w-3"})]})]})]}),e.jsxs(h,{variant:"outline",onClick:()=>f(!0),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Disconnect"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"Your GitHub Personal Access Token is securely stored. You can now:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Track repositories from the GitHub page"}),e.jsx("li",{children:"View pull requests, issues, and commits"}),e.jsx("li",{children:"Monitor repository metrics and progress"})]})]})]}):e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"github-token",children:"Personal Access Token"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"github-token",type:b?"text":"password",value:j,onChange:p=>d(p.target.value),placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>k(!b),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:b?e.jsx(xs,{className:"h-4 w-4"}):e.jsx(ps,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Create a token at"," ",e.jsx("a",{href:"https://github.com/settings/tokens?type=beta",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"GitHub Settings → Developer Settings → Personal Access Tokens"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Required token permissions:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-green-600"}),e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"repo"})," - Read access to repositories"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-green-600"}),e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"read:user"})," - Read your profile"]})]})]}),e.jsx(h,{type:"submit",disabled:v||!j.trim(),children:v?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Connect GitHub"]})})]})]}),e.jsx(Q,{open:E,onOpenChange:f,children:e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Disconnect GitHub?"}),e.jsx(ee,{children:"This will remove your GitHub token and stop syncing repository data. Your tracked repositories will be kept, but metrics won't update until you reconnect."})]}),e.jsxs(se,{children:[e.jsx(h,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(h,{variant:"destructive",onClick:M,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Disconnecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"Disconnect"]})})]})]})})]})}const Re=[{key:"bug_inflow_rate",label:"Bug Inflow Rate",description:"Weekly bug creation rate"},{key:"median_ttfr_hours",label:"Time to First Response",description:"Median hours to first response"},{key:"sla_vh_percent",label:"SLA Compliance (VH)",description:"Very High priority SLA compliance"},{key:"sla_high_percent",label:"SLA Compliance (High)",description:"High priority SLA compliance"},{key:"backlog_health_score",label:"Backlog Health Score",description:"Overall backlog health metric"}];function Is(){const[o,w]=t.useState({}),[$,N]=t.useState(!0),[v,x]=t.useState(null),[j,d]=t.useState(null),[b,k]=t.useState(null),[n,m]=t.useState(""),[C,D]=t.useState(!1),[E,f]=t.useState(!1);t.useEffect(()=>{S()},[]);const S=async()=>{N(!0),d(null);try{const r=await ge.emailPreferences.list(),u={};let l="";r.forEach(g=>{u[g.kpi_key]={enabled:g.enabled,email:g.email},g.email&&!l&&(l=g.email)}),w(u),m(l)}catch(r){console.error("Failed to load email preferences:",r),d("Failed to load email preferences. Please try again.")}finally{N(!1)}},T=async(r,u)=>{if(d(null),k(null),u&&!n){d("Please enter an email address before enabling notifications.");return}x(r);try{await ge.emailPreferences.update(r,{enabled:u,email:n}),w(l=>({...l,[r]:{enabled:u,email:n}})),k(`${u?"Enabled":"Disabled"} notifications for ${Re.find(l=>l.key===r)?.label||r}`),setTimeout(()=>k(null),3e3)}catch(l){console.error("Failed to update preference:",l),d("Failed to update notification preference. Please try again.")}finally{x(null)}},M=r=>{m(r),D(!0),d(null),k(null)},p=async()=>{if(!n){d("Please enter a valid email address.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){d("Please enter a valid email address.");return}f(!0),d(null),k(null);try{const u=Object.entries(o).filter(([l,g])=>g.enabled).map(([l])=>l);for(const l of u)await ge.emailPreferences.update(l,{enabled:!0,email:n});w(l=>{const g={...l};return u.forEach(z=>{g[z]&&(g[z].email=n)}),g}),D(!1),k(u.length>0?`Email updated for ${u.length} notification(s).`:"Email saved."),setTimeout(()=>k(null),3e3)}catch(u){console.error("Failed to save email:",u),d("Failed to save email address. Please try again.")}finally{f(!1)}};return $?e.jsx(_,{children:e.jsxs(B,{className:"flex items-center justify-center py-12",children:[e.jsx(H,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Loading preferences..."})]})}):e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"Email Notifications"]}),e.jsx(te,{children:"Receive email alerts when KPIs cross into red zone thresholds"})]}),e.jsxs(B,{className:"space-y-6",children:[j&&e.jsxs(U,{variant:"destructive",children:[e.jsx(gs,{className:"h-4 w-4"}),e.jsx(G,{children:j})]}),b&&e.jsxs(U,{children:[e.jsx(be,{className:"h-4 w-4 text-green-600"}),e.jsx(G,{className:"text-green-700",children:b})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(y,{htmlFor:"notification-email",className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-4 w-4"}),"Notification Email"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(P,{id:"notification-email",type:"email",placeholder:"you@example.com",value:n,onChange:r=>M(r.target.value),className:"flex-1"}),e.jsx(h,{onClick:p,disabled:!C||E,variant:C?"default":"outline",children:E?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"All KPI alert emails will be sent to this address."})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"KPI Alert Preferences"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enable or disable email notifications for individual KPIs when they enter red zone status."}),e.jsx("div",{className:"space-y-3",children:Re.map(r=>{const l=o[r.key]?.enabled||!1,g=v===r.key;return e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg border bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.label}),e.jsx("p",{className:"text-sm text-gray-500",children:r.description})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[g&&e.jsx(H,{className:"h-4 w-4 animate-spin text-gray-400"}),e.jsx(Fs,{checked:l,onCheckedChange:z=>T(r.key,z),disabled:g,"aria-label":`Enable email notifications for ${r.label}`})]})]},r.key)})})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 p-4 text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"How it works"}),e.jsx("p",{children:"When you upload a CSV with KPI data, the system automatically checks thresholds. If any enabled KPI crosses into the red zone, you'll receive an email alert with details and a link to the dashboard."})]})]})]})}function Js(){const{user:o}=Me(),[w,$]=t.useState([]),[N,v]=t.useState(!0),[x,j]=t.useState("priorities"),[d,b]=t.useState(""),[k,n]=t.useState(!1),[m,C]=t.useState(null),[D,E]=t.useState(null),[f,S]=t.useState(!1),[T,M]=t.useState(null),[p,r]=t.useState(!1),[u,l]=t.useState(null),[g,z]=t.useState("merge"),[V,ne]=t.useState(null),[a,i]=t.useState(!1),A=t.useRef(null),[F,me]=t.useState({type:"priority",name:"",description:"",color:"",order:0,default:!1}),ue={priorities:"priority",taskTypes:"taskType",tags:"tag",statuses:"status"};t.useEffect(()=>{x!=="account"&&he()},[x]);const he=async()=>{v(!0),E(null);try{const s=await q.list();if(s.length===0){await Ye();const c=await q.list();$(c)}else $(s)}catch(s){console.error("Failed to load attributes:",s),E("Failed to load task attributes. Please try again.")}finally{v(!1)}},Ye=async()=>{const s=[{type:"priority",name:"low",description:"Low priority tasks",color:"blue",order:1,default:!0},{type:"priority",name:"medium",description:"Medium priority tasks",color:"yellow",order:2,default:!0},{type:"priority",name:"high",description:"High priority tasks",color:"orange",order:3,default:!0},{type:"priority",name:"urgent",description:"Urgent priority tasks",color:"red",order:4,default:!0},{type:"taskType",name:"generic",description:"Generic tasks",color:"gray",order:1,default:!0},{type:"taskType",name:"meeting",description:"Meeting tasks",color:"blue",order:2,default:!0},{type:"taskType",name:"metric",description:"Metric tracking tasks",color:"green",order:3,default:!0},{type:"taskType",name:"action",description:"Action items",color:"purple",order:4,default:!0},{type:"status",name:"backlog",description:"Backlog tasks",color:"gray",order:1,default:!0},{type:"status",name:"todo",description:"To-do tasks",color:"blue",order:2,default:!0},{type:"status",name:"in_progress",description:"In-progress tasks",color:"yellow",order:3,default:!0},{type:"status",name:"blocked",description:"Blocked tasks",color:"red",order:4,default:!0},{type:"status",name:"done",description:"Completed tasks",color:"green",order:5,default:!0},{type:"tag",name:"design",description:"Design-related tasks",color:"purple",order:1,default:!0},{type:"tag",name:"development",description:"Development tasks",color:"blue",order:2,default:!0},{type:"tag",name:"research",description:"Research tasks",color:"green",order:3,default:!0},{type:"tag",name:"planning",description:"Planning tasks",color:"yellow",order:4,default:!0}];await q.bulkCreate(s)},qe=s=>({blue:"bg-blue-100 text-blue-800 border-blue-200",green:"bg-green-100 text-green-800 border-green-200",red:"bg-red-100 text-red-800 border-red-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",purple:"bg-purple-100 text-purple-800 border-purple-200",orange:"bg-orange-100 text-orange-800 border-orange-200",pink:"bg-pink-100 text-pink-800 border-pink-200",indigo:"bg-indigo-100 text-indigo-800 border-indigo-200",gray:"bg-gray-100 text-gray-800 border-gray-200"})[s]||"bg-gray-100 text-gray-800 border-gray-200",Ke=s=>{switch(s){case"priority":return e.jsx(Se,{className:"h-4 w-4"});case"taskType":return e.jsx(Pe,{className:"h-4 w-4"});case"tag":return e.jsx(De,{className:"h-4 w-4"});case"status":return e.jsx(pe,{className:"h-4 w-4"});default:return null}},Qe=s=>{j(s)},Ne=w.filter(s=>s.type!==ue[x]?!1:d?s.name.toLowerCase().includes(d.toLowerCase())||s.description&&s.description.toLowerCase().includes(d.toLowerCase()):!0).sort((s,c)=>s.order-c.order),We=()=>{me({type:ue[x],name:"",description:"",color:"blue",order:Xe(),default:!1}),C(null),n(!0)},Xe=()=>{const s=w.filter(O=>O.type===ue[x]);return s.length===0?1:Math.max(...s.map(O=>O.order||0))+1},Ze=s=>{me({type:s.type,name:s.name||"",description:s.description||"",color:s.color||"blue",order:s.order||0,default:s.default||!1}),C(s),n(!0)},es=s=>{M(s),S(!0)},ss=async()=>{if(T)try{await q.delete(T.id),await he(),S(!1),M(null)}catch(s){console.error("Failed to delete attribute:",s),E("Failed to delete attribute. Please try again.")}},le=(s,c)=>{me(O=>({...O,[s]:c}))},as=async()=>{try{m?await q.update(m.id,F):await q.create(F),n(!1),await he()}catch(s){console.error("Failed to save attribute:",s),E("Failed to save attribute. Please try again.")}},ts=o?.role==="admin",ve=[{id:"priorities",label:"Priorities",icon:Se},{id:"taskTypes",label:"Task Types",icon:Pe},{id:"statuses",label:"Statuses",icon:pe},{id:"tags",label:"Tags",icon:De},{id:"account",label:"Account",icon:fe},...ts?[{id:"users",label:"Users",icon:fe}]:[],{id:"github",label:"GitHub",icon:ye},{id:"notifications",label:"Notifications",icon:Ge},{id:"data",label:"Data",icon:Te}],rs=async()=>{r(!0),l(null);try{const s=await Le.export(),c=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),O=URL.createObjectURL(c),R=document.createElement("a"),xe=new Date().toISOString().split("T")[0];R.href=O,R.download=`pe-backup-${xe}.json`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(O),l({type:"success",text:"Backup downloaded successfully!"})}catch(s){console.error("Export failed:",s),l({type:"error",text:"Failed to export data. Please try again."})}finally{r(!1)}},ns=s=>{const c=s.target.files[0];c&&(ne(c),l(null))},ls=()=>{if(!V){l({type:"error",text:"Please select a backup file first."});return}g==="replace"?i(!0):ke()},ke=async()=>{r(!0),l(null),i(!1);try{const s=await V.text(),c=JSON.parse(s),O=await Le.import(c,g),{summary:R}=O,xe=Object.values(R).reduce((cs,os)=>cs+os,0);l({type:"success",text:`Import completed! ${xe} records imported (${R.tasks} tasks, ${R.projects} projects, ${R.teamMembers} team members, ${R.stakeholders} stakeholders).`}),ne(null),A.current&&(A.current.value="")}catch(s){console.error("Import failed:",s),l({type:"error",text:`Import failed: ${s.message}`})}finally{r(!1)}},is=[{id:"blue",name:"Blue"},{id:"green",name:"Green"},{id:"red",name:"Red"},{id:"yellow",name:"Yellow"},{id:"purple",name:"Purple"},{id:"orange",name:"Orange"},{id:"pink",name:"Pink"},{id:"indigo",name:"Indigo"},{id:"gray",name:"Gray"}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Settings"}),e.jsxs(bs,{defaultValue:"priorities",value:x,onValueChange:Qe,className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx(Ns,{className:"bg-gray-100",children:ve.map(s=>e.jsxs(vs,{value:s.id,className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{children:s.label})]},s.id))}),x!=="account"&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(P,{placeholder:`Search ${x}...`,value:d,onChange:s=>b(s.target.value),className:"pl-9"})]}),e.jsxs(h,{onClick:We,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add New"]})]})]}),D&&e.jsxs(U,{variant:"destructive",className:"mb-6",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(we,{children:"Error"}),e.jsx(G,{children:D})]}),ve.map(s=>e.jsx(ks,{value:s.id,className:"space-y-4",children:s.id==="data"?e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Data Management"]}),e.jsx(te,{children:"Export and import your data for backup and recovery"})]}),e.jsxs(B,{className:"space-y-6",children:[u&&e.jsxs(U,{variant:u.type==="error"?"destructive":"default",children:[u.type==="error"?e.jsx(ae,{className:"h-4 w-4"}):e.jsx(pe,{className:"h-4 w-4"}),e.jsx(G,{children:u.text})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Export Backup"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Download all your data as a JSON file. This includes tasks, projects, stakeholders, team members, meetings, and more."}),e.jsx(h,{onClick:rs,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Download Backup"]})})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Import Backup"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Restore data from a previously exported backup file."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"backup-file",children:"Select Backup File"}),e.jsx(P,{id:"backup-file",type:"file",accept:".json",ref:A,onChange:ns,className:"cursor-pointer"}),V&&e.jsxs("p",{className:"text-sm text-green-600",children:["Selected: ",V.name]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Import Mode"}),e.jsxs(Cs,{value:g,onValueChange:z,className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{value:"merge",id:"merge"}),e.jsxs(y,{htmlFor:"merge",className:"font-normal cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:"Merge"})," - Add imported records to existing data"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{value:"replace",id:"replace"}),e.jsxs(y,{htmlFor:"replace",className:"font-normal cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:"Replace"})," - Clear all existing data and import fresh"]})]})]})]}),e.jsx(h,{onClick:ls,disabled:p||!V,children:p?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Import Data"]})})]})]})]}):s.id==="users"?e.jsx(As,{}):s.id==="github"?e.jsx(Ls,{}):s.id==="notifications"?e.jsx(Is,{}):s.id!=="account"?e.jsxs(_,{children:[e.jsxs(J,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-5 w-5"}),s.label]}),e.jsxs(te,{children:["Manage ",s.label.toLowerCase()," for your tasks"]})]}),e.jsx(B,{children:N?e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading attributes..."})]}):Ne.length===0?e.jsx("div",{className:"text-center p-8 border border-dashed rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:d?`No ${s.label.toLowerCase()} found matching your search`:`No ${s.label.toLowerCase()} found. Add your first one!`})}):e.jsxs(Oe,{children:[e.jsx(_e,{children:e.jsxs(oe,{children:[e.jsx(L,{children:"Name"}),e.jsx(L,{children:"Description"}),e.jsx(L,{children:"Color"}),e.jsx(L,{children:"Order"}),e.jsx(L,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Be,{children:Ne.map(c=>e.jsxs(oe,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{variant:"outline",className:qe(c.color),children:[Ke(c.type),e.jsx("span",{className:"ml-1",children:c.name})]}),c.default&&e.jsx(K,{variant:"outline",className:"text-xs",children:"Default"})]})}),e.jsx(I,{children:c.description||"-"}),e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${c.color?`bg-${c.color}-500`:"bg-gray-300"}`}),e.jsx("span",{className:"capitalize",children:c.color||"None"})]})}),e.jsx(I,{children:c.order}),e.jsx(I,{children:e.jsxs(ze,{children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})]})}),e.jsxs(Je,{align:"end",children:[e.jsx(de,{onClick:()=>Ze(c),children:"Edit"}),e.jsx(de,{className:"text-red-600",onClick:()=>es(c),children:"Delete"})]})]})})]},c.id))})]})})]}):e.jsx(Es,{})},s.id))]})]}),e.jsx(Q,{open:k,onOpenChange:n,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs(X,{children:[e.jsx(Z,{children:m?`Edit ${F.type}`:`Create new ${F.type}`}),e.jsx(ee,{children:m?`Edit the details for this ${F.type}`:`Add a new ${F.type} for your tasks`})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",children:"Name"}),e.jsx(P,{id:"name",value:F.name,onChange:s=>le("name",s.target.value),placeholder:`Enter ${F.type} name`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"description",children:"Description"}),e.jsx(P,{id:"description",value:F.description,onChange:s=>le("description",s.target.value),placeholder:"Optional description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Color"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:is.map(s=>e.jsxs(h,{type:"button",variant:F.color===s.id?"default":"outline",className:"justify-start",onClick:()=>le("color",s.id),children:[e.jsx("div",{className:`w-4 h-4 rounded-full bg-${s.id}-500 mr-2`}),s.name]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"order",children:"Display Order"}),e.jsx(P,{id:"order",type:"number",min:"1",value:F.order,onChange:s=>le("order",parseInt(s.target.value))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Lower numbers appear first in lists"})]})]}),e.jsxs(se,{children:[e.jsx(h,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsxs(h,{onClick:as,children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),m?"Update":"Create"]})]})]})}),e.jsx(Q,{open:f,onOpenChange:S,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Confirm Deletion"}),e.jsxs(ee,{children:["Are you sure you want to delete ",T?.name,"? This action cannot be undone."]})]}),e.jsxs(se,{className:"mt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsxs(h,{variant:"destructive",onClick:ss,children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}),e.jsx(Q,{open:a,onOpenChange:i,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Confirm Replace Import"}),e.jsx(ee,{children:'You selected "Replace" mode. This will DELETE ALL your existing data before importing the backup. This action cannot be undone. Are you sure you want to proceed?'})]}),e.jsxs(se,{className:"mt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(h,{variant:"destructive",onClick:ke,children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Delete All & Import"]})]})]})})]})}export{Js as default};
