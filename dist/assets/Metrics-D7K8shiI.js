const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TaskCreationForm-uUOFczhl.js","assets/chunk-DHGN2BiO.js","assets/chunk-pjYta8vt.js","assets/chunk-KzYfAQy1.js","assets/index-ByFAet0J.js","assets/chunk-CZDJnSNg.js","assets/index-zbygvEX7.css","assets/chunk-Dt0Bnklg.js","assets/chunk-D3uHh-f_.js","assets/chunk-Cwmy-p0V.js","assets/chunk-C6AVtkQH.js","assets/chunk-BdHZTqfh.js","assets/chunk-DSBO3d0u.js","assets/chunk-BxZc7glH.js"])))=>i.map(i=>d[i]);
import{T as w,B as b,g as l,h as i,i as k,j as T,k as _,l as U,_ as W}from"./index-ByFAet0J.js";import{j as e,Y as C,f as D,aa as f,ab as X,ac as M,ad as g,ae as $}from"./chunk-DHGN2BiO.js";import{a as c}from"./chunk-pjYta8vt.js";import{E as G}from"./chunk-DSBO3d0u.js";import{B as h,D as q,a as I,b as J,c as Q}from"./chunk-C6AVtkQH.js";import{R as Z,L as ee,X as se,Y as te,T as ae,a as E}from"./chunk-fJmDrOgU.js";import{f as A}from"./chunk-CZDJnSNg.js";const re=c.lazy(()=>W(()=>import("./TaskCreationForm-uUOFczhl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])));function he(){const[le,R]=c.useState([]),[P,S]=c.useState([]),[L,o]=c.useState(!1),[r,B]=c.useState(null),[p,F]=c.useState({}),[O,N]=c.useState(!0);c.useEffect(()=>{v(),V()},[]);const v=async()=>{try{const t=await w.list();R(t);const s=t.filter(a=>a.type==="metric");S(s)}catch(t){console.error("Failed to load tasks:",t)}},V=async()=>{try{N(!0);const[t,s]=await Promise.all([G.getGoalsAnalytics(),G.getEmployeeGoalsProgress()]);B(t),F(s)}catch(t){console.error("Error loading goals analytics:",t)}finally{N(!1)}},z=async t=>{if(!t){o(!1);return}try{await w.create({...t,type:"metric"}),await v(),o(!1)}catch(s){console.error("Failed to create metric:",s)}},y=P.reduce((t,s)=>{const a=s.metadata?.metric?.kpi_name;return a&&(t[a]||(t[a]=[]),t[a].push(s)),t},{}),K=t=>{if(!t||t.length<2)return{trend:"neutral",percentage:0};const s=[...t].sort((u,H)=>new Date(u.created_date)-new Date(H.created_date)),a=s[s.length-1],j=s[s.length-2],n=parseFloat(a.metadata?.metric?.current_value)||0,d=parseFloat(j.metadata?.metric?.current_value)||0;if(n===d)return{trend:"neutral",percentage:0};const m=n-d,x=d!==0?Math.abs(Math.round(m/d*100)):0;return{trend:m>0?"up":"down",percentage:x}},Y=t=>t.filter(s=>s.metadata?.metric?.current_value).map(s=>({date:A(new Date(s.created_date),"MMM dd"),value:parseFloat(s.metadata?.metric?.current_value)||0,target:parseFloat(s.metadata?.metric?.target_value)||void 0})).sort((s,a)=>new Date(s.date)-new Date(a.date));return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Metrics Dashboard"}),e.jsxs(b,{onClick:()=>o(!0),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Track New Metric"]})]}),Object.keys(y).length===0?e.jsx(l,{className:"bg-gray-50 border-dashed",children:e.jsxs(i,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(D,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No metrics being tracked"}),e.jsx("p",{className:"text-gray-500 text-center mb-4",children:"Start tracking your key product metrics to monitor performance"}),e.jsxs(b,{onClick:()=>o(!0),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Add First Metric"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(y).map(([t,s])=>{const a=K(s),j=Y(s),n=s.sort((x,u)=>new Date(u.created_date)-new Date(x.created_date))[0],d=n.metadata?.metric?.current_value,m=n.metadata?.metric?.target_value;return e.jsxs(l,{className:"overflow-hidden",children:[e.jsx(k,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(T,{children:t}),e.jsx(_,{children:n.metadata?.metric?.measurement_frequency||"Tracked periodically"})]}),e.jsxs(h,{variant:"outline",children:[s.length," updates"]})]})}),e.jsxs(i,{className:"pb-0",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("div",{className:"text-2xl font-bold",children:d}),a.percentage>0&&e.jsxs("div",{className:`flex items-center ${a.trend==="up"?"text-green-600":"text-red-600"}`,children:[a.trend==="up"?e.jsx(f,{className:"h-4 w-4 mr-1"}):e.jsx(X,{className:"h-4 w-4 mr-1"}),a.percentage,"%"]})]}),m&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(M,{className:"h-3 w-3 mr-1 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Target: ",m]})]}),e.jsx("div",{className:"h-36 mt-4",children:e.jsx(Z,{width:"100%",height:"100%",children:e.jsxs(ee,{data:j,children:[e.jsx(se,{dataKey:"date",tick:{fontSize:12},tickLine:!1,axisLine:!1}),e.jsx(te,{tick:{fontSize:12},tickLine:!1,axisLine:!1,width:30}),e.jsx(ae,{}),e.jsx(E,{type:"monotone",dataKey:"value",stroke:"#6366F1",strokeWidth:2,dot:{r:3},activeDot:{r:5}}),j.some(x=>x.target!==void 0)&&e.jsx(E,{type:"monotone",dataKey:"target",stroke:"#E5E7EB",strokeWidth:1,strokeDasharray:"4 4",dot:!1})]})})})]}),e.jsx(U,{className:"pt-4",children:e.jsxs("div",{className:"text-xs text-gray-500",children:["Last updated: ",A(new Date(n.created_date),"PPp")]})})]},t)})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),"Goals Analytics"]})}),O?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[1,2,3].map(t=>e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"})]})})},t))}):r?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Goals"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"text-2xl font-bold",children:r.totalGoals}),e.jsx($,{className:"h-4 w-4 text-green-500"})]})]}),e.jsx(g,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Goals"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-blue-600",children:r.statusBreakdown.active}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[r.totalGoals>0?Math.round(r.statusBreakdown.active/r.totalGoals*100):0,"%"]})]})]}),e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(f,{className:"h-4 w-4 text-blue-600"})})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Completed"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-green-600",children:r.statusBreakdown.completed}),e.jsxs(h,{variant:"outline",className:"text-xs bg-green-50",children:[Math.round(r.completionRate*100),"%"]})]})]}),e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(f,{className:"h-4 w-4 text-green-600"})})]})})}),e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Paused"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-yellow-600",children:r.statusBreakdown.paused}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[r.totalGoals>0?Math.round(r.statusBreakdown.paused/r.totalGoals*100):0,"%"]})]})]}),e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"h-4 w-4 text-yellow-600"})})]})})})]}):e.jsx(l,{children:e.jsx(i,{className:"p-6",children:e.jsx("p",{className:"text-center text-muted-foreground",children:"No goals data available. Goals will appear here once team members have development goals."})})}),Object.keys(p).length>0&&e.jsxs(l,{children:[e.jsxs(k,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Employee Goals Progress"]}),e.jsx(_,{children:"Goal completion rates by team member"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(p).sort(([,t],[,s])=>s.completionRate-t.completionRate).slice(0,10).map(([t,s])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"h-4 w-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Employee ",t.slice(-4)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.completed," of ",s.total," goals completed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${s.completionRate*100}%`}})}),e.jsxs(h,{variant:s.completionRate>=.7?"default":"secondary",children:[Math.round(s.completionRate*100),"%"]})]})]},t))})})]})]}),e.jsx(q,{open:L,onOpenChange:o,children:e.jsxs(I,{className:"sm:max-w-lg",children:[e.jsx(J,{children:e.jsx(Q,{children:"Track New Metric"})}),e.jsx(c.Suspense,{fallback:e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Loading task form..."})]}),children:e.jsx(re,{onCreateTask:z,initialTaskData:{status:"todo",priority:"medium",type:"metric",metadata:{metric:{}}}})})]})})]})})}export{he as default};
