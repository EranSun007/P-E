import{aU as ks,aV as Ds,aW as As,j as e,aX as Es,aY as Is,d as _e,at as os,aZ as Be,Y as De,a_ as Ze,a$ as $e,af as Ye,_ as ce,b0 as be,a4 as Le,b1 as Ts,ab as Os,T as Ms,a2 as es,X as ms,aH as Ke,p as ss,aK as qe,b2 as Ge,b3 as Je,a5 as Fs,ai as Ps,b4 as as}from"./chunk-CDfVSsCp.js";import{a as d,k as zs,L as Ws}from"./chunk-pjYta8vt.js";import{C as ee,g as se,h as te,f as ae,I as W,B as h,A as hs,L as v,W as me,l as F,D as we,v as Ie,w as Qe,u as Us,t as rs,q as Rs,r as Vs,s as Gs,i as Bs,O as Se}from"./index-CjGPc2b_.js";import{a as Xe,c as $s,g as Ys}from"./chunk-uiVOWrDz.js";import{B as Q,S as H,a as K,b as q,c as J,d as A,D as he,e as xe,f as ge,g as ue,i as ke,h as je}from"./chunk-2Vqr1Avx.js";import{T as Ae}from"./chunk-BRoLf8OO.js";import{P as Te,a as Oe,b as Me,C as Fe}from"./chunk-D56rD7Tk.js";import{T as Hs,a as Ks,b as ns,c as Pe,d as qs,e as ze}from"./chunk-CbeUZ2zF.js";import{T as Js}from"./chunk-DqGcurv-.js";import{f as Z,p as G,o as Qs}from"./chunk-DGzW4aIb.js";import{A as Xs,a as Zs,b as Ls,c as et,d as st,e as tt,f as at,g as rt,h as nt}from"./chunk-BATFaH_q.js";import{S as xs,P as lt}from"./chunk-BiA1Y_SF.js";import"./chunk-BdHZTqfh.js";const gs=ks,us=Ds,js=As,ls=({workItem:r,onAddInsight:u,onMarkComplete:D,onReactivate:c,onEdit:x,isLoading:n=!1})=>{const[j,l]=d.useState(!1),[m,f]=d.useState(""),[S,I]=d.useState("keep"),[C,_]=d.useState(!1),b=Array.isArray(r.insights)?r.insights:typeof r.insights=="string"?JSON.parse(r.insights||"[]"):[],g=b.length>0?b[b.length-1]:null,i=async()=>{m.trim()&&(await u(r.id,{text:m.trim(),type:S}),f(""),I("keep"),l(!1))},k=E=>E==="keep"?"bg-green-100 text-green-800 border-green-200":"bg-amber-100 text-amber-800 border-amber-200",O=E=>E==="keep"?e.jsx(De,{className:"h-3 w-3"}):e.jsx(Ze,{className:"h-3 w-3"}),T=r.status==="completed";return e.jsxs(ee,{className:T?"opacity-75":"",children:[e.jsx(se,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(te,{className:"flex items-center gap-2 text-base",children:[e.jsx(Es,{className:"h-4 w-4 text-gray-500"}),r.name]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-500",children:[r.project_name&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Is,{className:"h-3 w-3"}),r.project_name]}),r.sprint_name&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),r.sprint_name]}),r.effort_estimation&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"h-3 w-3"}),"Est: ",r.effort_estimation]})]})]}),e.jsx(Q,{variant:"outline",className:T?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800",children:T?"Completed":"Active"})]})}),e.jsxs(ae,{className:"space-y-3",children:[g&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Be,{className:"h-4 w-4 text-amber-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-700",children:g.text}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(Q,{variant:"outline",className:`text-xs ${k(g.type)}`,children:[O(g.type),e.jsx("span",{className:"ml-1",children:g.type})]}),e.jsx("span",{className:"text-xs text-gray-400",children:Z(G(g.date),"MMM d, yyyy")})]})]})]})}),j&&e.jsxs("div",{className:"p-3 border rounded-lg space-y-2",children:[e.jsx(W,{placeholder:"What did you learn or observe?",value:m,onChange:E=>f(E.target.value),disabled:n}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{value:S,onValueChange:I,children:[e.jsx(K,{className:"w-32",children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(A,{value:"keep",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"h-3 w-3 text-green-600"}),"Keep"]})}),e.jsx(A,{value:"improve",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3 text-amber-600"}),"Improve"]})})]})]}),e.jsx(h,{size:"sm",onClick:i,disabled:!m.trim()||n,children:"Save"}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>{l(!1),f("")},children:"Cancel"})]})]}),b.length>1&&e.jsxs(gs,{open:C,onOpenChange:_,children:[e.jsx(us,{asChild:!0,children:e.jsxs(h,{variant:"ghost",size:"sm",className:"w-full justify-start",children:[C?e.jsx($e,{className:"h-4 w-4 mr-2"}):e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"View History (",b.length," insights)"]})}),e.jsx(js,{className:"space-y-2 mt-2",children:b.slice(0,-1).reverse().map((E,a)=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded text-sm",children:[e.jsx("p",{className:"text-gray-700",children:E.text}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Q,{variant:"outline",className:`text-xs ${k(E.type)}`,children:E.type}),e.jsx("span",{className:"text-xs text-gray-400",children:Z(G(E.date),"MMM d, yyyy")})]})]},E.id||a))})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",children:[!T&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>l(!0),disabled:j||n,children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Add Insight"]}),x&&e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>x(r),disabled:n,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>D(r.id),disabled:n,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Mark Complete"]})]}),T&&c&&e.jsx(h,{size:"sm",variant:"outline",onClick:()=>c(r.id),disabled:n,children:"Reactivate"})]})]})]})},is=({open:r,onOpenChange:u,onSubmit:D,teamMemberId:c,initialData:x=null,isLoading:n=!1})=>{const{projects:j}=d.useContext(hs),[l,m]=d.useState({name:"",project_id:"",effort_value:"",effort_unit:"hours",sprint_name:"",initialInsight:"",insightType:"keep"}),[f,S]=d.useState({}),I=i=>{if(!i)return{value:"",unit:"hours"};const k=i.match(/^(\d+(?:\.\d+)?)\s*(hours?|days?)$/i);if(k){const O=k[2].toLowerCase().startsWith("day")?"days":"hours";return{value:k[1],unit:O}}return{value:"",unit:"hours"}};d.useEffect(()=>{if(r){if(x){const{value:i,unit:k}=I(x.effort_estimation);m({name:x.name||"",project_id:x.project_id||"",effort_value:i,effort_unit:k,sprint_name:x.sprint_name||"",initialInsight:"",insightType:"keep"})}else m({name:"",project_id:"",effort_value:"",effort_unit:"hours",sprint_name:"",initialInsight:"",insightType:"keep"});S({})}},[r,x]);const C=(i,k)=>{m(O=>({...O,[i]:k})),f[i]&&S(O=>({...O,[i]:""}))},_=()=>{const i={};return l.name.trim()||(i.name="Work item name is required"),S(i),Object.keys(i).length===0},b=async i=>{if(i.preventDefault(),!_())return;const k={team_member_id:c,name:l.name.trim(),project_id:l.project_id&&l.project_id!=="none"?l.project_id:null,effort_estimation:l.effort_value?`${l.effort_value} ${l.effort_unit}`:null,sprint_name:l.sprint_name.trim()||null},O=l.initialInsight.trim()?{text:l.initialInsight.trim(),type:l.insightType}:null;await D(k,O)},g=!!x;return e.jsx(he,{open:r,onOpenChange:u,children:e.jsxs(xe,{className:"sm:max-w-lg",children:[e.jsxs(ge,{children:[e.jsx(ue,{children:g?"Edit Work Item":"Add Work Item"}),e.jsx(ke,{children:g?"Update the work item details below.":"Add a new work item to track current work for this team member."})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",children:"Work Item Name *"}),e.jsx(W,{id:"name",placeholder:"e.g., Implement user authentication",value:l.name,onChange:i=>C("name",i.target.value),disabled:n,className:f.name?"border-destructive":""}),f.name&&e.jsx("p",{className:"text-sm text-destructive",children:f.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"project",children:"Project (Epic)"}),e.jsxs(H,{value:l.project_id,onValueChange:i=>C("project_id",i),disabled:n,children:[e.jsx(K,{children:e.jsx(q,{placeholder:"Select a project"})}),e.jsxs(J,{children:[e.jsx(A,{value:"none",children:"No project"}),j.map(i=>e.jsx(A,{value:i.id,children:i.name},i.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"sprint_name",children:"Sprint Name"}),e.jsx(W,{id:"sprint_name",placeholder:"e.g., Sprint 42, 2026-Q1-W3",value:l.sprint_name,onChange:i=>C("sprint_name",i.target.value),disabled:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Effort Estimation"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{id:"effort_value",type:"number",min:"0",step:"0.5",placeholder:"e.g., 8",value:l.effort_value,onChange:i=>C("effort_value",i.target.value),disabled:n,className:"w-24"}),e.jsxs(H,{value:l.effort_unit,onValueChange:i=>C("effort_unit",i),disabled:n,children:[e.jsx(K,{className:"w-28",children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(A,{value:"hours",children:"hours"}),e.jsx(A,{value:"days",children:"days"})]})]})]})]}),!g&&e.jsxs("div",{className:"space-y-2 p-3 border rounded-lg bg-gray-50",children:[e.jsx(v,{htmlFor:"initialInsight",children:"Initial Insight (optional)"}),e.jsx(W,{id:"initialInsight",placeholder:"Any initial observations or notes?",value:l.initialInsight,onChange:i=>C("initialInsight",i.target.value),disabled:n}),e.jsxs("div",{className:"flex items-center gap-4 pt-1",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Type:"}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"insightType",value:"keep",checked:l.insightType==="keep",onChange:()=>C("insightType","keep"),disabled:n,className:"w-4 h-4"}),e.jsx(De,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Keep"})]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"insightType",value:"improve",checked:l.insightType==="improve",onChange:()=>C("insightType","improve"),disabled:n,className:"w-4 h-4"}),e.jsx(Ze,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm",children:"Improve"})]})]})]})]}),e.jsxs(je,{children:[e.jsx(h,{variant:"outline",onClick:()=>u(!1),disabled:n,children:"Cancel"}),e.jsx(h,{onClick:b,disabled:n,children:n?"Saving...":g?"Update Work Item":"Create Work Item"})]})]})})},cs=({duty:r,onAddInsight:u,onComplete:D,onEdit:c,onDelete:x,isLoading:n=!1})=>{const[j,l]=d.useState(!1),[m,f]=d.useState(""),[S,I]=d.useState(!1),C=r.insights||[],_=r.status==="completed",g=(()=>{if(r.duration_days)return r.duration_days;if(r.start_date){const T=G(r.start_date),E=r.end_date?G(r.end_date):new Date;return Qs(E,T)+1}return null})(),i=()=>{if(!r.start_date)return"No date";const T=Z(G(r.start_date),"MMM d");if(!r.end_date)return`${T} - ongoing`;const E=Z(G(r.end_date),"MMM d, yyyy");return`${T} - ${E}`},k=async()=>{m.trim()&&(await u(r.id,m.trim()),f(""),l(!1))},O=async()=>{await D(r.id,{end_date:new Date().toISOString().split("T")[0],bugs_at_end:r.bugs_at_end,bugs_solved:r.bugs_solved,escalations:r.escalations})};return e.jsxs(ee,{className:_?"opacity-75":"",children:[e.jsx(se,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(te,{className:"flex items-center gap-2 text-base",children:[e.jsx(Le,{className:"h-4 w-4 text-indigo-600"}),"DevOps Duty"]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3"}),i()]}),g&&e.jsxs(Q,{variant:"outline",className:"text-xs",children:[g," day",g!==1?"s":""]})]})]}),e.jsx(Q,{variant:"outline",className:_?"bg-green-100 text-green-800":"bg-indigo-100 text-indigo-800",children:_?"Completed":"Active"})]})}),e.jsxs(ae,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(Ts,{className:"h-4 w-4 text-red-500"}),"Bugs"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:r.bugs_at_start||0}),e.jsx(Os,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:r.bugs_at_end||0}),(r.bugs_solved>0||r.bugs_at_start>r.bugs_at_end)&&e.jsxs(Q,{variant:"outline",className:"text-xs bg-green-100 text-green-800",children:[r.bugs_solved||r.bugs_at_start-r.bugs_at_end," solved"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(Ms,{className:"h-4 w-4 text-amber-500"}),"Escalations"]}),e.jsx("div",{className:"text-sm text-gray-600",children:r.escalations||0})]})]}),r.notes&&e.jsx("div",{className:"text-sm text-gray-600 p-2 bg-gray-50 rounded",children:r.notes}),C.length>0&&e.jsxs(gs,{open:S,onOpenChange:I,children:[e.jsx(us,{asChild:!0,children:e.jsxs(h,{variant:"ghost",size:"sm",className:"w-full justify-start",children:[S?e.jsx($e,{className:"h-4 w-4 mr-2"}):e.jsx(Ye,{className:"h-4 w-4 mr-2"}),e.jsx(Be,{className:"h-4 w-4 mr-1 text-amber-500"}),C.length," Insight",C.length!==1?"s":""]})}),e.jsx(js,{className:"space-y-2 mt-2",children:C.map((T,E)=>e.jsxs("div",{className:"p-2 bg-amber-50 rounded text-sm text-gray-700 flex items-start gap-2",children:[e.jsx(Be,{className:"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0"}),T]},E))})]}),j&&e.jsxs("div",{className:"p-3 border rounded-lg space-y-2",children:[e.jsx(W,{placeholder:"What did you learn from this duty?",value:m,onChange:T=>f(T.target.value),disabled:n,onKeyDown:T=>{T.key==="Enter"&&(T.preventDefault(),k())}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{size:"sm",onClick:k,disabled:!m.trim()||n,children:"Save"}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>{l(!1),f("")},children:"Cancel"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",children:[!_&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>l(!0),disabled:j||n,children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Add Insight"]}),c&&e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>c(r),disabled:n,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:O,disabled:n,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Complete"]})]}),_&&c&&e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>c(r),disabled:n,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Edit"]}),x&&e.jsxs(Xs,{children:[e.jsx(Zs,{asChild:!0,children:e.jsx(h,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",disabled:n,children:e.jsx(es,{className:"h-4 w-4"})})}),e.jsxs(Ls,{children:[e.jsxs(et,{children:[e.jsx(st,{children:"Delete DevOps Duty?"}),e.jsx(tt,{children:"This will permanently delete this DevOps duty record and all associated insights. This action cannot be undone."})]}),e.jsxs(at,{children:[e.jsx(rt,{children:"Cancel"}),e.jsx(nt,{onClick:()=>x(r.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]})},ds=({open:r,onOpenChange:u,onSubmit:D,teamMemberId:c,initialData:x=null,isLoading:n=!1})=>{const[j,l]=d.useState({start_date:"",end_date:"",bugs_at_start:"",bugs_at_end:"",bugs_solved:"",escalations:"",notes:""}),[m,f]=d.useState([]),[S,I]=d.useState(""),[C,_]=d.useState({});d.useEffect(()=>{if(r){if(x)l({start_date:x.start_date?x.start_date.split("T")[0]:"",end_date:x.end_date?x.end_date.split("T")[0]:"",bugs_at_start:x.bugs_at_start?.toString()||"",bugs_at_end:x.bugs_at_end?.toString()||"",bugs_solved:x.bugs_solved?.toString()||"",escalations:x.escalations?.toString()||"",notes:x.notes||""}),f(x.insights||[]);else{const a=new Date().toISOString().split("T")[0];l({start_date:a,end_date:"",bugs_at_start:"",bugs_at_end:"",bugs_solved:"",escalations:"",notes:""}),f([])}I(""),_({})}},[r,x]);const b=(a,N)=>{l(y=>({...y,[a]:N})),C[a]&&_(y=>({...y,[a]:""}))},g=()=>{S.trim()&&(f(a=>[...a,S.trim()]),I(""))},i=a=>{f(N=>N.filter((y,M)=>M!==a))},k=()=>{const a={};return j.start_date||(a.start_date="Start date is required"),_(a),Object.keys(a).length===0},O=async a=>{if(a.preventDefault(),!k())return;const N={team_member_id:c,start_date:j.start_date,end_date:j.end_date||null,bugs_at_start:parseInt(j.bugs_at_start,10)||0,bugs_at_end:parseInt(j.bugs_at_end,10)||0,bugs_solved:parseInt(j.bugs_solved,10)||0,escalations:parseInt(j.escalations,10)||0,notes:j.notes.trim()||null,insights:m,status:j.end_date?"completed":"active"};await D(N)},T=!!x,E=j.bugs_at_start&&j.bugs_at_end?Math.max(0,parseInt(j.bugs_at_start,10)-parseInt(j.bugs_at_end,10)):null;return e.jsx(he,{open:r,onOpenChange:u,children:e.jsxs(xe,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(ge,{children:[e.jsx(ue,{children:T?"Edit DevOps Duty":"Add DevOps Duty"}),e.jsx(ke,{children:T?"Update the DevOps duty details below.":"Track a DevOps duty period with bug metrics and learnings."})]}),e.jsxs("form",{onSubmit:O,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(W,{id:"start_date",type:"date",value:j.start_date,onChange:a=>b("start_date",a.target.value),disabled:n,className:C.start_date?"border-destructive":""}),C.start_date&&e.jsx("p",{className:"text-sm text-destructive",children:C.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"end_date",children:"End Date"}),e.jsx(W,{id:"end_date",type:"date",value:j.end_date,onChange:a=>b("end_date",a.target.value),disabled:n}),e.jsx("p",{className:"text-xs text-gray-500",children:"Leave empty for ongoing duty"})]})]}),e.jsxs("div",{className:"space-y-3 p-3 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700",children:"Bug Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"bugs_at_start",children:"Bugs at Start"}),e.jsx(W,{id:"bugs_at_start",type:"number",min:"0",placeholder:"e.g., 45",value:j.bugs_at_start,onChange:a=>b("bugs_at_start",a.target.value),disabled:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"bugs_at_end",children:"Bugs at End"}),e.jsx(W,{id:"bugs_at_end",type:"number",min:"0",placeholder:"e.g., 38",value:j.bugs_at_end,onChange:a=>b("bugs_at_end",a.target.value),disabled:n})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"bugs_solved",children:"Bugs Solved"}),e.jsx(W,{id:"bugs_solved",type:"number",min:"0",placeholder:E!==null?`Suggested: ${E}`:"e.g., 7",value:j.bugs_solved,onChange:a=>b("bugs_solved",a.target.value),disabled:n}),E!==null&&!j.bugs_solved&&e.jsxs(h,{type:"button",variant:"ghost",size:"sm",className:"text-xs",onClick:()=>b("bugs_solved",E.toString()),children:["Use suggested: ",E]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"escalations",children:"Escalations"}),e.jsx(W,{id:"escalations",type:"number",min:"0",placeholder:"e.g., 2",value:j.escalations,onChange:a=>b("escalations",a.target.value),disabled:n})]})]})]}),e.jsxs("div",{className:"space-y-3 p-3 border rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4 text-amber-500"}),"Insights & Learnings"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{placeholder:"What did you learn from this duty?",value:S,onChange:a=>I(a.target.value),disabled:n,onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),g())}}),e.jsx(h,{type:"button",variant:"outline",onClick:g,disabled:!S.trim()||n,children:e.jsx(ce,{className:"h-4 w-4"})})]}),m.length>0&&e.jsx("div",{className:"space-y-2",children:m.map((a,N)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-gray-50 rounded text-sm",children:[e.jsx("span",{className:"flex-1",children:a}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>i(N),disabled:n,children:e.jsx(ms,{className:"h-3 w-3"})})]},N))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"notes",children:"Notes"}),e.jsx(Ae,{id:"notes",placeholder:"Any additional notes about this duty period...",value:j.notes,onChange:a=>b("notes",a.target.value),disabled:n,rows:3})]})]}),e.jsxs(je,{children:[e.jsx(h,{variant:"outline",onClick:()=>u(!1),disabled:n,children:"Cancel"}),e.jsx(h,{onClick:O,disabled:n,children:n?"Saving...":T?"Update Duty":"Create Duty"})]})]})})},it=({teamMemberId:r})=>{const[u,D]=d.useState([]),[c,x]=d.useState([]),[n,j]=d.useState(!0),[l,m]=d.useState(!1),[f,S]=d.useState(!1),[I,C]=d.useState(!1),[_,b]=d.useState(null),[g,i]=d.useState(!1),[k,O]=d.useState(!1),[T,E]=d.useState(null),[a,N]=d.useState(!1),[y,M]=d.useState(!1),p=async()=>{if(r)try{const o=await me.listByTeamMember(r);D(Array.isArray(o)?o:[])}catch(o){F.error("Error loading work items",{error:String(o)}),D([])}},P=async()=>{if(r)try{const o=await we.listByTeamMember(r);x(Array.isArray(o)?o:[])}catch(o){F.error("Error loading DevOps duties",{error:String(o)}),x([])}},U=async()=>{if(r)try{j(!0),await Promise.all([p(),P()])}finally{j(!1)}};d.useEffect(()=>{U()},[r]);const B=u.filter(o=>o.status==="active"),ne=u.filter(o=>o.status==="completed"),de=c.filter(o=>o.status==="active"),R=c.filter(o=>o.status==="completed"),pe=async(o,z)=>{try{m(!0);const X=await me.create(o);z&&X.id&&await me.addInsight(X.id,z),await p(),S(!1)}catch(X){F.error("Error creating work item",{error:String(X)})}finally{m(!1)}},re=async(o,z)=>{try{m(!0),await me.addInsight(o,z),await p()}catch(X){F.error("Error adding insight",{error:String(X)})}finally{m(!1)}},fe=async o=>{try{m(!0),await me.update(o,{status:"completed"}),await p()}catch(z){F.error("Error marking work item complete",{error:String(z)})}finally{m(!1)}},V=async o=>{try{m(!0),await me.update(o,{status:"active"}),await p()}catch(z){F.error("Error reactivating work item",{error:String(z)})}finally{m(!1)}},Ee=o=>{b(o),C(!0)},ie=async o=>{if(_)try{m(!0),await me.update(_.id,o),await p(),C(!1),b(null)}catch(z){F.error("Error updating work item",{error:String(z)})}finally{m(!1)}},ve=async o=>{try{m(!0),await we.create(o),await P(),i(!1)}catch(z){F.error("Error creating DevOps duty",{error:String(z)})}finally{m(!1)}},We=async(o,z)=>{try{m(!0),await we.addInsight(o,z),await P()}catch(X){F.error("Error adding insight to DevOps duty",{error:String(X)})}finally{m(!1)}},ye=async(o,z)=>{try{m(!0),await we.complete(o,z),await P()}catch(X){F.error("Error completing DevOps duty",{error:String(X)})}finally{m(!1)}},$=o=>{E(o),O(!0)},le=async o=>{if(T)try{m(!0),await we.update(T.id,o),await P(),O(!1),E(null)}catch(z){F.error("Error updating DevOps duty",{error:String(z)})}finally{m(!1)}},Ue=async o=>{try{m(!0),await we.delete(o),await P()}catch(z){F.error("Error deleting DevOps duty",{error:String(z)})}finally{m(!1)}};return n?e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Current Work"]})}),e.jsx(ae,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ss,{className:"h-6 w-6 animate-spin text-gray-400"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Current Work"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{onClick:()=>S(!0),size:"sm",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Work Item"]}),e.jsxs(h,{onClick:()=>i(!0),size:"sm",variant:"outline",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Add DevOps Duty"]})]})]})}),e.jsxs(ae,{children:[B.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ke,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No active work items"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add work items to track current development tasks"})]}):e.jsx("div",{className:"space-y-4",children:B.map(o=>e.jsx(ls,{workItem:o,onAddInsight:re,onMarkComplete:fe,onEdit:Ee,isLoading:l},o.id))}),ne.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs(h,{variant:"ghost",size:"sm",className:"w-full justify-start text-gray-500",onClick:()=>N(!a),children:[a?e.jsx($e,{className:"h-4 w-4 mr-2"}):e.jsx(Ye,{className:"h-4 w-4 mr-2"}),a?"Hide":"Show"," Completed Items (",ne.length,")"]}),a&&e.jsx("div",{className:"space-y-4 mt-4",children:ne.map(o=>e.jsx(ls,{workItem:o,onAddInsight:re,onMarkComplete:fe,onReactivate:V,isLoading:l},o.id))})]}),(de.length>0||R.length>0)&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-indigo-600"}),"DevOps Duties"]}),de.length>0&&e.jsx("div",{className:"space-y-4",children:de.map(o=>e.jsx(cs,{duty:o,onAddInsight:We,onComplete:ye,onEdit:$,onDelete:Ue,isLoading:l},o.id))}),R.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs(h,{variant:"ghost",size:"sm",className:"w-full justify-start text-gray-500",onClick:()=>M(!y),children:[y?e.jsx($e,{className:"h-4 w-4 mr-2"}):e.jsx(Ye,{className:"h-4 w-4 mr-2"}),y?"Hide":"Show"," Completed Duties (",R.length,")"]}),y&&e.jsx("div",{className:"space-y-4 mt-4",children:R.map(o=>e.jsx(cs,{duty:o,onAddInsight:We,onComplete:ye,onEdit:$,onDelete:Ue,isLoading:l},o.id))})]})]})]})]}),e.jsx(is,{open:f,onOpenChange:S,onSubmit:pe,teamMemberId:r,isLoading:l}),e.jsx(is,{open:I,onOpenChange:o=>{C(o),o||b(null)},onSubmit:ie,teamMemberId:r,initialData:_,isLoading:l}),e.jsx(ds,{open:g,onOpenChange:i,onSubmit:ve,teamMemberId:r,isLoading:l}),e.jsx(ds,{open:k,onOpenChange:o=>{O(o),o||E(null)},onSubmit:le,teamMemberId:r,initialData:T,isLoading:l})]})},ct=({open:r,onOpenChange:u,onSubmit:D,initialData:c=null,isLoading:x=!1})=>{const n=new Date().getFullYear(),j=[n-1,n,n+1],[l,m]=d.useState({title:"",description:"",year:n.toString(),progress:0}),[f,S]=d.useState({});d.useEffect(()=>{r&&(m(c?{title:c.title||"",description:c.description||"",year:(c.year||n).toString(),progress:c.progress||0}:{title:"",description:"",year:n.toString(),progress:0}),S({}))},[r,c,n]);const I=(g,i)=>{m(k=>({...k,[g]:i})),f[g]&&S(k=>({...k,[g]:""}))},C=()=>{const g={};return l.title.trim()||(g.title="Goal title is required"),S(g),Object.keys(g).length===0},_=async g=>{if(g.preventDefault(),!C())return;const i={title:l.title.trim(),description:l.description.trim()||null,year:parseInt(l.year,10),progress:l.progress};await D(i)},b=!!c;return e.jsx(he,{open:r,onOpenChange:u,children:e.jsxs(xe,{className:"sm:max-w-lg",children:[e.jsx(ge,{children:e.jsx(ue,{children:b?"Edit Developer Goal":"Add Developer Goal"})}),e.jsxs("form",{onSubmit:_,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"title",children:"Goal Title *"}),e.jsx(W,{id:"title",placeholder:"e.g., Lead CAP Plugin Development",value:l.title,onChange:g=>I("title",g.target.value),disabled:x,className:f.title?"border-destructive":""}),f.title&&e.jsx("p",{className:"text-sm text-destructive",children:f.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"description",children:"Description"}),e.jsx(Ae,{id:"description",placeholder:"Describe the goal and success criteria...",value:l.description,onChange:g=>I("description",g.target.value),disabled:x,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"year",children:"Year"}),e.jsxs(H,{value:l.year,onValueChange:g=>I("year",g),disabled:x||b,children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsx(J,{children:j.map(g=>e.jsx(A,{value:g.toString(),children:g},g))})]})]}),b&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(v,{children:["Progress: ",l.progress,"%"]}),e.jsx(xs,{value:[l.progress],onValueChange:g=>I("progress",g[0]),max:100,step:5,disabled:x}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]})]}),e.jsxs(je,{children:[e.jsx(h,{variant:"outline",onClick:()=>u(!1),disabled:x,children:"Cancel"}),e.jsx(h,{onClick:_,disabled:x,children:x?"Saving...":b?"Update Goal":"Create Goal"})]})]})})},dt=({teamMemberId:r})=>{const u=new Date().getFullYear(),[D,c]=d.useState([]),[x,n]=d.useState(u.toString()),[j,l]=d.useState(!0),[m,f]=d.useState(!1),[S,I]=d.useState(!1),[C,_]=d.useState(null),[b,g]=d.useState({}),i=[u-1,u,u+1],k=async()=>{if(r)try{l(!0);const p=await Ie.list(r,parseInt(x,10));c(Array.isArray(p)?p:[])}catch(p){F.error("Error loading developer goals",{error:String(p)}),c([])}finally{l(!1)}};d.useEffect(()=>{k()},[r,x]);const O=async p=>{try{f(!0),await Ie.create({...p,team_member_id:r}),await k(),I(!1)}catch(P){F.error("Error creating goal",{error:String(P)})}finally{f(!1)}},T=async p=>{if(C)try{f(!0),await Ie.update(C.id,p),await k(),I(!1),_(null)}catch(P){F.error("Error updating goal",{error:String(P)})}finally{f(!1)}},E=async p=>{if(confirm("Are you sure you want to delete this goal?"))try{f(!0),await Ie.delete(p),await k()}catch(P){F.error("Error deleting goal",{error:String(P)})}finally{f(!1)}},a=(p,P)=>{g(U=>({...U,[p]:P}))},N=async p=>{const P=b[p];if(P!==void 0)try{f(!0),await Ie.update(p,{progress:P}),await k(),g(U=>{const B={...U};return delete B[p],B})}catch(U){F.error("Error updating progress",{error:String(U)})}finally{f(!1)}},y=p=>{_(p),I(!0)},M=()=>{_(null),I(!0)};return j?e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"Developer Goals"]})}),e.jsx(ae,{children:e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(ss,{className:"h-6 w-6 animate-spin text-gray-400"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"Developer Goals"]}),e.jsxs(H,{value:x,onValueChange:n,children:[e.jsx(K,{className:"w-24",children:e.jsx(q,{})}),e.jsx(J,{children:i.map(p=>e.jsx(A,{value:p.toString(),children:p},p))})]})]})}),e.jsxs(ae,{children:[D.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(qe,{className:"h-10 w-10 text-gray-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["No goals for ",x]})]}):e.jsx("div",{className:"space-y-4",children:D.map(p=>{const P=b[p.id]??p.progress;return e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:p.title}),p.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:p.description})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>y(p),disabled:m,children:e.jsx(be,{className:"h-3 w-3"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>E(p.id),disabled:m,children:e.jsx(es,{className:"h-3 w-3 text-red-500"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{value:P,className:"flex-1 h-2"}),e.jsxs("span",{className:"text-xs font-medium w-10 text-right",children:[P,"%"]})]}),e.jsx(xs,{value:[P],onValueChange:U=>a(p.id,U[0]),onValueCommit:()=>N(p.id),max:100,step:5,disabled:m,className:"cursor-pointer"})]})]},p.id)})}),e.jsxs(h,{variant:"outline",size:"sm",className:"w-full mt-4",onClick:M,disabled:m,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Goal"]})]})]}),e.jsx(ct,{open:S,onOpenChange:p=>{I(p),p||_(null)},onSubmit:C?T:O,initialData:C,isLoading:m})]})},Ve=({value:r,onChange:u,disabled:D})=>{const[c,x]=d.useState(0);return e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(n=>e.jsx("button",{type:"button",className:"p-0.5 focus:outline-none disabled:opacity-50",onClick:()=>!D&&u(n),onMouseEnter:()=>!D&&x(n),onMouseLeave:()=>x(0),disabled:D,children:e.jsx(Ge,{className:`h-6 w-6 ${(c||r)>=n?"fill-amber-400 text-amber-400":"text-gray-300"}`})},n))})},ot=({open:r,onOpenChange:u,onSubmit:D,initialData:c=null,workItems:x=[],isLoading:n=!1})=>{const j=new Date().getFullYear(),[l,m]=d.useState({year:j.toString(),summary:"",strengths:"",areas_for_improvement:"",main_points:[],self_technical_rating:null,self_collaboration_rating:null,technical_rating:null,collaboration_rating:null,highlighted_work_items:[]}),[f,S]=d.useState(""),[I,C]=d.useState({});d.useEffect(()=>{r&&(m(c?{year:(c.year||j).toString(),summary:c.summary||"",strengths:c.strengths||"",areas_for_improvement:c.areas_for_improvement||"",main_points:Array.isArray(c.main_points)?c.main_points:[],self_technical_rating:c.self_technical_rating||null,self_collaboration_rating:c.self_collaboration_rating||null,technical_rating:c.technical_rating||null,collaboration_rating:c.collaboration_rating||null,highlighted_work_items:Array.isArray(c.highlighted_work_items)?c.highlighted_work_items:[]}:{year:j.toString(),summary:"",strengths:"",areas_for_improvement:"",main_points:[],self_technical_rating:null,self_collaboration_rating:null,technical_rating:null,collaboration_rating:null,highlighted_work_items:[]}),S(""),C({}))},[r,c,j]);const _=(a,N)=>{m(y=>({...y,[a]:N}))},b=()=>{f.trim()&&(m(a=>({...a,main_points:[...a.main_points,f.trim()]})),S(""))},g=a=>{m(N=>({...N,main_points:N.main_points.filter((y,M)=>M!==a)}))},i=a=>{m(N=>{const y=N.highlighted_work_items;return y.includes(a)?{...N,highlighted_work_items:y.filter(M=>M!==a)}:y.length>=5?N:{...N,highlighted_work_items:[...y,a]}})},k=async a=>{a.preventDefault();const N={year:parseInt(l.year,10),summary:l.summary.trim()||null,strengths:l.strengths.trim()||null,areas_for_improvement:l.areas_for_improvement.trim()||null,main_points:l.main_points,self_technical_rating:l.self_technical_rating,self_collaboration_rating:l.self_collaboration_rating,technical_rating:l.technical_rating,collaboration_rating:l.collaboration_rating,highlighted_work_items:l.highlighted_work_items};await D(N)},O=!!c,E=(()=>{const a=[l.self_technical_rating,l.self_collaboration_rating,l.technical_rating,l.collaboration_rating].filter(N=>N!=null);return a.length===0?null:(a.reduce((N,y)=>N+y,0)/a.length).toFixed(1)})();return e.jsx(he,{open:r,onOpenChange:u,children:e.jsxs(xe,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ge,{children:e.jsx(ue,{children:O?"Edit Performance Evaluation":"Create Performance Evaluation"})}),e.jsxs("form",{onSubmit:k,className:"space-y-6 py-4",children:[!O&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Year"}),e.jsxs(H,{value:l.year,onValueChange:a=>_("year",a),disabled:n,children:[e.jsx(K,{className:"w-32",children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(A,{value:j.toString(),children:j}),e.jsx(A,{value:(j-1).toString(),children:j-1})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px flex-1 bg-gray-200"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Self-Assessment"}),e.jsx("div",{className:"h-px flex-1 bg-gray-200"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Developer's self-evaluation of their performance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Technical Rating"}),e.jsx(Ve,{value:l.self_technical_rating,onChange:a=>_("self_technical_rating",a),disabled:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Collaboration Rating"}),e.jsx(Ve,{value:l.self_collaboration_rating,onChange:a=>_("self_collaboration_rating",a),disabled:n})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-px flex-1 bg-gray-200"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Manager Assessment"}),e.jsx("div",{className:"h-px flex-1 bg-gray-200"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Manager's evaluation of the developer's performance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Technical Rating"}),e.jsx(Ve,{value:l.technical_rating,onChange:a=>_("technical_rating",a),disabled:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Collaboration Rating"}),e.jsx(Ve,{value:l.collaboration_rating,onChange:a=>_("collaboration_rating",a),disabled:n})]})]})]}),E&&e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Overall Rating: "}),e.jsx("span",{className:"font-bold text-lg",children:E}),e.jsx("span",{className:"text-gray-500",children:" / 5"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"summary",children:"Summary"}),e.jsx(Ae,{id:"summary",placeholder:"Summarize the overall performance...",value:l.summary,onChange:a=>_("summary",a.target.value),disabled:n,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"strengths",children:"Strengths"}),e.jsx(Ae,{id:"strengths",placeholder:"Key strengths demonstrated...",value:l.strengths,onChange:a=>_("strengths",a.target.value),disabled:n,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"areas_for_improvement",children:"Areas for Improvement"}),e.jsx(Ae,{id:"areas_for_improvement",placeholder:"Areas where improvement is needed...",value:l.areas_for_improvement,onChange:a=>_("areas_for_improvement",a.target.value),disabled:n,rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Main Points"}),e.jsxs("div",{className:"space-y-2",children:[l.main_points.map((a,N)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"flex-1 text-sm",children:a}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(N),disabled:n,children:e.jsx(ms,{className:"h-4 w-4"})})]},N)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{placeholder:"Add a main point...",value:f,onChange:a=>S(a.target.value),onKeyPress:a=>a.key==="Enter"&&(a.preventDefault(),b()),disabled:n}),e.jsx(h,{type:"button",variant:"outline",onClick:b,disabled:n||!f.trim(),children:e.jsx(ce,{className:"h-4 w-4"})})]})]})]}),x.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{children:["Key Contributions (",l.highlighted_work_items.length,"/5)"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select up to 5 work items to highlight"}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 border rounded",children:x.map(a=>{const N=l.highlighted_work_items.includes(a.id);return e.jsx(Q,{variant:N?"default":"outline",className:`cursor-pointer ${!N&&l.highlighted_work_items.length>=5?"opacity-50 cursor-not-allowed":""}`,onClick:()=>i(a.id),children:a.name},a.id)})})]})]}),e.jsxs(je,{children:[e.jsx(h,{variant:"outline",onClick:()=>u(!1),disabled:n,children:"Cancel"}),e.jsx(h,{onClick:k,disabled:n,children:n?"Saving...":O?"Update Evaluation":"Create Evaluation"})]})]})})},Ce=({rating:r,size:u="sm"})=>{const D=[],c=Math.floor(r||0),x=(r||0)%1>=.5;for(let n=1;n<=5;n++)n<=c?D.push(e.jsx(Ge,{className:`${u==="sm"?"h-4 w-4":"h-5 w-5"} fill-amber-400 text-amber-400`},n)):n===c+1&&x?D.push(e.jsx(Ge,{className:`${u==="sm"?"h-4 w-4":"h-5 w-5"} text-amber-400`,style:{fill:"url(#half-star-gradient)"}},n)):D.push(e.jsx(Ge,{className:`${u==="sm"?"h-4 w-4":"h-5 w-5"} text-gray-300`},n));return e.jsx("div",{className:"flex gap-0.5",children:D})},mt=({teamMemberId:r})=>{const u=new Date().getFullYear(),[D,c]=d.useState([]),[x,n]=d.useState(u.toString()),[j,l]=d.useState([]),[m,f]=d.useState(!0),[S,I]=d.useState(!1),[C,_]=d.useState(!1),b=[u,u-1],g=async()=>{if(r)try{f(!0);const[y,M]=await Promise.all([Qe.list(r),me.listByTeamMember(r)]);c(Array.isArray(y)?y:[]),l(Array.isArray(M)?M:[])}catch(y){F.error("Error loading performance data",{error:String(y)}),c([]),l([])}finally{f(!1)}};d.useEffect(()=>{g()},[r]);const i=D.find(y=>y.year===parseInt(x,10)),k=parseInt(x,10)<u,O=(y,M,p,P)=>{const U=[y,M,p,P].filter(B=>B!=null);return U.length===0?null:U.reduce((B,ne)=>B+ne,0)/U.length},T=async y=>{try{I(!0),await Qe.create({...y,team_member_id:r}),await g(),_(!1)}catch(M){F.error("Error creating evaluation",{error:String(M)})}finally{I(!1)}},E=async y=>{if(i)try{I(!0),await Qe.update(i.id,y),await g(),_(!1)}catch(M){F.error("Error updating evaluation",{error:String(M)})}finally{I(!1)}},a=i?O(i.self_technical_rating,i.self_collaboration_rating,i.technical_rating,i.collaboration_rating):null,N=i?.highlighted_work_items?.map(y=>j.find(M=>M.id===y)).filter(Boolean)||[];return m?e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),"Performance Evaluation"]})}),e.jsx(ae,{children:e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(ss,{className:"h-6 w-6 animate-spin text-gray-400"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5 shrink-0"}),"Performance"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(H,{value:x,onValueChange:n,children:[e.jsx(K,{className:"w-20 h-8",children:e.jsx(q,{})}),e.jsx(J,{children:b.map(y=>e.jsx(A,{value:y.toString(),children:y},y))})]}),i&&!k&&e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>_(!0),disabled:S,children:e.jsx(be,{className:"h-4 w-4"})})]})]}),a&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ce,{rating:a,size:"sm"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",a.toFixed(1),")"]})]})]}),e.jsx(ae,{children:i?e.jsxs("div",{className:"space-y-4",children:[k&&e.jsx(Q,{variant:"secondary",className:"mb-2",children:"Read-only (Previous Year)"}),e.jsxs("div",{className:"space-y-4",children:[(i.self_technical_rating||i.self_collaboration_rating)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"Self-Assessment"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Technical"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{rating:i.self_technical_rating}),e.jsxs("span",{className:"text-sm",children:["(",i.self_technical_rating||"-",")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Collaboration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{rating:i.self_collaboration_rating}),e.jsxs("span",{className:"text-sm",children:["(",i.self_collaboration_rating||"-",")"]})]})]})]})]}),(i.technical_rating||i.collaboration_rating)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"Manager Assessment"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Technical"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{rating:i.technical_rating}),e.jsxs("span",{className:"text-sm",children:["(",i.technical_rating||"-",")"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Collaboration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{rating:i.collaboration_rating}),e.jsxs("span",{className:"text-sm",children:["(",i.collaboration_rating||"-",")"]})]})]})]})]}),a&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Overall"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{rating:a}),e.jsxs("span",{className:"text-sm font-medium",children:["(",a.toFixed(2),")"]})]})]})})]}),i.summary&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Summary"}),e.jsx("p",{className:"text-sm text-gray-700",children:i.summary})]}),i.strengths&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Strengths"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-line",children:i.strengths})]}),i.areas_for_improvement&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Areas for Improvement"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-line",children:i.areas_for_improvement})]}),i.main_points?.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Main Points"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-1",children:i.main_points.map((y,M)=>e.jsx("li",{children:y},M))})]}),N.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 mb-2",children:["Key Contributions (",N.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:N.map(y=>e.jsx(Q,{variant:"outline",className:"text-xs",children:y.name},y.id))})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Je,{className:"h-10 w-10 text-gray-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-gray-500 text-sm mb-4",children:["No evaluation for ",x]}),!k&&e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>_(!0),disabled:S,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Create Evaluation"]})]})})]}),e.jsx(ot,{open:C,onOpenChange:_,onSubmit:i?E:T,initialData:i,workItems:j,isLoading:S})]})};function St(){const[r]=zs(),u=r.get("id"),{isPresentationMode:D}=Us(),[c,x]=d.useState(null),[n,j]=d.useState([]),{tasks:l,projects:m,teamMembers:f,stakeholders:S,oneOnOnes:I,refreshAll:C}=d.useContext(hs),[_,b]=d.useState(!0),g=()=>!c||!f?0:f.findIndex(s=>s.id===c.id),i=()=>c?D?Xe(c.name,g(),"Team Member"):c.name:"",k=()=>c?D?$s(c.notes):c.notes:"",O=()=>c?D?Ys(g(),"TM"):c.name.split(" ").map(s=>s[0]).join(""):"",T=s=>{if(!D)return f.find(Y=>String(Y.id)===String(s))?.name||"Unknown";const t=f.findIndex(w=>String(w.id)===String(s));return Xe("",t,"Team Member")},E=s=>{if(!D)return S.find(Y=>String(Y.id)===String(s))?.name||"Unknown";const t=S.findIndex(w=>String(w.id)===String(s));return Xe("",t,"Stakeholder")},[a,N]=d.useState(!1),[y,M]=d.useState(!1),[p,P]=d.useState(null),[U,B]=d.useState({text:"",referenced_entity:{type:"team_member",id:""}}),[ne,de]=d.useState(null),[R,pe]=d.useState({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),[re,fe]=d.useState({description:"",due_date:"",linked_task_id:"",linked_project_id:"",status:"open"}),[V,Ee]=d.useState("none"),[ie,ve]=d.useState("");d.useState(()=>{try{return JSON.parse(localStorage.getItem("discussedNotes")||"{}")}catch{return{}}});const[We,ye]=d.useState(!1),[$,le]=d.useState({name:"",role:"",email:"",phone:"",department:"",skills:[],notes:""}),[Ue,o]=d.useState(!1),[z,X]=d.useState(null),[L,Re]=d.useState({date:"",mood:"good",next_meeting_date:""});d.useEffect(()=>{u&&oe()},[u]);const oe=async()=>{b(!0);try{const s=await rs.get(u);x(s),await C();const t=(Array.isArray(I)?I:[]).filter(w=>String(w.team_member_id)===String(u));j(t)}catch(s){F.error("Error loading team member data",{error:String(s)})}finally{b(!1)}},ps=async()=>{try{await Se.create({...R,notes:Array.isArray(R.notes)?R.notes:[],team_member_id:u}),N(!1),oe()}catch(s){F.error("Error creating 1:1 meeting",{error:String(s)})}},fs=async()=>{if(p)try{const s={...p,action_items:[...p.action_items||[],re]};await Se.update(p.id,s),M(!1),oe()}catch(s){F.error("Error adding action item",{error:String(s)})}},vs=async s=>{if(!U.text)return;let t=null;V!=="none"&&ie&&(t={type:V,id:ie});const w=n.find(He=>He.id===s);if(!w)return;const Y={text:U.text,referenced_entity:t,created_by:u,timestamp:new Date().toISOString()},Ne=Array.isArray(w.notes)?[...w.notes,Y]:[Y];await Se.update(s,{...w,notes:Ne}),B({text:"",referenced_entity:{type:"team_member",id:""}}),de(null),oe()},ts=async(s,t,w)=>{try{const Y=n.find(He=>He.id===s);if(!Y)return;const Ne=[...Y.action_items];Ne[t]={...Ne[t],status:w},await Se.update(s,{...Y,action_items:Ne}),oe()}catch(Y){F.error("Error updating action item status",{error:String(Y)})}},ys=async s=>{try{await Se.delete(s),oe()}catch(t){F.error("Error deleting meeting",{error:String(t)})}},Ns=()=>{c&&(le({name:c.name||"",role:c.role||"",email:c.email||"",phone:c.phone||"",department:c.department||"",skills:Array.isArray(c.skills)?c.skills:[],notes:c.notes||""}),ye(!0))},_s=async()=>{try{await rs.update(u,{name:$.name,email:$.email||null,role:$.role||null,phone:$.phone||null,department:$.department||null,skills:Array.isArray($.skills)?$.skills:[],notes:$.notes||null}),ye(!1),oe()}catch(s){F.error("Error updating team member",{error:String(s)})}},bs=s=>{X(s),Re({date:s.date||"",mood:s.mood||"good",next_meeting_date:s.next_meeting_date||""}),o(!0)},ws=async()=>{if(z)try{await Se.update(z.id,{...z,date:L.date,mood:L.mood,next_meeting_date:L.next_meeting_date||null}),o(!1),X(null),oe()}catch(s){F.error("Error updating meeting",{error:String(s)})}};if(_)return e.jsx("div",{className:"p-6",children:"Loading..."});if(!c)return e.jsx("div",{className:"p-6",children:"Team member not found"});const Ss=s=>({open:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[s]||"bg-gray-100 text-gray-800",Cs=s=>({great:"",good:"",neutral:"",concerned:""})[s]||"";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(Ws,{to:"/team",children:e.jsxs(h,{variant:"ghost",children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),"Back to Team"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Rs,{className:"h-16 w-16",children:c.avatar&&!D?e.jsx(Vs,{src:c.avatar,alt:i()}):e.jsx(Gs,{children:O()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:i()}),e.jsx("p",{className:"text-gray-500",children:c.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(it,{teamMemberId:u}),e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(te,{children:"1:1 Meetings"}),e.jsxs(h,{onClick:()=>N(!0),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"New 1:1"]})]})}),e.jsx(ae,{children:n.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Ps,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No 1:1 meetings recorded yet"})]}):e.jsx("div",{className:"space-y-6",children:n.sort((s,t)=>new Date(t.date)-new Date(s.date)).map(s=>e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[Z(G(s.date),"PPP"),e.jsx("span",{className:"text-xl",children:Cs(s.mood)})]}),e.jsxs(Bs,{children:["Next meeting: ",s.next_meeting_date?Z(G(s.next_meeting_date),"PPP"):"Not scheduled"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{P(s),M(!0)},children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Action Item"]}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>bs(s),title:"Edit meeting",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>ys(s.id),title:"Delete meeting",children:e.jsx(es,{className:"h-5 w-5 text-red-500"})})]})]})}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-4",children:[Array.isArray(s.notes)&&s.notes.filter(t=>t.text&&t.text!=="{}"&&(!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(u))).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),D?e.jsx("p",{className:"text-gray-400 italic",children:"[Meeting notes hidden]"}):e.jsx("ul",{className:"list-disc pl-5",children:s.notes.filter(t=>t.text&&t.text!=="{}"&&(!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(u))).map((t,w)=>e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{children:t.text}),t.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[t.referenced_entity.type==="team_member"&&T(t.referenced_entity.id),t.referenced_entity.type==="stakeholder"&&E(t.referenced_entity.id),t.referenced_entity.type==="project"&&m.find(Y=>String(Y.id)===String(t.referenced_entity.id))?.name]})]},w))})]}),e.jsxs("div",{className:"mt-2 flex gap-2 items-end",children:[e.jsx(W,{className:"flex-1",placeholder:"Note text...",value:ne===s.id?U.text:"",onChange:t=>{de(s.id),B(w=>({...w,text:t.target.value}))}}),e.jsxs(H,{value:ne===s.id?V:"none",onValueChange:t=>{de(s.id),Ee(t),ve(""),B(w=>({...w,referenced_entity:t==="none"?null:{type:t,id:""}}))},children:[e.jsx(K,{className:"w-32",children:e.jsx(q,{placeholder:"No tag"})}),e.jsxs(J,{children:[e.jsx(A,{value:"none",children:"No tag"}),e.jsx(A,{value:"team_member",children:"Team Members"}),e.jsx(A,{value:"stakeholder",children:"Stakeholders"}),e.jsx(A,{value:"project",children:"Projects"})]})]}),V!=="none"&&ne===s.id&&e.jsxs(H,{value:ie,onValueChange:t=>{ve(t),B(w=>({...w,referenced_entity:{type:V,id:t}}))},children:[e.jsx(K,{className:"w-40",children:e.jsx(q,{placeholder:"Select name"})}),e.jsxs(J,{children:[V==="team_member"&&f.filter(t=>t.id.toString()!==u?.toString()).map(t=>e.jsx(A,{value:t.id,children:t.name},t.id)),V==="stakeholder"&&S.map(t=>e.jsx(A,{value:t.id,children:t.name},t.id)),V==="project"&&m.map(t=>e.jsx(A,{value:t.id,children:t.name},t.id))]})]}),e.jsx(h,{onClick:()=>{de(s.id),vs(s.id)},disabled:!U.text||V!=="none"&&!ie||ne!==s.id,children:"Add"})]}),s.topics_discussed?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Topics Discussed"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.topics_discussed.map((t,w)=>e.jsx(Q,{variant:"secondary",children:t},w))})]}),s.action_items?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Action Items"}),D?e.jsx("p",{className:"text-gray-400 italic",children:"[Action items hidden]"}):e.jsxs(Hs,{children:[e.jsx(Ks,{children:e.jsxs(ns,{children:[e.jsx(Pe,{children:"Description"}),e.jsx(Pe,{children:"Due Date"}),e.jsx(Pe,{children:"Status"}),e.jsx(Pe,{children:"Links"}),e.jsx(Pe,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(qs,{children:s.action_items.map((t,w)=>e.jsxs(ns,{children:[e.jsx(ze,{children:t.description}),e.jsx(ze,{children:t.due_date?Z(G(t.due_date),"MMM d, yyyy"):"No due date"}),e.jsx(ze,{children:e.jsx(Q,{className:Ss(t.status),children:t.status})}),e.jsx(ze,{children:(t.linked_task_id||t.linked_project_id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[t.linked_task_id&&e.jsxs(Q,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(as,{className:"h-3 w-3"}),"Task"]}),t.linked_project_id&&e.jsxs(Q,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(as,{className:"h-3 w-3"}),"Project"]})]})}),e.jsx(ze,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ts(s.id,w,"completed"),disabled:t.status==="completed",children:e.jsx(De,{className:"h-4 w-4 text-green-500"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ts(s.id,w,"in_progress"),disabled:t.status==="in_progress",children:e.jsx(os,{className:"h-4 w-4 text-blue-500"})})]})})]},w))})]})]})]})})]},s.id))})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(te,{children:"Team Member Info"}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:Ns,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Edit"]})]})}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-4",children:[c.department&&e.jsxs("div",{children:[e.jsx(v,{children:"Department"}),e.jsx("p",{className:"text-gray-600",children:c.department})]}),c.skills?.length>0&&e.jsxs("div",{children:[e.jsx(v,{children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:c.skills.map((s,t)=>e.jsx(Q,{variant:"secondary",children:s},t))})]}),c.notes&&e.jsxs("div",{children:[e.jsx(v,{children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:k()})]})]})})]}),e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Quick Stats"})}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Last 1:1"}),e.jsx("p",{className:"text-gray-600",children:n[0]?Z(G(n[0].date),"PPP"):"No meetings yet"})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Open Action Items"}),e.jsx("p",{className:"text-gray-600",children:n.reduce((s,t)=>s+(t.action_items?.filter(w=>w.status!=="completed").length||0),0)})]})]})})]}),e.jsx(dt,{teamMemberId:u}),e.jsx(mt,{teamMemberId:u})]})]})]}),e.jsx(he,{open:a,onOpenChange:N,children:e.jsxs(xe,{className:"sm:max-w-lg",children:[e.jsxs(ge,{children:[e.jsx(ue,{children:"New 1:1 Meeting"}),e.jsxs(ke,{children:["Record a new one-on-one meeting with ",c?.name||"this team member","."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Date"}),e.jsxs(Te,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),R.date?Z(G(R.date),"PPP"):"Select date"]})}),e.jsx(Me,{className:"w-auto p-0",children:e.jsx(Fe,{mode:"single",selected:R.date?G(R.date):void 0,onSelect:s=>pe(t=>({...t,date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Mood"}),e.jsxs(H,{value:R.mood,onValueChange:s=>pe(t=>({...t,mood:s})),children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(A,{value:"great",children:"Great "}),e.jsx(A,{value:"good",children:"Good "}),e.jsx(A,{value:"neutral",children:"Neutral "}),e.jsx(A,{value:"concerned",children:"Concerned "})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Notes"}),Array.isArray(R.notes)&&R.notes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mb-2",children:R.notes.map((s,t)=>e.jsxs("li",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{children:s.text}),s.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[s.referenced_entity.type==="team_member"&&f.find(w=>w.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="stakeholder"&&S.find(w=>w.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="project"&&m.find(w=>w.id===s.referenced_entity.id)?.name]}),e.jsx(h,{variant:"ghost",size:"xs",className:"ml-2",onClick:()=>pe(w=>({...w,notes:w.notes.filter((Y,Ne)=>Ne!==t)})),children:"Remove"})]},t))}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(W,{className:"flex-1",placeholder:"Note text...",value:U.text,onChange:s=>B(t=>({...t,text:s.target.value}))}),e.jsxs(H,{value:V,onValueChange:s=>{Ee(s),ve(""),B(t=>({...t,referenced_entity:{type:s,id:""}}))},children:[e.jsx(K,{className:"w-32",children:e.jsx(q,{placeholder:"No tag"})}),e.jsxs(J,{children:[e.jsx(A,{value:"none",children:"No tag"}),e.jsx(A,{value:"team_member",children:"Team Members"}),e.jsx(A,{value:"stakeholder",children:"Stakeholders"}),e.jsx(A,{value:"project",children:"Projects"})]})]}),V!=="none"&&e.jsxs(H,{value:ie,onValueChange:s=>{ve(s),B(t=>({...t,referenced_entity:{type:V,id:s}}))},children:[e.jsx(K,{className:"w-40",children:e.jsx(q,{placeholder:"Select name"})}),e.jsxs(J,{children:[V==="team_member"&&f.filter(s=>s.id!==u).map(s=>e.jsx(A,{value:s.id,children:s.name},s.id)),V==="stakeholder"&&S.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id)),V==="project"&&m.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id))]})]}),e.jsx(h,{onClick:()=>{U.text&&(pe(s=>({...s,notes:[...Array.isArray(s.notes)?s.notes:[],{text:U.text,referenced_entity:V==="none"?{}:{type:V,id:ie},created_by:u,timestamp:new Date().toISOString()}]})),B({text:"",referenced_entity:{type:"team_member",id:""}}),Ee("none"),ve(""))},disabled:!U.text||V!=="none"&&!ie,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Next Meeting Date"}),e.jsxs(Te,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),R.next_meeting_date?Z(G(R.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(Me,{className:"w-auto p-0",children:e.jsx(Fe,{mode:"single",selected:R.next_meeting_date?G(R.next_meeting_date):void 0,onSelect:s=>pe(t=>({...t,next_meeting_date:s?.toISOString()}))})})]})]})]}),e.jsxs(je,{children:[e.jsx(h,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(h,{onClick:ps,children:"Create Meeting"})]})]})}),e.jsx(he,{open:y,onOpenChange:M,children:e.jsxs(xe,{className:"sm:max-w-lg",children:[e.jsxs(ge,{children:[e.jsx(ue,{children:"Add Action Item"}),e.jsx(ke,{children:"Create a new action item to track follow-up tasks from this meeting."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Description"}),e.jsx(W,{value:re.description,onChange:s=>fe(t=>({...t,description:s.target.value})),placeholder:"What needs to be done?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Due Date"}),e.jsxs(Te,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),re.due_date?Z(G(re.due_date),"PPP"):"Set due date"]})}),e.jsx(Me,{className:"w-auto p-0",children:e.jsx(Fe,{mode:"single",selected:re.due_date?G(re.due_date):void 0,onSelect:s=>fe(t=>({...t,due_date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Link to Task (Optional)"}),e.jsxs(H,{value:re.linked_task_id,onValueChange:s=>fe(t=>({...t,linked_task_id:s})),children:[e.jsx(K,{children:e.jsx(q,{placeholder:"Select a task"})}),e.jsxs(J,{children:[e.jsx(A,{value:null,children:"None"}),l.map(s=>e.jsx(A,{value:s.id,children:s.title},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Link to Project (Optional)"}),e.jsxs(H,{value:re.linked_project_id,onValueChange:s=>fe(t=>({...t,linked_project_id:s})),children:[e.jsx(K,{children:e.jsx(q,{placeholder:"Select a project"})}),e.jsxs(J,{children:[e.jsx(A,{value:null,children:"None"}),m.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs(je,{children:[e.jsx(h,{variant:"outline",onClick:()=>M(!1),children:"Cancel"}),e.jsx(h,{onClick:fs,children:"Add Action Item"})]})]})}),e.jsx(he,{open:We,onOpenChange:ye,children:e.jsxs(xe,{className:"sm:max-w-lg",children:[e.jsxs(ge,{children:[e.jsx(ue,{children:"Edit Team Member"}),e.jsx(ke,{children:"Update team member information."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-name",children:"Name"}),e.jsx(W,{id:"edit-name",value:$.name,onChange:s=>le(t=>({...t,name:s.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-role",children:"Role / Position"}),e.jsx(W,{id:"edit-role",value:$.role,onChange:s=>le(t=>({...t,role:s.target.value})),placeholder:"e.g. Product Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-department",children:"Department"}),e.jsx(W,{id:"edit-department",value:$.department,onChange:s=>le(t=>({...t,department:s.target.value})),placeholder:"e.g. Engineering"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-email",children:"Email"}),e.jsx(W,{id:"edit-email",type:"email",value:$.email,onChange:s=>le(t=>({...t,email:s.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-phone",children:"Phone"}),e.jsx(W,{id:"edit-phone",type:"tel",value:$.phone,onChange:s=>le(t=>({...t,phone:s.target.value})),placeholder:"Phone number"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-skills",children:"Skills"}),e.jsx(Js,{value:$.skills||[],onChange:s=>le(t=>({...t,skills:s})),placeholder:"Enter skills, press Enter or comma to add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Enter or comma after each skill"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(Ae,{id:"edit-notes",value:$.notes,onChange:s=>le(t=>({...t,notes:s.target.value})),placeholder:"Additional information",rows:3})]})]}),e.jsxs(je,{children:[e.jsx(h,{variant:"outline",onClick:()=>ye(!1),children:"Cancel"}),e.jsx(h,{onClick:_s,children:"Update"})]})]})}),e.jsx(he,{open:Ue,onOpenChange:o,children:e.jsxs(xe,{className:"sm:max-w-lg",children:[e.jsxs(ge,{children:[e.jsx(ue,{children:"Edit 1:1 Meeting"}),e.jsx(ke,{children:"Update meeting details."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Date"}),e.jsxs(Te,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),L.date?Z(G(L.date),"PPP"):"Select date"]})}),e.jsx(Me,{className:"w-auto p-0",children:e.jsx(Fe,{mode:"single",selected:L.date?G(L.date):void 0,onSelect:s=>Re(t=>({...t,date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Mood"}),e.jsxs(H,{value:L.mood,onValueChange:s=>Re(t=>({...t,mood:s})),children:[e.jsx(K,{children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(A,{value:"great",children:"Great "}),e.jsx(A,{value:"good",children:"Good "}),e.jsx(A,{value:"neutral",children:"Neutral "}),e.jsx(A,{value:"concerned",children:"Concerned "})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Next Meeting Date"}),e.jsxs(Te,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),L.next_meeting_date?Z(G(L.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(Me,{className:"w-auto p-0",children:e.jsx(Fe,{mode:"single",selected:L.next_meeting_date?G(L.next_meeting_date):void 0,onSelect:s=>Re(t=>({...t,next_meeting_date:s?.toISOString()}))})})]})]})]}),e.jsxs(je,{children:[e.jsx(h,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(h,{onClick:ws,children:"Update Meeting"})]})]})})]})}export{St as default};
