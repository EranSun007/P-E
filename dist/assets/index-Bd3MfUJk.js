var Il=Object.defineProperty;var qr=a=>{throw TypeError(a)};var Al=(a,t,s)=>t in a?Il(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var rt=(a,t,s)=>Al(a,typeof t!="symbol"?t+"":t,s),Ka=(a,t,s)=>t.has(a)||qr("Cannot "+s);var ps=(a,t,s)=>(Ka(a,t,"read from private field"),s?s.call(a):t.get(a)),_a=(a,t,s)=>t.has(a)?qr("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,s),Sa=(a,t,s,r)=>(Ka(a,t,"write to private field"),r?r.call(a,s):t.set(a,s),s),It=(a,t,s)=>(Ka(a,t,"access private method"),s);import{j as e,b as yn,I as jn,F as vn,S as Vs,d as Ee,e as wn,f as bn,U as Nn,g as Bs,h as Ml,X as Et,i as Us,k as _n,L as Pl,M as ir,l as Rl,T as Sn,m as Fl,n as Sr,o as En,p as $l,q as Cn,r as Ll,s as On,V as Vl,t as Dn,v as kn,w as Bl,x as zs,y as Ul,z as Tn,A as zl,B as Yl,D as Gl,E as In,G as Wl,H as ql,J as $a,K as xa,O as An,a as Hl,C as Mn,N as Kl,Q as Pn,W as Rn,R as Xl,Y as Ql,Z as _s,_ as Ue,$ as Jl,a0 as Fn,a1 as $n,a2 as Ln,a3 as Vn,a4 as Zl,a5 as Bn,a6 as Un,a7 as zn,a8 as Yn,a9 as Gn,aa as oa,ab as Wn,ac as qn,ad as eo,ae as to,af as Hn,ag as so,ah as Kn,ai as Xn,aj as ao,ak as ws,al as ro,am as La,an as ds,ao as Hr,ap as Yt,aq as Dt,ar as no,as as es,at as Ze,au as ms,av as lr,aw as Ma,ax as Va,ay as Ys,az as io,aA as lo,aB as oo,aC as Qn,aD as co,aE as mo,aF as uo,aG as Gs,aH as Er,aI as Ms,aJ as Cr,aK as Jn,aL as Zn,aM as ho,aN as xo,aO as ei,aP as go,aQ as po,aR as ti,aS as Ws,aT as fo,aU as yo,aV as jo,aW as si,aX as vo,aY as ai,aZ as ri,a_ as ni,a$ as ii,b0 as wo,b1 as us,b2 as li,b3 as Kr,b4 as Xr,b5 as bo,b6 as oi,b7 as ci,b8 as di,b9 as mi,ba as No,bb as _o,bc as Pa,bd as ui,be as Qr,bf as So,bg as hi,bh as xi,bi as Eo,bj as gi,bk as pi,bl as fi,bm as yi,bn as ji,bo as Co,bp as Oo,bq as Do,br as ko,bs as To,bt as Jr,bu as Ra,bv as Io,bw as vi,bx as Ao,by as Mo,bz as Po,bA as wi,bB as Ro,P as qs,bC as Fo,bD as $o,bE as Jt,bF as Fa,bG as bi,bH as Lo,bI as Vo,bJ as Bo,bK as Uo,bL as zo,bM as Yo}from"./vendor-ui-bcE-e3Fa.js";import{f as Go,g as Wo,a as c,L as ca,R as da,u as Ba,h as Or,B as qo,i as Ho,j as Ko,k as Lt,b as Xo}from"./vendor-core-CAgkf7aV.js";import{t as Qo,c as Jo,a as ga,D as Zo,_ as Tt,f as Q,b as nt,p as H,s as Da,e as or,d as ec,i as Vt,g as Zr,h as en,j as tn,k as sn,l as Xa,m as Qa,n as tc,o as sc,q as ac,r as Ja}from"./vendor-utils-C7Omb02E.js";import{R as Ni,L as rc,X as nc,Y as ic,T as _i,a as an,P as lc,b as oc,C as cc,c as dc}from"./vendor-charts-CD6yuEN1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var Ea={},rn;function mc(){if(rn)return Ea;rn=1;var a=Go();return Ea.createRoot=a.createRoot,Ea.hydrateRoot=a.hydrateRoot,Ea}var uc=mc();const hc=Wo(uc);function qt(a){return"/"+a.toLowerCase().replace(/ /g,"-")}function B(...a){return Qo(Jo(a))}const xc="modulepreload",gc=function(a){return"/"+a},nn={},Xt=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){let l=function(u){return Promise.all(u.map(x=>Promise.resolve(x).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),m=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=l(s.map(u=>{if(u=gc(u),u in nn)return;nn[u]=!0;const x=u.endsWith(".css"),h=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const d=document.createElement("link");if(d.rel=x?"stylesheet":xc,x||(d.as="script"),d.crossOrigin="",d.href=u,m&&d.setAttribute("nonce",m),document.head.appendChild(d),x)return new Promise((p,j)=>{d.addEventListener("load",p),d.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return n.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})},pc={text:(a,t=255)=>!(typeof a!="string"||a.length>t||a.trim().length===0),email:a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),url:a=>{try{return new URL(a),!0}catch{return!1}},array:(a,t=100)=>!(!Array.isArray(a)||a.length>t),required:a=>a==null?!1:typeof a=="string"?a.trim().length>0:Array.isArray(a)?a.length>0:!0},Ls=()=>{try{const a="__localStorage_test__";return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch{return!1}},fc=a=>{if(!Ls())return console.warn("localStorage is not available"),null;try{return localStorage.getItem(a)}catch(t){return console.warn(`Failed to get item from localStorage: ${a}`,t),null}},yc=(a,t)=>{if(!Ls())return console.warn("localStorage is not available"),!1;try{return localStorage.setItem(a,t),!0}catch(s){return console.warn(`Failed to set item in localStorage: ${a}`,s),!1}},Si=a=>{if(!Ls())return console.warn("localStorage is not available"),!1;try{return localStorage.removeItem(a),!0}catch(t){return console.warn(`Failed to remove item from localStorage: ${a}`,t),!1}},jc=a=>{const t=fc(a);if(!t)return null;try{return JSON.parse(t)}catch(s){return console.warn(`Failed to parse JSON from localStorage: ${a}`,s),Si(a),null}},vc=(a,t)=>{try{const s=JSON.stringify(t);return yc(a,s)}catch(s){return console.warn(`Failed to stringify and store JSON in localStorage: ${a}`,s),!1}},ta={username:"admin",password:"password123"},Za="auth_token";class Zt{static validateCredentials(t,s){return!t||!s?!1:t===ta.username&&s===ta.password}static generateToken(t){return{value:Math.random().toString(36).substring(2)+Date.now().toString(36),timestamp:Date.now(),username:t}}static isValidToken(t){return!(!t||typeof t!="object"||!t.value||!t.timestamp||!t.username)}static clearAuthData(){if(!Ls())return console.warn("localStorage is not available - cannot clear authentication data"),!1;try{return Si(Za)}catch(t){return console.warn("Failed to clear authentication data:",t),!1}}static storeToken(t){if(!Ls()){const s=new Error("localStorage is not available - browser storage may be disabled");throw s.type="STORAGE_UNAVAILABLE",s}try{if(!vc(Za,t)){const r=new Error("Unable to store authentication data - storage may be full or restricted");throw r.type="STORAGE_QUOTA_EXCEEDED",r}}catch(s){if(s.name==="QuotaExceededError"||s.code===22){const r=new Error("Browser storage is full - please clear some data and try again");throw r.type="STORAGE_QUOTA_EXCEEDED",r}else if(s.name==="SecurityError"){const r=new Error("Browser storage access is restricted - please check your privacy settings");throw r.type="STORAGE_SECURITY_ERROR",r}else{const r=new Error("Failed to save authentication data - please try again");throw r.type="STORAGE_UNKNOWN_ERROR",r.originalError=s,r}}}static getStoredToken(){if(!Ls()){const t=new Error("localStorage is not available - cannot retrieve authentication token");throw t.type="STORAGE_UNAVAILABLE",t}try{const t=jc(Za);return this.isValidToken(t)?t:null}catch{return console.warn("Corrupted authentication token detected, clearing storage"),this.clearAuthData(),null}}static isAuthenticated(){try{return this.getStoredToken()!==null}catch(t){if(t.type==="STORAGE_UNAVAILABLE")throw t;return console.warn("Error checking authentication status:",t),!1}}static async changePassword(t,s,r){if(t!==ta.username||s!==ta.password)throw new Error("Incorrect current password.");ta.password=r,console.log("Password for user '"+t+"' has been changed."),this.clearAuthData()}}const ln=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"})),Ei="audit_logs",wc=()=>{try{const a=Zt.getStoredToken();return(a==null?void 0:a.username)||null}catch(a){return console.warn("Unable to get current user for audit log:",a),null}},bc=()=>{try{const a=localStorage.getItem(Ei);return a?JSON.parse(a):[]}catch(a){return console.error("Error reading audit logs:",a),[]}},Nc=a=>{try{localStorage.setItem(Ei,JSON.stringify(a))}catch(t){console.error("Error saving audit logs:",t)}},yt=(a,t,s,r={})=>{const n=wc();if(!n){console.warn("Cannot create audit log: no authenticated user");return}const i={id:crypto.randomUUID?crypto.randomUUID():`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),user:n,action:a,resource:t,resourceId:s,metadata:r,userAgent:navigator.userAgent,ipAddress:"localhost"},l=bc();l.unshift(i),l.length>1e3&&l.splice(1e3),Nc(l)},jt={CREATE:"CREATE",READ:"READ",UPDATE:"UPDATE",DELETE:"DELETE",EXPORT:"EXPORT",PRINT:"PRINT",ACCESS:"ACCESS"},vt={PERSONAL_FILE_ITEM:"PERSONAL_FILE_ITEM",AGENDA_ITEM:"AGENDA_ITEM",TEAM_MEMBER:"TEAM_MEMBER"};function X(a){try{const t=localStorage.getItem(a);return t?JSON.parse(t):[]}catch(t){return console.error(`Error reading data from localStorage key "${a}":`,t),[]}}function pe(a,t){try{if(!pc.array(t))throw new Error("Invalid data format - must be an array");localStorage.setItem(a,JSON.stringify(t))}catch(s){throw console.error(`Error saving data to localStorage key "${a}":`,s),s}}function pt(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"_"+Date.now().toString(36)+Math.random().toString(36).substr(2,9)}function _c(){try{const a=Zt.getStoredToken();return(a==null?void 0:a.username)||null}catch(a){return console.warn("Unable to get current user:",a),null}}function fs(a,t,s=null){const r=_c();if(!r)throw new Error("Access denied: User not authenticated");if(s&&s.createdBy&&s.createdBy!==r)throw new Error("Access denied: You can only access your own personal file items");return r}const Pe={entities:{Task:{async list(){return X("tasks")},async create(a){const t=X("tasks"),s={...a,id:pt(),created_date:new Date().toISOString(),updated_date:new Date().toISOString(),due_date:a.due_date||null,assignee:a.assignee||null,estimated_hours:a.estimated_hours||null,actual_hours:a.actual_hours||null,completion_date:null};return t.unshift(s),pe("tasks",t),s},async update(a,t){const s=X("tasks"),r=s.findIndex(n=>n.id===a);if(r!==-1){const n=s[r],i={...n,...t,updated_date:new Date().toISOString()};return t.status==="done"&&n.status!=="done"?i.completion_date=new Date().toISOString():t.status&&t.status!=="done"&&n.status==="done"&&(i.completion_date=null),s[r]=i,pe("tasks",s),s[r]}throw new Error("Task not found")},async delete(a){let t=X("tasks");return t=t.filter(s=>s.id!==a),pe("tasks",t),!0}},Project:{async list(){return X("projects")},async create(a){const t=X("projects"),s={...a,id:pt(),created_date:new Date().toISOString(),deadline:a.deadline||null,budget:a.budget||null,cost:a.cost||null,priority_level:a.priority_level||"medium",progress_percentage:a.progress_percentage||0};return t.unshift(s),pe("projects",t),s},async update(a,t){const s=X("projects"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t},pe("projects",s),s[r];throw new Error("Project not found")},async delete(a){let t=X("projects");return t=t.filter(s=>s.id!==a),pe("projects",t),!0}},Stakeholder:{async list(){return X("stakeholders")},async create(a){const t=X("stakeholders"),s={...a,id:pt(),created_date:new Date().toISOString(),phone:a.phone||null,contact_info:a.contact_info||null,company:a.company||a.organization||null};return delete s.organization,t.unshift(s),pe("stakeholders",t),s},async update(a,t){const s=X("stakeholders"),r=s.findIndex(n=>n.id===a);if(r!==-1){const n={...s[r],...t};return t.organization&&!t.company&&(n.company=t.organization,delete n.organization),s[r]=n,pe("stakeholders",s),s[r]}throw new Error("Stakeholder not found")},async delete(a){let t=X("stakeholders");return t=t.filter(s=>s.id!==a),pe("stakeholders",t),!0}},TeamMember:{async list(){return X("team_members")},async get(a){return X("team_members").find(s=>s.id===a)||null},async create(a){const t=X("team_members"),s={...a,id:pt(),created_date:new Date().toISOString(),phone:a.phone||null,company:a.company||null,birthday:a.birthday||null,duties:a.duties||[],last_activity:null};return t.unshift(s),pe("team_members",t),s},async update(a,t){const s=X("team_members"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t},pe("team_members",s),s[r];throw new Error("Team member not found")},async delete(a){let t=X("team_members");return t=t.filter(s=>s.id!==a),pe("team_members",t),!0},async getDuties(a){return X("duties").filter(s=>s.team_member_id===a)},async getCurrentDuties(a){const t=X("duties"),s=new Date;return t.filter(r=>{if(r.team_member_id!==a)return!1;const n=new Date(r.start_date),i=new Date(r.end_date);return s>=n&&s<=i})}},OneOnOne:{async list(){return X("one_on_ones")},async create(a){const t=X("one_on_ones"),s={...a,id:pt(),created_date:new Date().toISOString(),updated_date:new Date().toISOString(),team_member_id:a.team_member_id||a.participant_id||null,status:a.status||"scheduled",location:a.location||null,next_meeting_calendar_event_id:a.next_meeting_calendar_event_id||null};if(delete s.participant_id,t.unshift(s),pe("one_on_ones",t),s.next_meeting_date&&s.team_member_id)try{const{CalendarService:r}=await Xt(async()=>{const{CalendarService:i}=await Promise.resolve().then(()=>Ca);return{CalendarService:i}},void 0),n=await r.createAndLinkOneOnOneMeeting(s.id,s.team_member_id,s.next_meeting_date);s.next_meeting_calendar_event_id=n.calendarEvent.id,t[0]=s,pe("one_on_ones",t)}catch(r){console.warn("Failed to create calendar event for OneOnone:",r)}try{const{CalendarSynchronizationService:r}=await Xt(async()=>{const{CalendarSynchronizationService:n}=await Promise.resolve().then(()=>vr);return{CalendarSynchronizationService:n}},void 0);r.ensureOneOnOneVisibility({teamMemberId:s.team_member_id,createMissing:!0}).catch(n=>{console.warn("Background calendar sync failed after OneOnOne creation:",n)})}catch(r){console.warn("Failed to import CalendarSynchronizationService:",r)}return s},async update(a,t){const s=X("one_on_ones"),r=s.findIndex(n=>n.id===a);if(r!==-1){const n=s[r],i={...n,...t,updated_date:new Date().toISOString()};if(t.participant_id&&!t.team_member_id&&(i.team_member_id=t.participant_id,delete i.participant_id),t.next_meeting_date&&t.next_meeting_date!==n.next_meeting_date)try{const{CalendarService:l}=await Xt(async()=>{const{CalendarService:o}=await Promise.resolve().then(()=>Ca);return{CalendarService:o}},void 0);if(n.next_meeting_calendar_event_id)await l.updateOneOnOneMeeting(n.next_meeting_calendar_event_id,t.next_meeting_date);else if(i.team_member_id){const o=await l.createAndLinkOneOnOneMeeting(a,i.team_member_id,t.next_meeting_date);i.next_meeting_calendar_event_id=o.calendarEvent.id}}catch(l){console.warn("Failed to update calendar event for OneOnOne:",l)}try{const{CalendarSynchronizationService:l}=await Xt(async()=>{const{CalendarSynchronizationService:o}=await Promise.resolve().then(()=>vr);return{CalendarSynchronizationService:o}},void 0);l.ensureOneOnOneVisibility({teamMemberId:i.team_member_id,createMissing:!0}).catch(o=>{console.warn("Background calendar sync failed after OneOnOne update:",o)})}catch(l){console.warn("Failed to import CalendarSynchronizationService:",l)}if((t.next_meeting_date===null||t.next_meeting_date==="")&&n.next_meeting_calendar_event_id)try{const{CalendarService:l}=await Xt(async()=>{const{CalendarService:o}=await Promise.resolve().then(()=>Ca);return{CalendarService:o}},void 0);await l.deleteOneOnOneMeeting(n.next_meeting_calendar_event_id),i.next_meeting_calendar_event_id=null}catch(l){console.warn("Failed to delete calendar event for OneOnOne:",l)}return s[r]=i,pe("one_on_ones",s),s[r]}throw new Error("OneOnOne not found")},async delete(a){const t=X("one_on_ones"),s=t.find(n=>n.id===a);if(s&&s.next_meeting_calendar_event_id)try{const{CalendarService:n}=await Xt(async()=>{const{CalendarService:i}=await Promise.resolve().then(()=>Ca);return{CalendarService:i}},void 0);await n.deleteOneOnOneMeeting(s.next_meeting_calendar_event_id)}catch(n){console.warn("Failed to delete associated calendar event:",n)}const r=t.filter(n=>n.id!==a);return pe("one_on_ones",r),!0}},TaskAttribute:{async list(){return X("task_attributes")},async create(a){const t=X("task_attributes"),s={...a,id:pt(),created_date:new Date().toISOString(),updated_date:new Date().toISOString()};return t.unshift(s),pe("task_attributes",t),s},async update(a,t){const s=X("task_attributes"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t,updated_date:new Date().toISOString()},pe("task_attributes",s),s[r];throw new Error("TaskAttribute not found")},async delete(a){let t=X("task_attributes");return t=t.filter(s=>s.id!==a),pe("task_attributes",t),!0}},Meeting:{async list(){return X("meetings")},async get(a){return X("meetings").find(s=>s.id===a)||null},async create(a){const t=X("meetings"),s={...a,id:pt(),created_date:new Date().toISOString(),updated_date:new Date().toISOString(),status:a.status||"scheduled",participants:a.participants||[],agenda_items:a.agenda_items||[],action_items:a.action_items||[]};return t.unshift(s),pe("meetings",t),s},async update(a,t){const s=X("meetings"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t,updated_date:new Date().toISOString()},pe("meetings",s),s[r];throw new Error("Meeting not found")},async delete(a){let t=X("meetings");return t=t.filter(s=>s.id!==a),pe("meetings",t),!0}},CalendarEvent:{async list(){return X("calendar_events")},async get(a){return X("calendar_events").find(s=>s.id===a)||null},async create(a){const t=X("calendar_events"),s=["meeting","one_on_one","duty","birthday","out_of_office"];if(a.event_type&&!s.includes(a.event_type))throw new Error(`Invalid event_type. Must be one of: ${s.join(", ")}`);a.event_type==="duty"&&!a.duty_id&&console.warn("Duty event created without duty_id - this may cause display issues"),a.event_type==="out_of_office"&&!a.out_of_office_id&&console.warn("Out of office event created without out_of_office_id - this may cause display issues");const r={...a,id:pt(),created_date:new Date().toISOString(),all_day:a.all_day||!1,recurrence_rule:a.recurrence_rule||null,event_type:a.event_type||"meeting",duty_id:a.duty_id||null,out_of_office_id:a.out_of_office_id||null,recurrence:a.recurrence||null};return r.event_type==="birthday"&&!r.recurrence&&(r.recurrence={type:"yearly",interval:1}),t.unshift(r),pe("calendar_events",t),r},async update(a,t){const s=X("calendar_events"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t},pe("calendar_events",s),s[r];throw new Error("Calendar event not found")},async delete(a){let t=X("calendar_events");return t=t.filter(s=>s.id!==a),pe("calendar_events",t),!0},async createDutyEvent(a,t,s,r,n,i=null){return await this.create({title:s,description:i||`Duty assignment: ${s}`,start_date:r,end_date:n,all_day:!0,event_type:"duty",duty_id:a,team_member_id:t,linked_entity_type:"duty",linked_entity_id:a})},async createBirthdayEvent(a,t,s){return await this.create({title:`🎂 ${t}'s Birthday`,description:`Birthday celebration for ${t}`,start_date:s,end_date:s,all_day:!0,event_type:"birthday",team_member_id:a,linked_entity_type:"team_member",linked_entity_id:a,recurrence:{type:"yearly",interval:1}})},async createOutOfOfficeEvent(a,t,s,r,n,i="vacation"){return await this.create({title:`${s} - Out of Office (${i})`,description:`${s} is out of office`,start_date:r,end_date:n,all_day:!0,event_type:"out_of_office",out_of_office_id:a,team_member_id:t,linked_entity_type:"out_of_office",linked_entity_id:a})},async getByType(a){return(await this.list()).filter(s=>s.event_type===a)},async getByDutyId(a){return(await this.list()).filter(s=>s.duty_id===a)},async getByOutOfOfficeId(a){return(await this.list()).filter(s=>s.out_of_office_id===a)},async getBirthdayEvents(){return await this.getByType("birthday")},async getDutyEvents(){return await this.getByType("duty")},async getOutOfOfficeEvents(){return await this.getByType("out_of_office")},async getMeetingEvents(){return(await this.list()).filter(t=>t.event_type==="meeting"||t.event_type==="one_on_one")}},Notification:{async list(){return X("notifications")},async get(a){return X("notifications").find(s=>s.id===a)||null},async create(a){const t=X("notifications"),s={...a,id:pt(),created_date:new Date().toISOString(),read:a.read||!1,scheduled_date:a.scheduled_date||null};return t.unshift(s),pe("notifications",t),s},async update(a,t){const s=X("notifications"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t},pe("notifications",s),s[r];throw new Error("Notification not found")},async delete(a){let t=X("notifications");return t=t.filter(s=>s.id!==a),pe("notifications",t),!0}},Reminder:{async list(){return X("reminders")},async get(a){return X("reminders").find(s=>s.id===a)||null},async create(a){const t=X("reminders"),s={...a,id:pt(),created_date:new Date().toISOString(),completed:a.completed||!1};return t.unshift(s),pe("reminders",t),s},async update(a,t){const s=X("reminders"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t},pe("reminders",s),s[r];throw new Error("Reminder not found")},async delete(a){let t=X("reminders");return t=t.filter(s=>s.id!==a),pe("reminders",t),!0}},Comment:{async list(){return X("comments")},async get(a){return X("comments").find(s=>s.id===a)||null},async create(a){const t=X("comments"),s={...a,id:pt(),created_date:new Date().toISOString(),updated_date:new Date().toISOString(),author_name:a.author_name||"Local User"};return t.unshift(s),pe("comments",t),s},async update(a,t){const s=X("comments"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t,updated_date:new Date().toISOString()},pe("comments",s),s[r];throw new Error("Comment not found")},async delete(a){let t=X("comments");return t=t.filter(s=>s.id!==a),pe("comments",t),!0}},OutOfOffice:{async list(){return X("out_of_office")},async get(a){return X("out_of_office").find(s=>s.id===a)||null},async create(a){const t=X("out_of_office"),s={...a,id:pt(),created_date:new Date().toISOString(),updated_date:new Date().toISOString(),notes:a.notes||null,team_member_id:a.team_member_id||null,peer_id:a.peer_id||null};return t.unshift(s),pe("out_of_office",t),s},async update(a,t){const s=X("out_of_office"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t,updated_date:new Date().toISOString()},pe("out_of_office",s),s[r];throw new Error("OutOfOffice not found")},async delete(a){let t=X("out_of_office");return t=t.filter(s=>s.id!==a),pe("out_of_office",t),!0},async getByTeamMember(a){return X("out_of_office").filter(s=>s.team_member_id===a)},async getByPeer(a){return X("out_of_office").filter(s=>s.peer_id===a)},async getActiveForDate(a){const t=X("out_of_office"),s=new Date(a);return t.filter(r=>{const n=new Date(r.start_date),i=new Date(r.end_date);return s>=n&&s<=i})},async getCountForYear(a,t){const r=X("out_of_office").filter(o=>o.team_member_id===a);let n=0;const i=new Date(t,0,1),l=new Date(t,11,31);return r.forEach(o=>{const m=new Date(o.start_date),u=new Date(o.end_date),x=new Date(Math.max(m.getTime(),i.getTime())),h=new Date(Math.min(u.getTime(),l.getTime()));if(x<=h){const d=h.getTime()-x.getTime(),p=Math.floor(d/(1e3*3600*24))+1;n+=p}}),n},async getCountForYearByPeer(a,t){const r=X("out_of_office").filter(o=>o.peer_id===a);let n=0;const i=new Date(t,0,1),l=new Date(t,11,31);return r.forEach(o=>{const m=new Date(o.start_date),u=new Date(o.end_date),x=new Date(Math.max(m.getTime(),i.getTime())),h=new Date(Math.min(u.getTime(),l.getTime()));if(x<=h){const d=h.getTime()-x.getTime(),p=Math.floor(d/(1e3*3600*24))+1;n+=p}}),n}},Peer:{async list(){return X("peers")},async get(a){return X("peers").find(s=>s.id===a)||null},async create(a){const t=X("peers"),s={...a,id:pt(),created_date:new Date().toISOString(),last_activity:null,organization:a.organization||"",collaboration_context:a.collaboration_context||"",relationship_type:a.relationship_type||"other",name:a.name,role:a.role||"",email:a.email||"",phone:a.phone||"",department:a.department||"",availability:a.availability||"",skills:Array.isArray(a.skills)?a.skills:[],notes:a.notes||"",avatar:a.avatar||""};return t.unshift(s),pe("peers",t),s},async update(a,t){const s=X("peers"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t},pe("peers",s),s[r];throw new Error("Peer not found")},async delete(a){let t=X("peers");return t=t.filter(s=>s.id!==a),pe("peers",t),!0}},Duty:{async list(){return X("duties")},async get(a){return X("duties").find(s=>s.id===a)||null},async create(a){const t=X("duties");if(!a.team_member_id)throw new Error("team_member_id is required");if(!a.type)throw new Error("duty type is required");if(!a.title)throw new Error("duty title is required");if(!a.start_date)throw new Error("start_date is required");if(!a.end_date)throw new Error("end_date is required");const s=["devops","on_call","other"];if(!s.includes(a.type))throw new Error(`Invalid duty type. Must be one of: ${s.join(", ")}`);const r=new Date(a.start_date),n=new Date(a.end_date);if(r>=n)throw new Error("start_date must be before end_date");t.filter(m=>m.team_member_id===a.team_member_id).some(m=>{const u=new Date(m.start_date),x=new Date(m.end_date);return r<=x&&n>=u})&&console.warn("Duty assignment conflicts with existing duty for this team member");const o={...a,id:pt(),created_date:new Date().toISOString(),updated_date:new Date().toISOString(),team_member_id:a.team_member_id,type:a.type,title:a.title,description:a.description||null,start_date:a.start_date,end_date:a.end_date};return t.unshift(o),pe("duties",t),o},async update(a,t){const s=X("duties"),r=s.findIndex(m=>m.id===a);if(r===-1)throw new Error("Duty not found");const n=s[r];if(t.type){const m=["devops","on_call","other"];if(!m.includes(t.type))throw new Error(`Invalid duty type. Must be one of: ${m.join(", ")}`)}const i=new Date(t.start_date||n.start_date),l=new Date(t.end_date||n.end_date);if(i>=l)throw new Error("start_date must be before end_date");if(t.start_date||t.end_date||t.team_member_id){const m=t.team_member_id||n.team_member_id;s.filter(h=>h.team_member_id===m&&h.id!==a).some(h=>{const d=new Date(h.start_date),p=new Date(h.end_date);return i<=p&&l>=d})&&console.warn("Updated duty assignment conflicts with existing duty for this team member")}const o={...n,...t,updated_date:new Date().toISOString()};return s[r]=o,pe("duties",s),o},async delete(a){let t=X("duties");if(!t.some(r=>r.id===a))throw new Error("Duty not found");return t=t.filter(r=>r.id!==a),pe("duties",t),!0},async getByTeamMember(a){return X("duties").filter(s=>s.team_member_id===a)},async getActiveForDate(a){const t=X("duties"),s=new Date(a);return t.filter(r=>{const n=new Date(r.start_date),i=new Date(r.end_date);return s>=n&&s<=i})},async getConflicts(a,t,s,r=null){const n=X("duties"),i=new Date(t),l=new Date(s);return n.filter(o=>{if(r&&o.id===r||o.team_member_id!==a)return!1;const m=new Date(o.start_date),u=new Date(o.end_date);return i<=u&&l>=m})}},AgendaItem:{async list(){return X("agenda_items")},async get(a){return X("agenda_items").find(s=>s.id===a)||null},async create(a){const t=X("agenda_items"),s={...a,id:pt(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:a.status||"pending",priority:a.priority||2,tags:a.tags||[]};return t.unshift(s),pe("agenda_items",t),s},async update(a,t){const s=X("agenda_items"),r=s.findIndex(n=>n.id===a);if(r!==-1)return s[r]={...s[r],...t,updatedAt:new Date().toISOString()},pe("agenda_items",s),s[r];throw new Error("AgendaItem not found")},async delete(a){let t=X("agenda_items");return t=t.filter(s=>s.id!==a),pe("agenda_items",t),!0},async getByTeamMember(a){return X("agenda_items").filter(s=>s.teamMemberId===a)},async getByStatus(a){return X("agenda_items").filter(s=>s.status===a)},async getForNextMeeting(a){return X("agenda_items").filter(s=>s.teamMemberId===a&&s.status==="pending")}},PersonalFileItem:{async list(){const a=fs(),s=X("personal_file_items").filter(r=>r.createdBy===a);return yt(jt.READ,vt.PERSONAL_FILE_ITEM,"all",{operation:"list",itemCount:s.length}),s},async get(a){const t=fs(),r=X("personal_file_items").find(n=>n.id===a);if(!r)return null;if(r.createdBy!==t)throw new Error("Access denied: You can only access your own personal file items");return yt(jt.READ,vt.PERSONAL_FILE_ITEM,a,{operation:"get",teamMemberId:r.teamMemberId}),r},async create(a){const t=fs(),s=X("personal_file_items"),r={...a,id:pt(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),createdBy:t,category:a.category||"general",tags:a.tags||[],importance:a.importance||3};return s.unshift(r),pe("personal_file_items",s),yt(jt.CREATE,vt.PERSONAL_FILE_ITEM,r.id,{operation:"create",teamMemberId:r.teamMemberId,category:r.category,importance:r.importance}),r},async update(a,t){const s=fs(),r=X("personal_file_items"),n=r.findIndex(o=>o.id===a);if(n===-1)throw new Error("PersonalFileItem not found");const i=r[n];if(i.createdBy!==s)throw new Error("Access denied: You can only update your own personal file items");const l={...i,...t,updatedAt:new Date().toISOString(),createdBy:i.createdBy};return r[n]=l,pe("personal_file_items",r),yt(jt.UPDATE,vt.PERSONAL_FILE_ITEM,a,{operation:"update",teamMemberId:l.teamMemberId,changes:Object.keys(t)}),l},async delete(a){const t=fs();let s=X("personal_file_items");const r=s.find(n=>n.id===a);if(!r)throw new Error("PersonalFileItem not found");if(r.createdBy!==t)throw new Error("Access denied: You can only delete your own personal file items");return s=s.filter(n=>n.id!==a),pe("personal_file_items",s),yt(jt.DELETE,vt.PERSONAL_FILE_ITEM,a,{operation:"delete",teamMemberId:r.teamMemberId,category:r.category}),!0},async getByTeamMember(a){const t=fs(),r=X("personal_file_items").filter(n=>n.teamMemberId===a&&n.createdBy===t);return yt(jt.READ,vt.PERSONAL_FILE_ITEM,"team_member",{operation:"getByTeamMember",teamMemberId:a,itemCount:r.length}),r},async getByCategory(a){const t=fs(),r=X("personal_file_items").filter(n=>n.category===a&&n.createdBy===t);return yt(jt.READ,vt.PERSONAL_FILE_ITEM,"category",{operation:"getByCategory",category:a,itemCount:r.length}),r},async searchByTags(a){if(!Array.isArray(a)||a.length===0)return[];const t=fs(),r=X("personal_file_items").filter(n=>n.createdBy===t&&n.tags&&n.tags.some(i=>a.includes(i)));return yt(jt.READ,vt.PERSONAL_FILE_ITEM,"tags",{operation:"searchByTags",tags:a,itemCount:r.length}),r}}}},xt=Pe.entities.Task,Pt=Pe.entities.Project,cs=Pe.entities.Stakeholder,Fe=Pe.entities.TeamMember,ks=Pe.entities.TaskAttribute,Re=Pe.entities.OneOnOne,Sc=Pe.entities.Meeting,Ce=Pe.entities.CalendarEvent,Ec=Pe.entities.Notification,Cc=Pe.entities.Reminder,Oc=Pe.entities.Comment,Ut=Pe.entities.OutOfOffice,js=Pe.entities.Peer,Mt=Pe.entities.Duty,Dc=Pe.entities.AgendaItem,kc=Pe.entities.PersonalFileItem,Ci={me:async()=>{const t=(await Xt(async()=>{const{default:r}=await Promise.resolve().then(()=>ln);return{default:r}},void 0)).default.getStoredToken();if(!t)throw new Error("No authenticated user found");return{id:"local-user",name:t.username==="admin"?"Administrator":t.username.charAt(0).toUpperCase()+t.username.slice(1),username:t.username,isAuthenticated:!0,loginTime:new Date(t.timestamp).toISOString()}},logout:async()=>((await Xt(async()=>{const{default:t}=await Promise.resolve().then(()=>ln);return{default:t}},void 0)).default.clearAuthData(),!0)},Oi=Object.freeze(Object.defineProperty({__proto__:null,AgendaItem:Dc,CalendarEvent:Ce,Comment:Oc,Duty:Mt,Meeting:Sc,Notification:Ec,OneOnOne:Re,OutOfOffice:Ut,Peer:js,PersonalFileItem:kc,Project:Pt,Reminder:Cc,Stakeholder:cs,Task:xt,TaskAttribute:ks,TeamMember:Fe,User:Ci},Symbol.toStringTag,{value:"Module"})),bs=c.forwardRef(({className:a,...t},s)=>e.jsx(yn,{ref:s,className:B("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...t}));bs.displayName=yn.displayName;const pa=c.forwardRef(({className:a,...t},s)=>e.jsx(jn,{ref:s,className:B("aspect-square h-full w-full",a),...t}));pa.displayName=jn.displayName;const Ns=c.forwardRef(({className:a,...t},s)=>e.jsx(vn,{ref:s,className:B("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...t}));Ns.displayName=vn.displayName;const Di=c.createContext(null),Dr=()=>{const a=c.useContext(Di);if(!a)throw new Error("useAuth must be used within an AuthProvider");return a},Tc=({children:a})=>{const[t,s]=c.useState(!1),[r,n]=c.useState(!0),[i,l]=c.useState(null);c.useEffect(()=>{(async()=>{var d;try{l(null);const p=Zt.isAuthenticated();s(p)}catch(p){console.error("Failed to initialize authentication state:",p);let j="Failed to initialize authentication. Please refresh the page.";switch(p.type){case"STORAGE_UNAVAILABLE":j="Browser storage is not available. Please enable cookies and local storage in your browser settings.";break;case"STORAGE_SECURITY_ERROR":j="Browser storage access is restricted. Please check your privacy settings.";break;default:(d=p.message)!=null&&d.includes("localStorage")&&(j="Browser storage is not available. Please enable cookies and local storage.")}l(j),s(!1)}finally{n(!1)}})()},[]);const x={isAuthenticated:t,login:async(h,d)=>{var p,j;try{if(l(null),!h||!d)return{success:!1,error:"Please fill in all fields"};if(!Zt.validateCredentials(h,d))return{success:!1,error:"Invalid username or password"};const b=Zt.generateToken(h);return Zt.storeToken(b),s(!0),{success:!0}}catch(y){console.error("Login failed:",y);let b="Authentication failed. Please try again.";switch(y.type){case"STORAGE_UNAVAILABLE":b="Browser storage is disabled. Please enable cookies and local storage in your browser settings.";break;case"STORAGE_QUOTA_EXCEEDED":b="Browser storage is full. Please clear some browser data and try again.";break;case"STORAGE_SECURITY_ERROR":b="Browser storage access is restricted. Please check your privacy settings and try again.";break;case"STORAGE_UNKNOWN_ERROR":b="Unable to save login session. Please try again or contact support.";break;default:(p=y.message)!=null&&p.includes("localStorage")?b="Unable to save login session. Please check your browser settings.":(j=y.message)!=null&&j.includes("Unable to store")&&(b="Unable to save login session. Your browser storage may be full.")}return{success:!1,error:b}}},logout:()=>{try{l(null);const h=Zt.clearAuthData();s(!1),h||console.warn("Unable to clear browser storage during logout - session data may persist")}catch(h){console.error("Logout failed:",h),s(!1),h.type==="STORAGE_UNAVAILABLE"?console.warn("localStorage unavailable during logout - session cleared from memory only"):console.warn("Unexpected error during logout:",h)}},loading:r,error:i,clearError:()=>{l(null)}};return e.jsx(Di.Provider,{value:x,children:a})};function Ic({children:a,currentPageName:t}){var d;const[s,r]=c.useState(!1),[n,i]=c.useState(null),[l,o]=c.useState(!0),{logout:m,isAuthenticated:u}=Dr();c.useEffect(()=>{(async()=>{if(!u){i(null),o(!1);return}try{o(!0);const j=await Ci.me();i(j)}catch(j){console.error("Error fetching user data:",j),i(null)}finally{o(!1)}})()},[u]);const x=()=>{m()},h=[{name:"Tasks",icon:Vs,href:qt("Tasks"),current:t==="Tasks"},{name:"Calendar",icon:Ee,href:qt("Calendar"),current:t==="Calendar"},{name:"Projects",icon:wn,href:qt("Projects"),current:t==="Projects"},{name:"Metrics",icon:bn,href:qt("Metrics"),current:t==="Metrics"},{name:"Team",icon:Nn,href:qt("Team"),current:t==="Team"},{name:"Stakeholders",icon:Bs,href:qt("Stakeholders"),current:t==="Stakeholders"},{name:"Peers",icon:Bs,href:qt("Peers"),current:t==="Peers"}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[s&&e.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-40 lg:hidden",onClick:()=>r(!1)}),e.jsxs("div",{className:B("fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-200 ease-in-out lg:translate-x-0 overflow-y-auto",s?"translate-x-0":"-translate-x-full"),children:[e.jsx("div",{className:"sticky top-0 bg-white z-10 border-b",children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ml,{className:"h-8 w-8 text-indigo-600"}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900",children:"P&E Manager"})]}),e.jsx("button",{onClick:()=>r(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:e.jsx(Et,{className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"flex flex-col h-[calc(100%-4rem)] justify-between",children:[e.jsx("nav",{className:"flex-1 p-4 overflow-y-auto",children:e.jsx("div",{className:"space-y-1",children:h.map(p=>e.jsxs(ca,{to:p.href,onClick:()=>r(!1),className:B("flex items-center px-4 py-3 text-sm font-medium rounded-md",p.current?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100"),children:[e.jsx(p.icon,{className:"h-5 w-5 mr-3"}),p.name]},p.name))})}),e.jsxs("div",{className:"p-4 border-t",children:[l?e.jsxs("div",{className:"mb-4 px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-gray-200 rounded-full animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-2/3"})]})]}):n?e.jsxs("div",{className:"mb-4 px-4 py-3 flex items-center gap-3",children:[e.jsx(bs,{className:"h-10 w-10 bg-indigo-100",children:e.jsx(Ns,{className:"text-indigo-700",children:((d=n.name)==null?void 0:d.split(" ").map(p=>p[0]).join("").toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:n.name||"User"}),e.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["@",n.username||"user"]})]})]}):u&&e.jsxs("div",{className:"mb-4 px-4 py-3 flex items-center gap-3",children:[e.jsx(bs,{className:"h-10 w-10 bg-gray-100",children:e.jsx(Ns,{className:"text-gray-500",children:e.jsx(Us,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:"User"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:"Authenticated"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(ca,{to:qt("Settings"),onClick:()=>r(!1),className:B("flex items-center px-4 py-3 text-sm font-medium rounded-md",t==="Settings"?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100"),children:[e.jsx(_n,{className:"h-5 w-5 mr-3"}),"Settings"]}),e.jsxs("button",{onClick:x,className:"w-full flex items-center px-4 py-3 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100",children:[e.jsx(Pl,{className:"h-5 w-5 mr-3"}),"Log out"]})]})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 lg:ml-64",children:[e.jsx("header",{className:"sticky top-0 bg-white shadow-sm z-10",children:e.jsx("div",{className:"flex justify-between items-center h-16 px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>r(!0),className:"lg:hidden text-gray-500 hover:text-gray-700 mr-4",children:e.jsx(ir,{className:"h-6 w-6"})}),e.jsxs("div",{className:"text-md font-medium text-gray-800",children:["P&E Manager ",t&&e.jsxs("span",{className:"text-gray-500",children:[" > ",t]})]})]})})}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:a})]})]})}const ma=ga("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),E=c.forwardRef(({className:a,variant:t,size:s,asChild:r=!1,...n},i)=>{const l=r?Rl:"button";return e.jsx(l,{className:B(ma({variant:t,size:s,className:a})),ref:i,...n})});E.displayName="Button";const kr=async()=>{throw new Error("LLM integration not available in local mode")},Rt=c.forwardRef(({className:a,...t},s)=>e.jsx("textarea",{className:B("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...t}));Rt.displayName="Textarea";const ie=c.forwardRef(({className:a,type:t,...s},r)=>e.jsx("input",{type:t,className:B("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:r,...s}));ie.displayName="Input";const fe=zl,je=Yl,xe=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Sn,{ref:r,className:B("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...s,children:[t,e.jsx(Fl,{asChild:!0,children:e.jsx(Sr,{className:"h-4 w-4 opacity-50"})})]}));xe.displayName=Sn.displayName;const ki=c.forwardRef(({className:a,...t},s)=>e.jsx(En,{ref:s,className:B("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx($l,{className:"h-4 w-4"})}));ki.displayName=En.displayName;const Ti=c.forwardRef(({className:a,...t},s)=>e.jsx(Cn,{ref:s,className:B("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(Sr,{className:"h-4 w-4"})}));Ti.displayName=Cn.displayName;const ge=c.forwardRef(({className:a,children:t,position:s="popper",...r},n)=>e.jsx(Ll,{children:e.jsxs(On,{ref:n,className:B("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...r,children:[e.jsx(ki,{}),e.jsx(Vl,{className:B("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(Ti,{})]})}));ge.displayName=On.displayName;const Ac=c.forwardRef(({className:a,...t},s)=>e.jsx(Dn,{ref:s,className:B("px-2 py-1.5 text-sm font-semibold",a),...t}));Ac.displayName=Dn.displayName;const k=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(kn,{ref:r,className:B("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Bl,{children:e.jsx(zs,{className:"h-4 w-4"})})}),e.jsx(Ul,{children:t})]}));k.displayName=kn.displayName;const Mc=c.forwardRef(({className:a,...t},s)=>e.jsx(Tn,{ref:s,className:B("-mx-1 my-1 h-px bg-muted",a),...t}));Mc.displayName=Tn.displayName;const ct=Wl,dt=ql,lt=c.forwardRef(({className:a,align:t="center",sideOffset:s=4,...r},n)=>e.jsx(Gl,{children:e.jsx(In,{ref:n,align:t,sideOffset:s,className:B("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}));lt.displayName=In.displayName;function it({className:a,classNames:t,showOutsideDays:s=!0,...r}){return e.jsx(Zo,{showOutsideDays:s,className:B("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:B(ma({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:B("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",r.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:B(ma({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({className:n,...i})=>e.jsx(xa,{className:B("h-4 w-4",n),...i}),IconRight:({className:n,...i})=>e.jsx($a,{className:B("h-4 w-4",n),...i})},...r})}it.displayName="Calendar";const Ye=Xl,on=Ql,Pc=Hl,Ii=c.forwardRef(({className:a,...t},s)=>e.jsx(An,{ref:s,className:B("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t}));Ii.displayName=An.displayName;const Be=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Pc,{children:[e.jsx(Ii,{}),e.jsxs(Mn,{ref:r,className:B("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s,children:[t,e.jsxs(Kl,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Be.displayName=Mn.displayName;const Ge=({className:a,...t})=>e.jsx("div",{className:B("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});Ge.displayName="DialogHeader";const bt=({className:a,...t})=>e.jsx("div",{className:B("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});bt.displayName="DialogFooter";const We=c.forwardRef(({className:a,...t},s)=>e.jsx(Pn,{ref:s,className:B("text-lg font-semibold leading-none tracking-tight",a),...t}));We.displayName=Pn.displayName;const cr=c.forwardRef(({className:a,...t},s)=>e.jsx(Rn,{ref:s,className:B("text-sm text-muted-foreground",a),...t}));cr.displayName=Rn.displayName;const Ai=c.forwardRef(({className:a,...t},s)=>e.jsx(Tt,{ref:s,className:B("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...t}));Ai.displayName=Tt.displayName;const Mi=c.forwardRef(({className:a,...t},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(_s,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(Tt.Input,{ref:s,className:B("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...t})]}));Mi.displayName=Tt.Input.displayName;const Rc=c.forwardRef(({className:a,...t},s)=>e.jsx(Tt.List,{ref:s,className:B("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...t}));Rc.displayName=Tt.List.displayName;const Pi=c.forwardRef((a,t)=>e.jsx(Tt.Empty,{ref:t,className:"py-6 text-center text-sm",...a}));Pi.displayName=Tt.Empty.displayName;const dr=c.forwardRef(({className:a,...t},s)=>e.jsx(Tt.Group,{ref:s,className:B("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...t}));dr.displayName=Tt.Group.displayName;const Fc=c.forwardRef(({className:a,...t},s)=>e.jsx(Tt.Separator,{ref:s,className:B("-mx-1 h-px bg-border",a),...t}));Fc.displayName=Tt.Separator.displayName;const mr=c.forwardRef(({className:a,...t},s)=>e.jsx(Tt.Item,{ref:s,className:B("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a),...t}));mr.displayName=Tt.Item.displayName;const $c=ga("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function te({className:a,variant:t,...s}){return e.jsx("div",{className:B($c({variant:t}),a),...s})}const Ht=a=>Array.isArray(a)?a:a==null?[]:[a];function Lc({metadata:a={},onChange:t}){const s={location:"",participants:[],agenda:[],...a},[r,n]=c.useState([]),[i,l]=c.useState([]),[o,m]=c.useState([]),[u,x]=c.useState(!1),[h,d]=c.useState("");c.useEffect(()=>{Array.isArray(s.agenda)&&d(s.agenda.join(`
`))},[]),c.useEffect(()=>{m(Ht(a==null?void 0:a.participants))},[a]),c.useEffect(()=>{p()},[]);const p=async()=>{try{const[N,w]=await Promise.all([cs.list().catch(()=>[]),Fe.list().catch(()=>[])]);n(Ht(N)),l(Ht(w))}catch(N){console.error("Error loading participants:",N),n([]),l([])}},j=(N,w)=>{t({...s,[N]:w})},y=N=>{const w=N.target.value;d(w);const S=w.split(`
`).map(v=>v.trim()).filter(Boolean);j("agenda",S)},b=N=>{if(!o.includes(N)){const w=[...o,N];m(w),j("participants",w)}x(!1)},F=N=>{const w=o.filter(S=>S!==N);m(w),j("participants",w)};return e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("h3",{className:"font-medium text-lg mb-4",children:"Meeting Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Location"}),e.jsx(ie,{value:s.location||"",onChange:N=>j("location",N.target.value),placeholder:"Meeting location or link"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Participants"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1 p-1 border rounded-md min-h-10",children:Ht(o).map(N=>e.jsxs(te,{variant:"secondary",className:"flex items-center gap-1",children:[N,e.jsx("button",{type:"button",onClick:()=>F(N),className:"ml-1 rounded-full hover:bg-gray-200 p-0.5",children:e.jsx(Et,{className:"h-3 w-3"})})]},N))}),e.jsxs(ct,{open:u,onOpenChange:x,children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"w-full justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add participants"]}),e.jsx(Jl,{className:"h-4 w-4 opacity-50"})]})}),e.jsx(lt,{className:"p-0",align:"start",children:e.jsxs(Ai,{children:[e.jsx(Mi,{placeholder:"Search participants..."}),e.jsx(Pi,{children:"No participants found."}),Ht(i).length>0&&e.jsx(dr,{heading:"Team Members",children:Ht(i).map(N=>e.jsxs(mr,{onSelect:()=>b(N.name),children:[e.jsx(zs,{className:`mr-2 h-4 w-4 ${o.includes(N.name)?"opacity-100":"opacity-0"}`}),N.name]},N.id))}),Ht(r).length>0&&e.jsx(dr,{heading:"Stakeholder Groups",children:Ht(r).map(N=>e.jsxs(mr,{onSelect:()=>b(N.name),children:[e.jsx(zs,{className:`mr-2 h-4 w-4 ${o.includes(N.name)?"opacity-100":"opacity-0"}`}),N.name]},N.id))})]})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Agenda Items"}),e.jsx(Rt,{value:h,onChange:y,placeholder:"Enter agenda items (one per line)",className:"h-24"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter each agenda item on a new line"})]})]})]})}function Vc({metadata:a={},onChange:t}){const s=(r,n)=>{t({...a,[r]:n})};return e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("h3",{className:"font-medium text-lg mb-4",children:"Metric Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"KPI Name"}),e.jsx(ie,{value:a.kpi_name||"",onChange:r=>s("kpi_name",r.target.value),placeholder:"e.g. Monthly Active Users"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Current Value"}),e.jsx(ie,{value:a.current_value||"",onChange:r=>s("current_value",r.target.value),placeholder:"Current metric value"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Value"}),e.jsx(ie,{value:a.target_value||"",onChange:r=>s("target_value",r.target.value),placeholder:"Target metric value"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Measurement Frequency"}),e.jsxs(fe,{value:a.measurement_frequency||"",onValueChange:r=>s("measurement_frequency",r),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select frequency"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"daily",children:"Daily"}),e.jsx(k,{value:"weekly",children:"Weekly"}),e.jsx(k,{value:"biweekly",children:"Bi-weekly"}),e.jsx(k,{value:"monthly",children:"Monthly"}),e.jsx(k,{value:"quarterly",children:"Quarterly"})]})]})]})]})]})}function Bc({metadata:a={},onChange:t}){var n;const s=(i,l)=>{t({...a,[i]:l})},r=i=>{s("dependencies",i.split(",").map(l=>l.trim()).filter(Boolean))};return e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("h3",{className:"font-medium text-lg mb-4",children:"Action Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Expected Outcome"}),e.jsx(Rt,{value:a.outcome||"",onChange:i=>s("outcome",i.target.value),placeholder:"What should be accomplished by this action item",className:"h-24"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dependencies"}),e.jsx(ie,{value:((n=a.dependencies)==null?void 0:n.join(", "))||"",onChange:i=>r(i.target.value),placeholder:"Comma-separated list of dependencies"})]})]})]})}const me=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:B("rounded-xl border bg-card text-card-foreground shadow",a),...t}));me.displayName="Card";const be=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:B("flex flex-col space-y-1.5 p-6",a),...t}));be.displayName="CardHeader";const Ne=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:B("font-semibold leading-none tracking-tight",a),...t}));Ne.displayName="CardTitle";const kt=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:B("text-sm text-muted-foreground",a),...t}));kt.displayName="CardDescription";const ue=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:B("p-6 pt-0",a),...t}));ue.displayName="CardContent";const Hs=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:B("flex items-center p-6 pt-0",a),...t}));Hs.displayName="CardFooter";function Ua({value:a=[],onChange:t=()=>{},placeholder:s="Enter tags...",maxTags:r=100,className:n="",disabled:i=!1}){const l=Ht(a),[o,m]=c.useState(""),u=c.useRef(null),x=y=>{const b=y.target.value;m(b),b.endsWith(",")&&d(b.slice(0,-1))},h=y=>{if(y.key==="Enter")y.preventDefault(),d(o);else if(y.key==="Backspace"&&o===""&&l.length>0){const b=[...l];b.pop(),t(b)}},d=y=>{!y.trim()||l.length>=r||(l.includes(y.trim())||t([...l,y.trim()]),m(""))},p=c.useCallback(y=>{t(l.filter(b=>b!==y))},[l,t]),j=()=>{var y;(y=u.current)==null||y.focus()};return e.jsxs("div",{className:`flex flex-wrap gap-1.5 p-2 border rounded-md min-h-10 ${n} ${i?"bg-gray-100 opacity-60":"cursor-text"}`,onClick:j,children:[l.map(y=>e.jsxs(te,{variant:"secondary",className:"flex items-center h-6 px-2 text-sm",children:[y,!i&&e.jsx("button",{type:"button",onClick:b=>{b.stopPropagation(),p(y)},className:"ml-1 rounded-full hover:bg-gray-200 p-0.5",children:e.jsx(Et,{className:"h-3 w-3"})})]},y)),e.jsx(ie,{ref:u,value:o,onChange:x,onKeyDown:h,onBlur:()=>o.trim()&&d(o),placeholder:l.length===0?s:"",className:"flex-1 border-none p-0 min-w-[80px] shadow-none focus-visible:ring-0 placeholder:text-gray-400",disabled:i})]})}const Uc=ga("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),V=c.forwardRef(({className:a,...t},s)=>e.jsx(Fn,{ref:s,className:B(Uc(),a),...t}));V.displayName=Fn.displayName;function za({onCreateTask:a,initialTaskData:t=null}){var q,L,M;const[s,r]=c.useState(""),[n,i]=c.useState(!1),[l,o]=c.useState(!!t),m={title:"",description:"",type:"generic",status:"todo",priority:"medium",project:"",due_date:"",assignee:"",estimated_hours:"",actual_hours:"",stakeholders:[],tags:[],strategic:!1,reminders:[],subtasks:[],metadata:{meeting:{participants:[],agenda:[],location:""},metric:{kpi_name:"",current_value:"",target_value:"",measurement_frequency:""},action:{outcome:"",dependencies:[]}}};let u={...m};t&&(u={...u,...t},u.stakeholders=Array.isArray(t.stakeholders)?[...t.stakeholders]:[],u.tags=Array.isArray(t.tags)?[...t.tags]:[],u.reminders=Array.isArray(t.reminders)?[...t.reminders]:[],u.subtasks=Array.isArray(t.subtasks)?[...t.subtasks]:[],u.metadata={...m.metadata,...t.metadata||{}},(q=t.metadata)!=null&&q.meeting&&(u.metadata.meeting={...m.metadata.meeting,...t.metadata.meeting,participants:Array.isArray(t.metadata.meeting.participants)?[...t.metadata.meeting.participants]:[],agenda:Array.isArray(t.metadata.meeting.agenda)?[...t.metadata.meeting.agenda]:[]}),(M=(L=t.metadata)==null?void 0:L.action)!=null&&M.dependencies&&(u.metadata.action.dependencies=Array.isArray(t.metadata.action.dependencies)?[...t.metadata.action.dependencies]:[]));const[x,h]=c.useState(u),[d,p]=c.useState([]),[j,y]=c.useState([]),[b,F]=c.useState([]),[N,w]=c.useState([]),[S,v]=c.useState(""),[D,C]=c.useState(""),[I,R]=c.useState("");c.useEffect(()=>{const g=async()=>{try{const ne=await Pt.list();p(ne||[])}catch(ne){console.error("Error loading projects:",ne),p([])}},Y=async()=>{try{const ne=await cs.list();y(ne||[])}catch(ne){console.error("Error loading stakeholders:",ne),y([])}},W=async()=>{try{const[ne,ce]=await Promise.all([Fe.list(),js.list()]);F(ne||[]),w(ce||[])}catch{F([]),w([])}};g(),Y(),W()},[]),c.useEffect(()=>{t&&t.assignee&&typeof t.assignee=="object"?(v(t.assignee.type),C(t.assignee.id)):(v(""),C(""))},[t]);const $=async()=>{var g,Y,W,ne,ce;if(s.trim()){i(!0);try{const _e=await kr({prompt:`Extract structured task information from this natural language input: "${s}". 
        Identify task title, description, type (meeting, metric, action, or generic), 
        priority (low, medium, high, urgent), due date (in ISO format), 
        stakeholders (as array of names), tags (as array), and whether it's strategic (true/false).
        For meetings, extract participants and agenda items if mentioned.
        For metrics, extract KPI name, current value, target value if mentioned.
        For actions, extract expected outcome if mentioned.`,response_json_schema:{type:"object",properties:{title:{type:"string"},description:{type:"string"},type:{type:"string",enum:["meeting","metric","action","generic"]},priority:{type:"string",enum:["low","medium","high","urgent"]},due_date:{type:"string"},stakeholders:{type:"array",items:{type:"string"}},tags:{type:"array",items:{type:"string"}},strategic:{type:"boolean"},metadata:{type:"object",properties:{meeting:{type:"object",properties:{participants:{type:"array",items:{type:"string"}},agenda:{type:"array",items:{type:"string"}},location:{type:"string"}}},metric:{type:"object",properties:{kpi_name:{type:"string"},current_value:{type:"string"},target_value:{type:"string"}}},action:{type:"object",properties:{outcome:{type:"string"},dependencies:{type:"array",items:{type:"string"}}}}}}}}}),qe={..._e,stakeholders:Array.isArray(_e.stakeholders)?_e.stakeholders:[],tags:Array.isArray(_e.tags)?_e.tags:[],metadata:{..._e.metadata||{},meeting:{...((g=_e.metadata)==null?void 0:g.meeting)||{},participants:Array.isArray((W=(Y=_e.metadata)==null?void 0:Y.meeting)==null?void 0:W.participants)?_e.metadata.meeting.participants:[],agenda:Array.isArray((ce=(ne=_e.metadata)==null?void 0:ne.meeting)==null?void 0:ce.agenda)?_e.metadata.meeting.agenda:[]}}},Te={...m,...qe};h(Te),o(!0)}catch(_e){console.error("Error processing natural language input:",_e),h({...m,title:s}),o(!0)}finally{i(!1)}}},J=g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),$())},le=(g,Y)=>{if(g==="tags"||g==="stakeholders"||g==="reminders"){const W=Array.isArray(Y)?Y:[];h(ne=>({...ne,[g]:W}))}else h(W=>({...W,[g]:Y}))},re=g=>{g.preventDefault(),a(x),r(""),h({title:"",description:"",type:"generic",status:"todo",priority:"medium",project:"",due_date:"",assignee:"",estimated_hours:"",actual_hours:"",stakeholders:[],tags:[],strategic:!1,reminders:[],subtasks:[],metadata:{meeting:{participants:[],agenda:[],location:""},metric:{kpi_name:"",current_value:"",target_value:"",measurement_frequency:""},action:{outcome:"",dependencies:[]}}}),o(!1)},Z=()=>{const g=x.metadata||{};switch(x.type){case"meeting":return e.jsx(Lc,{metadata:g.meeting||{participants:[],agenda:[],location:""},onChange:Y=>h(W=>({...W,metadata:{...W.metadata,meeting:Y}}))});case"metric":return e.jsx(Vc,{metadata:g.metric||{},onChange:Y=>h(W=>({...W,metadata:{...W.metadata,metric:Y}}))});case"action":return e.jsx(Bc,{metadata:g.action||{},onChange:Y=>h(W=>({...W,metadata:{...W.metadata,action:Y}}))});default:return null}},z=()=>{I.trim()&&(h(g=>({...g,subtasks:[...Array.isArray(g.subtasks)?g.subtasks:[],{title:I.trim(),done:!1}]})),R(""))},ae=g=>{h(Y=>({...Y,subtasks:Y.subtasks.filter((W,ne)=>ne!==g)}))},O=()=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Subtasks"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ie,{value:I,onChange:g=>R(g.target.value),placeholder:"Add a subtask",onKeyDown:g=>{g.key==="Enter"&&(g.preventDefault(),z())}}),e.jsx(E,{type:"button",onClick:z,children:e.jsx(Ue,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2 mt-2",children:Array.isArray(x.subtasks)&&x.subtasks.map((g,Y)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"flex-1 text-sm",children:g.title}),e.jsx(E,{type:"button",variant:"ghost",size:"sm",onClick:()=>ae(Y),children:e.jsx(Et,{className:"h-4 w-4"})})]},Y))})]});return e.jsx("div",{className:"w-full",children:l?e.jsxs(me,{children:[e.jsx(be,{children:e.jsx(Ne,{children:t?"Edit Task":"Task Details"})}),e.jsx(ue,{children:e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Title"}),e.jsx(ie,{value:x.title,onChange:g=>le("title",g.target.value),placeholder:"Task title",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx(Rt,{value:x.description||"",onChange:g=>le("description",g.target.value),placeholder:"Task description",className:"h-20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Task Type"}),e.jsxs(fe,{value:x.type,onValueChange:g=>le("type",g),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select type"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"generic",children:"Generic"}),e.jsx(k,{value:"meeting",children:"Meeting"}),e.jsx(k,{value:"metric",children:"Metric"}),e.jsx(k,{value:"action",children:"Action"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Priority"}),e.jsxs(fe,{value:x.priority,onValueChange:g=>le("priority",g),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select priority"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"low",children:"Low"}),e.jsx(k,{value:"medium",children:"Medium"}),e.jsx(k,{value:"high",children:"High"}),e.jsx(k,{value:"urgent",children:"Urgent"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Project"}),e.jsxs(fe,{value:x.project||"",onValueChange:g=>le("project",g),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select project"})}),e.jsxs(ge,{children:[e.jsx(k,{value:null,children:"No Project"}),d.map(g=>e.jsx(k,{value:g.name,children:g.name},g.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Due Date & Time"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),x.due_date?Q(new Date(x.due_date),"PPP p"):e.jsx("span",{children:"Pick a date & time"})]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:x.due_date?new Date(x.due_date):void 0,onSelect:g=>{if(g){const Y=new Date(g),W=new Date;Y.setHours(W.getHours()),Y.setMinutes(W.getMinutes()),le("due_date",Y.toISOString())}}})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Assignee Type"}),e.jsxs(fe,{value:S,onValueChange:g=>{v(g),C(""),le("assignee","")},children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select type"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"stakeholder",children:"Stakeholder"}),e.jsx(k,{value:"member",children:"Team Member"}),e.jsx(k,{value:"peer",children:"Peer"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Assignee"}),e.jsxs(fe,{value:D,onValueChange:g=>{C(g),le("assignee",g?{type:S,id:g}:"")},disabled:!S,children:[e.jsx(xe,{children:e.jsx(je,{placeholder:S?"Select assignee":"Select type first"})}),e.jsxs(ge,{children:[S==="stakeholder"&&j.map(g=>e.jsx(k,{value:g.id,children:g.name},g.id)),S==="member"&&b.map(g=>e.jsx(k,{value:g.id,children:g.name},g.id)),S==="peer"&&N.map(g=>e.jsx(k,{value:g.id,children:g.name},g.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Strategic"}),e.jsxs(E,{type:"button",variant:x.strategic?"default":"outline",className:"w-full justify-start",onClick:()=>le("strategic",!x.strategic),children:[x.strategic&&e.jsx(zs,{className:"mr-2 h-4 w-4"}),x.strategic?"Strategic Task":"Tactical Task"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Estimated Hours"}),e.jsx(ie,{type:"number",step:"0.5",min:"0",value:x.estimated_hours||"",onChange:g=>le("estimated_hours",g.target.value),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Actual Hours"}),e.jsx(ie,{type:"number",step:"0.5",min:"0",value:x.actual_hours||"",onChange:g=>le("actual_hours",g.target.value),placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tags"}),e.jsx(Ua,{value:Array.isArray(x.tags)?x.tags:[],onChange:g=>le("tags",g),placeholder:"Add tags to categorize your task"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Stakeholders"}),e.jsxs(fe,{value:(x.stakeholders||[])[0]||"",onValueChange:g=>{le("stakeholders",g?[g]:[])},children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select a stakeholder"})}),e.jsxs(ge,{children:[e.jsx(k,{value:null,children:"None"}),j.map(g=>e.jsxs(k,{value:g.name,children:[g.name," ",g.role&&`(${g.role})`]},g.id))]})]})]})]}),O(),Z(),e.jsx(Hs,{className:"px-0 pt-4",children:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>{t?a(null):o(!1)},children:"Cancel"}),e.jsx(E,{type:"submit",children:t?"Update Task":"Create Task"})]})})]})})]}):e.jsxs(me,{children:[e.jsx(be,{children:e.jsx(Ne,{children:"Create New Task"})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(Rt,{placeholder:"Enter task naturally: 'Schedule quarterly review meeting with design team next Tuesday at 2pm'",value:s,onChange:g=>r(g.target.value),onKeyDown:J,className:"h-24",disabled:n})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(E,{variant:"outline",onClick:()=>o(!0),children:"Enter Details Manually"}),e.jsx(E,{onClick:$,disabled:!s.trim()||n,className:"relative",children:n?e.jsxs(e.Fragment,{children:[e.jsx($n,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Create Task"})]})]})})]})})}const ss=eo,as=to,zc=c.forwardRef(({className:a,inset:t,children:s,...r},n)=>e.jsxs(Ln,{ref:n,className:B("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",a),...r,children:[s,e.jsx($a,{className:"ml-auto"})]}));zc.displayName=Ln.displayName;const Yc=c.forwardRef(({className:a,...t},s)=>e.jsx(Vn,{ref:s,className:B("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));Yc.displayName=Vn.displayName;const Qt=c.forwardRef(({className:a,sideOffset:t=4,...s},r)=>e.jsx(Zl,{children:e.jsx(Bn,{ref:r,sideOffset:t,className:B("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})}));Qt.displayName=Bn.displayName;const et=c.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(Un,{ref:r,className:B("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",a),...s}));et.displayName=Un.displayName;const At=c.forwardRef(({className:a,children:t,checked:s,...r},n)=>e.jsxs(zn,{ref:n,className:B("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Yn,{children:e.jsx(zs,{className:"h-4 w-4"})})}),t]}));At.displayName=zn.displayName;const Gc=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Gn,{ref:r,className:B("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Yn,{children:e.jsx(oa,{className:"h-2 w-2 fill-current"})})}),t]}));Gc.displayName=Gn.displayName;const Wc=c.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(Wn,{ref:r,className:B("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",a),...s}));Wc.displayName=Wn.displayName;const ur=c.forwardRef(({className:a,...t},s)=>e.jsx(qn,{ref:s,className:B("-mx-1 my-1 h-px bg-muted",a),...t}));ur.displayName=qn.displayName;const Tr=c.forwardRef(({className:a,...t},s)=>e.jsx(Hn,{ref:s,className:B("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...t,children:e.jsx(so,{className:B("flex items-center justify-center text-current"),children:e.jsx(zs,{className:"h-4 w-4"})})}));Tr.displayName=Hn.displayName;const Ir=c.forwardRef(({className:a,...t},s)=>e.jsx(Kn,{className:B("grid gap-2",a),...t,ref:s}));Ir.displayName=Kn.displayName;const Ps=c.forwardRef(({className:a,...t},s)=>e.jsx(Xn,{ref:s,className:B("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),...t,children:e.jsx(ao,{className:"flex items-center justify-center",children:e.jsx(oa,{className:"h-3.5 w-3.5 fill-primary"})})}));Ps.displayName=Xn.displayName;const zt={async list(){return Pe.entities.AgendaItem.list()},async create(a){return Pe.entities.AgendaItem.create(a)},async update(a,t){return Pe.entities.AgendaItem.update(a,t)},async delete(a){return Pe.entities.AgendaItem.delete(a)},async getByTeamMember(a){return Pe.entities.AgendaItem.getByTeamMember(a)},async getByStatus(a){return Pe.entities.AgendaItem.getByStatus(a)},async getForNextMeeting(a){return Pe.entities.AgendaItem.getForNextMeeting(a)}},Rs={async list(){return Pe.entities.PersonalFileItem.list()},async create(a){return Pe.entities.PersonalFileItem.create(a)},async update(a,t){return Pe.entities.PersonalFileItem.update(a,t)},async delete(a){return Pe.entities.PersonalFileItem.delete(a)},async getByTeamMember(a){return Pe.entities.PersonalFileItem.getByTeamMember(a)},async getByCategory(a){return Pe.entities.PersonalFileItem.getByCategory(a)},async searchByTags(a){return Pe.entities.PersonalFileItem.searchByTags(a)}},Ar=({teamMemberId:a,onSubmit:t,initialData:s=null,sourceItem:r=null,onCancel:n})=>{const[i,l]=c.useState({title:"",description:"",priority:"2",tags:""}),[o,m]=c.useState(!1),[u,x]=c.useState({});c.useEffect(()=>{var y;s?l({title:s.title||"",description:s.description||"",priority:((y=s.priority)==null?void 0:y.toString())||"2",tags:Array.isArray(s.tags)?s.tags.join(", "):""}):r&&l({title:r.title||"",description:r.description||r.text||"",priority:"2",tags:""})},[s,r]);const h=y=>{const{name:b,value:F}=y.target;l(N=>({...N,[b]:F})),u[b]&&x(N=>({...N,[b]:null}))},d=y=>{l(b=>({...b,priority:y}))},p=()=>{const y={};return i.title.trim()||(y.title="Title is required"),x(y),Object.keys(y).length===0},j=async y=>{if(y.preventDefault(),!!p()){m(!0);try{const b=i.tags?i.tags.split(",").map(w=>w.trim()).filter(Boolean):[],F={teamMemberId:a,title:i.title.trim(),description:i.description.trim(),priority:parseInt(i.priority,10),tags:b,status:"pending"};let N;s!=null&&s.id?(N=await zt.update(s.id,F),nt.success("Agenda item updated successfully")):(N=await zt.create(F),nt.success("Agenda item added to next 1:1 meeting")),s||l({title:"",description:"",priority:"2",tags:""}),t&&t(N)}catch(b){console.error("Error saving agenda item:",b),nt.error("Failed to save agenda item")}finally{m(!1)}}};return e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"title",children:"Title"}),e.jsx(ie,{id:"title",name:"title",value:i.title,onChange:h,placeholder:"Enter agenda item title",className:u.title?"border-red-500":""}),u.title&&e.jsx("p",{className:"text-sm text-red-500",children:u.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Description"}),e.jsx(Rt,{id:"description",name:"description",value:i.description,onChange:h,placeholder:"Enter details about this agenda item",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Priority"}),e.jsxs(Ir,{value:i.priority,onValueChange:d,className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{value:"1",id:"priority-high"}),e.jsx(V,{htmlFor:"priority-high",children:"High"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{value:"2",id:"priority-medium"}),e.jsx(V,{htmlFor:"priority-medium",children:"Medium"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{value:"3",id:"priority-low"}),e.jsx(V,{htmlFor:"priority-low",children:"Low"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"tags",children:"Tags (comma separated)"}),e.jsx(ie,{id:"tags",name:"tags",value:i.tags,onChange:h,placeholder:"e.g. feedback, project-x, career"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[n&&e.jsx(E,{type:"button",variant:"outline",onClick:n,disabled:o,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:o,children:o?"Saving...":s?"Update Item":"Add to Agenda"})]})]})},Ri=({teamMemberId:a,onSubmit:t,initialData:s=null,sourceItem:r=null,onCancel:n})=>{const[i,l]=c.useState({title:"",notes:"",category:"achievement",tags:"",importance:"3"}),[o,m]=c.useState(!1),[u,x]=c.useState({});c.useEffect(()=>{var y;s?l({title:s.title||"",notes:s.notes||"",category:s.category||"achievement",tags:Array.isArray(s.tags)?s.tags.join(", "):"",importance:((y=s.importance)==null?void 0:y.toString())||"3"}):r&&l({title:r.title||"",notes:r.description||r.text||"",category:"achievement",tags:"",importance:"3"})},[s,r]);const h=y=>{const{name:b,value:F}=y.target;l(N=>({...N,[b]:F})),u[b]&&x(N=>({...N,[b]:null}))},d=(y,b)=>{l(F=>({...F,[y]:b})),u[y]&&x(F=>({...F,[y]:null}))},p=()=>{const y={};return i.title.trim()||(y.title="Title is required"),x(y),Object.keys(y).length===0},j=async y=>{if(y.preventDefault(),!!p()){m(!0);try{const b=i.tags?i.tags.split(",").map(w=>w.trim()).filter(Boolean):[],F={teamMemberId:a,title:i.title.trim(),notes:i.notes.trim(),category:i.category,tags:b,importance:parseInt(i.importance,10),sourceType:(r==null?void 0:r.type)||"manual",sourceId:(r==null?void 0:r.id)||null};let N;s!=null&&s.id?(N=await Rs.update(s.id,F),nt.success("Personal file item updated successfully")):(N=await Rs.create(F),nt.success("Item saved to personal file")),s||l({title:"",notes:"",category:"achievement",tags:"",importance:"3"}),t&&t(N)}catch(b){console.error("Error saving personal file item:",b),nt.error("Failed to save personal file item")}finally{m(!1)}}};return e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"title",children:"Title"}),e.jsx(ie,{id:"title",name:"title",value:i.title,onChange:h,placeholder:"Enter a title for this item",className:u.title?"border-red-500":""}),u.title&&e.jsx("p",{className:"text-sm text-red-500",children:u.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"notes",children:"Notes"}),e.jsx(Rt,{id:"notes",name:"notes",value:i.notes,onChange:h,placeholder:"Enter detailed notes about this item",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"category",children:"Category"}),e.jsxs(fe,{value:i.category,onValueChange:y=>d("category",y),children:[e.jsx(xe,{id:"category",children:e.jsx(je,{placeholder:"Select a category"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"achievement",children:"Achievement"}),e.jsx(k,{value:"feedback",children:"Feedback"}),e.jsx(k,{value:"concern",children:"Concern"}),e.jsx(k,{value:"goal",children:"Goal"}),e.jsx(k,{value:"improvement",children:"Improvement"}),e.jsx(k,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"importance",children:"Importance"}),e.jsxs(fe,{value:i.importance,onValueChange:y=>d("importance",y),children:[e.jsx(xe,{id:"importance",children:e.jsx(je,{placeholder:"Select importance level"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"1",children:"Low"}),e.jsx(k,{value:"2",children:"Medium-Low"}),e.jsx(k,{value:"3",children:"Medium"}),e.jsx(k,{value:"4",children:"Medium-High"}),e.jsx(k,{value:"5",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"tags",children:"Tags (comma separated)"}),e.jsx(ie,{id:"tags",name:"tags",value:i.tags,onChange:h,placeholder:"e.g. leadership, communication, project-x"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[n&&e.jsx(E,{type:"button",variant:"outline",onClick:n,disabled:o,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:o,children:o?"Saving...":s?"Update Item":"Save to Personal File"})]})]})},ts=({teamMemberId:a,teamMemberName:t,sourceItem:s,variant:r="outline",size:n="sm",showAgendaAction:i=!0,showPersonalFileAction:l=!0,onActionComplete:o})=>{const[m,u]=c.useState(!1),[x,h]=c.useState(!1),d=j=>{u(!1),nt.success(`Item added to ${t}'s 1:1 agenda`),o&&o("agenda",j)},p=j=>{h(!1),nt.success(`Item saved to ${t}'s personal file`),o&&o("personalFile",j)};return!i&&!l?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[i&&e.jsxs(E,{variant:r,size:n,onClick:()=>u(!0),title:`Add to ${t}'s 1:1 agenda`,children:[e.jsx(Ue,{className:"h-4 w-4 mr-1"}),"Add to 1:1"]}),l&&e.jsxs(E,{variant:r,size:n,onClick:()=>h(!0),title:`Save to ${t}'s personal file`,children:[e.jsx(ws,{className:"h-4 w-4 mr-1"}),"Save to File"]})]}),e.jsx(Ye,{open:m,onOpenChange:u,children:e.jsxs(Be,{children:[e.jsx(Ge,{children:e.jsxs(We,{children:["Add to ",t,"'s 1:1 Agenda"]})}),e.jsx(Ar,{teamMemberId:a,onSubmit:d,onCancel:()=>u(!1),sourceItem:s})]})}),e.jsx(Ye,{open:x,onOpenChange:h,children:e.jsxs(Be,{children:[e.jsx(Ge,{children:e.jsxs(We,{children:["Save to ",t,"'s Personal File"]})}),e.jsx(Ri,{teamMemberId:a,onSubmit:p,onCancel:()=>h(!1),sourceItem:s})]})})]})};function cn({task:a,onEdit:t,onDelete:s,onStatusChange:r}){const n={title:"",description:"",type:"generic",status:"todo",priority:"medium",tags:[],stakeholders:[],strategic:!1,...a},i=Array.isArray(n.tags)?n.tags:[],l=Array.isArray(n.stakeholders)?n.stakeholders:[],[o,m]=da.useState([]);da.useEffect(()=>{(async()=>{try{const w=await Fe.list();m(w)}catch(w){console.error("Failed to load team members:",w)}})()},[]);const u=()=>{switch(n.status){case"done":return e.jsx(Yt,{className:"h-5 w-5 text-green-500"});case"in_progress":return e.jsx(Hr,{className:"h-5 w-5 text-blue-500"});case"blocked":return e.jsx(ms,{className:"h-5 w-5 text-red-500"});case"backlog":return e.jsx(Ze,{className:"h-5 w-5 text-gray-500"});default:return e.jsx(oa,{className:"h-5 w-5 text-gray-400"})}},x=()=>{switch(n.type){case"meeting":return"bg-blue-100 text-blue-800";case"metric":return"bg-green-100 text-green-800";case"action":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},h=()=>{switch(n.priority){case"low":return"bg-blue-100 text-blue-800";case"medium":return"bg-yellow-100 text-yellow-800";case"high":return"bg-orange-100 text-orange-800";case"urgent":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},d=async(N,w)=>{const S={...a};S.subtasks=[...a.subtasks||[]],S.subtasks[N]={...S.subtasks[N],done:w},r&&r(S,a.status)},[p,j]=c.useState(!1),[y,b]=c.useState(""),F=async()=>{if(!y.trim())return;const N={...a,updates:[...a.updates||[],{text:y.trim(),date:new Date().toISOString()}]};j(!1),b(""),r&&r(N,a.status)};return e.jsxs(e.Fragment,{children:[e.jsxs(me,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(be,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5",onClick:()=>r==null?void 0:r(n,n.status==="done"?"todo":"done"),children:u()}),e.jsxs("div",{children:[e.jsx(Ne,{className:`text-base ${n.status==="done"?"line-through text-gray-500":""}`,children:n.title}),n.project&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:[e.jsx(ro,{className:"h-3 w-3"}),n.project]})]})]}),e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(La,{className:"h-4 w-4"})})}),e.jsxs(Qt,{align:"end",children:[e.jsxs(et,{onClick:()=>t==null?void 0:t(n),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(ur,{}),e.jsxs(et,{onClick:()=>r==null?void 0:r(n,"todo"),children:[e.jsx(oa,{className:"mr-2 h-4 w-4"}),"Mark as Todo"]}),e.jsxs(et,{onClick:()=>r==null?void 0:r(n,"in_progress"),children:[e.jsx(Hr,{className:"mr-2 h-4 w-4"}),"Mark as In Progress"]}),e.jsxs(et,{onClick:()=>r==null?void 0:r(n,"done"),children:[e.jsx(Yt,{className:"mr-2 h-4 w-4"}),"Mark as Done"]}),e.jsx(ur,{}),e.jsxs(et,{onClick:()=>s==null?void 0:s(n),className:"text-red-600",children:[e.jsx(Dt,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})}),e.jsxs(ue,{children:[n.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:n.description}),Array.isArray(n.subtasks)&&n.subtasks.length>0&&e.jsxs("div",{className:"mb-3 space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Subtasks"}),e.jsx("div",{className:"space-y-2",children:n.subtasks.map((N,w)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tr,{checked:N.done,onCheckedChange:S=>d(w,S),id:`subtask-${a.id}-${w}`}),e.jsx("label",{htmlFor:`subtask-${a.id}-${w}`,className:`text-sm ${N.done?"line-through text-gray-500":"text-gray-700"}`,children:N.title})]},w))})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-3",children:[e.jsx(te,{className:x(),children:n.type}),e.jsx(te,{className:h(),children:n.priority}),n.strategic&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(no,{className:"h-3 w-3"}),"Strategic"]})]}),i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:i.map((N,w)=>e.jsx(te,{variant:"secondary",className:"text-xs",children:N},w))}),n.due_date&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-2",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:["Due ",Q(new Date(n.due_date),"PPp")]})]}),l.length>0&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(Bs,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:["Stakeholders: ",l.join(", ")]})]}),l.length>0&&o.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:l.map(N=>{const w=o.find(S=>S.name===N);return w?e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:w.name}),e.jsx(ts,{teamMemberId:w.id,teamMemberName:w.name,sourceItem:{title:n.title,description:n.description,type:"task",id:n.id,priority:n.priority,status:n.status},variant:"outline",size:"sm"})]},w.id):null})}),Array.isArray(a.updates)&&a.updates.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Updates"}),a.updates.slice(0,2).map((N,w)=>e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded",children:[e.jsx("p",{children:N.text}),e.jsx("span",{className:"text-xs text-gray-500",children:Q(H(N.date),"MMM d, yyyy")})]},w))]}),e.jsxs(E,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>j(!0),children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Add Update"]})]})]}),e.jsx(Ye,{open:p,onOpenChange:j,children:e.jsxs(Be,{children:[e.jsx(Ge,{children:e.jsx(We,{children:"Add Progress Update"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Update Details"}),e.jsx(Rt,{value:y,onChange:N=>b(N.target.value),placeholder:"Share progress, blockers, or achievements...",rows:4})]})}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(E,{onClick:F,children:"Add Update"})]})]})})]})}function Fi({tasks:a=[],onEditTask:t,onDeleteTask:s,onStatusChange:r,groupBy:n=null}){const i=Ht(a);if(i.length===0)return e.jsx("div",{className:"text-center p-8 border border-dashed rounded-lg bg-gray-50",children:e.jsx("p",{className:"text-gray-500",children:"No active tasks found"})});if(n){const l={};return i.forEach(o=>{const m=qc(o,n);l[m]||(l[m]=[]),l[m].push(o)}),e.jsx("div",{className:"space-y-6",children:Object.entries(l).map(([o,m])=>e.jsxs("div",{className:"border rounded-lg p-4 bg-white",children:[e.jsx("h3",{className:"font-medium mb-4 text-lg border-b pb-2",children:o}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.jsx(lr,{children:Ht(m).map(u=>e.jsx(Ma.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:e.jsx(cn,{task:u,onEdit:t,onDelete:s,onStatusChange:r})},u.id))})})]},o))})}return e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.jsx(lr,{children:i.map(l=>e.jsx(Ma.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:e.jsx(cn,{task:l,onEdit:t,onDelete:s,onStatusChange:r})},l.id))})})}function qc(a,t){var s,r,n,i;if(!a)return"Other";switch(t){case"strategic":return a.strategic?"Strategic":"Tactical";case"type":return((s=a.type)==null?void 0:s.charAt(0).toUpperCase())+((r=a.type)==null?void 0:r.slice(1))||"Other";case"priority":return((n=a.priority)==null?void 0:n.charAt(0).toUpperCase())+((i=a.priority)==null?void 0:i.slice(1))||"Other";default:return a[t]||"Other"}}function Hc({filters:a={status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"},setFilters:t,availableTags:s=[]}){const r={status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none",...a};r.status=Array.isArray(r.status)?r.status:[],r.priority=Array.isArray(r.priority)?r.priority:[],r.type=Array.isArray(r.type)?r.type:[],r.tags=Array.isArray(r.tags)?r.tags:[];const n=()=>{t({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"})},i=r.status.length>0||r.priority.length>0||r.type.length>0||r.tags.length>0||r.strategic!==null||r.search,l=(h,d)=>{const p=r[h]||[];t(j=>p.includes(d)?{...j,[h]:p.filter(y=>y!==d)}:{...j,[h]:[...p,d]})},o=h=>{l("tags",h)},m=h=>{t(d=>({...d,search:h.target.value}))},u=h=>{t(d=>({...d,strategic:h==="all"?null:h==="strategic"}))},x=h=>{t(d=>({...d,groupBy:h}))};return e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ie,{placeholder:"Search tasks...",value:r.search,onChange:m,className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Va,{className:"h-4 w-4"}),"Filters",i&&e.jsx(te,{className:"h-5 w-5 p-0 flex items-center justify-center",children:r.status.length+r.type.length+r.priority.length+r.tags.length+(r.strategic!==null?1:0)})]})}),e.jsxs(Qt,{className:"w-56",align:"end",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Status"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(At,{checked:r.status.includes("todo"),onCheckedChange:()=>l("status","todo"),children:"Todo"}),e.jsx(At,{checked:r.status.includes("in_progress"),onCheckedChange:()=>l("status","in_progress"),children:"In Progress"}),e.jsx(At,{checked:r.status.includes("blocked"),onCheckedChange:()=>l("status","blocked"),children:"Blocked"}),e.jsx(At,{checked:r.status.includes("done"),onCheckedChange:()=>l("status","done"),children:"Done"})]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Type"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(At,{checked:r.type.includes("generic"),onCheckedChange:()=>l("type","generic"),children:"Generic"}),e.jsx(At,{checked:r.type.includes("meeting"),onCheckedChange:()=>l("type","meeting"),children:"Meeting"}),e.jsx(At,{checked:r.type.includes("metric"),onCheckedChange:()=>l("type","metric"),children:"Metric"}),e.jsx(At,{checked:r.type.includes("action"),onCheckedChange:()=>l("type","action"),children:"Action"})]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Priority"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(At,{checked:r.priority.includes("low"),onCheckedChange:()=>l("priority","low"),children:"Low"}),e.jsx(At,{checked:r.priority.includes("medium"),onCheckedChange:()=>l("priority","medium"),children:"Medium"}),e.jsx(At,{checked:r.priority.includes("high"),onCheckedChange:()=>l("priority","high"),children:"High"}),e.jsx(At,{checked:r.priority.includes("urgent"),onCheckedChange:()=>l("priority","urgent"),children:"Urgent"})]})]}),i&&e.jsx("div",{className:"border-t p-2",children:e.jsxs(E,{variant:"ghost",className:"w-full text-sm h-8 text-blue-600",onClick:n,children:[e.jsx(Et,{className:"h-3.5 w-3.5 mr-1"})," Clear filters"]})})]})]}),e.jsxs(fe,{value:r.strategic===null?"all":r.strategic?"strategic":"tactical",onValueChange:u,children:[e.jsx(xe,{className:"w-[130px]",children:e.jsx(je,{placeholder:"Focus"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"all",children:"All tasks"}),e.jsx(k,{value:"strategic",children:"Strategic"}),e.jsx(k,{value:"tactical",children:"Tactical"})]})]})]})]}),r.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx(Ys,{className:"h-4 w-4 text-gray-500"}),r.tags.map(h=>e.jsxs(te,{variant:"secondary",className:"flex gap-1 items-center cursor-pointer",onClick:()=>o(h),children:[h,e.jsx(Et,{className:"h-3 w-3"})]},h)),e.jsx(E,{variant:"ghost",size:"sm",className:"h-7 text-xs text-blue-600",onClick:()=>t(h=>({...h,tags:[]})),children:"Clear tags"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[s.length>0&&e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",children:[e.jsx(Ys,{className:"h-3.5 w-3.5 mr-1"})," Tags"]})}),e.jsx(Qt,{children:e.jsx("div",{className:"grid grid-cols-2 gap-1 p-1",children:s.slice(0,10).map(h=>e.jsxs(E,{variant:"ghost",size:"sm",className:`text-xs justify-start ${r.tags.includes(h)?"bg-slate-100":""}`,onClick:()=>o(h),children:[r.tags.includes(h)&&e.jsx(Yt,{className:"h-3 w-3 mr-1"}),h]},h))})})]}),e.jsx("div",{children:e.jsxs(fe,{value:r.groupBy,onValueChange:x,children:[e.jsx(xe,{className:"text-sm h-9",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(io,{className:"h-3.5 w-3.5 mr-2"}),"Group by"]})}),e.jsxs(ge,{children:[e.jsx(k,{value:"none",children:"No grouping"}),e.jsx(k,{value:"type",children:"Type"}),e.jsx(k,{value:"priority",children:"Priority"}),e.jsx(k,{value:"strategic",children:"Strategic/Tactical"})]})]})})]}),i&&e.jsxs(E,{variant:"ghost",size:"sm",onClick:n,className:"text-sm text-blue-600",children:[e.jsx(Et,{className:"h-3.5 w-3.5 mr-1"})," Clear all filters"]})]})]})}const Kc=ga("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),mt=c.forwardRef(({className:a,variant:t,...s},r)=>e.jsx("div",{ref:r,role:"alert",className:B(Kc({variant:t}),a),...s}));mt.displayName="Alert";const ua=c.forwardRef(({className:a,...t},s)=>e.jsx("h5",{ref:s,className:B("mb-1 font-medium leading-none tracking-tight",a),...t}));ua.displayName="AlertTitle";const ut=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:B("text-sm [&_p]:leading-relaxed",a),...t}));ut.displayName="AlertDescription";const fa=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:B("w-full caption-bottom text-sm",a),...t})}));fa.displayName="Table";const ya=c.forwardRef(({className:a,...t},s)=>e.jsx("thead",{ref:s,className:B("[&_tr]:border-b",a),...t}));ya.displayName="TableHeader";const ja=c.forwardRef(({className:a,...t},s)=>e.jsx("tbody",{ref:s,className:B("[&_tr:last-child]:border-0",a),...t}));ja.displayName="TableBody";const Xc=c.forwardRef(({className:a,...t},s)=>e.jsx("tfoot",{ref:s,className:B("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...t}));Xc.displayName="TableFooter";const hs=c.forwardRef(({className:a,...t},s)=>e.jsx("tr",{ref:s,className:B("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...t}));hs.displayName="TableRow";const tt=c.forwardRef(({className:a,...t},s)=>e.jsx("th",{ref:s,className:B("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...t}));tt.displayName="TableHead";const st=c.forwardRef(({className:a,...t},s)=>e.jsx("td",{ref:s,className:B("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...t}));st.displayName="TableCell";const Qc=c.forwardRef(({className:a,...t},s)=>e.jsx("caption",{ref:s,className:B("mt-4 text-sm text-muted-foreground",a),...t}));Qc.displayName="TableCaption";function hr(){const[a,t]=c.useState([]),[s,r]=c.useState(!0),[n,i]=c.useState(!1),[l,o]=c.useState(null),[m,u]=c.useState(null),[x,h]=c.useState({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"}),[d,p]=c.useState([]);c.useEffect(()=>{j()},[]);const j=async()=>{r(!0),u(null);try{const C=await xt.list("-created_date");t(C||[]);const I=new Set;(C||[]).forEach(R=>{Array.isArray(R.tags)&&R.tags.forEach($=>I.add($))}),p(Array.from(I))}catch(C){console.error("Failed to load tasks:",C),u("Failed to load tasks. Please try again.")}finally{r(!1)}},y=async C=>{if(!C){i(!1),o(null);return}try{l?await xt.update(l.id,C):await xt.create(C),await j(),i(!1),o(null)}catch(I){console.error("Failed to save task:",I),u("Failed to save task. Please try again.")}},b=async C=>{try{await xt.delete(C.id),await j()}catch(I){console.error("Failed to delete task:",I),u("Failed to delete task. Please try again.")}},F=C=>{o(C),i(!0)},N=async(C,I)=>{try{await xt.update(C.id,{...C,status:I}),await j()}catch(R){console.error("Failed to update task status:",R),u("Failed to update task status. Please try again.")}},S=(C=>{const I=Array.isArray(C)?C:[],R={...x,status:Array.isArray(x.status)?x.status:[],priority:Array.isArray(x.priority)?x.priority:[],type:Array.isArray(x.type)?x.type:[],tags:Array.isArray(x.tags)?x.tags:[]};return I.filter($=>{if(R.status.length>0&&!R.status.includes($.status)||R.type.length>0&&!R.type.includes($.type)||R.priority.length>0&&!R.priority.includes($.priority))return!1;if(R.tags.length>0){const J=Array.isArray($.tags)?$.tags:[];if(!R.tags.some(le=>J.includes(le)))return!1}if(R.strategic!==null&&$.strategic!==R.strategic)return!1;if(R.search){const J=R.search.toLowerCase(),le=($.title||"").toLowerCase().includes(J),re=($.description||"").toLowerCase().includes(J);if(!le&&!re)return!1}return!0})})(a),v=S.filter(C=>(C==null?void 0:C.status)!=="done"),D=S.filter(C=>(C==null?void 0:C.status)==="done");return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tasks"}),!n&&e.jsxs(E,{onClick:()=>i(!0),className:"mt-4 sm:mt-0",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"New Task"]})]}),m&&e.jsxs(mt,{variant:"destructive",className:"mb-6",children:[e.jsx(ua,{children:"Error"}),e.jsx(ut,{children:m})]}),e.jsx(lr,{mode:"wait",children:n?e.jsx(Ma.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-8",children:e.jsx(za,{onCreateTask:y,initialTaskData:l})}):e.jsxs(Ma.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(Hc,{filters:x,setFilters:h,availableTags:d}),s?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading tasks..."})]}):e.jsx(e.Fragment,{children:S.length===0?e.jsxs("div",{className:"text-center p-12 border border-dashed rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No tasks found"}),e.jsx("p",{className:"text-gray-500",children:a.length===0?"Create your first task to get started":"Try adjusting your filters to see more tasks"}),a.length>0&&e.jsx(E,{variant:"outline",className:"mt-4",onClick:()=>h({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"}),children:"Clear all filters"})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{children:e.jsx(Fi,{tasks:v,onEditTask:F,onDeleteTask:b,onStatusChange:N,groupBy:x.groupBy==="none"?null:x.groupBy})}),D.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-gray-600",children:[e.jsx(Vs,{className:"h-5 w-5"}),"Completed Tasks (",D.length,")"]}),e.jsx("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:e.jsxs(fa,{children:[e.jsx(ya,{children:e.jsxs(hs,{children:[e.jsx(tt,{children:"Task"}),e.jsx(tt,{children:"Type"}),e.jsx(tt,{children:"Completed Date"}),e.jsx(tt,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ja,{children:D.map(C=>{var I;return e.jsxs(hs,{children:[e.jsxs(st,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:C.title}),C.project&&e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["in ",C.project]})]}),((I=C.tags)==null?void 0:I.length)>0&&e.jsx("div",{className:"flex gap-1 mt-1",children:C.tags.map(R=>e.jsx(te,{variant:"secondary",className:"text-xs",children:R},R))})]}),e.jsx(st,{children:e.jsx(te,{variant:"outline",children:C.type})}),e.jsx(st,{children:Q(new Date(C.updated_date),"MMM d, yyyy")}),e.jsx(st,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>N(C,"todo"),title:"Mark as Todo",children:e.jsx(lo,{className:"h-4 w-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>b(C),className:"text-red-500",title:"Delete",children:e.jsx(Dt,{className:"h-4 w-4"})})]})})]},C.id)})})]})})]})]})})]})})]})})}const Jc=co,Zc=mo,ed=uo,$i=c.forwardRef(({className:a,sideOffset:t=4,...s},r)=>e.jsx(oo,{children:e.jsx(Qn,{ref:r,sideOffset:t,className:B("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})}));$i.displayName=Qn.displayName;var ls,As,Je,xr,gr,pr,fr,yr,Li,Vi;const De=class De{constructor(){_a(this,Je);_a(this,ls,De.DEFAULT_VIEW_MODE);_a(this,As,[]);Sa(this,ls,this.loadViewPreference())}getCurrentViewMode(){return ps(this,ls)}setViewMode(t){if(!this.isValidViewMode(t))throw new Error(`Invalid view mode: ${t}. Valid modes are: ${Object.values(De.VIEW_MODES).join(", ")}`);const s=ps(this,ls);Sa(this,ls,t),this.saveViewPreference(t),It(this,Je,Vi).call(this,t,s)}isValidViewMode(t){return Object.values(De.VIEW_MODES).includes(t)}filterEventsForCurrentView(t){return this.filterEventsForView(t,ps(this,ls))}filterEventsForView(t,s){if(!this.isValidViewMode(s))throw new Error(`Invalid view mode: ${s}`);if(!Array.isArray(t))return console.warn("ViewModeManager: events parameter is not an array, returning empty array"),[];switch(s){case De.VIEW_MODES.MEETINGS:return It(this,Je,xr).call(this,t);case De.VIEW_MODES.OUT_OF_OFFICE:return It(this,Je,gr).call(this,t);case De.VIEW_MODES.DUTIES:return It(this,Je,pr).call(this,t);case De.VIEW_MODES.BIRTHDAYS:return It(this,Je,fr).call(this,t);case De.VIEW_MODES.ALL_EVENTS:return It(this,Je,yr).call(this,t);default:return console.warn(`ViewModeManager: Unknown view mode ${s}, returning all events`),t}}getEventCounts(t){return Array.isArray(t)?{[De.VIEW_MODES.MEETINGS]:It(this,Je,xr).call(this,t).length,[De.VIEW_MODES.OUT_OF_OFFICE]:It(this,Je,gr).call(this,t).length,[De.VIEW_MODES.DUTIES]:It(this,Je,pr).call(this,t).length,[De.VIEW_MODES.BIRTHDAYS]:It(this,Je,fr).call(this,t).length,[De.VIEW_MODES.ALL_EVENTS]:It(this,Je,yr).call(this,t).length}:It(this,Je,Li).call(this)}saveViewPreference(t){try{localStorage.setItem(De.STORAGE_KEY,t)}catch(s){console.warn("ViewModeManager: Failed to save view preference to localStorage:",s)}}loadViewPreference(){try{const t=localStorage.getItem(De.STORAGE_KEY);if(t&&this.isValidViewMode(t))return t}catch(t){console.warn("ViewModeManager: Failed to load view preference from localStorage:",t)}return De.DEFAULT_VIEW_MODE}clearViewPreference(){try{localStorage.removeItem(De.STORAGE_KEY),Sa(this,ls,De.DEFAULT_VIEW_MODE)}catch(t){console.warn("ViewModeManager: Failed to clear view preference from localStorage:",t)}}addViewModeChangeListener(t){if(typeof t!="function")throw new Error("Listener must be a function");return ps(this,As).push(t),()=>{const s=ps(this,As).indexOf(t);s>-1&&ps(this,As).splice(s,1)}}getAvailableViewModes(){return[{id:De.VIEW_MODES.MEETINGS,label:"Meetings",description:"View all scheduled meetings and one-on-ones",icon:"calendar"},{id:De.VIEW_MODES.OUT_OF_OFFICE,label:"Out of Office",description:"View team member out-of-office periods",icon:"user-x"},{id:De.VIEW_MODES.DUTIES,label:"Duties",description:"View team member duty assignments",icon:"shield"},{id:De.VIEW_MODES.BIRTHDAYS,label:"Birthdays",description:"View team member birthdays",icon:"cake"},{id:De.VIEW_MODES.ALL_EVENTS,label:"All Events",description:"View all calendar events combined",icon:"calendar-days"}]}};ls=new WeakMap,As=new WeakMap,Je=new WeakSet,xr=function(t){return t.filter(s=>s.event_type==="meeting"||s.event_type==="one_on_one")},gr=function(t){return t.filter(s=>s.event_type==="out_of_office")},pr=function(t){return t.filter(s=>s.event_type==="duty")},fr=function(t){return t.filter(s=>s.event_type==="birthday")},yr=function(t){return t},Li=function(){return{[De.VIEW_MODES.MEETINGS]:0,[De.VIEW_MODES.OUT_OF_OFFICE]:0,[De.VIEW_MODES.DUTIES]:0,[De.VIEW_MODES.BIRTHDAYS]:0,[De.VIEW_MODES.ALL_EVENTS]:0}},Vi=function(t,s){ps(this,As).forEach(r=>{try{r(t,s)}catch(n){console.error("ViewModeManager: Error in view mode change listener:",n)}})},rt(De,"VIEW_MODES",{MEETINGS:"meetings",OUT_OF_OFFICE:"out_of_office",DUTIES:"duties",BIRTHDAYS:"birthdays",ALL_EVENTS:"all_events"}),rt(De,"STORAGE_KEY","calendar_view_mode_preference"),rt(De,"DEFAULT_VIEW_MODE",De.VIEW_MODES.ALL_EVENTS);let _t=De;const Ds=new _t;function td({currentViewMode:a,onViewModeChange:t,eventCounts:s={},className:r="",disabled:n=!1}){const[i,l]=c.useState(-1),o=c.useRef([]),m=d=>{switch(d){case _t.VIEW_MODES.MEETINGS:return Ee;case _t.VIEW_MODES.OUT_OF_OFFICE:return Cr;case _t.VIEW_MODES.DUTIES:return Ms;case _t.VIEW_MODES.BIRTHDAYS:return Er;case _t.VIEW_MODES.ALL_EVENTS:return Gs;default:return Ee}},u=_t.prototype.getAvailableViewModes(),x=(d,p)=>{var j,y,b,F;switch(d.key){case"ArrowLeft":d.preventDefault();const N=p>0?p-1:u.length-1;l(N),(j=o.current[N])==null||j.focus();break;case"ArrowRight":d.preventDefault();const w=p<u.length-1?p+1:0;l(w),(y=o.current[w])==null||y.focus();break;case"Enter":case" ":d.preventDefault(),n||t(u[p].id);break;case"Home":d.preventDefault(),l(0),(b=o.current[0])==null||b.focus();break;case"End":d.preventDefault();const S=u.length-1;l(S),(F=o.current[S])==null||F.focus();break}},h=d=>{n||t(d)};return c.useEffect(()=>{l(-1)},[a]),e.jsx("div",{className:B("flex items-center space-x-1 bg-gray-100 rounded-lg p-1",n&&"opacity-50 cursor-not-allowed",r),role:"tablist","aria-label":"Calendar view modes",children:u.map((d,p)=>{const j=m(d.id),y=a===d.id,b=s[d.id]||0;return e.jsxs(E,{ref:F=>o.current[p]=F,variant:y?"default":"ghost",size:"sm",className:B("relative flex items-center space-x-2 px-3 py-2 text-sm font-medium transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",y&&"bg-white shadow-sm text-blue-600",!y&&"text-gray-600 hover:text-gray-900 hover:bg-gray-50",n&&"cursor-not-allowed opacity-50"),onClick:()=>h(d.id),onKeyDown:F=>x(F,p),disabled:n,role:"tab","aria-selected":y,"aria-controls":`calendar-panel-${d.id}`,tabIndex:i===p?0:-1,title:d.description,children:[e.jsx(j,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:d.label}),b>0&&e.jsx(te,{variant:y?"secondary":"outline",className:B("ml-1 text-xs min-w-[1.25rem] h-5 flex items-center justify-center",y&&"bg-blue-100 text-blue-700 border-blue-200",!y&&"bg-gray-200 text-gray-600 border-gray-300"),"aria-label":`${b} ${d.label.toLowerCase()}`,children:b>99?"99+":b})]},d.id)})})}const Mr=({icon:a=ws,title:t="No items found",description:s="Get started by creating your first item.",actionLabel:r="Create Item",onAction:n=null,className:i="",size:l="md"})=>{const m={sm:{container:"p-8",icon:"h-8 w-8",title:"text-base",description:"text-sm",spacing:"mb-3"},md:{container:"p-12",icon:"h-12 w-12",title:"text-lg",description:"text-base",spacing:"mb-4"},lg:{container:"p-16",icon:"h-16 w-16",title:"text-xl",description:"text-lg",spacing:"mb-6"}}[l];return e.jsxs("div",{className:B("text-center border border-dashed border-gray-300 rounded-lg",m.container,i),children:[e.jsx(a,{className:B("text-gray-400 mx-auto",m.icon,m.spacing)}),e.jsx("h3",{className:B("font-medium text-gray-900",m.title,"mb-2"),children:t}),e.jsx("p",{className:B("text-gray-500",m.description,m.spacing),children:s}),n&&e.jsxs(E,{onClick:n,className:"mt-2",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),r]})]})},Bi=({viewMode:a,onCreateTask:t=null,onAddTeamMember:s=null,onManageDuties:r=null,className:n="",size:i="md",context:l="calendar"})=>{const m=(()=>{switch(a){case _t.VIEW_MODES.MEETINGS:return{icon:Ee,title:l==="sidebar"?"No meetings today":"No meetings scheduled",description:l==="sidebar"?"No meetings are scheduled for this date.":"You don't have any meetings or one-on-ones scheduled. Create a task to schedule your first meeting.",actionLabel:"Create Meeting Task",onAction:t,suggestions:["Schedule a one-on-one with a team member","Plan your next team meeting","Block time for important discussions"]};case _t.VIEW_MODES.OUT_OF_OFFICE:return{icon:Cr,title:l==="sidebar"?"No one is out today":"No out-of-office periods",description:l==="sidebar"?"No team members are out of office on this date.":"No team members have scheduled out-of-office periods. Manage team availability to track time off.",actionLabel:"Manage Team",onAction:s,suggestions:["Add team members to track their availability","Schedule upcoming vacation time","Plan around team member absences"]};case _t.VIEW_MODES.DUTIES:return{icon:Ms,title:l==="sidebar"?"No duties assigned today":"No duty assignments",description:l==="sidebar"?"No duty assignments are scheduled for this date.":"No team member duties are currently assigned. Set up duty rotations to track responsibilities.",actionLabel:"Manage Duties",onAction:r,suggestions:["Set up DevOps duty rotations","Assign on-call responsibilities","Track team member duties"]};case _t.VIEW_MODES.BIRTHDAYS:return{icon:Er,title:l==="sidebar"?"No birthdays today":"No birthdays this month",description:l==="sidebar"?"No team member birthdays are on this date.":"No team member birthdays are scheduled. Add team members with birthday information to celebrate together.",actionLabel:"Add Team Members",onAction:s,suggestions:["Add team member birthday information","Plan birthday celebrations","Never miss a team member's special day"]};case _t.VIEW_MODES.ALL_EVENTS:default:return{icon:Gs,title:l==="sidebar"?"Nothing scheduled today":"Your calendar is empty",description:l==="sidebar"?"No tasks or events are scheduled for this date.":"You don't have any events, meetings, or tasks scheduled. Start organizing your work and team activities.",actionLabel:"Create Task",onAction:t,suggestions:["Schedule your first meeting","Add team member information","Create tasks to stay organized"]}}})();return l==="sidebar"?e.jsxs("div",{className:B("text-center p-6",n),children:[e.jsx(m.icon,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:m.title}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:m.description}),m.onAction&&e.jsxs(E,{onClick:m.onAction,variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(Ue,{className:"h-3 w-3 mr-1"}),m.actionLabel]})]}):e.jsxs("div",{className:B("space-y-6",n),children:[e.jsx(Mr,{icon:m.icon,title:m.title,description:m.description,actionLabel:m.actionLabel,onAction:m.onAction,size:i}),m.suggestions&&m.suggestions.length>0&&e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"Quick suggestions:"}),e.jsx("ul",{className:"space-y-2",children:m.suggestions.map((u,x)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:u})]},x))})]})]})},sd=({viewMode:a,onCreateTask:t,onAddTeamMember:s,onManageDuties:r,className:n=""})=>e.jsx("div",{className:B("flex items-center justify-center min-h-[400px] bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",n),children:e.jsx(Bi,{viewMode:a,onCreateTask:t,onAddTeamMember:s,onManageDuties:r,context:"calendar",size:"lg"})}),ad=({viewMode:a,onCreateTask:t,className:s=""})=>e.jsx(Bi,{viewMode:a,onCreateTask:t,context:"sidebar",className:s}),rd=({className:a=""})=>e.jsx("div",{className:B("flex items-center justify-center min-h-[400px] bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",a),children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ze,{className:"h-12 w-12 text-gray-400 mx-auto mb-4 animate-pulse"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading calendar..."}),e.jsx("p",{className:"text-gray-500",children:"Please wait while we load your events and tasks."})]})}),nd=20,id=1e6,os={ADD_TOAST:"ADD_TOAST",UPDATE_TOAST:"UPDATE_TOAST",DISMISS_TOAST:"DISMISS_TOAST",REMOVE_TOAST:"REMOVE_TOAST"};let er=0;function ld(){return er=(er+1)%Number.MAX_VALUE,er.toString()}const tr=new Map,dn=a=>{if(tr.has(a))return;const t=setTimeout(()=>{tr.delete(a),ra({type:os.REMOVE_TOAST,toastId:a})},id);tr.set(a,t)},od=(a,t)=>{switch(t.type){case os.ADD_TOAST:return{...a,toasts:[t.toast,...a.toasts].slice(0,nd)};case os.UPDATE_TOAST:return{...a,toasts:a.toasts.map(s=>s.id===t.toast.id?{...s,...t.toast}:s)};case os.DISMISS_TOAST:{const{toastId:s}=t;return s?dn(s):a.toasts.forEach(r=>{dn(r.id)}),{...a,toasts:a.toasts.map(r=>r.id===s||s===void 0?{...r,open:!1}:r)}}case os.REMOVE_TOAST:return t.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(s=>s.id!==t.toastId)}}},ka=[];let Ta={toasts:[]};function ra(a){Ta=od(Ta,a),ka.forEach(t=>{t(Ta)})}function sa({...a}){const t=ld(),s=n=>ra({type:os.UPDATE_TOAST,toast:{...n,id:t}}),r=()=>ra({type:os.DISMISS_TOAST,toastId:t});return ra({type:os.ADD_TOAST,toast:{...a,id:t,open:!0,onOpenChange:n=>{n||r()}}}),{id:t,dismiss:r,update:s}}function Ui(){const[a,t]=c.useState(Ta);return c.useEffect(()=>(ka.push(t),()=>{const s=ka.indexOf(t);s>-1&&ka.splice(s,1)}),[a]),{...a,toast:sa,dismiss:s=>ra({type:os.DISMISS_TOAST,toastId:s})}}class Ya extends Error{constructor(t,s,r=null,n={}){super(t),this.name="CalendarError",this.code=s,this.originalError=r,this.context=n,this.timestamp=new Date().toISOString()}}let wt=class extends Ya{constructor(t,s=null,r=null){super(t,"VALIDATION_ERROR"),this.name="ValidationError",this.field=s,this.value=r}};class mn extends Ya{constructor(t,s=null,r=null){super(t,"NETWORK_ERROR",r),this.name="NetworkError",this.operation=s,this.isRetryable=!0}}class ha extends Ya{constructor(t,s=null,r=null,n=null){super(t,"DATA_ERROR",n),this.name="DataError",this.entityType=s,this.entityId=r,this.isRetryable=!1}}class zi extends Ya{constructor(t,s=null,r=null){super(t,"SYNC_ERROR",r),this.name="SynchronizationError",this.syncType=s,this.isRetryable=!0}}const ve=class ve{static handleError(t,s={}){const{operation:r="operation",showToast:n=!0,logError:i=!0,context:l={},severity:o=ve.SEVERITY.MEDIUM,category:m=null}=s,u=m||ve.categorizeError(t),x=ve.getErrorInfo(t,u);return i&&ve.logError(t,{operation:r,context:l,severity:o,category:u}),n&&ve.showErrorToast(x,{operation:r,severity:o,context:l}),{error:t,category:u,severity:o,userMessage:x.userMessage,technicalMessage:x.technicalMessage,suggestions:x.suggestions,isRetryable:x.isRetryable,context:{...l,operation:r,timestamp:new Date().toISOString()}}}static categorizeError(t){var r;if(t instanceof wt)return ve.CATEGORIES.VALIDATION;if(t instanceof mn)return ve.CATEGORIES.NETWORK;if(t instanceof ha)return ve.CATEGORIES.DATA;if(t instanceof zi)return ve.CATEGORIES.SYNC;const s=((r=t.message)==null?void 0:r.toLowerCase())||"";return s.includes("network")||s.includes("fetch")||s.includes("connection")?ve.CATEGORIES.NETWORK:s.includes("validation")||s.includes("invalid")||s.includes("required")?ve.CATEGORIES.VALIDATION:s.includes("permission")||s.includes("unauthorized")||s.includes("forbidden")?ve.CATEGORIES.PERMISSION:s.includes("sync")||s.includes("synchroniz")?ve.CATEGORIES.SYNC:ve.CATEGORIES.UNKNOWN}static getErrorInfo(t,s){const r={technicalMessage:t.message,isRetryable:!1,suggestions:[]};switch(s){case ve.CATEGORIES.VALIDATION:return{...r,userMessage:"Please check your input and try again",suggestions:["Verify all required fields are filled","Check date formats and ranges","Ensure data meets validation requirements"]};case ve.CATEGORIES.NETWORK:return{...r,userMessage:"Connection issue occurred. Please try again.",isRetryable:!0,suggestions:["Check your internet connection","Try refreshing the page","Wait a moment and retry the operation"]};case ve.CATEGORIES.DATA:return{...r,userMessage:"Data issue encountered. Some information may be missing.",suggestions:["Try refreshing the calendar data","Check if related records exist","Contact support if the issue persists"]};case ve.CATEGORIES.SYNC:return{...r,userMessage:"Synchronization failed. Calendar data may be outdated.",isRetryable:!0,suggestions:["Try manual sync from the calendar toolbar","Refresh the page to reload data","Check for conflicting calendar events"]};case ve.CATEGORIES.PERMISSION:return{...r,userMessage:"Permission denied. You may not have access to this feature.",suggestions:["Check your user permissions","Contact your administrator","Try logging out and back in"]};default:return{...r,userMessage:"An unexpected error occurred. Please try again.",isRetryable:!0,suggestions:["Try refreshing the page","Wait a moment and retry","Contact support if the issue continues"]}}}static showErrorToast(t,s={}){const{operation:r,severity:n,context:i}=s,l=ve.getErrorTitle(n,r),o=ve.getErrorDescription(t,i);sa({variant:"destructive",title:l,description:o,duration:n===ve.SEVERITY.CRITICAL?0:5e3})}static getErrorTitle(t,s){switch(t){case ve.SEVERITY.CRITICAL:return"Critical Error";case ve.SEVERITY.HIGH:return"Error";case ve.SEVERITY.MEDIUM:return`${s} Failed`;case ve.SEVERITY.LOW:return"Warning";default:return"Error"}}static getErrorDescription(t,s){let r=t.userMessage;return t.suggestions.length>0&&(r+=`

Suggestions:
• `+t.suggestions.slice(0,2).join(`
• `)),r}static logError(t,s={}){const{operation:r,context:n,severity:i,category:l}=s,o={timestamp:new Date().toISOString(),operation:r,category:l,severity:i,message:t.message,stack:t.stack,context:n,errorType:t.constructor.name};switch(i){case ve.SEVERITY.CRITICAL:console.error("CRITICAL ERROR:",o);break;case ve.SEVERITY.HIGH:console.error("ERROR:",o);break;case ve.SEVERITY.MEDIUM:console.warn("WARNING:",o);break;case ve.SEVERITY.LOW:console.info("INFO:",o);break;default:console.error("ERROR:",o)}}static async retryOperation(t,s={}){const{maxRetries:r=ve.RETRY_CONFIG.maxRetries,baseDelay:n=ve.RETRY_CONFIG.baseDelay,maxDelay:i=ve.RETRY_CONFIG.maxDelay,backoffMultiplier:l=ve.RETRY_CONFIG.backoffMultiplier,operationName:o="operation",onRetry:m=null,shouldRetry:u=null}=s;let x,h=n;for(let p=1;p<=r;p++)try{const j=await t();return p>1&&(console.log(`${o} succeeded on attempt ${p}/${r}`),sa({title:"Operation Recovered",description:`${o} succeeded after ${p} attempts`,variant:"default",duration:3e3})),j}catch(j){x=j;const y=ve.categorizeError(j),b=ve.getErrorInfo(j,y);if(!(u?u(j,p):b.isRetryable))throw j;if(p>=r)break;console.warn(`${o} failed on attempt ${p}/${r}: ${j.message}. Retrying in ${h}ms...`),m&&m(j,p,h),await new Promise(N=>setTimeout(N,h)),h=Math.min(h*l,i)}const d=new mn(`${o} failed after ${r} attempts: ${x.message}`,o,x);throw ve.handleError(d,{operation:o,severity:ve.SEVERITY.HIGH,context:{attempts:r,lastError:x.message}}),d}static showSuccess(t,s={}){const{title:r="Success",duration:n=3e3,description:i=null}=s;sa({title:r,description:i||t,variant:"default",duration:n})}static showLoading(t,s={}){const{showProgress:r=!1,estimatedDuration:n=null}=s;let i,l;const o=()=>{if(i=sa({title:"Loading...",description:`${t} in progress...`,duration:0,variant:"default"}),r&&n){let x=0;const h=100/(n/1e3);l=setInterval(()=>{x=Math.min(x+h,95),i&&i.update({description:`${t} in progress... ${Math.round(x)}%`})},1e3)}},m=(x,h=null)=>{if(i){const d=h!==null?`${x} ${Math.round(h)}%`:x;i.update({description:d})}},u=(x=!0,h=null)=>{l&&clearInterval(l),i&&(x&&h?(i.update({title:"Completed",description:h,variant:"default"}),setTimeout(()=>{i&&i.dismiss()},2e3)):i.dismiss())};return o(),{update:m,dismiss:u}}static async wrapOperation(t,s={}){const{operationName:r="operation",showLoading:n=!1,showSuccess:i=!1,successMessage:l=`${r} completed successfully`,retryOptions:o={},errorOptions:m={}}=s;let u;try{n&&(u=ve.showLoading(r,{showProgress:o.maxRetries>1,estimatedDuration:o.maxRetries*o.baseDelay||3e3}));const x=o.maxRetries>0?await ve.retryOperation(t,{...o,operationName:r,onRetry:(h,d,p)=>{u&&u.update(`Retrying ${r}... (attempt ${d})`)}}):await t();return i&&ve.showSuccess(l),u&&u.dismiss(!0,i?null:l),x}catch(x){throw u&&u.dismiss(!1),ve.handleError(x,{operation:r,...m}),x}}static createRecoveryAction(t,s="Retry"){return{label:s,action:t}}static validateParams(t,s){for(const[r,n]of Object.entries(s)){const i=t[r];if(n.required&&(i==null||i===""))throw new wt(`${r} is required`,r,i);if(i!=null){if(n.type&&typeof i!==n.type)throw new wt(`${r} must be of type ${n.type}`,r,i);if(n.minLength&&i.length<n.minLength)throw new wt(`${r} must be at least ${n.minLength} characters`,r,i);if(n.maxLength&&i.length>n.maxLength)throw new wt(`${r} must be no more than ${n.maxLength} characters`,r,i);if(n.pattern&&!n.pattern.test(i))throw new wt(`${r} format is invalid`,r,i);if(n.custom&&!n.custom(i))throw new wt(n.customMessage||`${r} is invalid`,r,i)}}}};rt(ve,"SEVERITY",{LOW:"low",MEDIUM:"medium",HIGH:"high",CRITICAL:"critical"}),rt(ve,"CATEGORIES",{VALIDATION:"validation",NETWORK:"network",DATA:"data",SYNC:"synchronization",PERMISSION:"permission",UNKNOWN:"unknown"}),rt(ve,"RETRY_CONFIG",{maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffMultiplier:1.5});let we=ve;class ys{static async generateBirthdayEventsForYears(t,s,r){return we.wrapOperation(async()=>{if(we.validateParams({teamMember:t,startYear:s,endYear:r},{teamMember:{required:!0,type:"object",custom:o=>o&&o.id&&o.name,customMessage:"Team member must have id and name fields"},startYear:{required:!0,type:"number",custom:o=>o>1900&&o<3e3,customMessage:"Start year must be a valid year"},endYear:{required:!0,type:"number",custom:o=>o>1900&&o<3e3,customMessage:"End year must be a valid year"}}),!t.birthday)return console.log(`Team member ${t.name} has no birthday date set`),[];if(s>r)throw new wt("Start year must be less than or equal to end year","startYear",s);const i=new Date(t.birthday);if(isNaN(i.getTime()))throw new wt(`Invalid birthday date for team member ${t.name}: ${t.birthday}`,"birthday",t.birthday);const l=[];for(let o=s;o<=r;o++)try{if((await we.retryOperation(()=>Ce.getBirthdayEvents(),{maxRetries:2,operationName:`load birthday events for ${t.name}`,shouldRetry:d=>!(d instanceof wt)})).find(d=>d.team_member_id===t.id&&new Date(d.start_date).getFullYear()===o)){console.log(`Birthday event already exists for ${t.name} in ${o}`);continue}const x=new Date(o,i.getMonth(),i.getDate()),h=await we.retryOperation(()=>Ce.create({title:`🎂 ${t.name}'s Birthday`,description:`Birthday celebration for ${t.name}`,start_date:x.toISOString(),end_date:x.toISOString(),all_day:!0,location:null,event_type:"birthday",team_member_id:t.id,linked_entity_type:"team_member",linked_entity_id:t.id,recurrence:{type:"yearly",interval:1}}),{maxRetries:2,operationName:`create birthday event for ${t.name} in ${o}`,shouldRetry:d=>!(d instanceof wt)});l.push(h),console.log(`Created birthday event for ${t.name} in ${o}: ${h.id}`)}catch(m){const u=we.handleError(m,{operation:`create birthday event for ${t.name} in ${o}`,showToast:!1,context:{teamMemberId:t.id,year:o}});console.error(`Error creating birthday event for ${t.name} in ${o}:`,u)}return l},{operationName:"Birthday Event Generation",showLoading:!1,showSuccess:!1,successMessage:null,retryOptions:{maxRetries:0},errorOptions:{severity:we.SEVERITY.MEDIUM,context:{teamMemberId:t==null?void 0:t.id,startYear:s,endYear:r}}})}static async updateBirthdayEventsForTeamMember(t,s){return we.wrapOperation(async()=>{we.validateParams({teamMemberId:t,newBirthdayDate:s},{teamMemberId:{required:!0,type:"string"},newBirthdayDate:{required:!0,type:"string"}});const n=new Date(s);if(isNaN(n.getTime()))throw new wt(`Invalid birthday date: ${s}`,"newBirthdayDate",s);const i=await we.retryOperation(()=>Fe.get(t),{operationName:`load team member ${t}`,maxRetries:2});if(!i)throw new ha(`Team member not found: ${t}`,"TeamMember",t);const o=(await we.retryOperation(()=>Ce.getBirthdayEvents(),{operationName:"load birthday events",maxRetries:2})).filter(j=>j.team_member_id===t),m=new Date().getFullYear(),u=o.filter(j=>new Date(j.start_date).getFullYear()>=m),x=[];for(const j of u)try{await we.retryOperation(()=>Ce.delete(j.id),{operationName:`delete birthday event ${j.id}`,maxRetries:2,shouldRetry:y=>!(y instanceof wt)}),x.push({eventId:j.id,success:!0}),console.log(`Deleted existing birthday event ${j.id} for ${i.name}`)}catch(y){x.push({eventId:j.id,success:!1,error:y.message}),console.error(`Error deleting birthday event ${j.id}:`,y)}const h={...i,birthday:s},d=m+2,p=await this.generateBirthdayEventsForYears(h,m,d);return console.log(`Updated birthday events for ${i.name} with new date: ${s}`),{teamMember:h,deletedEvents:x.filter(j=>j.success).length,createdEvents:p.length,errors:x.filter(j=>!j.success)}},{operationName:"Update Birthday Events",showLoading:!0,showSuccess:!0,successMessage:"Updated birthday events for team member",retryOptions:{maxRetries:1},errorOptions:{severity:we.SEVERITY.MEDIUM,context:{teamMemberId:t,newBirthdayDate:s}}})}static async deleteBirthdayEventsForTeamMember(t){return we.wrapOperation(async()=>{we.validateParams({teamMemberId:t},{teamMemberId:{required:!0,type:"string"}});const n=(await we.retryOperation(()=>Ce.getBirthdayEvents(),{operationName:"load birthday events for deletion",maxRetries:2})).filter(u=>u.team_member_id===t);if(n.length===0)return console.log(`No birthday events found for team member ${t}`),{deletedCount:0,errorCount:0,errors:[]};const i=[];for(const u of n)try{await we.retryOperation(()=>Ce.delete(u.id),{operationName:`delete birthday event ${u.id}`,maxRetries:2,shouldRetry:x=>!(x instanceof wt)}),i.push({eventId:u.id,success:!0}),console.log(`Deleted birthday event ${u.id} for team member ${t}`)}catch(x){const h=we.handleError(x,{operation:`delete birthday event ${u.id}`,showToast:!1,context:{eventId:u.id,teamMemberId:t}});i.push({eventId:u.id,success:!1,error:h.userMessage})}const l=i.filter(u=>u.success).length,o=i.filter(u=>!u.success).length,m=i.filter(u=>!u.success);return console.log(`Birthday event deletion completed for team member ${t}: ${l} successful, ${o} failed`),o>0&&console.warn("Some birthday events could not be deleted:",m),{deletedCount:l,errorCount:o,errors:m,totalEvents:n.length}},{operationName:"Delete Birthday Events",showLoading:!0,showSuccess:!0,successMessage:"Deleted birthday events for team member",retryOptions:{maxRetries:1},errorOptions:{severity:we.SEVERITY.MEDIUM,context:{teamMemberId:t}}})}static async ensureBirthdayEventsExist(t=null,s=null){return we.wrapOperation(async()=>{if(t||(t=await we.retryOperation(()=>Fe.list(),{operationName:"load team members for birthday sync",maxRetries:2})),!s){const l=new Date().getFullYear();s=[l,l+1,l+2]}const n={timestamp:new Date().toISOString(),processedMembers:0,createdEvents:0,skippedMembers:0,errors:[],summary:{}},i=t.filter(l=>l.birthday);n.processedMembers=i.length,n.skippedMembers=t.length-i.length;for(const l of i)try{for(const o of s){const m=await this.generateBirthdayEventsForYears(l,o,o);n.createdEvents+=m.length}}catch(o){const m=we.handleError(o,{operation:`ensure birthday events for ${l.name}`,showToast:!1,context:{teamMemberId:l.id,targetYears:s}});n.errors.push({teamMemberId:l.id,teamMemberName:l.name,error:m.userMessage,category:m.category})}return n.summary={totalTeamMembers:t.length,membersWithBirthdays:i.length,membersWithoutBirthdays:n.skippedMembers,targetYears:s,eventsCreated:n.createdEvents,errorsEncountered:n.errors.length,successRate:n.processedMembers>0?((n.processedMembers-n.errors.length)/n.processedMembers*100).toFixed(1)+"%":"100%"},console.log("Birthday event synchronization completed:",n.summary),n},{operationName:"Ensure Birthday Events Exist",showLoading:!1,showSuccess:!1,retryOptions:{maxRetries:1},errorOptions:{severity:we.SEVERITY.MEDIUM,context:{targetYears:s,teamMemberCount:t==null?void 0:t.length}}})}static async getBirthdayEventsForTeamMember(t){try{if(!t)throw new Error("Team member ID is required");return(await Ce.getBirthdayEvents()).filter(r=>r.team_member_id===t)}catch(s){throw console.error("Error getting birthday events for team member:",s),new Error(`Failed to get birthday events for team member: ${s.message}`)}}static async removeDuplicateBirthdayEvents(){try{const t=await Ce.getBirthdayEvents(),s={};for(const n of t){const i=new Date(n.start_date).getFullYear(),l=`${n.team_member_id}-${i}`;s[l]||(s[l]=[]),s[l].push(n)}const r={timestamp:new Date().toISOString(),duplicatesFound:0,duplicatesRemoved:0,errors:[]};for(const[n,i]of Object.entries(s))if(i.length>1){r.duplicatesFound+=i.length-1;const l=i.slice(1);for(const o of l)try{await Ce.delete(o.id),r.duplicatesRemoved++,console.log(`Removed duplicate birthday event ${o.id} for ${n}`)}catch(m){r.errors.push({eventId:o.id,key:n,error:m.message}),console.error(`Error removing duplicate birthday event ${o.id}:`,m)}}return console.log("Duplicate birthday event removal completed:",{duplicatesFound:r.duplicatesFound,duplicatesRemoved:r.duplicatesRemoved,errors:r.errors.length}),r}catch(t){throw console.error("Error removing duplicate birthday events:",t),new Error(`Failed to remove duplicate birthday events: ${t.message}`)}}}class na{static async generateBirthdayEvents(t=null,s=new Date().getFullYear()){try{t||(t=await Fe.list());const r=[];for(const n of t)if(n.birthday)try{const i=new Date(n.birthday);if(isNaN(i.getTime())){console.warn(`Invalid birthday date for team member ${n.name}: ${n.birthday}`);continue}const l=new Date(s,i.getMonth(),i.getDate());if((await Ce.getBirthdayEvents()).find(x=>x.team_member_id===n.id&&new Date(x.start_date).getFullYear()===s)){console.log(`Birthday event already exists for ${n.name} in ${s}`);continue}const u=await Ce.create({title:`🎂 ${n.name}'s Birthday`,description:`Birthday celebration for ${n.name}`,start_date:l.toISOString(),end_date:l.toISOString(),all_day:!0,location:null,event_type:"birthday",team_member_id:n.id,linked_entity_type:"team_member",linked_entity_id:n.id,recurrence:{type:"yearly",interval:1}});r.push(u),console.log(`Created birthday event for ${n.name}: ${u.id}`)}catch(i){console.error(`Error creating birthday event for ${n.name}:`,i)}return r}catch(r){throw console.error("Error generating birthday events:",r),new Error(`Failed to generate birthday events: ${r.message}`)}}static async convertDutyToCalendarEvent(t,s=!1){try{if(!t)throw new Error("Duty object is required");if(!t.id||!t.team_member_id||!t.title||!t.start_date||!t.end_date)throw new Error("Duty object missing required fields: id, team_member_id, title, start_date, end_date");const r=await Fe.get(t.team_member_id);if(!r)throw new Error(`Team member not found: ${t.team_member_id}`);if(!s){const o=await Ce.getByDutyId(t.id);if(o.length>0)return console.log(`Calendar event already exists for duty ${t.id}`),o[0]}const i={devops:"⚙️",on_call:"📞",other:"🛡️"}[t.type]||"🛡️",l=await Ce.createDutyEvent(t.id,t.team_member_id,`${i} ${t.title} - ${r.name}`,t.start_date,t.end_date,t.description||`${t.type} duty assignment for ${r.name}`);return console.log(`Created calendar event for duty ${t.title}: ${l.id}`),l}catch(r){throw console.error("Error converting duty to calendar event:",r),new Error(`Failed to convert duty to calendar event: ${r.message}`)}}static async convertOutOfOfficeToCalendarEvent(t,s=!1){try{if(!t)throw new Error("OutOfOffice object is required");if(!t.id||!t.team_member_id||!t.start_date||!t.end_date)throw new Error("OutOfOffice object missing required fields: id, team_member_id, start_date, end_date");const r=await Fe.get(t.team_member_id);if(!r)throw new Error(`Team member not found: ${t.team_member_id}`);if(!s){const m=await Ce.getByOutOfOfficeId(t.id);if(m.length>0)return console.log(`Calendar event already exists for out-of-office ${t.id}`),m[0]}const i={vacation:"🏖️",sick:"🤒",personal:"👤",conference:"🎤",training:"📚",other:"📅"}[t.type]||"📅",l=t.type?t.type.charAt(0).toUpperCase()+t.type.slice(1):"Out of Office",o=await Ce.createOutOfOfficeEvent(t.id,t.team_member_id,r.name,t.start_date,t.end_date,t.type||"other");return console.log(`Created calendar event for out-of-office ${r.name}: ${o.id}`),o}catch(r){throw console.error("Error converting out-of-office to calendar event:",r),new Error(`Failed to convert out-of-office to calendar event: ${r.message}`)}}static async generateDutyEvents(t=null){try{t||(t=await Mt.list());const s=[];for(const r of t)try{const n=await this.convertDutyToCalendarEvent(r);s.push(n)}catch(n){console.error(`Error generating calendar event for duty ${r.id}:`,n)}return s}catch(s){throw console.error("Error generating duty events:",s),new Error(`Failed to generate duty events: ${s.message}`)}}static async generateOutOfOfficeEvents(t=null){try{t||(t=await Ut.list());const s=[];for(const r of t)try{const n=await this.convertOutOfOfficeToCalendarEvent(r);s.push(n)}catch(n){console.error(`Error generating calendar event for out-of-office ${r.id}:`,n)}return s}catch(s){throw console.error("Error generating out-of-office events:",s),new Error(`Failed to generate out-of-office events: ${s.message}`)}}static async synchronizeAllEvents(t={}){const{includeBirthdays:s=!0,includeDuties:r=!0,includeOutOfOffice:n=!0,birthdayYears:i=null,year:l=null}=t;return we.wrapOperation(async()=>{const m={timestamp:new Date().toISOString(),birthdayEvents:[],dutyEvents:[],outOfOfficeEvents:[],errors:[],summary:{totalCreated:0,totalErrors:0,success:!0}};if(s)try{const u=await we.retryOperation(()=>Fe.list(),{operationName:"load team members for birthday sync",maxRetries:2});let x=i;if(!x){const d=l||new Date().getFullYear();x=[d,d+1,d+2]}const h=await ys.ensureBirthdayEventsExist(u,x);m.birthdayEvents=h.createdEvents||0,m.summary.totalCreated+=h.createdEvents||0,h.errors&&h.errors.length>0&&(m.errors.push(...h.errors.map(d=>({type:"birthday_generation",teamMemberId:d.teamMemberId,teamMemberName:d.teamMemberName,message:d.error,category:d.category}))),m.summary.totalErrors+=h.errors.length)}catch(u){const x=we.handleError(u,{operation:"birthday event generation",showToast:!1,context:{birthdayYears:i,year:l}});m.errors.push({type:"birthday_generation",message:x.userMessage,category:x.category}),m.summary.totalErrors++}if(r)try{const u=await we.retryOperation(()=>this.generateDutyEvents(),{operationName:"generate duty events",maxRetries:2,shouldRetry:x=>{var h;return!((h=x.message)!=null&&h.includes("validation"))}});m.dutyEvents=u,m.summary.totalCreated+=u.length}catch(u){const x=we.handleError(u,{operation:"duty event generation",showToast:!1,context:{year:l}});m.errors.push({type:"duty_generation",message:x.userMessage,category:x.category}),m.summary.totalErrors++}if(n)try{const u=await we.retryOperation(()=>this.generateOutOfOfficeEvents(),{operationName:"generate out-of-office events",maxRetries:2,shouldRetry:x=>{var h;return!((h=x.message)!=null&&h.includes("validation"))}});m.outOfOfficeEvents=u,m.summary.totalCreated+=u.length}catch(u){const x=we.handleError(u,{operation:"out-of-office event generation",showToast:!1,context:{year:l}});m.errors.push({type:"out_of_office_generation",message:x.userMessage,category:x.category}),m.summary.totalErrors++}return m.summary.success=m.summary.totalErrors===0,console.log("Calendar event synchronization completed:",{totalCreated:m.summary.totalCreated,totalErrors:m.summary.totalErrors,success:m.summary.success}),m},{operationName:"Synchronize Calendar Events",showLoading:!1,showSuccess:!1,retryOptions:{maxRetries:1},errorOptions:{severity:we.SEVERITY.MEDIUM,context:{includeBirthdays:s,includeDuties:r,includeOutOfOffice:n,year:l}}})}static async updateCalendarEventFromSource(t,s,r){try{let n=null;switch(t){case"duty":const i=await Ce.getByDutyId(s);i.length>0&&(await Ce.delete(i[0].id),n=await this.convertDutyToCalendarEvent(r,!0));break;case"out_of_office":const l=await Ce.getByOutOfOfficeId(s);l.length>0&&(await Ce.delete(l[0].id),n=await this.convertOutOfOfficeToCalendarEvent(r,!0));break;case"team_member":if(r.birthday){await ys.updateBirthdayEventsForTeamMember(s,r.birthday);const o=await ys.getBirthdayEventsForTeamMember(s);n=o.length>0?o[0]:null}break;default:throw new Error(`Unsupported source type: ${t}`)}return n}catch(n){throw console.error(`Error updating calendar event from ${t} source:`,n),new Error(`Failed to update calendar event from ${t}: ${n.message}`)}}static async handleTeamMemberCreation(t){try{if(!t)throw new Error("Team member object is required");if(!t.birthday)return console.log(`Team member ${t.name} has no birthday date, skipping birthday event generation`),[];const s=new Date().getFullYear(),r=await ys.generateBirthdayEventsForYears(t,s,s+2);return console.log(`Generated ${r.length} birthday events for new team member ${t.name}`),r}catch(s){throw console.error("Error handling team member creation:",s),new Error(`Failed to handle team member creation: ${s.message}`)}}static async handleTeamMemberUpdate(t,s,r=null){try{if(!t)throw new Error("Team member ID is required");if(!s)throw new Error("Updated team member data is required");if(r&&r.birthday!==s.birthday||!r&&s.birthday)if(s.birthday){await ys.updateBirthdayEventsForTeamMember(t,s.birthday);const i=await ys.getBirthdayEventsForTeamMember(t);return console.log(`Updated ${i.length} birthday events for team member ${s.name}`),i}else return await ys.deleteBirthdayEventsForTeamMember(t),console.log(`Deleted birthday events for team member ${s.name} (birthday removed)`),[];return[]}catch(n){throw console.error("Error handling team member update:",n),new Error(`Failed to handle team member update: ${n.message}`)}}static async handleTeamMemberDeletion(t){try{if(!t)throw new Error("Team member ID is required");return await this.deleteCalendarEventsForSource("team_member",t),console.log(`Cleaned up all calendar events for deleted team member ${t}`),!0}catch(s){throw console.error("Error handling team member deletion:",s),new Error(`Failed to handle team member deletion: ${s.message}`)}}static async deleteCalendarEventsForSource(t,s){try{let r=[];switch(t){case"duty":r=await Ce.getByDutyId(s);break;case"out_of_office":r=await Ce.getByOutOfOfficeId(s);break;case"team_member":await ys.deleteBirthdayEventsForTeamMember(s),r=(await Ce.list()).filter(i=>i.team_member_id===s&&i.event_type!=="birthday");break;default:throw new Error(`Unsupported source type: ${t}`)}for(const n of r)try{await Ce.delete(n.id),console.log(`Deleted calendar event ${n.id} for ${t} ${s}`)}catch(i){console.error(`Error deleting calendar event ${n.id}:`,i)}return!0}catch(r){throw console.error(`Error deleting calendar events for ${t} source:`,r),new Error(`Failed to delete calendar events for ${t}: ${r.message}`)}}}class ia{static async getAgendaCountsForTeamMember(t){try{if(!t)return{count:0,unresolvedCount:0,hasUnresolved:!1};const s=await zt.getByTeamMember(t);if(!Array.isArray(s))return{count:0,unresolvedCount:0,hasUnresolved:!1};const r=s.length,i=s.filter(l=>l.status==="pending"||l.status==="in_progress").length;return{count:r,unresolvedCount:i,hasUnresolved:i>0,items:s}}catch(s){return console.error("Error getting agenda counts for team member:",s),{count:0,unresolvedCount:0,hasUnresolved:!1}}}static async getAgendaCountsForTeamMembers(t){try{if(!Array.isArray(t)||t.length===0)return{};const s={},r=t.map(async i=>{const l=await this.getAgendaCountsForTeamMember(i);return{teamMemberId:i,count:l}});return(await Promise.all(r)).forEach(({teamMemberId:i,count:l})=>{s[i]=l}),s}catch(s){return console.error("Error getting agenda counts for team members:",s),{}}}static async getAgendaCountsForCalendarEvents(t){try{if(!Array.isArray(t))return{};const s=t.filter(l=>l.event_type==="one_on_one"&&l.team_member_id);if(s.length===0)return{};const r=[...new Set(s.map(l=>l.team_member_id))],n=await this.getAgendaCountsForTeamMembers(r),i={};return s.forEach(l=>{const o=n[l.team_member_id];o&&(i[l.id]={...o,teamMemberId:l.team_member_id})}),i}catch(s){return console.error("Error getting agenda counts for calendar events:",s),{}}}static async hasAgendaItems(t){try{return!t||t.event_type!=="one_on_one"||!t.team_member_id?!1:(await this.getAgendaCountsForTeamMember(t.team_member_id)).count>0}catch(s){return console.error("Error checking if event has agenda items:",s),!1}}static async getAgendaItemsForNextMeeting(t){try{if(!t)return[];const s=await zt.getForNextMeeting(t);return Array.isArray(s)?s:[]}catch(s){return console.error("Error getting agenda items for next meeting:",s),[]}}}function Yi({count:a=0,unresolvedCount:t=0,hasUnresolved:s=!1,size:r="xs",className:n=""}){if(a===0)return null;const i={xs:"text-xs px-1.5 py-0.5 h-5",sm:"text-xs px-2 py-0.5 h-6"},l={xs:"h-2.5 w-2.5",sm:"h-3 w-3"},o=B("inline-flex items-center gap-1 font-medium rounded-full border",i[r],s?"bg-orange-100 text-orange-800 border-orange-300":"bg-green-100 text-green-800 border-green-300",n),m=s?Ze:Yt,u=s?t:a;return e.jsxs(te,{className:o,variant:"outline",children:[e.jsx(m,{className:l[r]}),e.jsx("span",{children:u})]})}function Gi({count:a=0,hasUnresolved:t=!1,className:s=""}){if(a===0)return null;const r=B("inline-flex items-center justify-center min-w-[18px] h-[18px] text-xs font-bold rounded-full border",t?"bg-orange-500 text-white border-orange-600":"bg-green-500 text-white border-green-600",s);return e.jsx("div",{className:r,children:a>99?"99+":a})}const jr=c.forwardRef(({className:a,orientation:t="horizontal",decorative:s=!0,...r},n)=>e.jsx(Jn,{ref:n,decorative:s,orientation:t,className:B("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",a),...r}));jr.displayName=Jn.displayName;const Ga=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Zn,{ref:r,className:B("relative overflow-hidden",a),...s,children:[e.jsx(ho,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(Wi,{}),e.jsx(xo,{})]}));Ga.displayName=Zn.displayName;const Wi=c.forwardRef(({className:a,orientation:t="vertical",...s},r)=>e.jsx(ei,{ref:r,orientation:t,className:B("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...s,children:e.jsx(go,{className:"relative flex-1 rounded-full bg-border"})}));Wi.displayName=ei.displayName;function cd({event:a,teamMember:t,isOpen:s=!1,onClose:r,onNavigateToProfile:n,className:i=""}){const[l,o]=c.useState([]),[m,u]=c.useState({count:0,unresolvedCount:0,hasUnresolved:!1}),[x,h]=c.useState(!1),[d,p]=c.useState(!1),[j,y]=c.useState(null);c.useEffect(()=>{s&&a&&a.event_type==="one_on_one"&&a.team_member_id&&b()},[s,a]);const b=async()=>{try{h(!0),y(null);const[I,R]=await Promise.all([ia.getAgendaItemsForNextMeeting(a.team_member_id),ia.getAgendaCountsForTeamMember(a.team_member_id)]);o(I),u(R)}catch(I){console.error("Error loading agenda items:",I),y("Failed to load agenda items")}finally{h(!1)}},F=async I=>{try{if(!I){p(!1);return}await zt.create({...I,teamMemberId:a.team_member_id,status:"pending",targetMeetingDate:a.start_date}),await b(),p(!1)}catch(R){console.error("Error adding agenda item:",R),y("Failed to add agenda item")}},N=async(I,R)=>{try{const $=R==="completed"?"pending":"completed";await zt.update(I,{status:$}),await b()}catch($){console.error("Error updating agenda item:",$),y("Failed to update agenda item")}},w=async I=>{try{await zt.update(I,{status:"moved",targetMeetingDate:null}),await b()}catch(R){console.error("Error moving agenda item:",R),y("Failed to move agenda item")}};if(!s||!a)return null;const S=a.event_type==="one_on_one",v=a.start_date?Q(H(a.start_date),"h:mm a"):"",D=a.end_date?Q(H(a.end_date),"h:mm a"):"",C=a.start_date?Q(H(a.start_date),"EEEE, MMMM d, yyyy"):"";return e.jsxs(me,{className:B("w-full max-w-2xl mx-auto",i),children:[e.jsx(be,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-5 w-5 text-blue-600"}),e.jsx(Ne,{className:"text-lg",children:a.title}),S&&m.count>0&&e.jsx(Yi,{count:m.count,unresolvedCount:m.unresolvedCount,hasUnresolved:m.hasUnresolved,size:"sm"})]}),e.jsx(E,{variant:"ghost",size:"sm",onClick:r,children:e.jsx(Et,{className:"h-4 w-4"})})]})}),e.jsxs(ue,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{children:C}),v&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:D&&D!==v?`${v} - ${D}`:v})]})]}),t&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Us,{className:"h-4 w-4"}),e.jsx("span",{children:t.name})]}),a.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(po,{className:"h-4 w-4"}),e.jsx("span",{children:a.location})]}),a.description&&a.description!==a.title&&e.jsx("p",{className:"text-sm text-gray-700 mt-2",children:a.description})]}),S&&t&&e.jsxs(e.Fragment,{children:[e.jsx(jr,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx("h3",{className:"font-medium",children:"Meeting Agenda"}),m.count>0&&e.jsxs(te,{variant:"secondary",className:"text-xs",children:[m.count," items"]})]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>p(!0),disabled:x,children:[e.jsx(Ue,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),j&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:j}),d&&e.jsx(me,{className:"border-dashed",children:e.jsx(ue,{className:"pt-4",children:e.jsx(Ar,{teamMemberId:a.team_member_id,onSubmit:F,onCancel:()=>p(!1),initialData:{targetMeetingDate:a.start_date}})})}),x?e.jsx("div",{className:"text-center py-4 text-sm text-gray-500",children:"Loading agenda items..."}):l.length>0?e.jsx(Ga,{className:"max-h-64",children:e.jsx("div",{className:"space-y-2",children:l.map(I=>e.jsxs("div",{className:B("flex items-start gap-3 p-3 rounded-lg border transition-colors",I.status==="completed"?"bg-green-50 border-green-200":"bg-white border-gray-200 hover:bg-gray-50"),children:[e.jsx(E,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 mt-0.5",onClick:()=>N(I.id,I.status),children:I.status==="completed"?e.jsx(Yt,{className:"h-4 w-4 text-green-600"}):e.jsx(oa,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:B("font-medium text-sm",I.status==="completed"&&"line-through text-gray-500"),children:I.title}),I.description&&e.jsx("p",{className:B("text-xs text-gray-600 mt-1",I.status==="completed"&&"line-through"),children:I.description}),I.priority&&I.priority!=="medium"&&e.jsxs(te,{variant:I.priority==="high"?"destructive":"secondary",className:"text-xs mt-1",children:[I.priority," priority"]})]}),I.status!=="completed"&&e.jsx(E,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>w(I.id),title:"Move to next meeting",children:e.jsx(ti,{className:"h-3 w-3"})})]},I.id))})}):e.jsxs("div",{className:"text-center py-6 text-sm text-gray-500",children:[e.jsx(es,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No agenda items yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Add items to prepare for this meeting"})]})]})]}),e.jsx(jr,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-2",children:t&&n&&e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>n(t.id),children:[e.jsx(Us,{className:"h-4 w-4 mr-1"}),"View Profile"]})}),e.jsx(E,{variant:"outline",size:"sm",onClick:r,children:"Close"})]})]})]})}const ke=class ke{static getEventStyling(t,s=ke.VARIANTS.DEFAULT){if(!t)throw new Error("Event object is required");const r=t.event_type||"default",n=ke.EVENT_COLORS[r]||ke.EVENT_COLORS.default,i=ke.EVENT_ICONS[r]||ke.EVENT_ICONS.default,l=ke.EVENT_LABELS[r]||ke.EVENT_LABELS.default;return{colors:{primary:n.primary,background:n.background,light:n.light,border:n.border,text:n.text,hover:n.hover},icon:i,label:l,className:ke.generateEventClassName(r,s),style:{color:n.text,backgroundColor:n.light,borderColor:n.border},badgeStyle:{borderColor:n.primary+"50",color:n.primary},hoverStyle:{backgroundColor:n.hover}}}static generateEventClassName(t,s=ke.VARIANTS.DEFAULT){const r="transition-all duration-200 cursor-pointer",n="border-l-2";let i="";switch(s){case ke.VARIANTS.COMPACT:i="text-xs p-1 rounded truncate";break;case ke.VARIANTS.SIDEBAR:i="text-sm p-2 rounded-md truncate";break;case ke.VARIANTS.DEFAULT:default:i="text-xs p-1 rounded truncate";break}let l="";switch(t){case"one_on_one":l="bg-orange-100 text-orange-800 border-orange-400 hover:bg-orange-200 hover:shadow-sm";break;case"meeting":l="bg-blue-100 text-blue-800 border-blue-400 hover:bg-blue-200 hover:shadow-sm";break;case"birthday":l="bg-pink-100 text-pink-800 border-pink-400 hover:bg-pink-200 hover:shadow-sm";break;case"duty":l="bg-purple-100 text-purple-800 border-purple-400 hover:bg-purple-200 hover:shadow-sm";break;case"out_of_office":l="bg-orange-100 text-orange-800 border-orange-400 hover:bg-orange-200 hover:shadow-sm";break;default:l="bg-indigo-100 text-indigo-800 border-indigo-400 hover:bg-indigo-200 hover:shadow-sm";break}return`${r} ${i} ${n} ${l}`.trim()}static getEventTypeColors(){return{...ke.EVENT_COLORS}}static getEventTypeIcons(){return{...ke.EVENT_ICONS}}static getEventTypeLabels(){return{...ke.EVENT_LABELS}}static getEventCardStyling(t){if(!t)throw new Error("Event object is required");const s=t.event_type||"default",r=ke.EVENT_COLORS[s]||ke.EVENT_COLORS.default,n="p-3 border rounded-md cursor-pointer transition-colors";let i="";switch(s){case"birthday":i="border-pink-200 bg-pink-50 hover:bg-pink-100";break;case"one_on_one":i="border-orange-200 bg-orange-50 hover:bg-orange-100";break;case"meeting":i="border-blue-200 bg-blue-50 hover:bg-blue-100";break;case"out_of_office":i="border-orange-200 bg-orange-50 hover:bg-orange-100";break;case"duty":i="border-purple-200 bg-purple-50 hover:bg-purple-100";break;default:i="border-indigo-200 bg-indigo-50 hover:bg-indigo-100";break}return{className:`${n} ${i}`,colors:r,icon:ke.EVENT_ICONS[s]||ke.EVENT_ICONS.default}}static getMultiDayEventStyling(t,s,r=ke.VARIANTS.DEFAULT){const n=ke.getEventStyling(t,r);let i="",l="";switch(s){case"start":i="rounded-r-none border-r-0",l="▶ ";break;case"middle":i="rounded-none border-r-0 border-l-0",l="─ ";break;case"end":i="rounded-l-none border-l-0",l="◀ ";break}return{...n,className:`${n.className} ${i}`.trim(),titlePrefix:l,isMultiDay:s!=="single",position:s}}static isValidEventType(t){return!t||typeof t!="string"||t.trim()===""?!1:Object.keys(ke.EVENT_COLORS).includes(t)||t==="default"}static isValidVariant(t){return Object.values(ke.VARIANTS).includes(t)}static getAccessibilityInfo(t){const s=ke.EVENT_COLORS[t]||ke.EVENT_COLORS.default;return{hasGoodContrast:!0,backgroundColor:s.light,textColor:s.text,borderColor:s.border,ariaLabel:`${ke.EVENT_LABELS[t]||"Event"} calendar event`}}};rt(ke,"EVENT_COLORS",{one_on_one:{primary:"#f97316",background:"#fed7aa",light:"#fef3c7",border:"#fb923c",text:"#ea580c",hover:"#fdba74"},meeting:{primary:"#3b82f6",background:"#bfdbfe",light:"#dbeafe",border:"#60a5fa",text:"#2563eb",hover:"#93c5fd"},birthday:{primary:"#ec4899",background:"#f9a8d4",light:"#fce7f3",border:"#f472b6",text:"#db2777",hover:"#f8bbd9"},duty:{primary:"#8b5cf6",background:"#c4b5fd",light:"#ede9fe",border:"#a78bfa",text:"#7c3aed",hover:"#ddd6fe"},out_of_office:{primary:"#f97316",background:"#fed7aa",light:"#fef3c7",border:"#fb923c",text:"#ea580c",hover:"#fdba74"},default:{primary:"#6366f1",background:"#c7d2fe",light:"#e0e7ff",border:"#818cf8",text:"#4f46e5",hover:"#a5b4fc"}}),rt(ke,"EVENT_ICONS",{one_on_one:Us,meeting:Ee,birthday:Er,duty:Ms,out_of_office:Cr,default:Gs}),rt(ke,"EVENT_LABELS",{one_on_one:"1:1",meeting:"Meeting",birthday:"Birthday",duty:"Duty",out_of_office:"OOO",default:"Event"}),rt(ke,"VARIANTS",{DEFAULT:"default",COMPACT:"compact",SIDEBAR:"sidebar"});let Kt=ke;function dd({currentWeek:a=new Date,meetings:t=[],onMeetingClick:s,onDateNavigate:r,agendaCounts:n={},className:i="",isLoading:l=!1,error:o=null,onRetry:m=null,showRetryButton:u=!0,errorContext:x={}}){const[h,d]=c.useState(null),[p,j]=c.useState(0),y=c.useMemo(()=>Da(a,{weekStartsOn:1}),[a]),b=c.useMemo(()=>or(a,{weekStartsOn:1}),[a]),F=c.useMemo(()=>ec({start:y,end:b}),[y,b]),N=c.useMemo(()=>{try{d(null);const R={};return F.forEach($=>{const J=Q($,"yyyy-MM-dd");R[J]={date:$,meetings:[]}}),t.forEach($=>{try{if(!$.start_date)return;const J=H($.start_date),le=$.end_date?H($.end_date):J;F.forEach(re=>{const Z=Q(re,"yyyy-MM-dd");(Vt(J,re)||Vt(le,re)||J<re&&le>re)&&J<=b&&le>=y&&R[Z].meetings.push($)})}catch(J){console.warn(`Error processing meeting ${$.id}:`,J)}}),R}catch(R){const $=we.handleError(R,{operation:"process weekly meetings",showToast:!1,context:{weekStart:y,weekEnd:b,meetingsCount:t.length}});d($);const J={};return F.forEach(le=>{const re=Q(le,"yyyy-MM-dd");J[re]={date:le,meetings:[]}}),J}},[t,F,y,b]),w=c.useMemo(()=>Object.values(N).reduce((R,$)=>R+$.meetings.length,0),[N]),S=c.useCallback(R=>{try{if(R.all_day)return"All day";if(!R.start_date)return"";const $=Q(H(R.start_date),"h:mm a");if(R.end_date){const J=Q(H(R.end_date),"h:mm a");if($!==J)return`${$} - ${J}`}return $}catch($){return console.warn(`Error formatting meeting time for ${R.id}:`,$),"Time unavailable"}},[]),v=c.useCallback((R,$)=>{try{const J=we.wrapOperation(async()=>{s&&await s(R,$)},{operationName:"Navigate to Meeting",showLoading:!1,showSuccess:!1,retryOptions:{maxRetries:1,baseDelay:500},errorOptions:{severity:we.SEVERITY.LOW,context:{meetingId:R.id,meetingTitle:R.title,date:$.toISOString()}}});return J&&typeof J.catch=="function"?J.catch(le=>{console.warn("Meeting click failed:",le)}):J}catch(J){console.warn("Meeting click failed:",J)}},[s]),D=c.useCallback(R=>{try{const $=we.wrapOperation(async()=>{r&&await r(R)},{operationName:"Navigate to Date",showLoading:!1,showSuccess:!1,retryOptions:{maxRetries:1,baseDelay:500},errorOptions:{severity:we.SEVERITY.LOW,context:{date:R.toISOString()}}});return $&&typeof $.catch=="function"?$.catch(J=>{console.warn("Date navigation failed:",J)}):$}catch($){console.warn("Date navigation failed:",$)}},[r]),C=c.useCallback(()=>{if(m){const R=p+1;j(R),d(null);const $=Math.min(1e3*Math.pow(2,R-1),5e3);setTimeout(()=>{m()},$)}},[m,p]);da.useEffect(()=>{!o&&!h&&j(0)},[o,h]);const I=(R,$,...J)=>{(R.key==="Enter"||R.key===" ")&&(R.preventDefault(),$(...J))};return e.jsxs(me,{className:B("w-80 h-fit",i),children:[e.jsxs(be,{className:"pb-3",children:[e.jsxs(Ne,{className:"text-lg flex items-center gap-2",children:[e.jsx(Gs,{className:"h-5 w-5"}),"This Week",w>0&&e.jsxs(te,{variant:"secondary",className:"ml-auto",children:[w," meeting",w!==1?"s":""]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Q(y,"MMM d")," - ",Q(b,"MMM d, yyyy")]})]}),e.jsxs(ue,{className:"space-y-3",children:[(o||h)&&e.jsxs(mt,{variant:"destructive",className:"mb-3",role:"alert","aria-live":"polite",children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx(ut,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:o||(h==null?void 0:h.userMessage)||"Error processing meetings"}),u&&m&&e.jsx(E,{variant:"outline",size:"sm",onClick:C,disabled:l,className:"ml-2","aria-label":`Retry loading meetings${p>0?` (attempt ${p+1})`:""}`,children:l?e.jsx(Ws,{className:"h-3 w-3 animate-spin"}):"Retry"})]}),(h==null?void 0:h.suggestions)&&h.suggestions.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("p",{className:"font-medium",children:"Suggestions:"}),e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:h.suggestions.slice(0,2).map((R,$)=>e.jsx("li",{children:R},$))})]}),p>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Retry attempt: ",p]})]})})]}),l&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",role:"status","aria-label":"Loading meetings",children:[e.jsx(Ws,{className:"h-8 w-8 mx-auto mb-3 animate-spin"}),e.jsx("p",{className:"text-sm",children:"Loading meetings..."}),p>0&&e.jsxs("p",{className:"text-xs mt-1",children:["Retrying... (attempt ",p+1,")"]})]}),!l&&w===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",role:"status","aria-label":"No meetings this week",children:[e.jsx(Gs,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"No meetings this week"}),e.jsx("p",{className:"text-xs mt-1",children:"Your calendar is clear for the week"})]}):F.map(R=>{const $=Q(R,"yyyy-MM-dd"),J=N[$];return J.meetings.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{variant:"ghost",className:B("w-full justify-start p-2 h-auto font-medium text-left",Zr(R)&&"bg-blue-50 text-blue-900"),onClick:()=>D(R),onKeyDown:re=>I(re,D,R),"aria-label":`Navigate to ${Q(R,"EEEE, MMMM d")}`,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[Q(R,"EEEE"),Zr(R)&&e.jsx(te,{variant:"secondary",className:"ml-2 text-xs",children:"Today"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:Q(R,"MMM d")})]}),e.jsx(te,{variant:"outline",className:"text-xs",children:J.meetings.length})]})}),e.jsx("div",{className:"space-y-1 ml-2",children:J.meetings.map((re,Z)=>{const z=Kt.getEventStyling(re,Kt.VARIANTS.SIDEBAR),ae=z.icon,O=S(re),q=n[re.id];return e.jsx(E,{variant:"ghost",className:B("w-full justify-start p-2 h-auto text-left border hover:opacity-80 transition-opacity"),style:{backgroundColor:z.colors.light,color:z.colors.text,borderColor:z.colors.border},onClick:()=>v(re,R),onKeyDown:L=>I(L,v,re,R),"aria-label":`${re.title} at ${O||"no specific time"}`,children:e.jsxs("div",{className:"flex items-start gap-2 w-full min-w-0",children:[e.jsx(ae,{className:"h-4 w-4 mt-0.5 flex-shrink-0",style:{color:z.colors.primary},"aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:re.title}),re.event_type==="one_on_one"&&q&&q.count>0&&e.jsx(Gi,{count:q.unresolvedCount||q.count,hasUnresolved:q.hasUnresolved,className:"flex-shrink-0"})]}),O&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Ze,{className:"h-3 w-3 opacity-60","aria-hidden":"true"}),e.jsx("p",{className:"text-xs opacity-80",children:O})]}),re.description&&e.jsx("p",{className:"text-xs opacity-70 mt-1 line-clamp-2",children:re.description})]})]})},`${re.id}-${Z}`)})})]},$):null})]})]})}const sr=768;function md(){const[a,t]=c.useState(void 0);return c.useEffect(()=>{const s=window.matchMedia(`(max-width: ${sr-1}px)`),r=()=>{t(window.innerWidth<sr)};return s.addEventListener("change",r),t(window.innerWidth<sr),()=>s.removeEventListener("change",r)},[]),!!a}class vs extends Error{constructor(t,s,r=null){super(t),this.name="CalendarServiceError",this.code=s,this.originalError=r}}class Ae extends vs{constructor(t,s=null){super(t,"VALIDATION_ERROR"),this.field=s}}let is=class extends vs{constructor(t,s=null,r=null){super(t,"NOT_FOUND"),this.entityType=s,this.entityId=r}};class aa extends vs{constructor(t,s=null){super(t,"DUPLICATE_ERROR"),this.duplicateData=s}}let $s=class extends vs{constructor(t,s=null,r=null){super(t,"OPERATION_ERROR",r),this.operation=s}};class Me{static async _retryOperation(t,s=3,r="operation",n=1e3){let i;for(let l=1;l<=s;l++)try{const o=await t();return l>1&&console.log(`${r} succeeded on attempt ${l}`),o}catch(o){if(i=o,o instanceof Ae||o instanceof is)throw o;l<s?(console.warn(`${r} failed on attempt ${l}/${s}: ${o.message}. Retrying in ${n}ms...`),await new Promise(m=>setTimeout(m,n)),n*=1.5):console.error(`${r} failed after ${s} attempts: ${o.message}`)}throw new $s(`Operation failed after ${s} attempts: ${i.message}`,r,i)}static _generateUserFeedback(t,s,r=null,n={}){const i={operation:t,success:s,timestamp:new Date().toISOString(),context:n};if(s)switch(t){case"createOneOnOneMeeting":i.message=`Successfully scheduled 1:1 meeting${n.teamMemberName?` with ${n.teamMemberName}`:""}`,i.type="success";break;case"updateOneOnOneMeeting":i.message="Meeting successfully rescheduled",i.type="success";break;case"deleteOneOnOneMeeting":i.message="Meeting successfully cancelled",i.type="success";break;default:i.message="Calendar operation completed successfully",i.type="success"}else i.error={message:r.message,code:r.code||"UNKNOWN_ERROR",type:r.constructor.name},r instanceof Ae?(i.message=`Invalid input: ${r.message}`,i.type="validation_error",i.field=r.field):r instanceof is?(i.message=`Not found: ${r.message}`,i.type="not_found_error"):r instanceof aa?(i.message=`Duplicate meeting: ${r.message}`,i.type="duplicate_error"):(i.message=`Failed to ${t.replace(/([A-Z])/g," $1").toLowerCase()}: ${r.message}`,i.type="error");return i}static generateOneOnOneTitle(t){if(!t||typeof t!="string"||t.trim().length===0)throw new Ae("Team member name is required and must be a non-empty string","teamMemberName");return`${t.trim()} 1:1`}static _validateDateTime(t,s="dateTime",r=!1,n=5){if(!t)throw new Ae(`${s} is required`,s);if(typeof t!="string")throw new Ae(`${s} must be a string`,s);const i=new Date(t);if(isNaN(i.getTime()))throw new Ae(`Invalid ${s} format. Expected ISO string, received: "${t}"`,s);const l=new Date,o=new Date(l);if(o.setFullYear(o.getFullYear()+2),i>o)throw new Ae(`${s} cannot be more than 2 years in the future. Provided date: ${i.toISOString()}, maximum allowed: ${o.toISOString()}`,s);if(!r){const m=Math.max(n,1)*60*1e3,u=new Date(l.getTime()-m);if(i<u){const x=l.getTime()-i.getTime(),h=Math.round(x/(60*1e3));throw new Ae(`${s} cannot be in the past. Provided date: ${i.toISOString()}, current time: ${l.toISOString()} (${h} minutes ago)`,s)}}return i}static async _validateTeamMember(t,s="teamMemberId"){if(!t)throw new Ae(`${s} is required`,s);if(typeof t!="string")throw new Ae(`${s} must be a string`,s);const r=await Fe.get(t);if(!r)throw new is("Team member not found","TeamMember",t);return r}static async _validateCalendarEvent(t,s=!0,r="eventId"){if(!t)throw new Ae(`${r} is required`,r);if(typeof t!="string")throw new Ae(`${r} must be a string`,r);const n=await Ce.get(t);if(!n)throw new is("Calendar event not found","CalendarEvent",t);if(s&&n.event_type!=="one_on_one")throw new Ae("Event is not a 1:1 meeting","eventType");return n}static async _checkForDuplicateEvents(t,s,r=null){if(!t||!s)return null;try{const n=await this.getOneOnOneMeetingsForTeamMember(t),i=s.toDateString();return n.find(o=>r&&o.id===r?!1:new Date(o.start_date).toDateString()===i)||null}catch(n){return console.warn("Error checking for duplicate events:",n),null}}static async _validateOneOnOne(t,s="oneOnOneId"){if(!t)throw new Ae(`${s} is required`,s);if(typeof t!="string")throw new Ae(`${s} must be a string`,s);const n=(await Re.list()).find(i=>i.id===t);if(!n)throw new is("OneOnOne record not found","OneOnOne",t);return n}static _validateDuration(t,s="durationMinutes"){if(t==null)return 30;if(typeof t!="number")throw new Ae(`${s} must be a number`,s);if(t<=0)throw new Ae(`${s} must be greater than 0`,s);if(t>480)throw new Ae(`${s} cannot exceed 8 hours (480 minutes)`,s);return t}static async validateDataConsistency(t={}){const{fixInconsistencies:s=!1,includeOrphanedEvents:r=!0,includeMissingLinks:n=!0,includeInvalidData:i=!0}=t;try{console.log("Starting comprehensive data consistency validation...");const l={timestamp:new Date().toISOString(),totalEventsChecked:0,totalOneOnOnesChecked:0,inconsistencies:{orphanedEvents:[],missingLinks:[],invalidData:[],duplicateEvents:[],brokenReferences:[]},fixes:{applied:[],failed:[]},summary:{isConsistent:!0,totalIssues:0,fixesApplied:0,fixesFailed:0}},[o,m,u]=await Promise.all([this.getOneOnOneMeetings(),Re.list(),Fe.list()]);if(l.totalEventsChecked=o.length,l.totalOneOnOnesChecked=m.length,r){const d=new Set(m.filter(p=>p.next_meeting_calendar_event_id).map(p=>p.next_meeting_calendar_event_id));for(const p of o)!d.has(p.id)&&(!p.linked_entity_id||!m.find(y=>y.id===p.linked_entity_id))&&l.inconsistencies.orphanedEvents.push({eventId:p.id,title:p.title,teamMemberId:p.team_member_id,startDate:p.start_date,issue:"Calendar event not linked to any OneOnOne record"})}if(n)for(const d of m)d.next_meeting_date&&!d.next_meeting_calendar_event_id&&l.inconsistencies.missingLinks.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,nextMeetingDate:d.next_meeting_date,issue:"OneOnOne has next_meeting_date but no calendar event"}),d.next_meeting_calendar_event_id&&(o.find(j=>j.id===d.next_meeting_calendar_event_id)||l.inconsistencies.brokenReferences.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,referencedEventId:d.next_meeting_calendar_event_id,issue:"OneOnOne references non-existent calendar event"}));if(i)for(const d of o){const p=[],j=u.find(F=>F.id===d.team_member_id);if(!j)p.push("Team member not found");else{const F=this.generateOneOnOneTitle(j.name);d.title!==F&&p.push(`Title mismatch: expected "${F}", got "${d.title}"`)}d.event_type!=="one_on_one"&&p.push(`Incorrect event type: expected "one_on_one", got "${d.event_type}"`),d.linked_entity_type!=="one_on_one"&&p.push(`Incorrect linked entity type: expected "one_on_one", got "${d.linked_entity_type}"`);const y=new Date(d.start_date),b=new Date(d.end_date);isNaN(y.getTime())||isNaN(b.getTime())?p.push("Invalid date format"):b<=y&&p.push("End date must be after start date"),p.length>0&&l.inconsistencies.invalidData.push({eventId:d.id,title:d.title,teamMemberId:d.team_member_id,issues:p})}const x={};for(const d of o){const p=new Date(d.start_date).toDateString(),j=`${d.team_member_id}-${p}`;x[j]||(x[j]=[]),x[j].push(d)}for(const[d,p]of Object.entries(x))p.length>1&&l.inconsistencies.duplicateEvents.push({key:d,teamMemberId:p[0].team_member_id,date:new Date(p[0].start_date).toDateString(),events:p.map(j=>({id:j.id,title:j.title})),count:p.length});const h=[...l.inconsistencies.orphanedEvents,...l.inconsistencies.missingLinks,...l.inconsistencies.invalidData,...l.inconsistencies.duplicateEvents,...l.inconsistencies.brokenReferences];if(l.summary.totalIssues=h.length,l.summary.isConsistent=h.length===0,s&&h.length>0){console.log(`Attempting to fix ${h.length} inconsistencies...`);for(const d of l.inconsistencies.orphanedEvents)try{await this.deleteOneOnOneMeeting(d.eventId),l.fixes.applied.push({type:"orphaned_event_deleted",eventId:d.eventId,title:d.title})}catch(p){l.fixes.failed.push({type:"orphaned_event_deletion_failed",eventId:d.eventId,error:p.message})}for(const d of l.inconsistencies.brokenReferences)try{await Re.update(d.oneOnOneId,{next_meeting_calendar_event_id:null}),l.fixes.applied.push({type:"broken_reference_cleared",oneOnOneId:d.oneOnOneId,referencedEventId:d.referencedEventId})}catch(p){l.fixes.failed.push({type:"broken_reference_fix_failed",oneOnOneId:d.oneOnOneId,error:p.message})}l.summary.fixesApplied=l.fixes.applied.length,l.summary.fixesFailed=l.fixes.failed.length}return console.log("Data consistency validation completed:",{totalIssues:l.summary.totalIssues,isConsistent:l.summary.isConsistent,fixesApplied:l.summary.fixesApplied}),l}catch(l){throw console.error("Error during data consistency validation:",l),new $s(`Data consistency validation failed: ${l.message}`,"validateDataConsistency",l)}}static async createOneOnOneMeeting(t,s,r,n=30){const i="createOneOnOneMeeting";try{if(!t)throw new Ae("Team member ID is required","teamMemberId");if(!s||typeof s!="string"||s.trim().length===0)throw new Ae("Team member name is required and must be a non-empty string","teamMemberName");if(!r)throw new Ae("Date/time is required","dateTime");if(n&&(typeof n!="number"||n<=0))throw new Ae("Duration must be a positive number","durationMinutes");if(!await Fe.get(t))throw new is("Team member not found","TeamMember",t);const o=this._validateDateTime(r,"dateTime",!1,5),u=(await this.getOneOnOneMeetingsForTeamMember(t)).find(p=>new Date(p.start_date).toDateString()===o.toDateString());if(u)throw new aa(`A 1:1 meeting already exists for ${s} on ${o.toDateString()}`,{existingEventId:u.id,date:o.toDateString()});const x=new Date(o.getTime()+n*60*1e3),h=this.generateOneOnOneTitle(s),d=await this._retryOperation(async()=>await Ce.create({title:h,description:`1:1 meeting with ${s}`,start_date:o.toISOString(),end_date:x.toISOString(),all_day:!1,location:null,event_type:"one_on_one",team_member_id:t,linked_entity_type:"one_on_one",linked_entity_id:null}),3,`create calendar event for ${s}`);return console.log(`Successfully created calendar event: ${h} (${d.id})`),d}catch(l){if(l instanceof vs)throw l;const o=new $s(`Failed to create 1:1 meeting calendar event: ${l.message}`,i,l);throw console.error("Error creating 1:1 meeting calendar event:",o),o}}static async updateOneOnOneMeeting(t,s,r=30){const n="updateOneOnOneMeeting";try{if(!t)throw new Ae("Event ID is required","eventId");if(!s)throw new Ae("Date/time is required","dateTime");if(r&&(typeof r!="number"||r<=0))throw new Ae("Duration must be a positive number","durationMinutes");const i=await Ce.get(t);if(!i)throw new is("Calendar event not found","CalendarEvent",t);if(i.event_type!=="one_on_one")throw new Ae("Event is not a 1:1 meeting","eventType");const l=this._validateDateTime(s,"dateTime",!1,5);if(i.team_member_id){const x=(await this.getOneOnOneMeetingsForTeamMember(i.team_member_id)).find(h=>h.id===t?!1:new Date(h.start_date).toDateString()===l.toDateString());if(x)throw new aa(`Another 1:1 meeting already exists on ${l.toDateString()}`,{conflictingEventId:x.id,date:l.toDateString()})}const o=new Date(l.getTime()+r*60*1e3),m=await this._retryOperation(async()=>await Ce.update(t,{start_date:l.toISOString(),end_date:o.toISOString()}),3,`update calendar event ${t}`);return console.log(`Successfully updated calendar event: ${i.title} (${t})`),m}catch(i){if(i instanceof vs)throw i;const l=new $s(`Failed to update 1:1 meeting calendar event: ${i.message}`,n,i);throw console.error("Error updating 1:1 meeting calendar event:",l),l}}static async deleteOneOnOneMeeting(t){const s="deleteOneOnOneMeeting";try{if(!t)throw new Ae("Event ID is required","eventId");const r=await Ce.get(t);if(!r)throw new is("Calendar event not found","CalendarEvent",t);if(r.event_type!=="one_on_one")throw new Ae("Event is not a 1:1 meeting","eventType");return await this._retryOperation(async()=>{await Ce.delete(t)},3,`delete calendar event ${t}`),console.log(`Successfully deleted calendar event: ${r.title} (${t})`),!0}catch(r){if(r instanceof vs)throw r;const n=new $s(`Failed to delete 1:1 meeting calendar event: ${r.message}`,s,r);throw console.error("Error deleting 1:1 meeting calendar event:",n),n}}static async getOneOnOneMeetings(){try{return(await Ce.list()).filter(r=>r.event_type==="one_on_one")}catch(t){throw console.error("Error fetching 1:1 meeting calendar events:",t),t}}static async linkMeetingToCalendarEvent(t,s){try{if(!t||!s)throw new Error("OneOnOne ID and Calendar Event ID are required");const r=await Re.update(t,{next_meeting_calendar_event_id:s});return await Ce.update(s,{linked_entity_id:t}),r}catch(r){throw console.error("Error linking OneOnOne to CalendarEvent:",r),r}}static async createAndLinkOneOnOneMeeting(t,s,r,n=30){try{const i=await this._validateOneOnOne(t),l=await this._validateTeamMember(s),o=this._validateDateTime(r),m=this._validateDuration(n);if(i.team_member_id!==s)throw new Ae("Team member ID mismatch between OneOnOne record and provided team member ID","teamMemberId");const u=await this._checkForDuplicateEvents(s,o);if(u)throw new aa(`A 1:1 meeting already exists for ${l.name} on ${o.toDateString()}`,{existingEventId:u.id,date:o.toDateString()});const x=await this.createOneOnOneMeeting(s,l.name,r,m),h=await this.linkMeetingToCalendarEvent(t,x.id);return console.log(`Successfully created and linked 1:1 meeting: ${l.name} (${x.id})`),{calendarEvent:x,oneOnOne:h}}catch(i){throw console.error("Error creating and linking 1:1 meeting:",i),i}}}const Ca=Object.freeze(Object.defineProperty({__proto__:null,CalendarService:Me,CalendarServiceError:vs,DuplicateError:aa,NotFoundError:is,OperationError:$s,ValidationError:Ae},Symbol.toStringTag,{value:"Module"}));class qi extends ha{constructor(t,s=null,r=null){super(t,s,r),this.name="NotFoundError"}}class Ia extends zi{constructor(t,s=null,r=null){super(t,s,r),this.name="OperationError"}}class Ts{static async _retryOperation(t,s="operation",r={}){return we.retryOperation(t,{maxRetries:3,baseDelay:1e3,operationName:s,shouldRetry:(n,i)=>!(n instanceof wt||n instanceof qi),...r})}static async syncOneOnOneMeetings(t={}){const{createMissing:s=!0,updateExisting:r=!1,dryRun:n=!1,showProgress:i=!1}=t;return we.wrapOperation(async()=>{we.validateParams(t,{createMissing:{type:"boolean"},updateExisting:{type:"boolean"},dryRun:{type:"boolean"}}),console.log("Starting OneOnOne meeting synchronization...");const o={timestamp:new Date().toISOString(),dryRun:n,totalOneOnOnes:0,processed:0,created:[],updated:[],skipped:[],errors:[],summary:{success:!0,createdCount:0,updatedCount:0,skippedCount:0,errorCount:0}},[m,u]=await Promise.all([Re.list().catch(h=>{throw new ha("Failed to load OneOnOne records","OneOnOne",null,h)}),Fe.list().catch(h=>{throw new ha("Failed to load team members","TeamMember",null,h)})]);o.totalOneOnOnes=m.length;const x=new Map(u.map(h=>[h.id,h]));for(const h of m)try{if(o.processed++,!h.next_meeting_date){o.skipped.push({oneOnOneId:h.id,teamMemberId:h.team_member_id,reason:"No next_meeting_date set"});continue}const d=x.get(h.team_member_id);if(!d){o.errors.push({oneOnOneId:h.id,teamMemberId:h.team_member_id,error:"Team member not found",action:"skipped"});continue}let p=!1,j=null;if(h.next_meeting_calendar_event_id){if(j=await Ce.get(h.next_meeting_calendar_event_id),!j)p=!0,console.warn(`OneOnOne ${h.id} references non-existent calendar event ${h.next_meeting_calendar_event_id}`);else if(r){const y=new Date(j.start_date),b=new Date(h.next_meeting_date);y.getTime()!==b.getTime()&&(n||await this._retryOperation(async()=>{await Me.updateOneOnOneMeeting(j.id,h.next_meeting_date)},`update calendar event for OneOnOne ${h.id}`),o.updated.push({oneOnOneId:h.id,teamMemberId:h.team_member_id,teamMemberName:d.name,calendarEventId:j.id,oldDate:j.start_date,newDate:h.next_meeting_date}))}}else p=!0;if(p&&s)if(n)o.created.push({oneOnOneId:h.id,teamMemberId:h.team_member_id,teamMemberName:d.name,calendarEventId:"dry-run-placeholder",meetingDate:h.next_meeting_date});else{const y=await this._retryOperation(async()=>await Me.createAndLinkOneOnOneMeeting(h.id,h.team_member_id,h.next_meeting_date),`create calendar event for OneOnOne ${h.id}`);o.created.push({oneOnOneId:h.id,teamMemberId:h.team_member_id,teamMemberName:d.name,calendarEventId:y.calendarEvent.id,meetingDate:h.next_meeting_date})}else p&&!s&&o.skipped.push({oneOnOneId:h.id,teamMemberId:h.team_member_id,reason:"Missing calendar event but createMissing is false"})}catch(d){console.error(`Error processing OneOnOne ${h.id}:`,d),o.errors.push({oneOnOneId:h.id,teamMemberId:h.team_member_id,error:d.message,action:"failed"})}return o.summary.createdCount=o.created.length,o.summary.updatedCount=o.updated.length,o.summary.skippedCount=o.skipped.length,o.summary.errorCount=o.errors.length,o.summary.success=o.errors.length===0,console.log("OneOnOne meeting synchronization completed:",{total:o.totalOneOnOnes,created:o.summary.createdCount,updated:o.summary.updatedCount,skipped:o.summary.skippedCount,errors:o.summary.errorCount,success:o.summary.success}),o},{operationName:"OneOnOne Meeting Synchronization",showLoading:i,showSuccess:!0,successMessage:"OneOnOne meeting synchronization completed successfully",retryOptions:{maxRetries:1},errorOptions:{severity:we.SEVERITY.HIGH,context:{dryRun:n,createMissing:s,updateExisting:r}}})}static async ensureOneOnOneVisibility(t={}){const{teamMemberId:s=null,dateRange:r=null,createMissing:n=!0}=t,i="ensureOneOnOneVisibility";try{console.log("Ensuring OneOnOne meeting visibility...");const l={timestamp:new Date().toISOString(),scope:{teamMemberId:s,dateRange:r},totalChecked:0,visible:[],missing:[],created:[],errors:[],summary:{success:!0,visibleCount:0,missingCount:0,createdCount:0,errorCount:0}};let o=await Re.list();if(s&&(o=o.filter(d=>d.team_member_id===s)),r&&r.start&&r.end){const d=new Date(r.start),p=new Date(r.end);o=o.filter(j=>{if(!j.next_meeting_date)return!1;const y=new Date(j.next_meeting_date);return y>=d&&y<=p})}o=o.filter(d=>d.next_meeting_date),l.totalChecked=o.length;const m=await Me.getOneOnOneMeetings(),u=new Map(m.map(d=>[d.id,d])),x=await Fe.list(),h=new Map(x.map(d=>[d.id,d]));for(const d of o)try{const p=h.get(d.team_member_id);if(!p){l.errors.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,error:"Team member not found"});continue}if(d.next_meeting_calendar_event_id){const j=u.get(d.next_meeting_calendar_event_id);if(j)l.visible.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,teamMemberName:p.name,calendarEventId:j.id,meetingDate:d.next_meeting_date});else if(l.missing.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,teamMemberName:p.name,meetingDate:d.next_meeting_date,reason:"Referenced calendar event not found"}),n)try{const y=await this._retryOperation(async()=>await Me.createAndLinkOneOnOneMeeting(d.id,d.team_member_id,d.next_meeting_date),3,`create missing calendar event for OneOnOne ${d.id}`);l.created.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,teamMemberName:p.name,calendarEventId:y.calendarEvent.id,meetingDate:d.next_meeting_date})}catch(y){l.errors.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,error:`Failed to create calendar event: ${y.message}`})}}else if(l.missing.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,teamMemberName:p.name,meetingDate:d.next_meeting_date,reason:"No calendar event linked"}),n)try{const j=await this._retryOperation(async()=>await Me.createAndLinkOneOnOneMeeting(d.id,d.team_member_id,d.next_meeting_date),3,`create calendar event for OneOnOne ${d.id}`);l.created.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,teamMemberName:p.name,calendarEventId:j.calendarEvent.id,meetingDate:d.next_meeting_date})}catch(j){l.errors.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,error:`Failed to create calendar event: ${j.message}`})}}catch(p){console.error(`Error checking visibility for OneOnOne ${d.id}:`,p),l.errors.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,error:p.message})}return l.summary.visibleCount=l.visible.length,l.summary.missingCount=l.missing.length,l.summary.createdCount=l.created.length,l.summary.errorCount=l.errors.length,l.summary.success=l.errors.length===0,console.log("OneOnOne visibility check completed:",{checked:l.totalChecked,visible:l.summary.visibleCount,missing:l.summary.missingCount,created:l.summary.createdCount,errors:l.summary.errorCount,success:l.summary.success}),l}catch(l){throw console.error("Error during OneOnOne visibility check:",l),new Ia(`OneOnOne visibility check failed: ${l.message}`,i,l)}}static async validateEventConsistency(t={}){const{includeOrphanedEvents:s=!0,includeMissingLinks:r=!0,includeInvalidData:n=!0,includeDuplicates:i=!0,includeBrokenReferences:l=!0}=t,o="validateEventConsistency";try{console.log("Starting event consistency validation...");const m={timestamp:new Date().toISOString(),totalEventsChecked:0,totalOneOnOnesChecked:0,inconsistencies:{orphanedEvents:[],missingLinks:[],invalidData:[],duplicateEvents:[],brokenReferences:[]},summary:{isConsistent:!0,totalIssues:0,orphanedCount:0,missingLinksCount:0,invalidDataCount:0,duplicatesCount:0,brokenReferencesCount:0}},[u,x,h]=await Promise.all([Me.getOneOnOneMeetings(),Re.list(),Fe.list()]);m.totalEventsChecked=u.length,m.totalOneOnOnesChecked=x.length;const d=new Map(x.map(y=>[y.id,y])),p=new Map(h.map(y=>[y.id,y])),j=new Map(u.map(y=>[y.id,y]));if(s){const y=new Set(x.filter(b=>b.next_meeting_calendar_event_id).map(b=>b.next_meeting_calendar_event_id));for(const b of u)!y.has(b.id)&&(!b.linked_entity_id||!d.has(b.linked_entity_id))&&m.inconsistencies.orphanedEvents.push({eventId:b.id,title:b.title,teamMemberId:b.team_member_id,startDate:b.start_date,linkedEntityId:b.linked_entity_id,issue:"Calendar event not linked to any OneOnOne record"})}if(r)for(const y of x)y.next_meeting_date&&!y.next_meeting_calendar_event_id&&m.inconsistencies.missingLinks.push({oneOnOneId:y.id,teamMemberId:y.team_member_id,nextMeetingDate:y.next_meeting_date,issue:"OneOnOne has next_meeting_date but no calendar event"});if(l)for(const y of x)y.next_meeting_calendar_event_id&&(j.get(y.next_meeting_calendar_event_id)||m.inconsistencies.brokenReferences.push({oneOnOneId:y.id,teamMemberId:y.team_member_id,referencedEventId:y.next_meeting_calendar_event_id,issue:"OneOnOne references non-existent calendar event"}));if(n)for(const y of u){const b=[],F=p.get(y.team_member_id);if(!F)b.push("Team member not found");else{const S=Me.generateOneOnOneTitle(F.name);y.title!==S&&b.push(`Title mismatch: expected "${S}", got "${y.title}"`)}y.event_type!=="one_on_one"&&b.push(`Incorrect event type: expected "one_on_one", got "${y.event_type}"`),y.linked_entity_type!=="one_on_one"&&b.push(`Incorrect linked entity type: expected "one_on_one", got "${y.linked_entity_type}"`);const N=new Date(y.start_date),w=new Date(y.end_date);if(isNaN(N.getTime())||isNaN(w.getTime())?b.push("Invalid date format"):w<=N&&b.push("End date must be after start date"),y.linked_entity_id){const S=d.get(y.linked_entity_id);if(S&&S.next_meeting_date){const v=new Date(S.next_meeting_date);Math.abs(N.getTime()-v.getTime())>6e4&&b.push("Calendar event date does not match OneOnOne next_meeting_date")}}b.length>0&&m.inconsistencies.invalidData.push({eventId:y.id,title:y.title,teamMemberId:y.team_member_id,linkedEntityId:y.linked_entity_id,issues:b})}if(i){const y={};for(const b of u){const F=new Date(b.start_date).toDateString(),N=`${b.team_member_id}-${F}`;y[N]||(y[N]=[]),y[N].push(b)}for(const[b,F]of Object.entries(y))if(F.length>1){const N=p.get(F[0].team_member_id);m.inconsistencies.duplicateEvents.push({key:b,teamMemberId:F[0].team_member_id,teamMemberName:N?N.name:"Unknown",date:new Date(F[0].start_date).toDateString(),events:F.map(w=>({id:w.id,title:w.title,linkedEntityId:w.linked_entity_id})),count:F.length})}}return m.summary.orphanedCount=m.inconsistencies.orphanedEvents.length,m.summary.missingLinksCount=m.inconsistencies.missingLinks.length,m.summary.invalidDataCount=m.inconsistencies.invalidData.length,m.summary.duplicatesCount=m.inconsistencies.duplicateEvents.length,m.summary.brokenReferencesCount=m.inconsistencies.brokenReferences.length,m.summary.totalIssues=m.summary.orphanedCount+m.summary.missingLinksCount+m.summary.invalidDataCount+m.summary.duplicatesCount+m.summary.brokenReferencesCount,m.summary.isConsistent=m.summary.totalIssues===0,console.log("Event consistency validation completed:",{eventsChecked:m.totalEventsChecked,oneOnOnesChecked:m.totalOneOnOnesChecked,totalIssues:m.summary.totalIssues,isConsistent:m.summary.isConsistent}),m}catch(m){throw console.error("Error during event consistency validation:",m),new Ia(`Event consistency validation failed: ${m.message}`,o,m)}}static async repairMissingEvents(t={}){const{repairOrphaned:s=!0,repairMissing:r=!0,repairBroken:n=!0,removeDuplicates:i=!0,dryRun:l=!1}=t,o="repairMissingEvents";try{console.log("Starting calendar event repair...");const m={timestamp:new Date().toISOString(),dryRun:l,repairs:{orphanedRemoved:[],missingCreated:[],brokenFixed:[],duplicatesRemoved:[]},errors:[],summary:{success:!0,totalRepairs:0,orphanedRemovedCount:0,missingCreatedCount:0,brokenFixedCount:0,duplicatesRemovedCount:0,errorCount:0}},u=await this.validateEventConsistency();if(u.summary.isConsistent)return console.log("No inconsistencies found, no repairs needed"),m;if(s&&u.inconsistencies.orphanedEvents.length>0){console.log(`Repairing ${u.inconsistencies.orphanedEvents.length} orphaned events...`);for(const x of u.inconsistencies.orphanedEvents)try{l||await this._retryOperation(async()=>{await Ce.delete(x.eventId)},3,`delete orphaned event ${x.eventId}`),m.repairs.orphanedRemoved.push({eventId:x.eventId,title:x.title,teamMemberId:x.teamMemberId,action:l?"would_delete":"deleted"})}catch(h){m.errors.push({type:"orphaned_removal_failed",eventId:x.eventId,error:h.message})}}if(r&&u.inconsistencies.missingLinks.length>0){console.log(`Repairing ${u.inconsistencies.missingLinks.length} missing calendar events...`);for(const x of u.inconsistencies.missingLinks)try{if(l)m.repairs.missingCreated.push({oneOnOneId:x.oneOnOneId,teamMemberId:x.teamMemberId,calendarEventId:"dry-run-placeholder",meetingDate:x.nextMeetingDate,action:"would_create"});else{const h=await this._retryOperation(async()=>await Me.createAndLinkOneOnOneMeeting(x.oneOnOneId,x.teamMemberId,x.nextMeetingDate),3,`create missing calendar event for OneOnOne ${x.oneOnOneId}`);m.repairs.missingCreated.push({oneOnOneId:x.oneOnOneId,teamMemberId:x.teamMemberId,calendarEventId:h.calendarEvent.id,meetingDate:x.nextMeetingDate,action:"created"})}}catch(h){m.errors.push({type:"missing_creation_failed",oneOnOneId:x.oneOnOneId,error:h.message})}}if(n&&u.inconsistencies.brokenReferences.length>0){console.log(`Repairing ${u.inconsistencies.brokenReferences.length} broken references...`);for(const x of u.inconsistencies.brokenReferences)try{l||await this._retryOperation(async()=>{await Re.update(x.oneOnOneId,{next_meeting_calendar_event_id:null})},3,`clear broken reference for OneOnOne ${x.oneOnOneId}`),m.repairs.brokenFixed.push({oneOnOneId:x.oneOnOneId,teamMemberId:x.teamMemberId,referencedEventId:x.referencedEventId,action:l?"would_clear":"cleared"})}catch(h){m.errors.push({type:"broken_reference_fix_failed",oneOnOneId:x.oneOnOneId,error:h.message})}}if(i&&u.inconsistencies.duplicateEvents.length>0){console.log(`Removing ${u.inconsistencies.duplicateEvents.length} duplicate event groups...`);for(const x of u.inconsistencies.duplicateEvents)try{const h=x.events.slice(1);for(const d of h)l||await this._retryOperation(async()=>{await Ce.delete(d.id)},3,`delete duplicate event ${d.id}`),m.repairs.duplicatesRemoved.push({eventId:d.id,title:d.title,teamMemberId:x.teamMemberId,date:x.date,action:l?"would_delete":"deleted"})}catch(h){m.errors.push({type:"duplicate_removal_failed",duplicateKey:x.key,error:h.message})}}return m.summary.orphanedRemovedCount=m.repairs.orphanedRemoved.length,m.summary.missingCreatedCount=m.repairs.missingCreated.length,m.summary.brokenFixedCount=m.repairs.brokenFixed.length,m.summary.duplicatesRemovedCount=m.repairs.duplicatesRemoved.length,m.summary.errorCount=m.errors.length,m.summary.totalRepairs=m.summary.orphanedRemovedCount+m.summary.missingCreatedCount+m.summary.brokenFixedCount+m.summary.duplicatesRemovedCount,m.summary.success=m.errors.length===0,console.log("Calendar event repair completed:",{totalRepairs:m.summary.totalRepairs,orphanedRemoved:m.summary.orphanedRemovedCount,missingCreated:m.summary.missingCreatedCount,brokenFixed:m.summary.brokenFixedCount,duplicatesRemoved:m.summary.duplicatesRemovedCount,errors:m.summary.errorCount,success:m.summary.success}),m}catch(m){throw console.error("Error during calendar event repair:",m),new Ia(`Calendar event repair failed: ${m.message}`,o,m)}}}const vr=Object.freeze(Object.defineProperty({__proto__:null,CalendarSynchronizationService:Ts,NotFoundError:qi,OperationError:Ia},Symbol.toStringTag,{value:"Module"}));class Is{static addStatusListener(t){this.listeners.add(t)}static removeStatusListener(t){this.listeners.delete(t)}static notifyListeners(t){this.listeners.forEach(s=>{try{s(t)}catch(r){console.warn("Error in sync status listener:",r)}})}static getSyncStatus(){return{...this.syncStatus}}static updateStatus(t){this.syncStatus={...this.syncStatus,...t},this.notifyListeners(this.getSyncStatus())}static startPeriodicSync(t=5*60*1e3){this.stopPeriodicSync(),console.log(`Starting periodic calendar sync with ${t}ms interval`),this.syncStatus.periodicSyncInterval=setInterval(async()=>{try{await this.performBackgroundSync()}catch(s){console.warn("Periodic sync failed:",s),this.updateStatus({lastError:s.message,lastSync:new Date().toISOString()})}},t),this.performBackgroundSync().catch(s=>{console.warn("Initial periodic sync failed:",s)})}static stopPeriodicSync(){this.syncStatus.periodicSyncInterval&&(clearInterval(this.syncStatus.periodicSyncInterval),this.syncStatus.periodicSyncInterval=null,console.log("Stopped periodic calendar sync"))}static async performBackgroundSync(){if(this.syncStatus.isRunning)return console.log("Sync already running, skipping background sync"),this.syncStatus.syncResults;try{this.updateStatus({isRunning:!0,lastError:null});const[t,s]=await Promise.all([Ts.syncOneOnOneMeetings({createMissing:!0,updateExisting:!1}),Ts.ensureOneOnOneVisibility({createMissing:!0})]),r={timestamp:new Date().toISOString(),sync:t,visibility:s,summary:{success:t.summary.success&&s.summary.success,totalOperations:t.summary.createdCount+s.summary.createdCount,errors:[...t.errors||[],...s.errors||[]]}};return this.updateStatus({isRunning:!1,lastSync:new Date().toISOString(),syncResults:r,lastError:null}),r.summary.totalOperations>0&&console.log("Background sync completed with changes:",{syncCreated:t.summary.createdCount,visibilityCreated:s.summary.createdCount,errors:r.summary.errors.length}),r}catch(t){throw console.error("Background sync failed:",t),this.updateStatus({isRunning:!1,lastSync:new Date().toISOString(),lastError:t.message}),t}}static async manualSync(t={}){const{createMissing:s=!0,updateExisting:r=!0,repairBroken:n=!0,showProgress:i=!0}=t;if(this.syncStatus.isRunning)throw new Error("Sync is already running. Please wait for it to complete.");try{this.updateStatus({isRunning:!0,lastError:null}),i&&console.log("Starting manual calendar synchronization...");const l=await Ts.validateEventConsistency();i&&console.log("Validation completed:",{totalIssues:l.summary.totalIssues,isConsistent:l.summary.isConsistent});let o=null;!l.summary.isConsistent&&n&&(o=await Ts.repairMissingEvents({repairOrphaned:!0,repairMissing:!0,repairBroken:!0,removeDuplicates:!0}),i&&console.log("Repair completed:",{totalRepairs:o.summary.totalRepairs}));const m=await Ts.syncOneOnOneMeetings({createMissing:s,updateExisting:r}),u=await Ts.ensureOneOnOneVisibility({createMissing:s}),x={timestamp:new Date().toISOString(),validation:l,repair:o,sync:m,visibility:u,summary:{success:m.summary.success&&u.summary.success,totalChanges:((o==null?void 0:o.summary.totalRepairs)||0)+m.summary.createdCount+m.summary.updatedCount+u.summary.createdCount,userMessage:this.generateUserMessage(l,o,m,u)}};return this.updateStatus({isRunning:!1,lastSync:new Date().toISOString(),syncResults:x,lastError:null}),i&&console.log("Manual sync completed:",x.summary.userMessage),x}catch(l){throw console.error("Manual sync failed:",l),this.updateStatus({isRunning:!1,lastSync:new Date().toISOString(),lastError:l.message}),l}}static generateUserMessage(t,s,r,n){var o,m;const i=[];if(t.summary.isConsistent&&r.summary.createdCount===0&&n.summary.createdCount===0)return"Calendar is already synchronized. No changes needed.";s&&s.summary.totalRepairs>0&&i.push(`Fixed ${s.summary.totalRepairs} data consistency issue(s)`),r.summary.createdCount>0&&i.push(`Created ${r.summary.createdCount} missing calendar event(s)`),r.summary.updatedCount>0&&i.push(`Updated ${r.summary.updatedCount} calendar event(s)`),n.summary.createdCount>0&&i.push(`Ensured visibility for ${n.summary.createdCount} meeting(s)`);const l=(((o=r.errors)==null?void 0:o.length)||0)+(((m=n.errors)==null?void 0:m.length)||0);return l>0&&i.push(`${l} error(s) occurred during sync`),i.length>0?`Synchronization completed: ${i.join(", ")}.`:"Synchronization completed successfully."}static getSyncStatistics(){var s,r,n;const t=this.getSyncStatus();return{isRunning:t.isRunning,lastSync:t.lastSync,lastError:t.lastError,hasPeriodicSync:t.periodicSyncInterval!==null,lastSyncResults:t.syncResults?{success:((s=t.syncResults.summary)==null?void 0:s.success)||!1,totalChanges:((r=t.syncResults.summary)==null?void 0:r.totalOperations)||0,message:((n=t.syncResults.summary)==null?void 0:n.userMessage)||"No details available"}:null}}static initialize(){this.startPeriodicSync(),typeof window<"u"&&window.addEventListener("beforeunload",()=>{this.stopPeriodicSync()})}static cleanup(){this.stopPeriodicSync(),this.listeners.clear()}}rt(Is,"syncStatus",{isRunning:!1,lastSync:null,lastError:null,syncResults:null,periodicSyncInterval:null}),rt(Is,"listeners",new Set);function Hi(){var ba,Na;const[a,t]=c.useState([]),[s,r]=c.useState([]),[n,i]=c.useState([]),[l,o]=c.useState([]),[m,u]=c.useState([]),[x,h]=c.useState(new Date),[d,p]=c.useState(new Date),[j,y]=c.useState(null),[b,F]=c.useState(null),[N,w]=c.useState(!1),[S,v]=c.useState(Ds.getCurrentViewMode()),[D,C]=c.useState(!0),[I,R]=c.useState({}),[$,J]=c.useState(!1),[le,re]=c.useState(null),[Z,z]=c.useState(new Date),[ae,O]=c.useState([]),[q,L]=c.useState(!0),M=md(),[g,Y]=c.useState({events:[],tasks:[],teamMembers:[],outOfOffice:[],duties:[],lastUpdated:null,loadedDateRanges:new Set}),[W,ne]=c.useState(null),[ce,_e]=c.useState(Is.getSyncStatus()),[qe,Te]=c.useState(!1),$e=Ba(),{toast:Ft}=Ui(),ft=async()=>we.wrapOperation(async()=>{Te(!0);const G=await Is.manualSync({createMissing:!0,updateExisting:!0,repairBroken:!0,showProgress:!0});return G.summary.success&&G.summary.totalChanges>0&&await _(!0),G},{operationName:"Manual Calendar Sync",showLoading:!0,showSuccess:!0,successMessage:"Calendar synchronized successfully",retryOptions:{maxRetries:2,baseDelay:2e3,onRetry:(G,f,P)=>{console.log(`Retrying sync operation (attempt ${f}) in ${P}ms...`),Ft({title:"Retrying Sync",description:`Attempting to sync again (attempt ${f})...`,duration:2e3})}},errorOptions:{severity:we.SEVERITY.HIGH,context:{source:"manual_sync_button"}}}).catch(G=>{throw Te(!0),G});c.useEffect(()=>(_(),Is.initialize(),Is.addStatusListener(_e),()=>{Is.removeStatusListener(_e)}),[]),c.useEffect(()=>{const G=x.getFullYear(),f=`${G}`;!g.loadedDateRanges.has(f)&&!g.loadedDateRanges.has(`${G-1}`)&&!g.loadedDateRanges.has(`${G+1}`)&&_(!1,x),z(x)},[x]),c.useEffect(()=>{Js()},[s,Z,S]),c.useEffect(()=>{L(!M)},[M]);const _=async(G=!1,f=null)=>we.wrapOperation(async()=>{C(!0),ne(null);const U=Date.now(),T=5*60*1e3,ee=f||x;if(!G&&g.lastUpdated&&U-g.lastUpdated<T&&g.events.length>0){t(g.tasks),r(g.events),i(g.teamMembers),o(g.outOfOffice),u(g.duties);const ze=await ia.getAgendaCountsForCalendarEvents(g.events);R(ze),C(!1);return}const ye=[xt.list().catch(ze=>(console.warn("Failed to load tasks:",ze),g.tasks||[])),Ce.list().catch(ze=>(console.warn("Failed to load calendar events:",ze),g.events||[])),Fe.list().catch(ze=>(console.warn("Failed to load team members:",ze),g.teamMembers||[])),Ut.list().catch(ze=>(console.warn("Failed to load out of office records:",ze),g.outOfOffice||[])),Mt.list().catch(ze=>(console.warn("Failed to load duties:",ze),g.duties||[]))],[oe,$t,Wt,gt,at]=await Promise.all(ye);t(oe),i(Wt),o(gt),u(at);const ht=ee.getFullYear(),Cs=[ht-1,ht,ht+1];try{for(const ze of Cs)await na.synchronizeAllEvents({includeBirthdays:!0,includeDuties:!0,includeOutOfOffice:!0,year:ze})}catch(ze){console.warn("Failed to synchronize some calendar events:",ze)}try{const{CalendarSynchronizationService:ze}=await Xt(async()=>{const{CalendarSynchronizationService:qa}=await Promise.resolve().then(()=>vr);return{CalendarSynchronizationService:qa}},void 0);await ze.ensureOneOnOneVisibility({createMissing:!0})}catch(ze){console.warn("Failed to synchronize OneOnOne meetings:",ze)}let Os;try{Os=await Ce.list()}catch(ze){console.warn("Failed to reload calendar events after sync:",ze),Os=$t}r(Os);try{const ze=await ia.getAgendaCountsForCalendarEvents(Os);R(ze)}catch(ze){console.warn("Failed to load agenda counts:",ze),R({})}Y({events:Os,tasks:oe,teamMembers:Wt,outOfOffice:gt,duties:at,lastUpdated:U,loadedDateRanges:new Set([`${ht-1}`,`${ht}`,`${ht+1}`])})},{operationName:"Load Calendar Data",showLoading:!1,showSuccess:!1,retryOptions:{maxRetries:2,baseDelay:1e3,shouldRetry:(U,T)=>{var ee,ye;return!((ee=U.message)!=null&&ee.includes("validation")||(ye=U.message)!=null&&ye.includes("invalid"))}},errorOptions:{severity:we.SEVERITY.MEDIUM,showToast:!1,context:{forceRefresh:G,targetMonth:f==null?void 0:f.toISOString()}}}).catch(U=>{if(console.error("Failed to load calendar data:",U),ne(U.message||"Failed to load calendar data"),g.events.length>0){t(g.tasks),r(g.events),i(g.teamMembers),o(g.outOfOffice),u(g.duties);try{const T=ia.getAgendaCountsForCalendarEvents(g.events);R(T)}catch{R({})}}}).finally(()=>{C(!1)}),de=async()=>{await _(!0)},Oe=async()=>{await _(!0,x)},Le=async G=>{if(!G){w(!1);return}return we.wrapOperation(async()=>{await xt.create({...G,due_date:G.due_date||d.toISOString()}),await de(),w(!1)},{operationName:"Create Task",showLoading:!0,showSuccess:!0,successMessage:"Task created successfully",retryOptions:{maxRetries:2},errorOptions:{severity:we.SEVERITY.MEDIUM,context:{taskTitle:G.title,dueDate:G.due_date}}})},ot=()=>{const G=sc(x);h(G)},Nt=()=>{const G=ac(x,1);h(G)},Qe=G=>{p(G)},Ke=G=>{y(G)},Xe=G=>{F(G),G.event_type==="one_on_one"&&G.team_member_id&&(re(G),J(!0))},Fs=()=>{J(!1),re(null)},Xs=G=>{$e(`/team/${G}`),J(!1),re(null)},Qs=G=>{v(G),Ds.setViewMode(G)},Js=()=>{const G=Da(Z,{weekStartsOn:1}),f=or(Z,{weekStartsOn:1}),P=s.filter(T=>{if(!T.start_date)return!1;try{const ee=H(T.start_date),ye=T.end_date?H(T.end_date):ee;return ee>=G&&ee<=f||ye>=G&&ye<=f||ee<=G&&ye>=f}catch(ee){return console.warn("Invalid date in calendar event:",T.id,ee),!1}}),U=Ds.filterEventsForView(P,S);O(U)},Ss=(G,f)=>{h(f),p(f),Xe(G),M&&L(!1)},A=G=>{h(G),p(G),M&&L(!1)},se=()=>{L(!q)},he=G=>{if(!G.start_date||!G.end_date)return!1;const f=H(G.start_date),P=H(G.end_date);return Ja(P,f)>0},K=(G,f)=>{if(!he(G))return"single";const P=H(G.start_date),U=H(G.end_date);return Vt(f,P)?"start":Vt(f,U)?"end":Xa(f,P)&&Qa(f,U)?"middle":"none"},Se=G=>{const f=n.find(oe=>oe.id===G.team_member_id),P=G.start_date?Q(H(G.start_date),"h:mm a"):"",U=G.end_date?Q(H(G.end_date),"h:mm a"):"",T=I[G.id],ee=Kt.getEventStyling(G),ye={title:G.title,time:null,details:[],actions:[],styling:ee,eventType:ee.label};switch(!G.all_day&&P&&(ye.time=U&&U!==P?`${P} - ${U}`:P),G.event_type){case"one_on_one":f&&(ye.details.push(`1:1 with ${f.name}`),T&&T.count>0?T.hasUnresolved?ye.details.push(`${T.unresolvedCount} pending agenda items`):ye.details.push(`${T.count} agenda items ready`):ye.details.push("No agenda items yet"),ye.actions.push("Click to view team member profile"));break;case"out_of_office":if(f&&(ye.details.push(`${f.name} is out of office`),he(G))){const oe=Ja(H(G.end_date),H(G.start_date))+1;ye.details.push(`Duration: ${oe} day${oe>1?"s":""}`)}break;case"duty":if(f&&(ye.details.push(`Duty assignment for ${f.name}`),he(G))){const oe=Ja(H(G.end_date),H(G.start_date))+1;ye.details.push(`Duration: ${oe} day${oe>1?"s":""}`)}break;case"birthday":f&&ye.details.push(`Wish ${f.name} a happy birthday!`);break}return G.description&&G.description!==G.title&&ye.details.push(G.description),ye},He=G=>{const f=tn(G),P=sn(G);return s.filter(U=>{if(!U.start_date)return!1;try{const T=H(U.start_date),ee=U.end_date?H(U.end_date):T;return T>=f&&T<=P||ee>=f&&ee<=P||T<=f&&ee>=P}catch(T){return console.warn("Invalid date in calendar event:",U.id,T),!1}})},Ie=()=>{var P,U;const G=He(x),f=Ds.getEventCounts(G);return e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:Q(x,"MMMM yyyy")}),M&&e.jsx(E,{variant:"outline",size:"icon",onClick:se,title:q?"Hide weekly meetings":"Show weekly meetings",children:q?e.jsx(Et,{className:"h-4 w-4"}):e.jsx(ir,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(E,{variant:"outline",size:"icon",onClick:ot,disabled:D,children:e.jsx(xa,{className:"h-4 w-4"})}),e.jsx(E,{variant:"outline",size:"icon",onClick:()=>h(new Date),disabled:D,children:"Today"}),e.jsx(E,{variant:"outline",size:"icon",onClick:Nt,disabled:D,children:e.jsx($a,{className:"h-4 w-4"})}),e.jsx(E,{variant:"outline",size:"icon",onClick:Oe,disabled:D,title:"Refresh calendar data",children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(E,{variant:"outline",size:"icon",onClick:ft,disabled:D||ce.isRunning,title:ce.isRunning?"Sync in progress...":"Sync calendar events",className:B(ce.lastError&&"border-red-200 text-red-600",ce.lastSync&&!ce.lastError&&"border-green-200 text-green-600"),children:ce.isRunning?e.jsx(Ws,{className:"h-4 w-4 animate-spin"}):ce.lastError?e.jsx(ms,{className:"h-4 w-4"}):e.jsx(Ws,{className:"h-4 w-4"})}),!M&&e.jsx(E,{variant:"outline",size:"icon",onClick:se,title:q?"Hide weekly meetings":"Show weekly meetings",children:q?e.jsx(Et,{className:"h-4 w-4"}):e.jsx(ir,{className:"h-4 w-4"})})]})]}),W&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-red-600 text-sm",children:[e.jsx("strong",{children:"Error loading calendar data:"})," ",W]}),e.jsx(E,{variant:"outline",size:"sm",onClick:Oe,disabled:D,children:"Retry"})]})}),qe&&ce.lastSync&&e.jsx("div",{className:B("border rounded-md p-3 mb-4",ce.lastError?"bg-red-50 border-red-200":"bg-green-50 border-green-200"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ce.lastError?e.jsx(ms,{className:"h-4 w-4 text-red-600"}):e.jsx(fo,{className:"h-4 w-4 text-green-600"}),e.jsx("div",{className:B("text-sm",ce.lastError?"text-red-600":"text-green-600"),children:ce.lastError?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Sync failed:"})," ",ce.lastError]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Sync completed"}),((U=(P=ce.syncResults)==null?void 0:P.summary)==null?void 0:U.userMessage)&&e.jsxs(e.Fragment,{children:[": ",ce.syncResults.summary.userMessage]})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:ce.lastSync&&new Date(ce.lastSync).toLocaleTimeString()}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>Te(!1),children:e.jsx(Et,{className:"h-3 w-3"})})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(td,{currentViewMode:S,onViewModeChange:Qs,eventCounts:f,disabled:D})})]})},Es=()=>{const G="EEEE",f=[],P=Da(x);for(let U=0;U<7;U++)f.push(e.jsx("div",{className:"font-medium text-sm py-2 text-center",children:Q(en(P,U),G)},U));return e.jsx("div",{className:"grid grid-cols-7 mb-2",children:f})},rs=()=>{const G=tn(x),f=sn(G),P=Da(G),U=or(f),T="d",ee=[];let ye=[],oe=P;const $t=s.filter(at=>{if(!at.start_date)return!1;try{const ht=H(at.start_date),Cs=at.end_date?H(at.end_date):ht;return ht>=P&&ht<=U||Cs>=P&&Cs<=U||ht<=P&&Cs>=U}catch(ht){return console.warn("Invalid date in calendar event:",at.id,ht),!1}}),gt=Ds.filterEventsForView($t,S).length>0||a.some(at=>at.due_date&&H(at.due_date)>=P&&H(at.due_date)<=U);if(!D&&!gt)return e.jsx(sd,{viewMode:S,onCreateTask:()=>w(!0),onAddTeamMember:()=>$e("/team"),onManageDuties:()=>$e("/team")});for(;oe<=U;){for(let at=0;at<7;at++){const ht=Q(oe,T),Cs=oe,Os=a.filter(Ve=>Ve.due_date&&Vt(H(Ve.due_date),oe)),ze=$t.filter(Ve=>{if(!Ve.start_date)return!1;const xs=H(Ve.start_date),gs=Ve.end_date?H(Ve.end_date):xs;return Vt(xs,oe)||Vt(gs,oe)||Xa(oe,xs)&&Qa(oe,gs)}),qa=Ds.filterEventsForView(ze,S);ye.push(e.jsxs("div",{className:B("min-h-[120px] p-2 border border-gray-200 relative",!tc(oe,G)&&"text-gray-400 bg-gray-50",Vt(oe,d)&&"bg-blue-50","hover:bg-blue-50 cursor-pointer transition-colors"),onClick:()=>Qe(Cs),children:[e.jsx("div",{className:"font-medium text-right",children:ht}),e.jsxs("div",{className:"mt-2 space-y-1 max-h-[90px] overflow-y-auto",children:[Os.map(Ve=>e.jsx("div",{className:B("text-xs p-1 rounded truncate",Ve.type==="meeting"&&"bg-blue-100 text-blue-800",Ve.type==="metric"&&"bg-green-100 text-green-800",Ve.type==="action"&&"bg-purple-100 text-purple-800",Ve.type==="generic"&&"bg-gray-100 text-gray-800"),onClick:xs=>{xs.stopPropagation(),Ke(Ve)},children:Ve.title},`task-${Ve.id}`)),qa.map(Ve=>{const xs=K(Ve,oe);if(xs==="none")return null;const gs=he(Ve)?Kt.getMultiDayEventStyling(Ve,xs,Kt.VARIANTS.DEFAULT):Kt.getEventStyling(Ve,Kt.VARIANTS.DEFAULT),Wr=gs.icon,ns=Se(Ve),Tl=gs.titlePrefix?`${gs.titlePrefix}${Ve.title}`:Ve.title,Zs=I[Ve.id];return e.jsx(Jc,{children:e.jsxs(Zc,{children:[e.jsx(ed,{asChild:!0,children:e.jsx("div",{className:gs.className,style:gs.style,onClick:ea=>{ea.stopPropagation(),Xe(Ve)},"aria-label":Kt.getAccessibilityInfo(Ve.event_type).ariaLabel,children:e.jsxs("div",{className:"flex items-center justify-between gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(Wr,{className:"h-3 w-3 flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:Tl})]}),Ve.event_type==="one_on_one"&&Zs&&Zs.count>0&&e.jsx(Gi,{count:Zs.unresolvedCount||Zs.count,hasUnresolved:Zs.hasUnresolved,className:"flex-shrink-0 ml-1"})]})})}),e.jsx($i,{side:"top",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wr,{className:"h-4 w-4 flex-shrink-0",style:{color:ns.styling.colors.primary}}),e.jsx("p",{className:"font-medium",children:ns.title}),e.jsx(te,{variant:"outline",className:"text-xs",style:{borderColor:ns.styling.colors.primary+"50",color:ns.styling.colors.primary},children:ns.eventType})]}),ns.time&&e.jsx("p",{className:"text-xs",children:ns.time}),ns.details.map((ea,Ha)=>e.jsx("p",{className:"text-xs text-gray-600",children:ea},Ha)),ns.actions.map((ea,Ha)=>e.jsx("p",{className:"text-xs text-gray-500 italic",children:ea},Ha))]})})]})},`event-${Ve.id}-${oe.toString()}`)})]}),Vt(oe,new Date)&&e.jsx(te,{className:"absolute top-1 left-1 bg-red-500 text-white",children:"Today"})]},oe.toString())),oe=en(oe,1)}ee.push(e.jsx("div",{className:"grid grid-cols-7",children:ye},oe.toString())),ye=[]}return e.jsx("div",{className:"mb-4",children:ee})},Gt=()=>{const G=a.filter(T=>T.due_date&&Vt(H(T.due_date),d)),f=s.filter(T=>{if(!T.start_date)return!1;try{const ee=H(T.start_date),ye=T.end_date?H(T.end_date):ee;return Vt(ee,d)||Vt(ye,d)||Xa(d,ee)&&Qa(d,ye)}catch(ee){return console.warn("Invalid date in calendar event:",T.id,ee),!1}}),P=Ds.filterEventsForView(f,S);return G.length>0||P.length>0?e.jsxs("div",{className:"space-y-3",children:[P.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(Gs,{className:"h-4 w-4"}),"Events (",P.length,")"]}),e.jsx("div",{className:"space-y-2",children:P.map(T=>{const ee=Kt.getEventCardStyling(T),ye=ee.icon,oe=Se(T),$t=n.find(at=>at.id===T.team_member_id),Wt=he(T),gt=I[T.id];return e.jsxs("div",{className:ee.className,onClick:()=>Xe(T),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4",style:{color:ee.colors.primary}}),e.jsx("h4",{className:"font-medium",children:T.title}),Wt&&e.jsx(te,{variant:"secondary",className:"text-xs",children:"Multi-day"}),T.event_type==="one_on_one"&&gt&&gt.count>0&&e.jsx(Yi,{count:gt.count,unresolvedCount:gt.unresolvedCount,hasUnresolved:gt.hasUnresolved,size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[oe.time&&e.jsx("span",{className:"text-xs text-gray-500",children:oe.time}),e.jsx(te,{variant:"outline",style:{borderColor:ee.colors.primary+"50",color:ee.colors.primary},children:oe.eventType})]})]}),oe.details.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:oe.details.map((at,ht)=>e.jsx("p",{className:"text-sm text-gray-600",children:at},ht))}),Wt&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[Q(H(T.start_date),"MMM d")," - ",Q(H(T.end_date),"MMM d")]}),$t&&(T.event_type==="one_on_one"||T.event_type==="meeting")&&e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(ts,{teamMemberId:$t.id,teamMemberName:$t.name,sourceItem:{title:T.title,description:T.description||`${T.event_type==="one_on_one"?"1:1 meeting":"Meeting"} on ${Q(H(T.start_date),"MMM d, yyyy")}`,type:T.event_type,id:T.id,date:T.start_date},variant:"outline",size:"sm"}),T.event_type==="one_on_one"&&e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{re(T),J(!0)},children:[e.jsx(es,{className:"h-4 w-4 mr-1"}),"Meeting Details"]})]})})]},T.id)})})]}),G.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1",children:[e.jsx(Ue,{className:"h-4 w-4"}),"Tasks (",G.length,")"]}),e.jsx("div",{className:"space-y-2",children:G.map(T=>{const ee=Array.isArray(T.stakeholders)?T.stakeholders:[],ye=n.filter(oe=>ee.includes(oe.name));return e.jsxs("div",{className:"p-3 border rounded-md hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>Ke(T),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium",children:T.title}),e.jsx(te,{variant:"outline",children:T.type})]}),T.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:T.description}),ye.length>0&&e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200 space-y-2",children:ye.map(oe=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:oe.name}),e.jsx(ts,{teamMemberId:oe.id,teamMemberName:oe.name,sourceItem:{title:T.title,description:T.description,type:"task",id:T.id,priority:T.priority,status:T.status,due_date:T.due_date},variant:"outline",size:"sm"})]},oe.id))})]},T.id)})})]})]}):e.jsx(ad,{viewMode:S,onCreateTask:()=>w(!0)})};return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row space-y-6 xl:space-y-0 xl:space-x-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Calendar"}),e.jsxs(E,{onClick:()=>w(!0),disabled:D,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"New Task"]})]}),D?e.jsx(rd,{}):e.jsxs(e.Fragment,{children:[Ie(),Es(),rs()]})]}),e.jsxs("div",{className:"xl:w-80",children:[e.jsxs("div",{className:"bg-white rounded-md border p-4 sticky top-4",children:[e.jsx("h2",{className:"font-semibold mb-4 pb-2 border-b",children:Q(d,"MMMM d, yyyy")}),Gt()]}),q&&e.jsxs("div",{className:B("mt-6",M&&"fixed inset-0 z-50 bg-white p-4 overflow-y-auto"),children:[M&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Weekly Meetings"}),e.jsx(E,{variant:"ghost",size:"icon",onClick:se,children:e.jsx(Et,{className:"h-4 w-4"})})]}),e.jsx(dd,{currentWeek:Z,meetings:ae,onMeetingClick:Ss,onDateNavigate:A,agendaCounts:I,isLoading:D,error:W,onRetry:()=>_(!0),className:B(M&&"static")})]})]})]}),M&&q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:se,"aria-hidden":"true"}),e.jsx(Ye,{open:N,onOpenChange:w,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsxs(We,{children:["Add Task for ",Q(d,"MMMM d, yyyy")]})}),e.jsx(za,{onCreateTask:Le,initialTaskData:{due_date:d.toISOString(),status:"todo",priority:"medium",type:"generic"}})]})}),e.jsx(Ye,{open:$,onOpenChange:Fs,children:e.jsx(Be,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:e.jsx(cd,{event:le,teamMember:le?n.find(G=>G.id===le.team_member_id):null,isOpen:$,onClose:Fs,onNavigateToProfile:Xs})})}),e.jsx(Ye,{open:!!j,onOpenChange:()=>y(null),children:j&&e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Task Details"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:j.title}),e.jsxs("div",{className:"flex items-center mt-2 space-x-2",children:[e.jsx(te,{children:j.type}),e.jsxs(te,{variant:"outline",children:[j.priority," priority"]}),j.strategic&&e.jsx(te,{variant:"secondary",children:"Strategic"})]})]}),j.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Description"}),e.jsx("p",{children:j.description})]}),j.due_date&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Due Date"}),e.jsx("p",{children:Q(H(j.due_date),"PPpp")})]}),((ba=j.stakeholders)==null?void 0:ba.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Stakeholders"}),e.jsx("p",{children:j.stakeholders.join(", ")}),e.jsx("div",{className:"mt-3 space-y-2",children:j.stakeholders.map(G=>{const f=n.find(P=>P.name===G);return f?e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm font-medium",children:f.name}),e.jsx(ts,{teamMemberId:f.id,teamMemberName:f.name,sourceItem:{title:j.title,description:j.description,type:"task",id:j.id,priority:j.priority,status:j.status,due_date:j.due_date},variant:"outline",size:"sm"})]},f.id):null})})]}),((Na=j.tags)==null?void 0:Na.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:j.tags.map((G,f)=>e.jsx(te,{variant:"secondary",children:G},f))})]})]})]})})]})})}function Ki(){const[a,t]=c.useState([]),[s,r]=c.useState([]),[n,i]=c.useState(!1);c.useEffect(()=>{l()},[]);const l=async()=>{try{const h=await xt.list();t(h);const d=h.filter(p=>p.type==="metric");r(d)}catch(h){console.error("Failed to load tasks:",h)}},o=async h=>{if(!h){i(!1);return}try{await xt.create({...h,type:"metric"}),await l(),i(!1)}catch(d){console.error("Failed to create metric:",d)}},m=s.reduce((h,d)=>{var j,y;const p=(y=(j=d.metadata)==null?void 0:j.metric)==null?void 0:y.kpi_name;return p&&(h[p]||(h[p]=[]),h[p].push(d)),h},{}),u=h=>{var w,S,v,D;if(!h||h.length<2)return{trend:"neutral",percentage:0};const d=[...h].sort((C,I)=>new Date(C.created_date)-new Date(I.created_date)),p=d[d.length-1],j=d[d.length-2],y=parseFloat((S=(w=p.metadata)==null?void 0:w.metric)==null?void 0:S.current_value)||0,b=parseFloat((D=(v=j.metadata)==null?void 0:v.metric)==null?void 0:D.current_value)||0;if(y===b)return{trend:"neutral",percentage:0};const F=y-b,N=b!==0?Math.abs(Math.round(F/b*100)):0;return{trend:F>0?"up":"down",percentage:N}},x=h=>h.filter(d=>{var p,j;return(j=(p=d.metadata)==null?void 0:p.metric)==null?void 0:j.current_value}).map(d=>{var p,j,y,b;return{date:Q(new Date(d.created_date),"MMM dd"),value:parseFloat((j=(p=d.metadata)==null?void 0:p.metric)==null?void 0:j.current_value)||0,target:parseFloat((b=(y=d.metadata)==null?void 0:y.metric)==null?void 0:b.target_value)||void 0}}).sort((d,p)=>new Date(d.date)-new Date(p.date));return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Metrics Dashboard"}),e.jsxs(E,{onClick:()=>i(!0),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Track New Metric"]})]}),Object.keys(m).length===0?e.jsx(me,{className:"bg-gray-50 border-dashed",children:e.jsxs(ue,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(bn,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No metrics being tracked"}),e.jsx("p",{className:"text-gray-500 text-center mb-4",children:"Start tracking your key product metrics to monitor performance"}),e.jsxs(E,{onClick:()=>i(!0),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add First Metric"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(m).map(([h,d])=>{var N,w,S,v,D,C;const p=u(d),j=x(d),y=d.sort((I,R)=>new Date(R.created_date)-new Date(I.created_date))[0],b=(w=(N=y.metadata)==null?void 0:N.metric)==null?void 0:w.current_value,F=(v=(S=y.metadata)==null?void 0:S.metric)==null?void 0:v.target_value;return e.jsxs(me,{className:"overflow-hidden",children:[e.jsx(be,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(Ne,{children:h}),e.jsx(kt,{children:((C=(D=y.metadata)==null?void 0:D.metric)==null?void 0:C.measurement_frequency)||"Tracked periodically"})]}),e.jsxs(te,{variant:"outline",children:[d.length," updates"]})]})}),e.jsxs(ue,{className:"pb-0",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("div",{className:"text-2xl font-bold",children:b}),p.percentage>0&&e.jsxs("div",{className:`flex items-center ${p.trend==="up"?"text-green-600":"text-red-600"}`,children:[p.trend==="up"?e.jsx(yo,{className:"h-4 w-4 mr-1"}):e.jsx(jo,{className:"h-4 w-4 mr-1"}),p.percentage,"%"]})]}),F&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(ti,{className:"h-3 w-3 mr-1 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Target: ",F]})]}),e.jsx("div",{className:"h-36 mt-4",children:e.jsx(Ni,{width:"100%",height:"100%",children:e.jsxs(rc,{data:j,children:[e.jsx(nc,{dataKey:"date",tick:{fontSize:12},tickLine:!1,axisLine:!1}),e.jsx(ic,{tick:{fontSize:12},tickLine:!1,axisLine:!1,width:30}),e.jsx(_i,{}),e.jsx(an,{type:"monotone",dataKey:"value",stroke:"#6366F1",strokeWidth:2,dot:{r:3},activeDot:{r:5}}),j.some(I=>I.target!==void 0)&&e.jsx(an,{type:"monotone",dataKey:"target",stroke:"#E5E7EB",strokeWidth:1,strokeDasharray:"4 4",dot:!1})]})})})]}),e.jsx(Hs,{className:"pt-4",children:e.jsxs("div",{className:"text-xs text-gray-500",children:["Last updated: ",Q(new Date(y.created_date),"PPp")]})})]},h)})}),e.jsx(Ye,{open:n,onOpenChange:i,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Track New Metric"})}),e.jsx(za,{onCreateTask:o,initialTaskData:{status:"todo",priority:"medium",type:"metric",metadata:{metric:{}}}})]})})]})})}function Xi(){const[a,t]=c.useState([]),[s,r]=c.useState([]),[n,i]=c.useState(!0),[l,o]=c.useState(!1),[m,u]=c.useState(""),[x,h]=c.useState(null),[d,p]=c.useState(null),[j,y]=c.useState({name:"",role:"",email:"",phone:"",company:"",influence_level:"medium",engagement_level:"active",contact_info:"",notes:"",tags:[]});c.useEffect(()=>{b()},[]);const b=async()=>{i(!0),h(null);try{const[v,D]=await Promise.all([cs.list(),Fe.list()]);if(!v)t([]);else{const I=Array.isArray(v)?v:[];t(I)}const C=Array.isArray(D)?D:[];r(C)}catch(v){console.error("Failed to load stakeholders:",v),h("Failed to load stakeholders"),t([])}finally{i(!1)}},F=()=>{y({name:"",role:"",email:"",phone:"",company:"",influence_level:"medium",engagement_level:"active",contact_info:"",notes:"",tags:[]}),p(null),o(!0)},N=v=>{y({name:v.name||"",role:v.role||"",email:v.email||"",phone:v.phone||"",company:v.company||v.organization||"",influence_level:v.influence_level||v.influence||"medium",engagement_level:v.engagement_level||"active",contact_info:v.contact_info||"",notes:v.notes||v.description||"",tags:Array.isArray(v.tags)?v.tags:[]}),p(v),o(!0)},w=async()=>{try{d?await cs.update(d.id,j):await cs.create(j),o(!1),b()}catch(v){console.error(`Failed to ${d?"update":"create"} stakeholder:`,v),h(`Failed to ${d?"update":"create"} stakeholder`)}};if(n)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading stakeholders..."})]})});const S=(a||[]).filter(v=>{if(!v)return!1;const D=(m||"").toLowerCase(),C=(v.name||"").toLowerCase(),I=(v.role||"").toLowerCase(),R=(v.company||v.organization||"").toLowerCase();return C.includes(D)||I.includes(D)||R.includes(D)});return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Stakeholders"}),e.jsxs(E,{onClick:F,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add Stakeholder"]})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ie,{placeholder:"Search stakeholders...",value:m,onChange:v=>u(v.target.value),className:"pl-9"})]}),x&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 text-red-600 rounded-md",children:x}),a.length===0?e.jsxs(me,{className:"text-center p-12",children:[e.jsx(Bs,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No stakeholders yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first stakeholder to get started"}),e.jsxs(E,{onClick:()=>o(!0),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add First Stakeholder"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(v=>v&&e.jsxs(me,{children:[e.jsxs(be,{children:[e.jsx(Ne,{children:v.name||"Unnamed Stakeholder"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(te,{className:(v.influence_level||v.influence)==="high"?"bg-red-100 text-red-800":(v.influence_level||v.influence)==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800",children:[v.influence_level||v.influence||"medium"," influence"]}),e.jsx(te,{className:v.engagement_level==="active"?"bg-green-100 text-green-800":v.engagement_level==="passive"?"bg-gray-100 text-gray-800":"bg-orange-100 text-orange-800",children:v.engagement_level||"active"})]})]}),e.jsxs(ue,{children:[v.role&&e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:v.role}),(v.company||v.organization)&&e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:v.company||v.organization}),v.email&&e.jsx("p",{className:"text-sm text-blue-600 mb-1",children:v.email}),(v.notes||v.description)&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:v.notes||v.description}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsx(E,{size:"sm",variant:"outline",onClick:()=>N(v),children:"Edit"}),s.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Add to team member agendas:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,3).map(D=>e.jsx(ts,{teamMemberId:D.id,teamMemberName:D.name,sourceItem:{title:`Stakeholder: ${v.name}`,description:`${v.role?`${v.role} - `:""}${v.company||v.organization||""}${v.notes||v.description?` | ${v.notes||v.description}`:""}`,type:"stakeholder",id:v.id,influence_level:v.influence_level||v.influence,engagement_level:v.engagement_level},variant:"ghost",size:"xs",showAgendaAction:!0,showPersonalFileAction:!0},D.id)),s.length>3&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",s.length-3," more"]})]})]})]})]})]},v.id||Math.random()))}),e.jsx(Ye,{open:l,onOpenChange:o,children:e.jsxs(Be,{children:[e.jsx(Ge,{children:e.jsx(We,{children:d?"Edit Stakeholder":"Add New Stakeholder"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Name"}),e.jsx(ie,{value:j.name,onChange:v=>y(D=>({...D,name:v.target.value})),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Role"}),e.jsx(ie,{value:j.role,onChange:v=>y(D=>({...D,role:v.target.value})),placeholder:"Job title or role"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Company"}),e.jsx(ie,{value:j.company,onChange:v=>y(D=>({...D,company:v.target.value})),placeholder:"Company name"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Email"}),e.jsx(ie,{type:"email",value:j.email,onChange:v=>y(D=>({...D,email:v.target.value})),placeholder:"Email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Phone"}),e.jsx(ie,{type:"tel",value:j.phone,onChange:v=>y(D=>({...D,phone:v.target.value})),placeholder:"Phone number"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Influence Level"}),e.jsxs(fe,{value:j.influence_level,onValueChange:v=>y(D=>({...D,influence_level:v})),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select influence level"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"low",children:"Low"}),e.jsx(k,{value:"medium",children:"Medium"}),e.jsx(k,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Engagement Level"}),e.jsxs(fe,{value:j.engagement_level,onValueChange:v=>y(D=>({...D,engagement_level:v})),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select engagement level"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"active",children:"Active"}),e.jsx(k,{value:"passive",children:"Passive"}),e.jsx(k,{value:"resistant",children:"Resistant"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Contact Info"}),e.jsx(ie,{value:j.contact_info,onChange:v=>y(D=>({...D,contact_info:v.target.value})),placeholder:"Additional contact information"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Notes"}),e.jsx(ie,{value:j.notes,onChange:v=>y(D=>({...D,notes:v.target.value})),placeholder:"Additional notes about this stakeholder"})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(E,{onClick:w,children:d?"Update Stakeholder":"Create Stakeholder"})]})]})})]})})}const Aa=c.forwardRef(({className:a,value:t,...s},r)=>e.jsx(si,{ref:r,className:B("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...s,children:e.jsx(vo,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Aa.displayName=si.displayName;function Qi(){const a=Ba(),[t,s]=c.useState([]),[r,n]=c.useState({}),[i,l]=c.useState(!0),[o,m]=c.useState(!1),[u,x]=c.useState(null),[h,d]=c.useState(null),[p,j]=c.useState({name:"",description:"",status:"not_started",start_date:"",end_date:"",deadline:"",owner:"",budget:"",cost:"",priority_level:"medium",color:O(),tags:[]}),[y,b]=c.useState({}),[F,N]=c.useState({}),[w,S]=c.useState(!1),[v,D]=c.useState(null),[C,I]=c.useState(""),[R,$]=c.useState(""),[J,le]=c.useState([]),[re,Z]=c.useState([]),[z,ae]=c.useState([]);c.useEffect(()=>{q()},[]);function O(){const _=["indigo","blue","green","amber","red","purple","pink","teal"];return _[Math.floor(Math.random()*_.length)]}const q=async()=>{l(!0),x(null);try{const _=await Pt.list("-created_date");s(_);const de=await xt.list(),Oe={};_.forEach(Le=>{Oe[Le.id]=de.filter(ot=>ot.project===Le.name)}),n(Oe)}catch(_){console.error("Failed to load projects:",_),x("Failed to load projects. Please try again.")}finally{l(!1)}},L=(_,de)=>{if(_==="tags"){const Oe=Array.isArray(de)?de:[];j(Le=>({...Le,[_]:Oe}))}else j(Oe=>({...Oe,[_]:de}))},M=()=>{j({name:"",description:"",status:"not_started",start_date:"",end_date:"",deadline:"",owner:"",budget:"",cost:"",priority_level:"medium",color:O(),tags:[]}),d(null),m(!0)},g=_=>{_&&(j({name:_.name||"",description:_.description||"",status:_.status||"not_started",start_date:_.start_date||"",end_date:_.end_date||"",deadline:_.deadline||"",owner:_.owner||"",budget:_.budget||"",cost:_.cost||"",priority_level:_.priority_level||"medium",color:_.color||O(),tags:Array.isArray(_.tags)?_.tags:[]}),d(_),m(!0))},Y=async()=>{try{h?await Pt.update(h.id,p):await Pt.create(p),m(!1),await q()}catch(_){console.error("Failed to save project:",_),x("Failed to save project. Please try again.")}},W=async _=>{try{await Pt.delete(_),await q()}catch(de){console.error("Failed to delete project:",de),x("Failed to delete project. Please try again.")}},ne=_=>({indigo:"bg-indigo-500",blue:"bg-blue-500",green:"bg-green-500",amber:"bg-amber-500",red:"bg-red-500",purple:"bg-purple-500",pink:"bg-pink-500",teal:"bg-teal-500"})[_]||"bg-gray-500",ce=_=>{const de={not_started:"bg-gray-100 text-gray-800 border-gray-200",in_progress:"bg-blue-100 text-blue-800 border-blue-200",on_hold:"bg-amber-100 text-amber-800 border-amber-200",completed:"bg-green-100 text-green-800 border-green-200"},Oe={not_started:"Not Started",in_progress:"In Progress",on_hold:"On Hold",completed:"Completed"};return e.jsx(te,{className:de[_],children:Oe[_]})},_e=_=>{const de=r[_]||[];if(de.length===0)return 0;const Oe=de.filter(Le=>Le.status==="done").length;return Math.round(Oe/de.length*100)},qe=_=>{const de=Array.isArray(r[_])?r[_]:[],Oe={total:de.length,done:0,in_progress:0,todo:0,backlog:0,blocked:0};return de.forEach(Le=>{Le&&Le.status&&(Oe[Le.status]=(Oe[Le.status]||0)+1)}),Oe},Te=async _=>{D(_.id);try{const de=r[_.id]||[],Oe=de.filter(Ke=>Ke.status==="done").length,Le=de.length,ot=de.flatMap(Ke=>(Ke.updates||[]).map(Xe=>({...Xe,taskTitle:Ke.title}))).sort((Ke,Xe)=>new Date(Xe.date)-new Date(Ke.date)).slice(0,3),Nt=await kr({prompt:`Analyze this project's status and provide next steps:
          Project: ${_.name}
          Description: ${_.description||"No description provided"}
          Status: ${_.status}
          Progress: ${Oe}/${Le} tasks completed
          Recent Updates: ${ot.map(Ke=>Ke.text).join(", ")||"No recent updates"}
          
          Provide a comprehensive analysis including current status, challenges, and recommended next steps.`,response_json_schema:{type:"object",properties:{currentStatus:{type:"string"},challenges:{type:"array",items:{type:"string"}},nextSteps:{type:"array",items:{type:"string"}}},required:["currentStatus","challenges","nextSteps"]}}),Qe=[..._.analyses||[]];Qe.push({...Nt,date:new Date().toISOString()}),await Pt.update(_.id,{..._,analyses:Qe}),await q()}catch(de){console.error(`Failed to analyze project ${_.name}:`,de)}finally{D(null)}},$e=_=>{b(de=>({...de,[_]:!de[_]}))},Ft=()=>{const _={not_started:0,in_progress:0,completed:0,on_hold:0};return t.forEach(de=>{_[de.status]=(_[de.status]||0)+1}),[{name:"Not Started",value:_.not_started,color:"#94a3b8"},{name:"In Progress",value:_.in_progress,color:"#60a5fa"},{name:"Completed",value:_.completed,color:"#4ade80"},{name:"On Hold",value:_.on_hold,color:"#fbbf24"}]};c.useEffect(()=>{o&&(Xt(async()=>{const{Stakeholder:_,TeamMember:de,Peer:Oe}=await Promise.resolve().then(()=>Oi);return{Stakeholder:_,TeamMember:de,Peer:Oe}},void 0).then(({Stakeholder:_,TeamMember:de,Peer:Oe})=>{_.list().then(le),de.list().then(Z),Oe.list().then(ae)}),h&&p.owner&&typeof p.owner=="object"?(I(p.owner.type),$(p.owner.id)):(I(""),$("")))},[o]),c.useEffect(()=>{C&&R?L("owner",{type:C,id:R}):L("owner","")},[C,R]);function ft(_){if(!_||typeof _!="object"||!_.type||!_.id)return"";if(_.type==="stakeholder"){const de=J.find(Oe=>Oe.id===_.id);return de?de.name:"(Unknown Stakeholder)"}if(_.type==="team_member"){const de=re.find(Oe=>Oe.id===_.id);return de?de.name:"(Unknown Team Member)"}if(_.type==="peer"){const de=z.find(Oe=>Oe.id===_.id);return de?de.name:"(Unknown Peer)"}return""}return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Projects"}),e.jsxs(E,{onClick:M,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"New Project"]})]}),u&&e.jsx(mt,{variant:"destructive",className:"mb-6",children:e.jsx(ut,{children:u})}),e.jsxs(me,{className:"mb-6",children:[e.jsx(be,{children:e.jsx(Ne,{children:"Projects Overview"})}),e.jsx(ue,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64",children:e.jsx(Ni,{width:"100%",height:"100%",children:e.jsxs(lc,{children:[e.jsx(oc,{data:Ft(),cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:_,percent:de})=>`${_} ${(de*100).toFixed(0)}%`,children:Ft().map((_,de)=>e.jsx(cc,{fill:_.color},de))}),e.jsx(_i,{}),e.jsx(dc,{})]})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Active Projects"}),e.jsx("span",{children:t.filter(_=>_.status==="in_progress").length})]}),e.jsx(Aa,{value:t.filter(_=>_.status==="in_progress").length/t.length*100})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Completed Projects"}),e.jsx("span",{children:t.filter(_=>_.status==="completed").length})]}),e.jsx(Aa,{value:t.filter(_=>_.status==="completed").length/t.length*100,className:"bg-green-100"})]})]})]})]})})]}),i?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading projects..."})]}):t.length===0?e.jsx(me,{className:"bg-gray-50 border-dashed",children:e.jsxs(ue,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(wn,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No projects yet"}),e.jsx("p",{className:"text-gray-500 text-center mb-4",children:"Create your first project to organize your tasks"}),e.jsxs(E,{onClick:M,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Create Project"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(_=>{var ot,Nt;const de=y[_.id]!==!1,Oe=_e(_.id),Le=qe(_.id);return F[_.id],e.jsxs(me,{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1.5 h-full ${ne(_.color)}`}),e.jsx(be,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>$e(_.id),children:de?e.jsx(Sr,{className:"h-4 w-4"}):e.jsx($a,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx(Ne,{className:"truncate hover:text-indigo-600 cursor-pointer transition-colors",onClick:()=>a(qt("ProjectDetails")+`?id=${_.id}`),children:_.name}),e.jsx("div",{className:"flex items-center mt-2",children:ce(_.status)})]})]}),e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(La,{className:"h-4 w-4"})})}),e.jsxs(Qt,{align:"end",children:[e.jsxs(et,{onClick:()=>g(_),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(et,{onClick:()=>W(_.id),className:"text-red-600",children:[e.jsx(Dt,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})}),de&&e.jsxs(ue,{children:[_.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:_.description}),Array.isArray(_.tags)&&_.tags.length>0&&e.jsx("div",{className:"mb-3 flex flex-wrap gap-1",children:_.tags.map(Qe=>e.jsx(te,{variant:"outline",className:"text-xs",children:Qe},Qe))}),_.start_date&&_.end_date&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-4",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[Q(H(_.start_date),"MMM d")," - ",Q(H(_.end_date),"MMM d, yyyy")]})]}),_.owner&&typeof _.owner=="object"&&_.owner.type&&_.owner.id&&e.jsx("div",{className:"mb-4",children:e.jsxs(te,{variant:"outline",className:"text-gray-600",children:["Owner: ",ft(_.owner)]})}),_.owner&&typeof _.owner=="string"&&_.owner&&e.jsx("div",{className:"mb-4",children:e.jsxs(te,{variant:"outline",className:"text-gray-600",children:["Owner: ",_.owner]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ai,{className:"h-4 w-4"}),"AI Analysis"]}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>Te(_),disabled:v===_.id,children:v===_.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"⭮"}),"Analyzing..."]}):"Run Analysis"})]}),((ot=_.analyses)==null?void 0:ot.length)>0?e.jsxs("div",{className:"bg-blue-50 rounded-md p-3 space-y-2",children:[e.jsx("p",{className:"text-sm text-blue-900",children:_.analyses[_.analyses.length-1].currentStatus}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{className:"block mb-1",children:"Next Steps:"}),e.jsx("ul",{className:"list-disc pl-4",children:_.analyses[_.analyses.length-1].nextSteps.map((Qe,Ke)=>e.jsx("li",{children:Qe},Ke))})]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-2",children:["Last analyzed: ",Q(H(_.analyses[_.analyses.length-1].date),"PPp")]})]}):e.jsxs("div",{className:"text-center p-4 border border-dashed rounded-md",children:[e.jsx(ms,{className:"h-5 w-5 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No analysis available yet"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Recent Updates"}),e.jsx(Ga,{className:"h-32 rounded-md border p-2",children:(Nt=r[_.id])==null?void 0:Nt.flatMap(Qe=>(Qe.updates||[]).map(Ke=>({...Ke,taskTitle:Qe.title}))).sort((Qe,Ke)=>new Date(Ke.date)-new Date(Qe.date)).map((Qe,Ke)=>e.jsx("div",{className:"mb-2 last:mb-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(es,{className:"h-4 w-4 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:Qe.text}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:Q(H(Qe.date),"MMM d, yyyy")}),e.jsxs("span",{className:"text-xs text-gray-400",children:["in ",Qe.taskTitle]})]})]})]})},Ke))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Oe,"%"]})]}),e.jsx(Aa,{value:Oe,className:"h-2"})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Vs,{className:"h-4 w-4 text-indigo-500 mr-1"}),e.jsxs("span",{className:"text-sm",children:[Le.total," tasks"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[Le.done>0&&e.jsxs(te,{variant:"outline",className:"bg-green-50",children:[Le.done," done"]}),Le.in_progress>0&&e.jsxs(te,{variant:"outline",className:"bg-blue-50",children:[Le.in_progress," in progress"]})]})]})]})]},_.id)})})]}),e.jsx(Ye,{open:o,onOpenChange:m,children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsx(Ge,{children:e.jsx(We,{children:h?"Edit Project":"Create New Project"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Project Name"}),e.jsx(ie,{id:"name",value:p.name,onChange:_=>L("name",_.target.value),placeholder:"Enter project name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Description"}),e.jsx(Rt,{id:"description",value:p.description,onChange:_=>L("description",_.target.value),placeholder:"Enter project description",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"status",children:"Status"}),e.jsxs(fe,{value:p.status,onValueChange:_=>L("status",_),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select status"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"not_started",children:"Not Started"}),e.jsx(k,{value:"in_progress",children:"In Progress"}),e.jsx(k,{value:"on_hold",children:"On Hold"}),e.jsx(k,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"ownerType",children:"Project Owner Type"}),e.jsxs(fe,{value:C,onValueChange:I,children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select owner type"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"stakeholder",children:"Stakeholder"}),e.jsx(k,{value:"team_member",children:"Team Member"}),e.jsx(k,{value:"peer",children:"Peer"})]})]})]})]}),C&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"ownerId",children:"Project Owner"}),e.jsxs(fe,{value:R,onValueChange:$,disabled:!C||C==="stakeholder"&&(!J||J.length===0)||C==="team_member"&&(!re||re.length===0)||C==="peer"&&(!z||z.length===0),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:`Select ${C.replace("_"," ")}`})}),e.jsxs(ge,{children:[C==="stakeholder"&&J&&J.length>0&&J.map(_=>e.jsx(k,{value:_.id,children:_.name},_.id)),C==="team_member"&&re&&re.length>0&&re.map(_=>e.jsx(k,{value:_.id,children:_.name},_.id)),C==="peer"&&z&&z.length>0&&z.map(_=>e.jsx(k,{value:_.id,children:_.name},_.id))]})]}),(C==="stakeholder"&&(!J||J.length===0)||C==="team_member"&&(!re||re.length===0)||C==="peer"&&(!z||z.length===0))&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"No records found for this type."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Start Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),p.start_date?Q(H(p.start_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:p.start_date?H(p.start_date):void 0,onSelect:_=>L("start_date",_?_.toISOString():"")})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"End Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),p.end_date?Q(H(p.end_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:p.end_date?H(p.end_date):void 0,onSelect:_=>L("end_date",_?_.toISOString():"")})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Deadline (Critical Date)"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),p.deadline?Q(H(p.deadline),"PPP"):e.jsx("span",{children:"Set deadline (optional)"})]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:p.deadline?H(p.deadline):void 0,onSelect:_=>L("deadline",_?_.toISOString():"")})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"priority_level",children:"Priority"}),e.jsxs(fe,{value:p.priority_level,onValueChange:_=>L("priority_level",_),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select priority"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"low",children:"Low"}),e.jsx(k,{value:"medium",children:"Medium"}),e.jsx(k,{value:"high",children:"High"}),e.jsx(k,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"budget",children:"Budget"}),e.jsx(ie,{id:"budget",type:"number",step:"0.01",min:"0",value:p.budget,onChange:_=>L("budget",_.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cost",children:"Actual Cost"}),e.jsx(ie,{id:"cost",type:"number",step:"0.01",min:"0",value:p.cost,onChange:_=>L("cost",_.target.value),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Project Tags"}),e.jsx(Ua,{value:p.tags||[],onChange:_=>L("tags",_),placeholder:"Add service-related tags..."}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tags for service categorization (e.g., software, consulting, support)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Color"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["indigo","blue","green","amber","red","purple","pink","teal"].map(_=>e.jsx("button",{type:"button",className:`w-8 h-8 rounded-full ${ne(_)} border-2 ${p.color===_?"border-black":"border-transparent"}`,onClick:()=>L("color",_)},_))})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(E,{onClick:Y,children:h?"Update Project":"Create Project"})]})]})})]})}const va=wo,Ks=c.forwardRef(({className:a,...t},s)=>e.jsx(ri,{ref:s,className:B("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a),...t}));Ks.displayName=ri.displayName;const Ct=c.forwardRef(({className:a,...t},s)=>e.jsx(ni,{ref:s,className:B("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a),...t}));Ct.displayName=ni.displayName;const Ot=c.forwardRef(({className:a,...t},s)=>e.jsx(ii,{ref:s,className:B("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...t}));Ot.displayName=ii.displayName;function ud(){const[a,t]=c.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[s,r]=c.useState(null),[n,i]=c.useState(null),[l,o]=c.useState(!1),m=(x,h)=>{t(d=>({...d,[x]:h}))},u=async x=>{if(x.preventDefault(),r(null),i(null),a.newPassword!==a.confirmPassword){r("New passwords do not match.");return}if(a.newPassword.length<8){r("New password must be at least 8 characters long.");return}o(!0);try{const h=Zt.getStoredToken();if(!h){r("You must be logged in to change your password."),o(!1);return}await Zt.changePassword(h.username,a.currentPassword,a.newPassword),i("Password changed successfully."),t({currentPassword:"",newPassword:"",confirmPassword:""})}catch(h){r(h.message||"Failed to change password. Please try again.")}finally{o(!1)}};return e.jsxs(me,{children:[e.jsxs(be,{children:[e.jsx(Ne,{children:"Change Password"}),e.jsx(kt,{children:"Update your password here. After changing, you will be logged out and will need to log in again with the new password."})]}),e.jsxs("form",{onSubmit:u,children:[e.jsxs(ue,{className:"space-y-4",children:[s&&e.jsxs(mt,{variant:"destructive",children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx(ua,{children:"Error"}),e.jsx(ut,{children:s})]}),n&&e.jsxs(mt,{variant:"default",children:[e.jsx(ua,{children:"Success"}),e.jsx(ut,{children:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"currentPassword",children:"Current Password"}),e.jsx(ie,{id:"currentPassword",type:"password",value:a.currentPassword,onChange:x=>m("currentPassword",x.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"newPassword",children:"New Password"}),e.jsx(ie,{id:"newPassword",type:"password",value:a.newPassword,onChange:x=>m("newPassword",x.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(ie,{id:"confirmPassword",type:"password",value:a.confirmPassword,onChange:x=>m("confirmPassword",x.target.value),required:!0})]})]}),e.jsx(Hs,{children:e.jsxs(E,{type:"submit",disabled:l,children:[e.jsx(li,{className:"h-4 w-4 mr-2"}),l?"Saving...":"Save Changes"]})})]})]})}function Ji(){const[a,t]=c.useState([]),[s,r]=c.useState(!0),[n,i]=c.useState("priorities"),[l,o]=c.useState(""),[m,u]=c.useState(!1),[x,h]=c.useState(null),[d,p]=c.useState(null),[j,y]=c.useState(!1),[b,F]=c.useState(null),[N,w]=c.useState({type:"priority",name:"",description:"",color:"",order:0,default:!1}),S={priorities:"priority",taskTypes:"taskType",tags:"tag",statuses:"status"};c.useEffect(()=>{n!=="account"&&v()},[n]);const v=async()=>{r(!0),p(null);try{const M=await ks.list();if(M.length===0){await D();const g=await ks.list();t(g)}else t(M)}catch(M){console.error("Failed to load attributes:",M),p("Failed to load task attributes. Please try again.")}finally{r(!1)}},D=async()=>{const M=[{type:"priority",name:"low",description:"Low priority tasks",color:"blue",order:1,default:!0},{type:"priority",name:"medium",description:"Medium priority tasks",color:"yellow",order:2,default:!0},{type:"priority",name:"high",description:"High priority tasks",color:"orange",order:3,default:!0},{type:"priority",name:"urgent",description:"Urgent priority tasks",color:"red",order:4,default:!0},{type:"taskType",name:"generic",description:"Generic tasks",color:"gray",order:1,default:!0},{type:"taskType",name:"meeting",description:"Meeting tasks",color:"blue",order:2,default:!0},{type:"taskType",name:"metric",description:"Metric tracking tasks",color:"green",order:3,default:!0},{type:"taskType",name:"action",description:"Action items",color:"purple",order:4,default:!0},{type:"status",name:"backlog",description:"Backlog tasks",color:"gray",order:1,default:!0},{type:"status",name:"todo",description:"To-do tasks",color:"blue",order:2,default:!0},{type:"status",name:"in_progress",description:"In-progress tasks",color:"yellow",order:3,default:!0},{type:"status",name:"blocked",description:"Blocked tasks",color:"red",order:4,default:!0},{type:"status",name:"done",description:"Completed tasks",color:"green",order:5,default:!0},{type:"tag",name:"design",description:"Design-related tasks",color:"purple",order:1,default:!0},{type:"tag",name:"development",description:"Development tasks",color:"blue",order:2,default:!0},{type:"tag",name:"research",description:"Research tasks",color:"green",order:3,default:!0},{type:"tag",name:"planning",description:"Planning tasks",color:"yellow",order:4,default:!0}];await ks.bulkCreate(M)},C=M=>({blue:"bg-blue-100 text-blue-800 border-blue-200",green:"bg-green-100 text-green-800 border-green-200",red:"bg-red-100 text-red-800 border-red-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",purple:"bg-purple-100 text-purple-800 border-purple-200",orange:"bg-orange-100 text-orange-800 border-orange-200",pink:"bg-pink-100 text-pink-800 border-pink-200",indigo:"bg-indigo-100 text-indigo-800 border-indigo-200",gray:"bg-gray-100 text-gray-800 border-gray-200"})[M]||"bg-gray-100 text-gray-800 border-gray-200",I=M=>{switch(M){case"priority":return e.jsx(Kr,{className:"h-4 w-4"});case"taskType":return e.jsx(Xr,{className:"h-4 w-4"});case"tag":return e.jsx(Ys,{className:"h-4 w-4"});case"status":return e.jsx(Vs,{className:"h-4 w-4"});default:return null}},R=M=>{i(M)},$=a.filter(M=>M.type!==S[n]?!1:l?M.name.toLowerCase().includes(l.toLowerCase())||M.description&&M.description.toLowerCase().includes(l.toLowerCase()):!0).sort((M,g)=>M.order-g.order),J=()=>{w({type:S[n],name:"",description:"",color:"blue",order:le(),default:!1}),h(null),u(!0)},le=()=>{const M=a.filter(Y=>Y.type===S[n]);return M.length===0?1:Math.max(...M.map(Y=>Y.order||0))+1},re=M=>{w({type:M.type,name:M.name||"",description:M.description||"",color:M.color||"blue",order:M.order||0,default:M.default||!1}),h(M),u(!0)},Z=M=>{F(M),y(!0)},z=async()=>{if(b)try{await ks.delete(b.id),await v(),y(!1),F(null)}catch(M){console.error("Failed to delete attribute:",M),p("Failed to delete attribute. Please try again.")}},ae=(M,g)=>{w(Y=>({...Y,[M]:g}))},O=async()=>{try{x?await ks.update(x.id,N):await ks.create(N),u(!1),await v()}catch(M){console.error("Failed to save attribute:",M),p("Failed to save attribute. Please try again.")}},q=[{id:"priorities",label:"Priorities",icon:Kr},{id:"taskTypes",label:"Task Types",icon:Xr},{id:"statuses",label:"Statuses",icon:Vs},{id:"tags",label:"Tags",icon:Ys},{id:"account",label:"Account",icon:Us}],L=[{id:"blue",name:"Blue"},{id:"green",name:"Green"},{id:"red",name:"Red"},{id:"yellow",name:"Yellow"},{id:"purple",name:"Purple"},{id:"orange",name:"Orange"},{id:"pink",name:"Pink"},{id:"indigo",name:"Indigo"},{id:"gray",name:"Gray"}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Settings"}),e.jsxs(va,{defaultValue:"priorities",value:n,onValueChange:R,className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx(Ks,{className:"bg-gray-100",children:q.map(M=>e.jsxs(Ct,{value:M.id,className:"flex items-center gap-2",children:[e.jsx(M.icon,{className:"h-4 w-4"}),e.jsx("span",{children:M.label})]},M.id))}),n!=="account"&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ie,{placeholder:`Search ${n}...`,value:l,onChange:M=>o(M.target.value),className:"pl-9"})]}),e.jsxs(E,{onClick:J,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add New"]})]})]}),d&&e.jsxs(mt,{variant:"destructive",className:"mb-6",children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx(ua,{children:"Error"}),e.jsx(ut,{children:d})]}),q.map(M=>e.jsx(Ot,{value:M.id,className:"space-y-4",children:M.id!=="account"?e.jsxs(me,{children:[e.jsxs(be,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(M.icon,{className:"h-5 w-5"}),M.label]}),e.jsxs(kt,{children:["Manage ",M.label.toLowerCase()," for your tasks"]})]}),e.jsx(ue,{children:s?e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading attributes..."})]}):$.length===0?e.jsx("div",{className:"text-center p-8 border border-dashed rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:l?`No ${M.label.toLowerCase()} found matching your search`:`No ${M.label.toLowerCase()} found. Add your first one!`})}):e.jsxs(fa,{children:[e.jsx(ya,{children:e.jsxs(hs,{children:[e.jsx(tt,{children:"Name"}),e.jsx(tt,{children:"Description"}),e.jsx(tt,{children:"Color"}),e.jsx(tt,{children:"Order"}),e.jsx(tt,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ja,{children:$.map(g=>e.jsxs(hs,{children:[e.jsx(st,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(te,{variant:"outline",className:C(g.color),children:[I(g.type),e.jsx("span",{className:"ml-1",children:g.name})]}),g.default&&e.jsx(te,{variant:"outline",className:"text-xs",children:"Default"})]})}),e.jsx(st,{children:g.description||"-"}),e.jsx(st,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${g.color?`bg-${g.color}-500`:"bg-gray-300"}`}),e.jsx("span",{className:"capitalize",children:g.color||"None"})]})}),e.jsx(st,{children:g.order}),e.jsx(st,{children:e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsxs(E,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})]})}),e.jsxs(Qt,{align:"end",children:[e.jsx(et,{onClick:()=>re(g),children:"Edit"}),e.jsx(et,{className:"text-red-600",onClick:()=>Z(g),children:"Delete"})]})]})})]},g.id))})]})})]}):e.jsx(ud,{})},M.id))]})]}),e.jsx(Ye,{open:m,onOpenChange:u,children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsxs(Ge,{children:[e.jsx(We,{children:x?`Edit ${N.type}`:`Create new ${N.type}`}),e.jsx(cr,{children:x?`Edit the details for this ${N.type}`:`Add a new ${N.type} for your tasks`})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Name"}),e.jsx(ie,{id:"name",value:N.name,onChange:M=>ae("name",M.target.value),placeholder:`Enter ${N.type} name`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Description"}),e.jsx(ie,{id:"description",value:N.description,onChange:M=>ae("description",M.target.value),placeholder:"Optional description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Color"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:L.map(M=>e.jsxs(E,{type:"button",variant:N.color===M.id?"default":"outline",className:"justify-start",onClick:()=>ae("color",M.id),children:[e.jsx("div",{className:`w-4 h-4 rounded-full bg-${M.id}-500 mr-2`}),M.name]},M.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"order",children:"Display Order"}),e.jsx(ie,{id:"order",type:"number",min:"1",value:N.order,onChange:M=>ae("order",parseInt(M.target.value))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Lower numbers appear first in lists"})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(E,{onClick:O,children:[e.jsx(li,{className:"h-4 w-4 mr-2"}),x?"Update":"Create"]})]})]})}),e.jsx(Ye,{open:j,onOpenChange:y,children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsxs(Ge,{children:[e.jsx(We,{children:"Confirm Deletion"}),e.jsxs(cr,{children:["Are you sure you want to delete ",b==null?void 0:b.name,"? This action cannot be undone."]})]}),e.jsxs(bt,{className:"mt-4",children:[e.jsx(E,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(E,{variant:"destructive",onClick:z,children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]})}class Bt{static async getAgendaItemsForMember(t){try{const s=await Re.list(),r=[];for(const n of s){if(!Array.isArray(n.notes))continue;const i=n.notes.filter(l=>!l.referenced_entity||typeof l.referenced_entity!="object"?!1:l.referenced_entity.type==="team_member"&&String(l.referenced_entity.id)===String(t));for(const l of i){if(!n.date||!n.id){console.warn("Malformed meeting data, skipping agenda item:",n.id);continue}const o={id:`${n.id}-${l.timestamp||Date.now()}`,meetingId:n.id,meetingDate:new Date(n.date),noteText:l.text||"[No text available]",referencedMemberId:t,createdBy:l.created_by||n.team_member_id||"Unknown",meetingOwner:n.team_member_id||"Unknown",isDiscussed:l.isDiscussed||!1,discussedAt:l.discussedAt||null,timestamp:l.timestamp||n.created_date||new Date().toISOString()};r.push(o)}}return r.sort((n,i)=>new Date(i.meetingDate)-new Date(n.meetingDate)),r}catch(s){return console.error("Error getting agenda items for member:",s),[]}}static async getAgendaSummaryForAllMembers(){try{const[t,s]=await Promise.all([Re.list(),Fe.list()]),r={};for(const n of s)r[n.id]={count:0,recentItems:[],hasUnresolved:!1};for(const n of t)if(Array.isArray(n.notes)){for(const i of n.notes)if(!(!i.referenced_entity||typeof i.referenced_entity!="object"||i.referenced_entity.type!=="team_member"||!i.referenced_entity.id)&&r[i.referenced_entity.id]){const l=i.referenced_entity.id,o=i.isDiscussed||!1;r[l].count++,o||(r[l].hasUnresolved=!0);const m={id:`${n.id}-${i.timestamp||Date.now()}`,meetingId:n.id,meetingDate:new Date(n.date),noteText:i.text,isDiscussed:o,meetingOwner:n.team_member_id};r[l].recentItems.push(m)}}for(const n in r)r[n].recentItems.sort((i,l)=>new Date(l.meetingDate)-new Date(i.meetingDate)),r[n].recentItems=r[n].recentItems.slice(0,3);return r}catch(t){return console.error("Error getting agenda summary for all members:",t),{}}}static async markAgendaItemDiscussed(t,s){try{const n=(await Re.list()).find(o=>o.id===t);if(!n||!Array.isArray(n.notes))throw new Error("Meeting or notes not found");const i=n.notes.findIndex(o=>o.timestamp===s);if(i===-1)throw new Error("Note not found");const l=[...n.notes];return l[i]={...l[i],isDiscussed:!0,discussedAt:new Date().toISOString()},await Re.update(t,{...n,notes:l}),!0}catch(r){return console.error("Error marking agenda item as discussed:",r),!1}}static async getFilteredAgendaItems(t,s=!0){try{const r=await this.getAgendaItemsForMember(t);return s?r:r.filter(n=>!n.isDiscussed)}catch(r){return console.error("Error getting filtered agenda items:",r),[]}}static async getAgendaItemsGroupedByMeeting(t){try{const s=await this.getAgendaItemsForMember(t),r={};for(const n of s)r[n.meetingId]||(r[n.meetingId]={meetingId:n.meetingId,meetingDate:n.meetingDate,meetingOwner:n.meetingOwner,items:[]}),r[n.meetingId].items.push(n);return r}catch(s){return console.error("Error grouping agenda items by meeting:",s),{}}}static async getUnresolvedItemsCount(t){try{return(await this.getFilteredAgendaItems(t,!1)).length}catch(s){return console.error("Error getting unresolved items count:",s),0}}static async getAgendaItemsForPeer(t){try{const s=await Re.list(),r=[];for(const n of s){if(!Array.isArray(n.notes))continue;const i=n.notes.filter(l=>!l.referenced_entity||typeof l.referenced_entity!="object"?!1:l.referenced_entity.type==="peer"&&String(l.referenced_entity.id)===String(t));for(const l of i){if(!n.date||!n.id)continue;const o={id:`${n.id}-${l.timestamp||Date.now()}`,meetingId:n.id,meetingDate:new Date(n.date),noteText:l.text||"[No text available]",referencedPeerId:t,createdBy:l.created_by||n.peer_id||"Unknown",meetingOwner:n.peer_id||"Unknown",isDiscussed:l.isDiscussed||!1,discussedAt:l.discussedAt||null,timestamp:l.timestamp||n.created_date||new Date().toISOString()};r.push(o)}}return r.sort((n,i)=>new Date(i.meetingDate)-new Date(n.meetingDate)),r}catch(s){return console.error("Error getting agenda items for peer:",s),[]}}static async getAgendaSummaryForAllPeers(){try{const[t,s]=await Promise.all([Re.list(),Xt(()=>Promise.resolve().then(()=>Oi),void 0).then(n=>n.Peer.list())]),r={};for(const n of s)r[n.id]={count:0,recentItems:[],hasUnresolved:!1};for(const n of t)if(Array.isArray(n.notes)){for(const i of n.notes)if(!(!i.referenced_entity||typeof i.referenced_entity!="object"||i.referenced_entity.type!=="peer"||!i.referenced_entity.id)&&r[i.referenced_entity.id]){const l=i.referenced_entity.id,o=i.isDiscussed||!1;r[l].count++,o||(r[l].hasUnresolved=!0);const m={id:`${n.id}-${i.timestamp||Date.now()}`,meetingId:n.id,meetingDate:new Date(n.date),noteText:i.text,isDiscussed:o,meetingOwner:n.peer_id};r[l].recentItems.push(m)}}for(const n in r)r[n].recentItems.sort((i,l)=>new Date(l.meetingDate)-new Date(i.meetingDate)),r[n].recentItems=r[n].recentItems.slice(0,3);return r}catch(t){return console.error("Error getting agenda summary for all peers:",t),{}}}static async getFilteredAgendaItemsForPeer(t,s=!0){try{const r=await this.getAgendaItemsForPeer(t);return s?r:r.filter(n=>!n.isDiscussed)}catch(r){return console.error("Error getting filtered agenda items for peer:",r),[]}}static async getAgendaItemsGroupedByMeetingForPeer(t){try{const s=await this.getAgendaItemsForPeer(t),r={};for(const n of s)r[n.meetingId]||(r[n.meetingId]={meetingId:n.meetingId,meetingDate:n.meetingDate,meetingOwner:n.meetingOwner,items:[]}),r[n.meetingId].items.push(n);return r}catch(s){return console.error("Error grouping agenda items by meeting for peer:",s),{}}}static async getUnresolvedItemsCountForPeer(t){try{return(await this.getFilteredAgendaItemsForPeer(t,!1)).length}catch(s){return console.error("Error getting unresolved items count for peer:",s),0}}}function Zi({count:a=0,unresolvedCount:t=0,hasUnresolved:s=!1,onClick:r,memberName:n="",size:i="default",showIcon:l=!0,className:o=""}){if(a===0)return null;const m=typeof r=="function",u=t>0,x=()=>{const b="transition-all duration-200",F={sm:"text-xs px-2 py-0.5",default:"text-xs px-2.5 py-0.5",lg:"text-sm px-3 py-1"};let N="";u?N="bg-orange-100 text-orange-800 border-orange-200 hover:bg-orange-200":N="bg-green-100 text-green-800 border-green-200 hover:bg-green-200";const w=m?"cursor-pointer hover:shadow-sm active:scale-95":"";return B(b,F[i],N,w,o)},h=()=>{if(!l)return null;const b=i==="sm"?"h-3 w-3":"h-3.5 w-3.5";return u?e.jsx(Ze,{className:B(b,"mr-1")}):e.jsx(Yt,{className:B(b,"mr-1")})},d=()=>u?`${t} pending`:`${a} item${a!==1?"s":""}`,p=()=>{const b=a===1?"agenda item":"agenda items",F=u?`${t} pending`:"all resolved";return`${n} has ${a} ${b}, ${F}${m?". Click to view details.":""}`},j=m?E:"div",y=m?{variant:"ghost",size:"sm",onClick:r,className:B("h-auto p-0 hover:bg-transparent",x()),"aria-label":p()}:{className:x(),"aria-label":p()};return e.jsx(j,{...y,children:e.jsxs("div",{className:"flex items-center",children:[h(),e.jsx("span",{className:"font-medium",children:d()})]})})}const hd=({open:a,onOpenChange:t,teamMember:s,onConfirm:r,onCancel:n})=>{const[i,l]=c.useState([]),[o,m]=c.useState([]),[u,x]=c.useState("archive"),[h,d]=c.useState(!1),[p,j]=c.useState(!1),[y,b]=c.useState(!0);c.useEffect(()=>{a&&s&&F()},[a,s]);const F=async()=>{b(!0);try{const[v,D]=await Promise.all([Rs.getByTeamMember(s.id),zt.getByTeamMember(s.id)]);l(v),m(D)}catch(v){console.error("Error loading related data:",v),nt.error("Failed to load related data")}finally{b(!1)}},N=async()=>{if(!h){nt.error("Please confirm that you want to delete this team member");return}j(!0);try{if(u==="delete")await Promise.all([...i.map(v=>Rs.delete(v.id)),...o.map(v=>zt.delete(v.id))]),yt(jt.DELETE,vt.PERSONAL_FILE_ITEM,"bulk_delete",{operation:"team_member_deletion",teamMemberId:s.id,teamMemberName:s.name,deletedItemsCount:i.length,dataHandling:"delete"}),yt(jt.DELETE,vt.AGENDA_ITEM,"bulk_delete",{operation:"team_member_deletion",teamMemberId:s.id,teamMemberName:s.name,deletedItemsCount:o.length,dataHandling:"delete"});else if(u==="archive"){const v={archived:!0,archivedAt:new Date().toISOString()};await Promise.all([...i.map(D=>Rs.update(D.id,v)),...o.map(D=>zt.update(D.id,v))]),yt(jt.UPDATE,vt.PERSONAL_FILE_ITEM,"bulk_archive",{operation:"team_member_deletion",teamMemberId:s.id,teamMemberName:s.name,archivedItemsCount:i.length,dataHandling:"archive"}),yt(jt.UPDATE,vt.AGENDA_ITEM,"bulk_archive",{operation:"team_member_deletion",teamMemberId:s.id,teamMemberName:s.name,archivedItemsCount:o.length,dataHandling:"archive"})}yt(jt.DELETE,vt.TEAM_MEMBER,s.id,{operation:"delete_team_member",teamMemberName:s.name,dataHandling:u,personalFileItemsCount:i.length,agendaItemsCount:o.length}),await r(s.id,u),nt.success(`Team member deleted successfully. Data was ${u==="delete"?"deleted":u==="archive"?"archived":"preserved"}.`),d(!1),x("archive")}catch(v){console.error("Error deleting team member:",v),nt.error("Failed to delete team member. Please try again.")}finally{j(!1)}},w=()=>{d(!1),x("archive"),n()};if(!s)return null;const S=i.length>0||o.length>0;return e.jsx(Ye,{open:a,onOpenChange:t,children:e.jsxs(Be,{className:"max-w-2xl",children:[e.jsx(Ge,{children:e.jsxs(We,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5 text-red-500"}),"Delete Team Member"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(mt,{children:[e.jsx(us,{className:"h-4 w-4"}),e.jsxs(ut,{children:["You are about to delete ",e.jsx("strong",{children:s.name}),". This action cannot be undone."]})]}),y?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2",children:"Loading related data..."})]}):S?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-yellow-800 mb-2",children:"Related Data Found"}),e.jsxs("div",{className:"space-y-2 text-sm text-yellow-700",children:[i.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-4 w-4"}),e.jsxs("span",{children:[i.length," personal file item(s)"]})]}),o.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsxs("span",{children:[o.length," agenda item(s)"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{className:"text-base font-medium",children:"What should happen to this data?"}),e.jsxs(Ir,{value:u,onValueChange:x,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{value:"archive",id:"archive"}),e.jsxs(V,{htmlFor:"archive",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(bo,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Archive data"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Keep data but mark it as archived (recommended)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{value:"keep",id:"keep"}),e.jsxs(V,{htmlFor:"keep",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ws,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Keep data active"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Preserve all data in its current state"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{value:"delete",id:"delete"}),e.jsxs(V,{htmlFor:"delete",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(Dt,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Delete all data"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Permanently remove all related data (cannot be undone)"})]})]})]})]})]})]}):e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-800",children:"No related personal file items or agenda items found."})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Tr,{id:"confirm",checked:h,onCheckedChange:d}),e.jsxs(V,{htmlFor:"confirm",className:"text-sm",children:["I understand that this action cannot be undone and confirm the deletion of"," ",e.jsx("strong",{children:s.name})]})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:w,disabled:p,children:"Cancel"}),e.jsx(E,{variant:"destructive",onClick:N,disabled:!h||p,children:p?"Deleting...":"Delete Team Member"})]})]})})};function el(){const a=Ba(),[t,s]=c.useState([]),[r,n]=c.useState([]),[i,l]=c.useState({}),[o,m]=c.useState(""),[u,x]=c.useState(!1),[h,d]=c.useState(null),[p,j]=c.useState(!0),[y,b]=c.useState(!1),[F,N]=c.useState(null),[w,S]=c.useState(null),[v,D]=c.useState({name:"",role:"",email:"",phone:"",department:"",availability:"full_time",skills:[],notes:"",avatar:""});c.useEffect(()=>{C()},[]);const C=async()=>{j(!0),S(null);try{const g=await Fe.list().catch(()=>[]),Y=await xt.list().catch(()=>[]);s(Y||[]);let W={};try{W=await Bt.getAgendaSummaryForAllMembers()}catch(ce){console.error("Failed to load agenda data:",ce)}l(W);const ne=(g||[]).map(ce=>{const _e=(Y||[]).filter($e=>{var Ft,ft;return(((ft=(Ft=$e.metadata)==null?void 0:Ft.meeting)==null?void 0:ft.participants)||[]).includes(ce.name)});let qe=null;_e.length>0&&(qe=_e.reduce(($e,Ft)=>{const ft=new Date(Ft.created_date);return!$e||ft>$e?ft:$e},null));const Te=W[ce.id]||{count:0,recentItems:[],hasUnresolved:!1};return{...ce,tasks:_e,taskCount:_e.length,lastActivity:qe?qe.toISOString():null,agenda:Te}});n(ne)}catch(g){console.error("Failed to load team members:",g),S("Failed to load team members. Please try again.")}finally{j(!1)}},I=()=>{D({name:"",role:"",email:"",phone:"",department:"",availability:"full_time",skills:[],notes:"",avatar:""}),d(null),x(!0)},R=g=>{g&&(D({name:g.name||"",role:g.role||"",email:g.email||"",phone:g.phone||"",department:g.department||"",availability:g.availability||"full_time",skills:Array.isArray(g.skills)?g.skills:[],notes:g.notes||"",avatar:g.avatar||""}),d(g),x(!0))},$=(g,Y)=>{if(g==="skills"){const W=Array.isArray(Y)?Y:[];D(ne=>({...ne,[g]:W}))}else D(W=>({...W,[g]:Y}))},J=async()=>{try{let g;const Y=h?{...h}:null;if(h){g=await Fe.update(h.id,v);try{await na.handleTeamMemberUpdate(h.id,g,Y)}catch(W){console.error("Failed to update birthday events:",W)}}else{g=await Fe.create(v);try{await na.handleTeamMemberCreation(g)}catch(W){console.error("Failed to generate birthday events:",W)}}x(!1),await C()}catch(g){console.error("Failed to save team member:",g),S("Failed to save team member. Please try again.")}},le=g=>{N(g),b(!0)},re=async(g,Y)=>{try{try{await na.handleTeamMemberDeletion(g)}catch(W){console.error("Failed to clean up calendar events:",W)}await Fe.delete(g),b(!1),N(null),await C()}catch(W){console.error("Failed to delete team member:",W),S("Failed to delete team member. Please try again.")}},Z=()=>{b(!1),N(null)},z=o?r.filter(g=>g.name.toLowerCase().includes(o.toLowerCase())||(g.role||"").toLowerCase().includes(o.toLowerCase())||(g.department||"").toLowerCase().includes(o.toLowerCase())||Array.isArray(g.skills)&&g.skills.some(Y=>Y.toLowerCase().includes(o.toLowerCase()))):r,ae=g=>g.split(" ").map(Y=>Y[0]).join("").toUpperCase().substring(0,2),O=g=>{const Y=["bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-purple-100 text-purple-800","bg-pink-100 text-pink-800","bg-yellow-100 text-yellow-800","bg-indigo-100 text-indigo-800","bg-red-100 text-red-800","bg-orange-100 text-orange-800"],W=g.split("").reduce((ne,ce)=>ne+ce.charCodeAt(0),0)%Y.length;return Y[W]},q=g=>{if(!g)return"No recent activity";const Y=new Date(g),ne=new Date-Y,ce=Math.floor(ne/(1e3*60*60*24));return ce===0?"Today":ce===1?"Yesterday":ce<7?`${ce} days ago`:ce<30?`${Math.floor(ce/7)} week${Math.floor(ce/7)>1?"s":""} ago`:ce<365?`${Math.floor(ce/30)} month${Math.floor(ce/30)>1?"s":""} ago`:`${Math.floor(ce/365)} year${Math.floor(ce/365)>1?"s":""} ago`},L=g=>{const Y={full_time:"bg-green-100 text-green-800",part_time:"bg-blue-100 text-blue-800",contractor:"bg-orange-100 text-orange-800",remote:"bg-purple-100 text-purple-800"},W={full_time:"Full-time",part_time:"Part-time",contractor:"Contractor",remote:"Remote"};return e.jsx(te,{className:Y[g]||"bg-gray-100 text-gray-800",children:W[g]||g})},M=g=>{a(qt("TeamMemberProfile")+`?id=${g}`)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Team Members"}),e.jsxs(E,{onClick:I,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add Team Member"]})]}),w&&e.jsx(mt,{variant:"destructive",className:"mb-6",children:e.jsx(ut,{children:w})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ie,{placeholder:"Search team members by name, role, department, or skills...",value:o,onChange:g=>m(g.target.value),className:"pl-9"})]}),p?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading team members..."})]}):z.length===0?e.jsx("div",{className:"text-center p-12 border border-dashed rounded-lg",children:o?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No team members found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search term"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No team members yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add team members to track participants in meetings and collaboration"}),e.jsxs(E,{onClick:I,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add First Team Member"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:z.map(g=>{const Y=O(g.name);return e.jsxs(me,{className:"overflow-hidden",children:[e.jsxs(be,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 cursor-pointer group",onClick:()=>M(g.id),children:[e.jsxs(bs,{className:`h-12 w-12 ${g.avatar?"":Y} ring-2 ring-white transition-transform group-hover:scale-105`,children:[g.avatar?e.jsx(pa,{src:g.avatar,alt:g.name}):null,e.jsx(Ns,{children:ae(g.name)})]}),e.jsxs("div",{children:[e.jsx(Ne,{className:"group-hover:text-indigo-600 transition-colors",children:g.name}),g.role&&e.jsx(kt,{className:"mt-1",children:g.role})]})]}),e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(La,{className:"h-4 w-4"})})}),e.jsxs(Qt,{align:"end",children:[e.jsxs(et,{onClick:()=>R(g),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(et,{onClick:()=>le(g),className:"text-red-600",children:[e.jsx(Dt,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[g.department&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(oi,{className:"h-3 w-3"}),g.department]}),g.availability&&L(g.availability),g.agenda&&e.jsx(Zi,{count:g.agenda.count,unresolvedCount:g.agenda.hasUnresolved?g.agenda.count:0,hasUnresolved:g.agenda.hasUnresolved,onClick:()=>M(g.id),memberName:g.name,size:"sm"})]})]}),e.jsxs(ue,{className:"space-y-4",children:[Array.isArray(g.skills)&&g.skills.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(ci,{className:"h-3.5 w-3.5"}),"Skills"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Array.isArray(g.skills)&&g.skills.map((W,ne)=>e.jsx(te,{variant:"outline",className:"text-xs",children:W},ne))})]}),g.notes&&e.jsx("p",{className:"text-sm text-gray-600",children:g.notes}),Array.isArray(g.tasks)&&g.tasks.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Recent Meetings"}),e.jsx("div",{className:"space-y-2",children:g.tasks.filter(W=>W.type==="meeting").sort((W,ne)=>new Date(ne.created_date)-new Date(W.created_date)).slice(0,2).map(W=>e.jsx("div",{className:"p-2 bg-gray-50 rounded-md text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"truncate",children:W.title}),e.jsxs(te,{variant:"outline",className:"ml-2 flex items-center gap-1 whitespace-nowrap",children:[e.jsx(di,{className:"h-3 w-3"}),W.status]})]})},W.id))})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),q(g.lastActivity)]}),g.taskCount>0&&e.jsxs("span",{children:[g.taskCount," meetings"]})]})]}),g.email&&e.jsx(Hs,{className:"border-t pt-4",children:e.jsxs("a",{href:`mailto:${g.email}`,className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(mi,{className:"h-3.5 w-3.5"}),g.email]})})]},g.id)})})]}),e.jsx(Ye,{open:u,onOpenChange:x,children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsx(Ge,{children:e.jsx(We,{children:h?"Edit Team Member":"Add Team Member"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Name"}),e.jsx(ie,{id:"name",value:v.name,onChange:g=>$("name",g.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"role",children:"Role / Position"}),e.jsx(ie,{id:"role",value:v.role,onChange:g=>$("role",g.target.value),placeholder:"e.g. Product Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"department",children:"Department"}),e.jsx(ie,{id:"department",value:v.department,onChange:g=>$("department",g.target.value),placeholder:"e.g. Engineering"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"email",children:"Email"}),e.jsx(ie,{id:"email",type:"email",value:v.email,onChange:g=>$("email",g.target.value),placeholder:"Email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"phone",children:"Phone"}),e.jsx(ie,{id:"phone",type:"tel",value:v.phone,onChange:g=>$("phone",g.target.value),placeholder:"Phone number"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"availability",children:"Availability"}),e.jsxs(fe,{value:v.availability,onValueChange:g=>$("availability",g),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select availability"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"full_time",children:"Full-time"}),e.jsx(k,{value:"part_time",children:"Part-time"}),e.jsx(k,{value:"contractor",children:"Contractor"}),e.jsx(k,{value:"remote",children:"Remote"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"skills",children:"Skills"}),e.jsx(Ua,{value:v.skills||[],onChange:g=>$("skills",g),placeholder:"Enter skills, press Enter or comma to add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Enter or comma after each skill"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"avatar",children:"Avatar URL (optional)"}),e.jsx(ie,{id:"avatar",value:v.avatar,onChange:g=>$("avatar",g.target.value),placeholder:"https://example.com/avatar.jpg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"notes",children:"Notes"}),e.jsx(Rt,{id:"notes",value:v.notes,onChange:g=>$("notes",g.target.value),placeholder:"Additional information about this team member",rows:3})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(E,{onClick:J,children:h?"Update":"Add"})]})]})}),e.jsx(hd,{open:y,onOpenChange:b,teamMember:F,onConfirm:re,onCancel:Z})]})}function ar({icon:a,title:t,subtitle:s,timestamp:r,variant:n="default"}){return e.jsxs("div",{className:"flex gap-4 pb-8 last:pb-0",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:B("rounded-full p-2",n==="outline"?"border-2 border-gray-200":"bg-gray-100"),children:a}),e.jsx("div",{className:"flex-1 w-px bg-gray-200 my-2"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t}),s&&e.jsx("div",{className:"text-sm text-gray-500",children:s}),e.jsx("div",{className:"text-xs text-gray-400",children:r})]})]})}function xd({children:a}){return e.jsx("div",{className:"space-y-4",children:a})}function tl(){var Z;const[a]=Or(),t=a.get("id"),[s,r]=c.useState(null),[n,i]=c.useState([]),[l,o]=c.useState([]),[m,u]=c.useState(!0),[x,h]=c.useState(!1),[d,p]=c.useState([]),[j,y]=c.useState([]),[b,F]=c.useState(!1),[N,w]=c.useState(""),[S,v]=c.useState(null),[D,C]=c.useState(!1);c.useEffect(()=>{t&&I()},[t]);const I=async()=>{u(!0);try{const z=await Pt.get(t);r(z);const O=(await xt.list()).filter(M=>M.project===z.name);i(O);const[q,L]=await Promise.all([cs.list(),Fe.list()]);p(q),o(L),z.stakeholders&&y(z.stakeholders),R(z,O)}catch(z){console.error("Error loading project data:",z)}finally{u(!1)}},R=async(z,ae)=>{C(!0);try{const O=ae.filter(Y=>Y.status==="done").length,q=ae.length,L=await kr({prompt:`Analyze this project's status and provide next steps:
          Project: ${z.name}
          Description: ${z.description||"No description provided"}
          Status: ${z.status}
          Progress: ${O}/${q} tasks completed
          User Comments: ${N||"No comments provided"}
          
          Provide a comprehensive analysis including current status, challenges, and recommended next steps.`,response_json_schema:{type:"object",properties:{currentStatus:{type:"string"},challenges:{type:"array",items:{type:"string"}},nextSteps:{type:"array",items:{type:"string"}}},required:["currentStatus","challenges","nextSteps"]}}),M={...L,date:new Date().toISOString()},g=z.analyses?[...z.analyses,M]:[M];await Pt.update(t,{...z,analyses:g}),r(Y=>({...Y,analyses:g})),v(L)}catch(O){console.error("Failed to analyze project:",O),v({currentStatus:"Analysis currently unavailable",challenges:["Unable to analyze project status"],nextSteps:["Please try again later"]})}finally{C(!1)}},$=async z=>{try{await Pt.update(t,{...s,status:z}),r(ae=>({...ae,status:z})),I()}catch(ae){console.error("Error updating project status:",ae)}},J=async z=>{try{await xt.create({...z,project:s.name}),h(!1),I()}catch(ae){console.error("Error creating task:",ae)}},le=async z=>{try{await Pt.update(t,{...s,stakeholders:z}),y(z),F(!1),I()}catch(ae){console.error("Error updating stakeholders:",ae)}},re=z=>{const ae={not_started:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",on_hold:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800"};return ae[z]||ae.not_started};return m?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"})}):s?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ca,{to:"/projects",children:e.jsxs(E,{variant:"ghost",children:[e.jsx(xa,{className:"h-4 w-4 mr-2"}),"Back to Projects"]})}),e.jsx("h1",{className:"text-3xl font-bold",children:s.name}),e.jsx(te,{className:re(s.status),children:s.status.replace("_"," ").toUpperCase()})]}),e.jsxs(fe,{value:s.status,onValueChange:$,children:[e.jsx(xe,{className:"w-[180px]",children:e.jsx(je,{placeholder:"Change Status"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"not_started",children:"Not Started"}),e.jsx(k,{value:"in_progress",children:"In Progress"}),e.jsx(k,{value:"on_hold",children:"On Hold"}),e.jsx(k,{value:"completed",children:"Completed"})]})]})]}),e.jsxs(va,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Ks,{children:[e.jsx(Ct,{value:"overview",children:"Overview"}),e.jsx(Ct,{value:"tasks",children:"Tasks"}),e.jsx(Ct,{value:"timeline",children:"Timeline"}),e.jsx(Ct,{value:"stakeholders",children:"Stakeholders"})]}),e.jsx(Ot,{value:"overview",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(me,{children:[e.jsx(be,{children:e.jsx(Ne,{children:"Project Information"})}),e.jsxs(ue,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1",children:s.description||"No description provided"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Owner"}),e.jsx("p",{className:"mt-1",children:s.owner||"No owner assigned"})]}),l.length>0&&e.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Add to team member agendas:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.slice(0,3).map(z=>e.jsx(ts,{teamMemberId:z.id,teamMemberName:z.name,sourceItem:{title:`Project: ${s.name}`,description:`${s.description||""} | Status: ${s.status}${s.owner?` | Owner: ${s.owner}`:""}`,type:"project",id:s.id,status:s.status,start_date:s.start_date,end_date:s.end_date},variant:"outline",size:"sm",showAgendaAction:!0,showPersonalFileAction:!0},z.id)),l.length>3&&e.jsxs("span",{className:"text-xs text-gray-400 self-center",children:["+",l.length-3," more"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Dates"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:[s.start_date?Q(H(s.start_date),"MMM d, yyyy"):"Not set"," - ",s.end_date?Q(H(s.end_date),"MMM d, yyyy"):"Not set"]})]})]})]})]}),e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(ai,{className:"h-5 w-5"}),"AI Analysis"]}),e.jsx(E,{onClick:()=>R(s,n),disabled:D,children:D?"Analyzing...":"Run New Analysis"})]})}),e.jsx(ue,{children:e.jsx(Ga,{className:"h-[400px]",children:(Z=s==null?void 0:s.analyses)==null?void 0:Z.map((z,ae)=>e.jsx("div",{className:"mb-6 last:mb-0",children:e.jsxs("div",{className:"bg-blue-50 rounded-md p-4",children:[e.jsx("p",{className:"text-blue-900",children:z.currentStatus}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-blue-800",children:"Challenges:"}),e.jsx("ul",{className:"list-disc pl-4 mt-1 space-y-1",children:z.challenges.map((O,q)=>e.jsx("li",{className:"text-blue-800",children:O},q))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-blue-800",children:"Next Steps:"}),e.jsx("ul",{className:"list-disc pl-4 mt-1 space-y-1",children:z.nextSteps.map((O,q)=>e.jsx("li",{className:"text-blue-800",children:O},q))})]}),e.jsxs("div",{className:"mt-4 text-sm text-blue-600",children:["Analysis performed: ",Q(H(z.date),"PPp")]})]})},ae))})})]})]})}),e.jsx(Ot,{value:"tasks",children:e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ne,{children:"Tasks"}),e.jsxs(E,{onClick:()=>h(!0),children:[e.jsx(No,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})}),e.jsx(ue,{children:e.jsx(Fi,{tasks:n,onStatusChange:(z,ae)=>{I()},groupBy:"status"})})]})}),e.jsx(Ot,{value:"timeline",children:e.jsxs(me,{children:[e.jsx(be,{children:e.jsx(Ne,{children:"Project Timeline"})}),e.jsx(ue,{children:e.jsxs(xd,{children:[e.jsx(ar,{icon:e.jsx(_o,{className:"h-4 w-4"}),title:"Project Created",timestamp:Q(H(s.created_date),"PPpp")}),n.map(z=>e.jsx(ar,{icon:e.jsx(Vs,{className:"h-4 w-4"}),title:z.title,subtitle:`Status: ${z.status}`,timestamp:Q(H(z.updated_date),"PPpp")},z.id)),s.end_date&&e.jsx(ar,{icon:e.jsx(Ee,{className:"h-4 w-4"}),title:"Target Completion",timestamp:Q(H(s.end_date),"PPp"),variant:"outline"})]})})]})}),e.jsx(Ot,{value:"stakeholders",children:e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ne,{children:"Stakeholders"}),e.jsxs(E,{onClick:()=>F(!0),children:[e.jsx(Nn,{className:"h-4 w-4 mr-2"}),"Manage Stakeholders"]})]})}),e.jsx(ue,{children:j.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No stakeholders assigned"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(z=>{const ae=d.find(O=>O.id===z);return ae?e.jsx(me,{children:e.jsx(ue,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:ae.name}),e.jsx("p",{className:"text-sm text-gray-500",children:ae.role})]})]})})},ae.id):null})})})]})})]}),e.jsx(Ye,{open:x,onOpenChange:h,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Add New Task"})}),e.jsx(za,{onCreateTask:J,initialTaskData:{project:s.name,status:"todo"}})]})}),e.jsx(Ye,{open:b,onOpenChange:F,children:e.jsxs(Be,{children:[e.jsx(Ge,{children:e.jsx(We,{children:"Manage Stakeholders"})}),e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:"space-y-4",children:d.map(z=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:j.includes(z.id),onChange:ae=>{ae.target.checked?y([...j,z.id]):y(j.filter(O=>O!==z.id))},className:"rounded border-gray-300"}),e.jsxs("label",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:z.name}),z.department&&e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",z.department,")"]})]})]},z.id))}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(E,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(E,{onClick:()=>le(j),children:"Save Changes"})]})]})]})})]})}):e.jsx("div",{className:"p-6",children:e.jsx(me,{children:e.jsxs(ue,{className:"text-center py-6",children:[e.jsx(us,{className:"h-12 w-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Project Not Found"}),e.jsx("p",{className:"text-gray-500",children:"The requested project could not be found."})]})})})}const gd=({item:a,onComplete:t,onMove:s,onEdit:r,onDelete:n,showActions:i=!0,className:l=""})=>{const o=j=>{switch(j){case 1:return"bg-red-100 text-red-800 border-red-200";case 2:return"bg-yellow-100 text-yellow-800 border-yellow-200";case 3:return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},m=j=>{switch(j){case 1:return"High";case 2:return"Medium";case 3:return"Low";default:return"Medium"}},u=j=>{switch(j){case"pending":return"bg-yellow-100 text-yellow-800";case"discussed":return"bg-green-100 text-green-800";case"moved":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},x=()=>{t&&a.status==="pending"&&t(a)},h=()=>{s&&a.status==="pending"&&s(a)},d=()=>{r&&r(a)},p=()=>{n&&n(a)};return e.jsx(me,{className:`transition-all hover:shadow-md ${l}`,children:e.jsx(ue,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h4",{className:"font-medium text-foreground leading-tight flex-1 mr-3",children:a.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(te,{variant:"outline",className:o(a.priority),children:[e.jsx(ms,{className:"h-3 w-3 mr-1"}),m(a.priority)]}),e.jsxs(te,{variant:a.status==="discussed"?"secondary":"outline",className:u(a.status),children:[a.status==="pending"&&e.jsx(Ze,{className:"h-3 w-3 mr-1"}),a.status==="discussed"&&e.jsx(Yt,{className:"h-3 w-3 mr-1"}),a.status==="moved"&&e.jsx(Pa,{className:"h-3 w-3 mr-1"}),a.status.charAt(0).toUpperCase()+a.status.slice(1)]})]})]}),a.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:e.jsx("p",{children:a.description})}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:a.tags.map((j,y)=>e.jsx(te,{variant:"secondary",className:"text-xs",children:j},y))}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created ",Q(new Date(a.createdAt),"MMM d, yyyy"),a.updatedAt!==a.createdAt&&e.jsxs("span",{children:[" • Updated ",Q(new Date(a.updatedAt),"MMM d, yyyy")]})]}),i&&e.jsxs("div",{className:"flex items-center gap-1",children:[a.status==="pending"&&t&&e.jsxs(E,{variant:"outline",size:"sm",onClick:x,className:"h-7 px-3 text-xs",children:[e.jsx(Yt,{className:"h-3 w-3 mr-1"}),"Complete"]}),a.status==="pending"&&s&&e.jsxs(E,{variant:"outline",size:"sm",onClick:h,className:"h-7 px-3 text-xs",children:[e.jsx(Pa,{className:"h-3 w-3 mr-1"}),"Move"]}),r&&e.jsxs(E,{variant:"ghost",size:"sm",onClick:d,className:"h-7 px-3 text-xs",children:[e.jsx(ds,{className:"h-3 w-3 mr-1"}),"Edit"]}),n&&e.jsxs(E,{variant:"ghost",size:"sm",onClick:p,className:"h-7 px-3 text-xs text-destructive hover:text-destructive",children:[e.jsx(Dt,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})]})})})},Pr=({size:a="md",className:t="",text:s="",showText:r=!1,variant:n="primary"})=>{const i={xs:"h-3 w-3",sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8",xl:"h-12 w-12"},l={primary:"text-indigo-600",secondary:"text-gray-600",white:"text-white",muted:"text-gray-400"},o={xs:"text-xs",sm:"text-sm",md:"text-base",lg:"text-lg",xl:"text-xl"};return e.jsxs("div",{className:B("flex items-center justify-center",t),children:[e.jsx($n,{className:B("animate-spin",i[a],l[n])}),(r||s)&&e.jsx("span",{className:B("ml-2",o[a],l[n]),children:s||"Loading..."})]})},la=({items:a=[],loading:t=!1,onComplete:s,onMove:r,onEdit:n,onDelete:i,showActions:l=!0,emptyMessage:o="No agenda items found",emptyDescription:m="Agenda items will appear here once they are added."})=>{const[u,x]=c.useState(""),[h,d]=c.useState("createdAt"),[p,j]=c.useState("desc"),[y,b]=c.useState("all"),[F,N]=c.useState("all"),w=c.useMemo(()=>{let S=a;if(u){const v=u.toLowerCase();S=S.filter(D=>D.title.toLowerCase().includes(v)||D.description&&D.description.toLowerCase().includes(v)||D.tags&&D.tags.some(C=>C.toLowerCase().includes(v)))}return y!=="all"&&(S=S.filter(v=>v.status===y)),F!=="all"&&(S=S.filter(v=>v.priority===parseInt(F))),S.sort((v,D)=>{let C,I;switch(h){case"title":C=v.title.toLowerCase(),I=D.title.toLowerCase();break;case"priority":C=v.priority,I=D.priority;break;case"status":C=v.status,I=D.status;break;case"updatedAt":C=new Date(v.updatedAt),I=new Date(D.updatedAt);break;case"createdAt":default:C=new Date(v.createdAt),I=new Date(D.createdAt);break}return p==="asc"?C<I?-1:C>I?1:0:C>I?-1:C<I?1:0}),S},[a,u,h,p,y,F]);return t?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Pr,{}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading agenda items..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"Search agenda items...",value:u,onChange:S=>x(S.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(fe,{value:y,onValueChange:b,children:[e.jsxs(xe,{className:"w-32",children:[e.jsx(Va,{className:"h-4 w-4 mr-2"}),e.jsx(je,{})]}),e.jsxs(ge,{children:[e.jsx(k,{value:"all",children:"All Status"}),e.jsx(k,{value:"pending",children:"Pending"}),e.jsx(k,{value:"discussed",children:"Discussed"}),e.jsx(k,{value:"moved",children:"Moved"})]})]}),e.jsxs(fe,{value:F,onValueChange:N,children:[e.jsxs(xe,{className:"w-32",children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),e.jsx(je,{})]}),e.jsxs(ge,{children:[e.jsx(k,{value:"all",children:"All Priority"}),e.jsx(k,{value:"1",children:"High"}),e.jsx(k,{value:"2",children:"Medium"}),e.jsx(k,{value:"3",children:"Low"})]})]}),e.jsxs(fe,{value:`${h}-${p}`,onValueChange:S=>{const[v,D]=S.split("-");d(v),j(D)},children:[e.jsxs(xe,{className:"w-40",children:[e.jsx(Pa,{className:"h-4 w-4 mr-2"}),e.jsx(je,{})]}),e.jsxs(ge,{children:[e.jsx(k,{value:"createdAt-desc",children:"Newest First"}),e.jsx(k,{value:"createdAt-asc",children:"Oldest First"}),e.jsx(k,{value:"updatedAt-desc",children:"Recently Updated"}),e.jsx(k,{value:"priority-asc",children:"Priority: High to Low"}),e.jsx(k,{value:"priority-desc",children:"Priority: Low to High"}),e.jsx(k,{value:"title-asc",children:"Title: A to Z"}),e.jsx(k,{value:"title-desc",children:"Title: Z to A"}),e.jsx(k,{value:"status-asc",children:"Status: A to Z"})]})]})]})]}),a.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",w.length," of ",a.length," agenda items"]}),w.length===0?e.jsx(Mr,{icon:Ze,title:a.length===0?o:"No matching items",description:a.length===0?m:"Try adjusting your search or filters"}):e.jsx("div",{className:"space-y-3",children:w.map(S=>e.jsx(gd,{item:S,onComplete:s,onMove:r,onEdit:n,onDelete:i,showActions:l},S.id))})]})},pd=({teamMemberId:a,teamMemberName:t})=>{const[s,r]=c.useState([]),[n,i]=c.useState(!0),[l,o]=c.useState(!1),[m,u]=c.useState("pending");c.useEffect(()=>{x()},[a]);const x=async()=>{i(!0);try{const j=await zt.getByTeamMember(a);r(j)}catch(j){console.error("Error loading agenda items:",j)}finally{i(!1)}},h=async()=>{o(!1),await x()},d=async j=>{try{await zt.update(j.id,{status:"discussed"}),await x()}catch(y){console.error("Error marking agenda item as discussed:",y)}},p=s.filter(j=>m==="pending"?j.status==="pending":m==="discussed"?j.status==="discussed":!0);return e.jsxs(me,{className:"w-full",children:[e.jsxs(be,{className:"flex flex-row items-center justify-between",children:[e.jsx(Ne,{children:"1:1 Agenda"}),e.jsxs(E,{onClick:()=>o(!0),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),e.jsx(ue,{children:e.jsxs(va,{defaultValue:"pending",value:m,onValueChange:u,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs(Ks,{children:[e.jsx(Ct,{value:"pending",children:"Pending"}),e.jsx(Ct,{value:"discussed",children:"Discussed"}),e.jsx(Ct,{value:"all",children:"All"})]})}),e.jsx(Ot,{value:"pending",className:"mt-0",children:n?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(la,{items:p,loading:n,onComplete:d,emptyMessage:"No pending agenda items",emptyDescription:"Add items to discuss in your next 1:1 meeting."})}),e.jsx(Ot,{value:"discussed",className:"mt-0",children:n?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(la,{items:p,loading:n,showActions:!1,emptyMessage:"No discussed agenda items",emptyDescription:"Items marked as discussed will appear here."})}),e.jsx(Ot,{value:"all",className:"mt-0",children:n?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(la,{items:p,loading:n,onComplete:d,emptyMessage:"No agenda items found",emptyDescription:"All agenda items for this team member will appear here."})})]})}),e.jsx(Ye,{open:l,onOpenChange:o,children:e.jsxs(Be,{children:[e.jsx(Ge,{children:e.jsx(We,{children:"Add to 1:1 Agenda"})}),e.jsx(Ar,{teamMemberId:a,onSubmit:h,onCancel:()=>o(!1)})]})})]})},fd=({item:a,onEdit:t,onDelete:s,showActions:r=!0,className:n=""})=>{const i=d=>{switch(d){case"achievement":return"bg-green-100 text-green-800 border-green-200";case"feedback":return"bg-blue-100 text-blue-800 border-blue-200";case"concern":return"bg-red-100 text-red-800 border-red-200";case"goal":return"bg-purple-100 text-purple-800 border-purple-200";case"improvement":return"bg-orange-100 text-orange-800 border-orange-200";case"other":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},l=d=>{switch(d){case"achievement":return"Achievement";case"feedback":return"Feedback";case"concern":return"Concern";case"goal":return"Goal";case"improvement":return"Improvement";case"other":return"Other";default:return"Other"}},o=d=>{switch(d){case 5:return"text-red-600";case 4:return"text-orange-600";case 3:return"text-yellow-600";case 2:return"text-blue-600";case 1:return"text-gray-600";default:return"text-gray-600"}},m=d=>{switch(d){case 5:return"High";case 4:return"Medium-High";case 3:return"Medium";case 2:return"Medium-Low";case 1:return"Low";default:return"Medium"}},u=d=>Array.from({length:5},(p,j)=>e.jsx(ui,{className:`h-3 w-3 ${j<d?`fill-current ${o(d)}`:"text-gray-300"}`},j)),x=()=>{t&&t(a)},h=()=>{s&&s(a)};return e.jsx(me,{className:`transition-all hover:shadow-md ${n}`,children:e.jsx(ue,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h4",{className:"font-medium text-foreground leading-tight flex-1 mr-3",children:a.title}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs(te,{variant:"outline",className:i(a.category),children:[e.jsx(ws,{className:"h-3 w-3 mr-1"}),l(a.category)]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Importance:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[u(a.importance),e.jsx("span",{className:`text-xs font-medium ${o(a.importance)}`,children:m(a.importance)})]})]}),a.notes&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:e.jsx("p",{className:"whitespace-pre-wrap",children:a.notes})}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:a.tags.map((d,p)=>e.jsxs(te,{variant:"secondary",className:"text-xs",children:[e.jsx(Ys,{className:"h-2 w-2 mr-1"}),d]},p))}),a.sourceType&&a.sourceType!=="manual"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ws,{className:"h-3 w-3"}),"Source: ",a.sourceType]})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created ",Q(new Date(a.createdAt),"MMM d, yyyy"),a.updatedAt!==a.createdAt&&e.jsxs("span",{children:[" • Updated ",Q(new Date(a.updatedAt),"MMM d, yyyy")]})]}),r&&e.jsxs("div",{className:"flex items-center gap-1",children:[t&&e.jsxs(E,{variant:"ghost",size:"sm",onClick:x,className:"h-7 px-3 text-xs",children:[e.jsx(ds,{className:"h-3 w-3 mr-1"}),"Edit"]}),s&&e.jsxs(E,{variant:"ghost",size:"sm",onClick:h,className:"h-7 px-3 text-xs text-destructive hover:text-destructive",children:[e.jsx(Dt,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})]})})})},un=({items:a=[],loading:t=!1,onEdit:s,onDelete:r,showActions:n=!0,emptyMessage:i="No personal file items found",emptyDescription:l="Personal file items will appear here once they are added."})=>{const[o,m]=c.useState(""),[u,x]=c.useState("createdAt"),[h,d]=c.useState("desc"),[p,j]=c.useState("all"),[y,b]=c.useState("all"),F=c.useMemo(()=>{let N=a;if(o){const w=o.toLowerCase();N=N.filter(S=>S.title.toLowerCase().includes(w)||S.notes&&S.notes.toLowerCase().includes(w)||S.tags&&S.tags.some(v=>v.toLowerCase().includes(w)))}return p!=="all"&&(N=N.filter(w=>w.category===p)),y!=="all"&&(N=N.filter(w=>w.importance===parseInt(y))),N.sort((w,S)=>{let v,D;switch(u){case"title":v=w.title.toLowerCase(),D=S.title.toLowerCase();break;case"importance":v=w.importance,D=S.importance;break;case"category":v=w.category,D=S.category;break;case"updatedAt":v=new Date(w.updatedAt),D=new Date(S.updatedAt);break;case"createdAt":default:v=new Date(w.createdAt),D=new Date(S.createdAt);break}return h==="asc"?v<D?-1:v>D?1:0:v>D?-1:v<D?1:0}),N},[a,o,u,h,p,y]);return t?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Pr,{}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading personal file items..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"Search personal file items...",value:o,onChange:N=>m(N.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(fe,{value:p,onValueChange:j,children:[e.jsxs(xe,{className:"w-36",children:[e.jsx(Va,{className:"h-4 w-4 mr-2"}),e.jsx(je,{})]}),e.jsxs(ge,{children:[e.jsx(k,{value:"all",children:"All Categories"}),e.jsx(k,{value:"achievement",children:"Achievement"}),e.jsx(k,{value:"feedback",children:"Feedback"}),e.jsx(k,{value:"concern",children:"Concern"}),e.jsx(k,{value:"goal",children:"Goal"}),e.jsx(k,{value:"improvement",children:"Improvement"}),e.jsx(k,{value:"other",children:"Other"})]})]}),e.jsxs(fe,{value:y,onValueChange:b,children:[e.jsxs(xe,{className:"w-36",children:[e.jsx(ui,{className:"h-4 w-4 mr-2"}),e.jsx(je,{})]}),e.jsxs(ge,{children:[e.jsx(k,{value:"all",children:"All Importance"}),e.jsx(k,{value:"5",children:"High"}),e.jsx(k,{value:"4",children:"Medium-High"}),e.jsx(k,{value:"3",children:"Medium"}),e.jsx(k,{value:"2",children:"Medium-Low"}),e.jsx(k,{value:"1",children:"Low"})]})]}),e.jsxs(fe,{value:`${u}-${h}`,onValueChange:N=>{const[w,S]=N.split("-");x(w),d(S)},children:[e.jsxs(xe,{className:"w-40",children:[e.jsx(Pa,{className:"h-4 w-4 mr-2"}),e.jsx(je,{})]}),e.jsxs(ge,{children:[e.jsx(k,{value:"createdAt-desc",children:"Newest First"}),e.jsx(k,{value:"createdAt-asc",children:"Oldest First"}),e.jsx(k,{value:"updatedAt-desc",children:"Recently Updated"}),e.jsx(k,{value:"importance-desc",children:"Importance: High to Low"}),e.jsx(k,{value:"importance-asc",children:"Importance: Low to High"}),e.jsx(k,{value:"title-asc",children:"Title: A to Z"}),e.jsx(k,{value:"title-desc",children:"Title: Z to A"}),e.jsx(k,{value:"category-asc",children:"Category: A to Z"})]})]})]})]}),a.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",F.length," of ",a.length," personal file items"]}),F.length===0?e.jsx(Mr,{icon:ws,title:a.length===0?i:"No matching items",description:a.length===0?l:"Try adjusting your search or filters"}):e.jsx("div",{className:"space-y-3",children:F.map(N=>e.jsx(fd,{item:N,onEdit:s,onDelete:r,showActions:n},N.id))})]})},yd=(a,t)=>{const r=a.sort((n,i)=>new Date(i.createdAt)-new Date(n.createdAt)).map(n=>{const i=new Date(n.createdAt).toLocaleDateString(),l=n.tags&&n.tags.length>0?`<div class="tags"><strong>Tags:</strong> ${n.tags.join(", ")}</div>`:"",o=`<div class="importance"><strong>Importance:</strong> ${n.importance}/5</div>`;return`
      <div class="item">
        <h3>${n.title}</h3>
        <div class="metadata">
          <div class="category"><strong>Category:</strong> ${n.category}</div>
          ${o}
          <div class="date"><strong>Date:</strong> ${i}</div>
          ${l}
        </div>
        <div class="notes">
          ${n.notes?`<p>${n.notes.replace(/\n/g,"<br>")}</p>`:"<p><em>No additional notes</em></p>"}
        </div>
      </div>
    `}).join("");return`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Personal File - ${t}</title>
      <style>
        @media print {
          body { margin: 0; }
          .no-print { display: none; }
        }
        
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333;
          max-width: 800px;
          margin: 0 auto;
          padding: 20px;
        }
        
        .header {
          border-bottom: 2px solid #333;
          padding-bottom: 20px;
          margin-bottom: 30px;
        }
        
        .header h1 {
          margin: 0 0 10px 0;
          color: #2563eb;
        }
        
        .header .meta {
          color: #666;
          font-size: 14px;
        }
        
        .item {
          margin-bottom: 30px;
          padding-bottom: 20px;
          border-bottom: 1px solid #eee;
        }
        
        .item:last-child {
          border-bottom: none;
        }
        
        .item h3 {
          margin: 0 0 10px 0;
          color: #1f2937;
        }
        
        .metadata {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
          margin-bottom: 15px;
          font-size: 14px;
          color: #666;
        }
        
        .metadata > div {
          background: #f8f9fa;
          padding: 4px 8px;
          border-radius: 4px;
        }
        
        .notes {
          margin-top: 10px;
        }
        
        .notes p {
          margin: 0;
          line-height: 1.5;
        }
        
        .tags {
          color: #059669;
        }
        
        .importance {
          color: #dc2626;
        }
        
        .print-button {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 10px 20px;
          background: #2563eb;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
        }
        
        .print-button:hover {
          background: #1d4ed8;
        }
        
        @media (max-width: 768px) {
          body {
            padding: 10px;
          }
          
          .metadata {
            flex-direction: column;
            gap: 5px;
          }
        }
      </style>
    </head>
    <body>
      <button class="print-button no-print" onclick="window.print()">Print</button>
      
      <div class="header">
        <h1>Personal File - ${t}</h1>
        <div class="meta">
          Generated: ${new Date().toLocaleDateString()} | 
          Total Items: ${a.length}
        </div>
      </div>
      
      <div class="content">
        ${r||"<p><em>No personal file items found.</em></p>"}
      </div>
    </body>
    </html>
  `},jd=(a,t)=>{const s=yd(a,t),r=window.open("","_blank");r.document.write(s),r.document.close(),r.focus(),setTimeout(()=>{r.print()},250),yt(jt.PRINT,vt.PERSONAL_FILE_ITEM,"print_preview",{operation:"print",teamMemberName:t,itemCount:a.length,categories:[...new Set(a.map(n=>n.category))]})},vd=(a,t)=>{const r=a.sort((u,x)=>new Date(x.createdAt)-new Date(u.createdAt)).map(u=>{const x=new Date(u.createdAt).toLocaleDateString(),h=u.tags&&u.tags.length>0?`
Tags: ${u.tags.join(", ")}`:"",d=`
Importance: ${u.importance}/5`;return`${u.title}
Category: ${u.category}${d}
Date: ${x}${h}

${u.notes||"No additional notes"}

${"=".repeat(50)}`}).join(`

`),i=`Personal File - ${t}
Generated: ${new Date().toLocaleDateString()}
Total Items: ${a.length}

PRIVACY NOTICE: This document contains sensitive performance-related information.
Handle according to your organization's data privacy policies.

${"=".repeat(50)}

`+r,l=new Blob([i],{type:"text/plain"}),o=URL.createObjectURL(l),m=document.createElement("a");m.href=o,m.download=`personal-file-${t.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(o),yt(jt.EXPORT,vt.PERSONAL_FILE_ITEM,"text_export",{operation:"export",teamMemberName:t,itemCount:a.length,categories:[...new Set(a.map(u=>u.category))],exportFormat:"text"})},wd=({teamMemberId:a,teamMemberName:t})=>{const[s,r]=c.useState([]),[n,i]=c.useState(!0),[l,o]=c.useState(!1),[m,u]=c.useState(null),[x,h]=c.useState("all");c.useEffect(()=>{d()},[a]);const d=async()=>{i(!0);try{const S=await Rs.getByTeamMember(a);r(S)}catch(S){console.error("Error loading personal file items:",S),nt.error("Failed to load personal file items")}finally{i(!1)}},p=async()=>{o(!1),u(null),await d()},j=S=>{u(S),o(!0)},y=async S=>{if(window.confirm("Are you sure you want to delete this personal file item?"))try{await Rs.delete(S.id),nt.success("Personal file item deleted"),await d()}catch(v){console.error("Error deleting personal file item:",v),nt.error("Failed to delete personal file item")}},b=()=>{try{vd(s,t),nt.success("Personal file exported successfully")}catch(S){console.error("Error exporting personal file:",S),nt.error("Failed to export personal file")}},F=()=>{try{jd(s,t),nt.success("Opening print preview...")}catch(S){console.error("Error printing personal file:",S),nt.error("Failed to open print preview")}},N=s.filter(S=>x==="all"?!0:S.category===x),w=[...new Set(s.map(S=>S.category))].sort();return e.jsxs(me,{className:"w-full",children:[e.jsxs(be,{className:"flex flex-row items-center justify-between",children:[e.jsx(Ne,{children:"Personal File"}),e.jsxs("div",{className:"flex gap-2",children:[s.length>0&&e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsxs(E,{variant:"outline",children:[e.jsx(Qr,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(Qt,{children:[e.jsxs(et,{onClick:b,children:[e.jsx(Qr,{className:"h-4 w-4 mr-2"}),"Export as Text"]}),e.jsxs(et,{onClick:F,children:[e.jsx(So,{className:"h-4 w-4 mr-2"}),"Print Preview"]})]})]}),e.jsxs(E,{onClick:()=>o(!0),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add Item"]})]})]}),e.jsx(ue,{children:e.jsxs(va,{defaultValue:"all",value:x,onValueChange:h,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs(Ks,{className:"grid-cols-auto",children:[e.jsx(Ct,{value:"all",children:"All"}),w.map(S=>e.jsx(Ct,{value:S,children:S.charAt(0).toUpperCase()+S.slice(1)},S))]})}),e.jsx(Ot,{value:"all",className:"mt-0",children:e.jsx(un,{items:N,loading:n,onEdit:j,onDelete:y,emptyMessage:"No personal file items found",emptyDescription:"Add items to build a comprehensive performance record."})}),w.map(S=>e.jsx(Ot,{value:S,className:"mt-0",children:e.jsx(un,{items:N,loading:n,onEdit:j,onDelete:y,emptyMessage:`No ${S} items found`,emptyDescription:`Items categorized as ${S} will appear here.`})},S))]})}),e.jsx(Ye,{open:l,onOpenChange:S=>{o(S),S||u(null)},children:e.jsxs(Be,{className:"max-w-2xl",children:[e.jsx(Ge,{children:e.jsx(We,{children:m?"Edit Personal File Item":"Add to Personal File"})}),e.jsx(Ri,{teamMemberId:a,initialData:m,onSubmit:p,onCancel:()=>{o(!1),u(null)}})]})})]})},rr=[{id:"vacation",name:"Vacation",value:"vacation",active:!0,color:"#3b82f6",order:1},{id:"sick_day",name:"Sick Day",value:"sick_day",active:!0,color:"#ef4444",order:2},{id:"day_off",name:"Day Off",value:"day_off",active:!0,color:"#10b981",order:3},{id:"personal_leave",name:"Personal Leave",value:"personal_leave",active:!0,color:"#f59e0b",order:4},{id:"training",name:"Training",value:"training",active:!0,color:"#8b5cf6",order:5}];class St{static calculateDaysInPeriod(t,s){if(!t||!s)throw new Error("Start date and end date are required");const r=new Date(t),n=new Date(s);if(isNaN(r.getTime())||isNaN(n.getTime()))throw new Error("Invalid date format");if(n<r)throw new Error("End date must be after or equal to start date");const i=n.getTime()-r.getTime();return Math.floor(i/(1e3*60*60*24))+1}static validatePeriod(t,s,r,n,i){const l=[];if(t||l.push("Start date is required"),s||l.push("End date is required"),r||l.push("Reason is required"),!n&&!i&&l.push("Reference (team member or peer) is required"),t){const o=new Date(t);isNaN(o.getTime())&&l.push("Invalid start date format")}if(s){const o=new Date(s);isNaN(o.getTime())&&l.push("Invalid end date format")}if(t&&s){const o=new Date(t),m=new Date(s);!isNaN(o.getTime())&&!isNaN(m.getTime())&&m<o&&l.push("End date must be after or equal to start date")}return r&&(rr.filter(m=>m.active).map(m=>m.value).includes(r)||l.push("Invalid reason type")),{isValid:l.length===0,errors:l}}static async getActivePeriodsForDate(t){if(!t)throw new Error("Date is required");const s=new Date(t);if(isNaN(s.getTime()))throw new Error("Invalid date format");try{return(await Ut.list()).filter(n=>{const i=new Date(n.start_date),l=new Date(n.end_date);return s>=i&&s<=l})}catch(r){throw new Error(`Failed to get active periods: ${r.message}`)}}static async getYearlyStats(t,s=new Date().getFullYear()){if(!t)throw new Error("Team member ID is required");if(!s||s<1900||s>3e3)throw new Error("Invalid year");try{const n=(await Ut.list()).filter(u=>u.team_member_id===t),i=`${s}-01-01`,l=`${s}-12-31`;let o=0;const m={};return n.forEach(u=>{const x=u.start_date,h=u.end_date,d=x>i?x:i,p=h<l?h:l;if(d<=p){const j=this.calculateDaysInPeriod(d,p);o+=j,m[u.reason]||(m[u.reason]=0),m[u.reason]+=j}}),{teamMemberId:t,year:s,totalDays:o,reasonBreakdown:m,periods:n.filter(u=>{const x=u.start_date,h=u.end_date,d=x>i?x:i,p=h<l?h:l;return d<=p})}}catch(r){throw new Error(`Failed to get yearly statistics: ${r.message}`)}}static async getYearlyStatsForPeer(t,s=new Date().getFullYear()){if(!t)throw new Error("Peer ID is required");if(!s||s<1900||s>3e3)throw new Error("Invalid year");try{const n=(await Ut.list()).filter(u=>u.peer_id===t),i=`${s}-01-01`,l=`${s}-12-31`;let o=0;const m={};return n.forEach(u=>{const x=u.start_date,h=u.end_date,d=x>i?x:i,p=h<l?h:l;if(d<=p){const j=this.calculateDaysInPeriod(d,p);o+=j,m[u.reason]||(m[u.reason]=0),m[u.reason]+=j}}),{peerId:t,year:s,totalDays:o,reasonBreakdown:m,periods:n.filter(u=>{const x=u.start_date,h=u.end_date,d=x>i?x:i,p=h<l?h:l;return d<=p})}}catch(r){throw new Error(`Failed to get yearly statistics: ${r.message}`)}}static async checkOverlaps(t,s,r,n=null){if(!t||!s||!r)throw new Error("Team member ID, start date, and end date are required");const i=new Date(s),l=new Date(r);if(isNaN(i.getTime())||isNaN(l.getTime()))throw new Error("Invalid date format");try{return(await Ut.list()).filter(u=>u.team_member_id===t&&(!n||u.id!==n)).filter(u=>{const x=new Date(u.start_date),h=new Date(u.end_date);return i<=h&&l>=x})}catch(o){throw new Error(`Failed to check overlaps: ${o.message}`)}}static async checkOverlapsForPeer(t,s,r,n=null){if(!t||!s||!r)throw new Error("Peer ID, start date, and end date are required");const i=new Date(s),l=new Date(r);if(isNaN(i.getTime())||isNaN(l.getTime()))throw new Error("Invalid date format");try{return(await Ut.list()).filter(u=>u.peer_id===t&&(!n||u.id!==n)).filter(u=>{const x=new Date(u.start_date),h=new Date(u.end_date);return i<=h&&l>=x})}catch(o){throw new Error(`Failed to check overlaps: ${o.message}`)}}static async getCurrentStatus(t,s=new Date().toISOString().split("T")[0]){if(!t)throw new Error("Team member ID is required");try{const n=(await this.getActivePeriodsForDate(s)).find(o=>o.team_member_id===t);if(!n)return null;const i=new Date(n.end_date),l=new Date(i);return l.setDate(l.getDate()+1),{...n,returnDate:l.toISOString().split("T")[0],daysRemaining:this.calculateDaysInPeriod(s,n.end_date)}}catch(r){throw new Error(`Failed to get current status: ${r.message}`)}}static async getCurrentStatusForPeer(t,s=new Date().toISOString().split("T")[0]){if(!t)throw new Error("Peer ID is required");try{const n=(await this.getActivePeriodsForDate(s)).find(o=>o.peer_id===t);if(!n)return null;const i=new Date(n.end_date),l=new Date(i);return l.setDate(l.getDate()+1),{...n,returnDate:l.toISOString().split("T")[0],daysRemaining:this.calculateDaysInPeriod(s,n.end_date)}}catch(r){throw new Error(`Failed to get current status: ${r.message}`)}}static getReasonTypes(){return rr.filter(t=>t.active).sort((t,s)=>t.order-s.order)}static getReasonType(t){return rr.find(s=>s.value===t)||null}}const bd=({teamMemberId:a,year:t,showBreakdown:s=!1,showYearSelector:r=!1,onStatsChange:n,className:i=""})=>{const l=new Date().getFullYear(),[o,m]=c.useState(t||l),[u,x]=c.useState(null),[h,d]=c.useState(!0),[p,j]=c.useState(null),y=c.useMemo(()=>{const D=[];for(let C=0;C<3;C++)D.push(l-C);return D},[l]),b=async D=>{if(!a){x(null),d(!1);return}try{d(!0),j(null);const C=await St.getYearlyStats(a,D);x(C),n&&n(C)}catch(C){console.error("Failed to load out of office stats:",C),j(C.message),x(null)}finally{d(!1)}};c.useEffect(()=>{b(o)},[a,o]);const F=D=>{m(parseInt(D))},N=D=>St.getReasonType(D)||{name:D,color:"#6b7280"},w=c.useMemo(()=>!u||!u.reasonBreakdown?[]:Object.entries(u.reasonBreakdown).map(([D,C])=>({reason:D,days:C,display:N(D)})).sort((D,C)=>C.days-D.days),[u]);if(h)return e.jsxs(me,{className:`animate-pulse ${i}`,children:[e.jsx(be,{className:"pb-2",children:e.jsxs(Ne,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(ue,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]})]});if(p)return e.jsxs(me,{className:`border-red-200 ${i}`,children:[e.jsx(be,{className:"pb-2",children:e.jsxs(Ne,{className:"text-sm font-medium text-red-600 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(ue,{children:[e.jsx("p",{className:"text-sm text-red-600",children:"Failed to load stats"}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>b(o),className:"mt-2",children:"Retry"})]})]});const S=(u==null?void 0:u.totalDays)||0,v=o===l;return e.jsxs(me,{className:i,children:[e.jsx(be,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ne,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Out of Office Days"]}),r&&e.jsxs(fe,{value:o.toString(),onValueChange:F,children:[e.jsx(xe,{className:"w-20 h-8 text-xs",children:e.jsx(je,{})}),e.jsx(ge,{children:y.map(D=>e.jsx(k,{value:D.toString(),children:D},D))})]})]})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:S}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[S===1?"day":"days"," in ",o,v&&e.jsx(te,{variant:"secondary",className:"ml-2 text-xs",children:"Current"})]})]}),s&&w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(hi,{className:"h-3 w-3"}),"Breakdown"]}),e.jsx("div",{className:"space-y-1",children:w.map(({reason:D,days:C,display:I})=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:I.color}}),e.jsx("span",{children:I.name})]}),e.jsxs("span",{className:"font-medium",children:[C," ",C===1?"day":"days"]})]},D))})]}),S===0&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),"No out of office periods in ",o]})]})})]})},sl=Co,Nd=Oo,_d=Eo,al=c.forwardRef(({className:a,...t},s)=>e.jsx(xi,{className:B("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t,ref:s}));al.displayName=xi.displayName;const Rr=c.forwardRef(({className:a,...t},s)=>e.jsxs(_d,{children:[e.jsx(al,{}),e.jsx(gi,{ref:s,className:B("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...t})]}));Rr.displayName=gi.displayName;const Fr=({className:a,...t})=>e.jsx("div",{className:B("flex flex-col space-y-2 text-center sm:text-left",a),...t});Fr.displayName="AlertDialogHeader";const $r=({className:a,...t})=>e.jsx("div",{className:B("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});$r.displayName="AlertDialogFooter";const Lr=c.forwardRef(({className:a,...t},s)=>e.jsx(pi,{ref:s,className:B("text-lg font-semibold",a),...t}));Lr.displayName=pi.displayName;const Vr=c.forwardRef(({className:a,...t},s)=>e.jsx(fi,{ref:s,className:B("text-sm text-muted-foreground",a),...t}));Vr.displayName=fi.displayName;const Br=c.forwardRef(({className:a,...t},s)=>e.jsx(yi,{ref:s,className:B(ma(),a),...t}));Br.displayName=yi.displayName;const Ur=c.forwardRef(({className:a,...t},s)=>e.jsx(ji,{ref:s,className:B(ma({variant:"outline"}),"mt-2 sm:mt-0",a),...t}));Ur.displayName=ji.displayName;const hn=({teamMemberId:a,initialData:t=null,onSubmit:s,onCancel:r,isLoading:n=!1})=>{const[i,l]=c.useState({start_date:"",end_date:"",reason:"",notes:""}),[o,m]=c.useState({}),[u,x]=c.useState([]),[h,d]=c.useState(!1),[p,j]=c.useState(!1),[y,b]=c.useState(!1);c.useEffect(()=>{t&&l({start_date:t.start_date||"",end_date:t.end_date||"",reason:t.reason||"",notes:t.notes||""})},[t]);const F=St.getReasonTypes(),N=()=>{const I=St.validatePeriod(i.start_date,i.end_date,i.reason,a),R={};return I.errors.forEach($=>{$.includes("Start date")?R.start_date=$:$.includes("End date")?R.end_date=$:$.includes("Reason")?R.reason=$:($.includes("Team member"),R.general=$)}),m(R),I.isValid},w=async()=>{if(!(!i.start_date||!i.end_date||!a))try{const I=await St.checkOverlaps(a,i.start_date,i.end_date,t==null?void 0:t.id);if(I.length>0){const R=I.map($=>{const J=Q(new Date($.start_date),"MMM dd, yyyy"),le=Q(new Date($.end_date),"MMM dd, yyyy"),re=St.getReasonType($.reason);return`Overlaps with existing ${(re==null?void 0:re.name)||$.reason} period (${J} - ${le})`});x(R)}else x([])}catch(I){console.error("Error checking overlaps:",I)}},S=(I,R)=>{l($=>({...$,[I]:R})),o[I]&&m($=>({...$,[I]:""})),o.general&&m($=>({...$,general:""}))},v=(I,R)=>{if(R){const $=Q(R,"yyyy-MM-dd");S(I,$),I==="start_date"?j(!1):b(!1)}},D=async I=>{if(I.preventDefault(),!!N()){d(!0);try{await w();const R={...i,team_member_id:a,created_date:(t==null?void 0:t.created_date)||new Date().toISOString(),updated_date:new Date().toISOString()};t!=null&&t.id&&(R.id=t.id),s&&await s(R)}catch(R){console.error("Error submitting form:",R),m({general:"Failed to save out of office period. Please try again."})}finally{d(!1)}}};c.useEffect(()=>{i.start_date&&i.end_date&&w()},[i.start_date,i.end_date,a]);const C=n||h;return e.jsxs(me,{className:"w-full max-w-2xl",children:[e.jsx(be,{children:e.jsx(Ne,{children:t?"Edit Out of Office Period":"New Out of Office Period"})}),e.jsx(ue,{children:e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[o.general&&e.jsx(mt,{variant:"destructive",children:e.jsx(ut,{children:o.general})}),u.length>0&&e.jsx(mt,{children:e.jsx(ut,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Warning: Period overlaps detected"}),u.map((I,R)=>e.jsx("p",{className:"text-sm",children:I},R))]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"start_date",children:"Start Date"}),e.jsxs(ct,{open:p,onOpenChange:j,children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:B("w-full justify-start text-left font-normal",!i.start_date&&"text-muted-foreground",o.start_date&&"border-destructive"),disabled:C,children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),i.start_date?Q(new Date(i.start_date),"PPP"):e.jsx("span",{children:"Pick start date"})]})}),e.jsx(lt,{className:"w-auto p-0",align:"start",children:e.jsx(it,{mode:"single",selected:i.start_date?new Date(i.start_date):void 0,onSelect:I=>v("start_date",I),disabled:I=>I<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),o.start_date&&e.jsx("p",{className:"text-sm text-destructive",children:o.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"end_date",children:"End Date"}),e.jsxs(ct,{open:y,onOpenChange:b,children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:B("w-full justify-start text-left font-normal",!i.end_date&&"text-muted-foreground",o.end_date&&"border-destructive"),disabled:C,children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),i.end_date?Q(new Date(i.end_date),"PPP"):e.jsx("span",{children:"Pick end date"})]})}),e.jsx(lt,{className:"w-auto p-0",align:"start",children:e.jsx(it,{mode:"single",selected:i.end_date?new Date(i.end_date):void 0,onSelect:I=>v("end_date",I),disabled:I=>{const R=new Date(new Date().setHours(0,0,0,0)),$=i.start_date?new Date(i.start_date):R;return I<Math.max(R,$)},initialFocus:!0})})]}),o.end_date&&e.jsx("p",{className:"text-sm text-destructive",children:o.end_date})]})]}),i.start_date&&i.end_date&&e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Duration: ",St.calculateDaysInPeriod(i.start_date,i.end_date)," days"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"reason",children:"Reason"}),e.jsxs(fe,{value:i.reason,onValueChange:I=>S("reason",I),disabled:C,children:[e.jsx(xe,{className:B(o.reason&&"border-destructive"),children:e.jsx(je,{placeholder:"Select a reason"})}),e.jsx(ge,{children:F.map(I=>e.jsx(k,{value:I.value,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:I.color}}),e.jsx("span",{children:I.name})]})},I.value))})]}),o.reason&&e.jsx("p",{className:"text-sm text-destructive",children:o.reason})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(Rt,{id:"notes",placeholder:"Add any additional notes...",value:i.notes,onChange:I=>S("notes",I.target.value),disabled:C,rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[r&&e.jsx(E,{type:"button",variant:"outline",onClick:r,disabled:C,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:C,children:C?"Saving...":t?"Update":"Create"})]})]})})]})},Sd=({teamMemberId:a,teamMemberName:t})=>{const[s,r]=c.useState([]),[n,i]=c.useState([]),[l,o]=c.useState(!0),[m,u]=c.useState(""),[x,h]=c.useState("start_date"),[d,p]=c.useState("desc"),[j,y]=c.useState("all"),[b,F]=c.useState("all"),[N,w]=c.useState(!1),[S,v]=c.useState(null),[D,C]=c.useState(null),I=St.getReasonTypes(),R=async()=>{try{o(!0),u("");const M=(await Ut.list()).filter(g=>g.team_member_id===a);r(M)}catch(L){console.error("Error loading periods:",L),u("Failed to load out of office periods. Please try again.")}finally{o(!1)}},$=L=>{const M=new Date,g=new Date(L.start_date),Y=new Date(L.end_date);return M>=g&&M<=Y},J=L=>{const M=new Date;return new Date(L.start_date)>M},le=L=>$(L)?"active":J(L)?"upcoming":"past",re=()=>{let L=[...s];j!=="all"&&(L=L.filter(M=>M.reason===j)),b!=="all"&&(L=L.filter(M=>le(M)===b)),L.sort((M,g)=>{let Y,W;switch(x){case"start_date":Y=new Date(M.start_date),W=new Date(g.start_date);break;case"end_date":Y=new Date(M.end_date),W=new Date(g.end_date);break;case"reason":Y=M.reason,W=g.reason;break;case"duration":Y=St.calculateDaysInPeriod(M.start_date,M.end_date),W=St.calculateDaysInPeriod(g.start_date,g.end_date);break;default:Y=new Date(M.start_date),W=new Date(g.start_date)}return d==="asc"?Y<W?-1:Y>W?1:0:Y>W?-1:Y<W?1:0}),i(L)},Z=async L=>{try{await Ut.create(L),await R(),w(!1)}catch(M){throw console.error("Error creating period:",M),new Error("Failed to create out of office period")}},z=async L=>{try{await Ut.update(L.id,L),await R(),v(null)}catch(M){throw console.error("Error updating period:",M),new Error("Failed to update out of office period")}},ae=async L=>{try{await Ut.delete(L),await R(),C(null)}catch(M){console.error("Error deleting period:",M),u("Failed to delete out of office period. Please try again.")}},O=L=>{switch(L){case"active":return"destructive";case"upcoming":return"default";case"past":return"secondary";default:return"secondary"}},q=L=>St.getReasonType(L);return c.useEffect(()=>{a&&R()},[a]),c.useEffect(()=>{re()},[s,x,d,j,b]),l?e.jsx(me,{children:e.jsx(ue,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading out of office periods..."})})})}):e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ne,{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{children:"Out of Office Periods"}),t&&e.jsxs("span",{className:"text-muted-foreground",children:["- ",t]})]}),e.jsxs(Ye,{open:N,onOpenChange:w,children:[e.jsx(on,{asChild:!0,children:e.jsxs(E,{size:"sm",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add Period"]})}),e.jsxs(Be,{className:"max-w-2xl",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Create Out of Office Period"})}),e.jsx(hn,{teamMemberId:a,onSubmit:Z,onCancel:()=>w(!1)})]})]})]})}),e.jsxs(ue,{children:[m&&e.jsx(mt,{variant:"destructive",className:"mb-4",children:e.jsx(ut,{children:m})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Va,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters:"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Reason:"}),e.jsxs(fe,{value:j,onValueChange:y,children:[e.jsx(xe,{className:"w-32",children:e.jsx(je,{})}),e.jsxs(ge,{children:[e.jsx(k,{value:"all",children:"All"}),I.map(L=>e.jsx(k,{value:L.value,children:L.name},L.value))]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Status:"}),e.jsxs(fe,{value:b,onValueChange:F,children:[e.jsx(xe,{className:"w-32",children:e.jsx(je,{})}),e.jsxs(ge,{children:[e.jsx(k,{value:"all",children:"All"}),e.jsx(k,{value:"active",children:"Active"}),e.jsx(k,{value:"upcoming",children:"Upcoming"}),e.jsx(k,{value:"past",children:"Past"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Sort by:"}),e.jsxs(fe,{value:x,onValueChange:h,children:[e.jsx(xe,{className:"w-32",children:e.jsx(je,{})}),e.jsxs(ge,{children:[e.jsx(k,{value:"start_date",children:"Start Date"}),e.jsx(k,{value:"end_date",children:"End Date"}),e.jsx(k,{value:"reason",children:"Reason"}),e.jsx(k,{value:"duration",children:"Duration"})]})]})]}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>p(d==="asc"?"desc":"asc"),children:d==="asc"?e.jsx(Do,{className:"h-4 w-4"}):e.jsx(ko,{className:"h-4 w-4"})})]}),n.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s.length===0?'No out of office periods found. Click "Add Period" to create one.':"No periods match the current filters."}):e.jsx("div",{className:"space-y-4",children:n.map(L=>{const M=q(L.reason),g=le(L),Y=St.calculateDaysInPeriod(L.start_date,L.end_date);return e.jsx(me,{className:"border-l-4",style:{borderLeftColor:(M==null?void 0:M.color)||"#6b7280"},children:e.jsx(ue,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:(M==null?void 0:M.color)||"#6b7280"}}),e.jsx("span",{className:"font-medium",children:(M==null?void 0:M.name)||L.reason})]}),e.jsx(te,{variant:O(g),children:g.charAt(0).toUpperCase()+g.slice(1)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Start:"})," ",Q(new Date(L.start_date),"MMM dd, yyyy")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"End:"})," ",Q(new Date(L.end_date),"MMM dd, yyyy")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",Y," day",Y!==1?"s":""]})]}),L.notes&&e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",L.notes]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsxs(Ye,{open:(S==null?void 0:S.id)===L.id,onOpenChange:W=>!W&&v(null),children:[e.jsx(on,{asChild:!0,children:e.jsx(E,{variant:"outline",size:"sm",onClick:()=>v(L),children:e.jsx(ds,{className:"h-4 w-4"})})}),e.jsxs(Be,{className:"max-w-2xl",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Edit Out of Office Period"})}),e.jsx(hn,{teamMemberId:a,initialData:S,onSubmit:z,onCancel:()=>v(null)})]})]}),e.jsxs(sl,{open:(D==null?void 0:D.id)===L.id,onOpenChange:W=>!W&&C(null),children:[e.jsx(Nd,{asChild:!0,children:e.jsx(E,{variant:"outline",size:"sm",onClick:()=>C(L),children:e.jsx(Dt,{className:"h-4 w-4"})})}),e.jsxs(Rr,{children:[e.jsxs(Fr,{children:[e.jsx(Lr,{children:"Delete Out of Office Period"}),e.jsxs(Vr,{children:["Are you sure you want to delete this ",(M==null?void 0:M.name)||L.reason," period from ",Q(new Date(L.start_date),"MMM dd, yyyy")," to ",Q(new Date(L.end_date),"MMM dd, yyyy"),"? This action cannot be undone."]})]}),e.jsxs($r,{children:[e.jsx(Ur,{children:"Cancel"}),e.jsx(Br,{onClick:()=>ae(L.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})})},L.id)})})]})]})},Ed=[{value:"devops",label:"DevOps Duty"},{value:"on_call",label:"On-Call Duty"},{value:"other",label:"Other"}];function Cd({duty:a=null,onSave:t,onCancel:s,teamMembers:r=[]}){const[n,i]=c.useState({team_member_id:"",type:"",title:"",description:"",start_date:"",end_date:""}),[l,o]=c.useState({}),[m,u]=c.useState([]),[x,h]=c.useState(!1),[d,p]=c.useState([]);c.useEffect(()=>{r.length===0?j():p(r)},[r]),c.useEffect(()=>{a&&i({team_member_id:a.team_member_id||"",type:a.type||"",title:a.title||"",description:a.description||"",start_date:a.start_date?a.start_date.split("T")[0]:"",end_date:a.end_date?a.end_date.split("T")[0]:""})},[a]);const j=async()=>{try{const w=await Fe.findAll();p(w)}catch(w){console.error("Failed to load team members:",w)}},y=(w,S)=>{i(v=>({...v,[w]:S})),l[w]&&o(v=>({...v,[w]:null}))},b=()=>{const w={};if(n.team_member_id||(w.team_member_id="Team member is required"),n.type||(w.type="Duty type is required"),n.title.trim()||(w.title="Title is required"),n.start_date||(w.start_date="Start date is required"),n.end_date||(w.end_date="End date is required"),n.start_date&&n.end_date){const S=new Date(n.start_date);new Date(n.end_date)<S&&(w.end_date="End date must be after start date")}return o(w),Object.keys(w).length===0},F=async()=>{if(!n.team_member_id||!n.start_date||!n.end_date)return[];try{return await Mt.getConflicts(n.team_member_id,n.start_date,n.end_date,a==null?void 0:a.id)}catch(w){return console.error("Failed to check for conflicts:",w),[]}},N=async w=>{if(w.preventDefault(),!!b()){h(!0);try{const S=await F();if(u(S),S.length>0){h(!1);return}const v={...n,start_date:new Date(n.start_date).toISOString(),end_date:new Date(n.end_date).toISOString()};let D;a?D=await Mt.update(a.id,v):D=await Mt.create(v),t==null||t(D)}catch(S){console.error("Failed to save duty:",S),o({submit:S.message||"Failed to save duty"})}finally{h(!1)}}};return e.jsxs(me,{className:"w-full max-w-2xl",children:[e.jsx(be,{children:e.jsx(Ne,{children:a?"Edit Duty Assignment":"Create Duty Assignment"})}),e.jsx(ue,{children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"team_member_id",children:"Team Member *"}),e.jsxs(fe,{value:n.team_member_id,onValueChange:w=>y("team_member_id",w),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select team member"})}),e.jsx(ge,{children:d.map(w=>e.jsx(k,{value:w.id,children:w.name},w.id))})]}),l.team_member_id&&e.jsx("p",{className:"text-sm text-red-600",children:l.team_member_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"type",children:"Duty Type *"}),e.jsxs(fe,{value:n.type,onValueChange:w=>y("type",w),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select duty type"})}),e.jsx(ge,{children:Ed.map(w=>e.jsx(k,{value:w.value,children:w.label},w.value))})]}),l.type&&e.jsx("p",{className:"text-sm text-red-600",children:l.type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"title",children:"Title *"}),e.jsx(ie,{id:"title",value:n.title,onChange:w=>y("title",w.target.value),placeholder:"Enter duty title"}),l.title&&e.jsx("p",{className:"text-sm text-red-600",children:l.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"description",children:"Description"}),e.jsx(Rt,{id:"description",value:n.description,onChange:w=>y("description",w.target.value),placeholder:"Enter duty description (optional)",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(ie,{id:"start_date",type:"date",value:n.start_date,onChange:w=>y("start_date",w.target.value)}),l.start_date&&e.jsx("p",{className:"text-sm text-red-600",children:l.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"end_date",children:"End Date *"}),e.jsx(ie,{id:"end_date",type:"date",value:n.end_date,onChange:w=>y("end_date",w.target.value)}),l.end_date&&e.jsx("p",{className:"text-sm text-red-600",children:l.end_date})]})]}),m.length>0&&e.jsx(mt,{className:"border-orange-200 bg-orange-50",children:e.jsxs(ut,{children:[e.jsx("strong",{children:"Warning: Duty conflicts detected!"}),e.jsx("ul",{className:"mt-2 list-disc list-inside",children:m.map(w=>e.jsxs("li",{children:[w.title," (",new Date(w.start_date).toLocaleDateString()," - ",new Date(w.end_date).toLocaleDateString(),")"]},w.id))}),e.jsx("p",{className:"mt-2 text-sm",children:"Please adjust the dates or confirm if you want to proceed with overlapping duties."})]})}),l.submit&&e.jsx(mt,{className:"border-red-200 bg-red-50",children:e.jsx(ut,{className:"text-red-800",children:l.submit})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:s,disabled:x,children:"Cancel"}),e.jsx(E,{type:"submit",disabled:x||m.length>0,children:x?"Saving...":a?"Update Duty":"Create Duty"})]})]})})]})}const xn={devops:{label:"DevOps Duty",icon:_n,color:"bg-blue-100 text-blue-800 border-blue-200",badgeVariant:"secondary"},on_call:{label:"On-Call Duty",icon:To,color:"bg-red-100 text-red-800 border-red-200",badgeVariant:"destructive"},other:{label:"Other Duty",icon:Ms,color:"bg-gray-100 text-gray-800 border-gray-200",badgeVariant:"outline"}};function gn({duty:a,teamMember:t,onEdit:s,onDelete:r,showActions:n=!0,compact:i=!1}){const[l,o]=c.useState(!1),[m,u]=c.useState(!1);if(!a)return null;const x=xn[a.type]||xn.other,h=x.icon,d=new Date(a.start_date),p=new Date(a.end_date),j=new Date,y=j>=d&&j<=p,b=j>p,F=C=>C.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),N=()=>{const C=F(d),I=F(p);return C===I?C:`${C} - ${I}`},w=()=>{const C=Math.abs(p-d),I=Math.ceil(C/(1e3*60*60*24))+1;if(I===1)return"1 day";if(I<7)return`${I} days`;if(I<30){const R=Math.floor(I/7),$=I%7;return $===0?`${R} week${R>1?"s":""}`:`${R}w ${$}d`}else{const R=Math.floor(I/30),$=I%30;return $===0?`${R} month${R>1?"s":""}`:`${R}m ${$}d`}},S=()=>y?e.jsx(te,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"}):b?e.jsx(te,{variant:"secondary",className:"bg-gray-100 text-gray-600",children:"Completed"}):e.jsx(te,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Upcoming"}),v=async()=>{u(!0);try{await(r==null?void 0:r(a)),o(!1)}catch(C){console.error("Failed to delete duty:",C)}finally{u(!1)}},D=()=>t!=null&&t.name?t.name.split(" ").map(C=>C[0]).join("").toUpperCase().slice(0,2):"?";return i?e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-white hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500",children:N()})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[S(),n&&e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(Jr,{className:"h-4 w-4"})})}),e.jsxs(Qt,{align:"end",children:[e.jsxs(et,{onClick:()=>s==null?void 0:s(a),children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(et,{onClick:()=>o(!0),className:"text-red-600",children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(me,{className:`w-full ${y?"ring-2 ring-green-200":""}`,children:[e.jsx(be,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${x.color}`,children:e.jsx(h,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx(Ne,{className:"text-lg",children:a.title}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(te,{variant:x.badgeVariant,children:x.label}),S()]})]})]}),n&&e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(Jr,{className:"h-4 w-4"})})}),e.jsxs(Qt,{align:"end",children:[e.jsxs(et,{onClick:()=>s==null?void 0:s(a),children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Edit Duty"]}),e.jsxs(et,{onClick:()=>o(!0),className:"text-red-600",children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Delete Duty"]})]})]})]})}),e.jsxs(ue,{className:"space-y-4",children:[t&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(bs,{className:"h-8 w-8",children:e.jsx(Ns,{className:"text-sm",children:D()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(Us,{className:"h-3 w-3 mr-1"}),"Assigned Team Member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 flex items-center mb-1",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Duration"]}),e.jsx("p",{className:"font-medium",children:w()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Date Range"}),e.jsx("p",{className:"font-medium",children:N()})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),y&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round((j-d)/(p-d)*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(j-d)/(p-d)*100))}%`}})})]}),t&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsx(ts,{teamMemberId:t.id,teamMemberName:t.name,sourceItem:{title:`${x.label}: ${a.title}`,description:`${a.description||""} (${N()})`,type:"duty",id:a.id,start_date:a.start_date,end_date:a.end_date,duty_type:a.type},variant:"outline",size:"sm"})})]})]}),e.jsx(sl,{open:l,onOpenChange:o,children:e.jsxs(Rr,{children:[e.jsxs(Fr,{children:[e.jsx(Lr,{children:"Delete Duty Assignment"}),e.jsxs(Vr,{children:['Are you sure you want to delete "',a.title,'"? This action cannot be undone.',y&&e.jsx("span",{className:"block mt-2 text-orange-600 font-medium",children:"Warning: This duty is currently active."})]})]}),e.jsxs($r,{children:[e.jsx(Ur,{disabled:m,children:"Cancel"}),e.jsx(Br,{onClick:v,disabled:m,className:"bg-red-600 hover:bg-red-700",children:m?"Deleting...":"Delete Duty"})]})]})})]})}function rl(){var G;const[a]=Or(),t=a.get("id"),[s,r]=c.useState(null),[n,i]=c.useState([]),[l,o]=c.useState([]),[m,u]=c.useState([]),[x,h]=c.useState([]),[d,p]=c.useState([]),[j,y]=c.useState([]),[b,F]=c.useState(null),[N,w]=c.useState([]),[S,v]=c.useState(!0),[D,C]=c.useState(!1),[I,R]=c.useState(!1),[$,J]=c.useState(null),[le,re]=c.useState(!1),[Z,z]=c.useState(null),[ae,O]=c.useState([]),[q,L]=c.useState({text:"",referenced_entity:{type:"team_member",id:""}}),[M,g]=c.useState(null),[Y,W]=c.useState({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),[ne,ce]=c.useState({description:"",due_date:"",linked_task_id:"",linked_project_id:"",status:"open"}),[_e,qe]=c.useState("none"),[Te,$e]=c.useState(""),[Ft,ft]=c.useState(null),[_,de]=c.useState(null),[Oe,Le]=c.useState(!1),[ot,Nt]=c.useState(""),[Qe,Ke]=c.useState(()=>{try{return JSON.parse(localStorage.getItem("discussedNotes")||"{}")}catch{return{}}});c.useEffect(()=>{t&&Xe()},[t]);const Xe=async()=>{v(!0);try{const f=await Fe.get(t);r(f);const U=(await Re.list()).filter(oe=>oe.team_member_id===t);i(U);try{const oe=await Bt.getAgendaItemsForMember(t);o(oe)}catch(oe){console.error("Error loading agenda items:",oe),o([])}const T=await xt.list(),ee=await Pt.list();u(T),h(ee),p(await Fe.list()),y(await cs.list());const ye=await Mt.getByTeamMember(t);w(ye),await Fs(U)}catch(f){console.error("Error loading team member data:",f)}finally{v(!1)}},Fs=async f=>{try{const P=f.filter(U=>U.next_meeting_date).sort((U,T)=>new Date(U.next_meeting_date)-new Date(T.next_meeting_date));if(P.length>0){const U=P[0];let T=null;if(U.next_meeting_calendar_event_id)try{T=(await Me.getOneOnOneMeetingsForTeamMember(t)).find(ye=>ye.id===U.next_meeting_calendar_event_id)}catch(ee){console.error("Error loading calendar event:",ee)}de({oneOnOne:U,calendarEvent:T,hasCalendarEvent:!!T,meetingDate:U.next_meeting_date})}else de(null)}catch(P){console.error("Error loading next meeting info:",P),de(null)}},Xs=async()=>{try{const f=await Re.create({...Y,notes:Array.isArray(Y.notes)?Y.notes:[],team_member_id:t});if(Y.next_meeting_date&&s)try{const P=await Me.createAndLinkOneOnOneMeeting(f.id,t,Y.next_meeting_date);console.log("Calendar event created successfully:",P.calendarEvent)}catch(P){console.error("Error creating calendar event:",P)}C(!1),W({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),Xe()}catch(f){console.error("Error creating 1:1 meeting:",f)}},Qs=async()=>{if($)try{const f={...$,action_items:[...$.action_items||[],ne]};await Re.update($.id,f),R(!1),Xe()}catch(f){console.error("Error adding action item:",f)}},Js=async f=>{if(!q.text)return;let P=null;_e!=="none"&&Te&&(P={type:_e,id:Te});const U=n.find(ye=>ye.id===f);if(!U)return;const T={text:q.text,referenced_entity:P,created_by:t,timestamp:new Date().toISOString()},ee=Array.isArray(U.notes)?[...U.notes,T]:[T];await Re.update(f,{...U,notes:ee}),L({text:"",referenced_entity:{type:"team_member",id:""}}),g(null),Xe()},Ss=async(f,P,U)=>{try{const T=n.find(ye=>ye.id===f);if(!T)return;const ee=[...T.action_items];ee[P]={...ee[P],status:U},await Re.update(f,{...T,action_items:ee}),Xe()}catch(T){console.error("Error updating action item status:",T)}},A=async f=>{try{try{await Me.unlinkCalendarEventFromOneOnOne(f)}catch(P){console.error("Error deleting associated calendar event:",P)}await Re.delete(f),Xe()}catch(P){console.error("Error deleting meeting:",P)}},se=async f=>{try{await Bt.markAgendaItemDiscussed(f.meetingId,f.timestamp)&&Xe()}catch(P){console.error("Error marking agenda item as discussed:",P)}},he=async(f,P)=>{try{const U=n.find(ee=>ee.id===f);if(!U)return;const T={...U,next_meeting_date:P};if(await Re.update(f,T),P&&s)try{await Me.updateOneOnOneCalendarEvent(f,P),console.log("Calendar event updated successfully for meeting:",f)}catch(ee){console.error("Error updating calendar event:",ee)}else if(!P&&U.next_meeting_calendar_event_id)try{await Me.unlinkCalendarEventFromOneOnOne(f),console.log("Calendar event removed for meeting:",f)}catch(ee){console.error("Error removing calendar event:",ee)}Xe()}catch(U){console.error("Error updating next meeting date:",U)}},K=async()=>{if(!(!_||!ot))try{await he(_.oneOnOne.id,ot),Le(!1),Nt("")}catch(f){console.error("Error rescheduling meeting:",f)}},Se=async()=>{if(_)try{await he(_.oneOnOne.id,"")}catch(f){console.error("Error canceling meeting:",f)}},He=()=>{z(null),re(!0)},Ie=f=>{z(f),re(!0)},Es=async f=>{try{Z?await Mt.update(Z.id,f):await Mt.create(f),re(!1),z(null);const P=await Mt.getByTeamMember(t);w(P),await Gt()}catch(P){console.error("Error saving duty:",P)}},rs=async f=>{try{await Mt.delete(f.id);const P=await Mt.getByTeamMember(t);w(P),await Gt()}catch(P){console.error("Error deleting duty:",P)}},Gt=async()=>{try{const f=[];for(const P of N){const U=await Mt.getConflicts(P.team_member_id,P.start_date,P.end_date,P.id);U.length>0&&f.push({duty:P,conflicts:U})}O(f)}catch(f){console.error("Error checking duty conflicts:",f)}};if(c.useEffect(()=>{N.length>0&&Gt()},[N]),S)return e.jsx("div",{className:"p-6",children:"Loading..."});if(!s)return e.jsx("div",{className:"p-6",children:"Team member not found"});const ba=f=>({open:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[f]||"bg-gray-100 text-gray-800",Na=f=>({great:"😄",good:"🙂",neutral:"😐",concerned:"😟"})[f]||"😐";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(ca,{to:"/team",children:e.jsxs(E,{variant:"ghost",children:[e.jsx(xa,{className:"h-4 w-4 mr-2"}),"Back to Team"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(bs,{className:"h-16 w-16",children:s.avatar?e.jsx(pa,{src:s.avatar,alt:s.name}):e.jsx(Ns,{children:s.name.split(" ").map(f=>f[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s.name}),e.jsx("p",{className:"text-gray-500",children:s.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(va,{defaultValue:"meetings",className:"w-full",children:[e.jsxs(Ks,{className:"grid grid-cols-3 mb-4",children:[e.jsxs(Ct,{value:"meetings",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"1:1 Meetings"]}),e.jsxs(Ct,{value:"agenda",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"1:1 Agenda"]}),e.jsxs(Ct,{value:"personal-file",children:[e.jsx(ws,{className:"h-4 w-4 mr-2"}),"Personal File"]})]}),e.jsx(Ot,{value:"meetings",className:"mt-0",children:e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Ne,{children:"1:1 Meetings"}),e.jsxs(E,{onClick:()=>C(!0),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"New 1:1"]})]})}),e.jsx(ue,{children:n.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(es,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No 1:1 meetings recorded yet"})]}):e.jsx("div",{className:"space-y-6",children:n.sort((f,P)=>new Date(P.date)-new Date(f.date)).map(f=>{var P,U;return e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[Q(H(f.date),"PPP"),e.jsx("span",{className:"text-xl",children:Na(f.mood)})]}),e.jsx(kt,{className:"flex items-center gap-2",children:Ft===f.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Next meeting:"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"h-8 text-xs",children:[e.jsx(Ee,{className:"mr-1 h-3 w-3"}),f.next_meeting_date?Q(H(f.next_meeting_date),"MMM d"):"Select date"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:f.next_meeting_date?H(f.next_meeting_date):void 0,onSelect:T=>{const ee=(T==null?void 0:T.toISOString())||"";he(f.id,ee),ft(null)}})})]}),e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>ft(null),children:"Cancel"}),f.next_meeting_date&&e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 px-2 text-red-500",onClick:()=>{he(f.id,""),ft(null)},children:"Clear"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Next meeting: ",f.next_meeting_date?Q(H(f.next_meeting_date),"PPP"):"Not scheduled"]}),e.jsx(E,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>ft(f.id),children:"Edit"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{J(f),R(!0)},children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add Action Item"]}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>A(f.id),title:"Delete meeting",children:e.jsx(Dt,{className:"h-5 w-5 text-red-500"})})]})]})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-4",children:[Array.isArray(f.notes)&&f.notes.filter(T=>!T.referenced_entity||!T.referenced_entity.id||String(T.referenced_entity.id)!==String(t)).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),e.jsx("ul",{className:"list-disc pl-5",children:f.notes.filter(T=>!T.referenced_entity||!T.referenced_entity.id||String(T.referenced_entity.id)!==String(t)).map((T,ee)=>{var ye,oe,$t,Wt;return e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{children:T.text}),((ye=T.referenced_entity)==null?void 0:ye.id)&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[T.referenced_entity.type==="team_member"&&((oe=d.find(gt=>String(gt.id)===String(T.referenced_entity.id)))==null?void 0:oe.name),T.referenced_entity.type==="stakeholder"&&(($t=j.find(gt=>String(gt.id)===String(T.referenced_entity.id)))==null?void 0:$t.name),T.referenced_entity.type==="project"&&((Wt=x.find(gt=>String(gt.id)===String(T.referenced_entity.id)))==null?void 0:Wt.name)]}),e.jsx("div",{className:"mt-1",children:e.jsx(ts,{teamMemberId:t,teamMemberName:s.name,sourceItem:{title:`Note from 1:1 on ${Q(H(f.date),"MMM d, yyyy")}`,description:T.text,type:"note",id:`note-${f.id}-${ee}`},variant:"ghost",size:"xs"})})]},ee)})})]}),e.jsxs("div",{className:"mt-2 flex gap-2 items-end",children:[e.jsx(ie,{className:"flex-1",placeholder:"Note text...",value:M===f.id?q.text:"",onChange:T=>{g(f.id),L(ee=>({...ee,text:T.target.value}))}}),e.jsxs(fe,{value:M===f.id?_e:"none",onValueChange:T=>{g(f.id),qe(T),$e(""),L(ee=>({...ee,referenced_entity:T==="none"?null:{type:T,id:""}}))},children:[e.jsx(xe,{className:"w-32",children:e.jsx(je,{placeholder:"No tag"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"none",children:"No tag"}),e.jsx(k,{value:"team_member",children:"Team Members"}),e.jsx(k,{value:"stakeholder",children:"Stakeholders"}),e.jsx(k,{value:"project",children:"Projects"})]})]}),_e!=="none"&&M===f.id&&e.jsxs(fe,{value:Te,onValueChange:T=>{$e(T),L(ee=>({...ee,referenced_entity:{type:_e,id:T}}))},children:[e.jsx(xe,{className:"w-40",children:e.jsx(je,{placeholder:"Select name"})}),e.jsxs(ge,{children:[_e==="team_member"&&d.filter(T=>T.id.toString()!==(t==null?void 0:t.toString())).map(T=>e.jsx(k,{value:T.id,children:T.name},T.id)),_e==="stakeholder"&&j.map(T=>e.jsx(k,{value:T.id,children:T.name},T.id)),_e==="project"&&x.map(T=>e.jsx(k,{value:T.id,children:T.name},T.id))]})]}),e.jsx(E,{onClick:()=>{g(f.id),Js(f.id)},disabled:!q.text||_e!=="none"&&!Te||M!==f.id,children:"Add"})]}),((P=f.topics_discussed)==null?void 0:P.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Topics Discussed"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:f.topics_discussed.map((T,ee)=>e.jsx(te,{variant:"secondary",children:T},ee))})]}),((U=f.action_items)==null?void 0:U.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Action Items"}),e.jsxs(fa,{children:[e.jsx(ya,{children:e.jsxs(hs,{children:[e.jsx(tt,{children:"Description"}),e.jsx(tt,{children:"Due Date"}),e.jsx(tt,{children:"Status"}),e.jsx(tt,{children:"Links"}),e.jsx(tt,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ja,{children:f.action_items.map((T,ee)=>e.jsxs(hs,{children:[e.jsx(st,{children:T.description}),e.jsx(st,{children:T.due_date?Q(H(T.due_date),"MMM d, yyyy"):"No due date"}),e.jsx(st,{children:e.jsx(te,{className:ba(T.status),children:T.status})}),e.jsx(st,{children:(T.linked_task_id||T.linked_project_id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[T.linked_task_id&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ra,{className:"h-3 w-3"}),"Task"]}),T.linked_project_id&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ra,{className:"h-3 w-3"}),"Project"]})]})}),e.jsx(st,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>Ss(f.id,ee,"completed"),disabled:T.status==="completed",children:e.jsx(Yt,{className:"h-4 w-4 text-green-500"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>Ss(f.id,ee,"in_progress"),disabled:T.status==="in_progress",children:e.jsx(Ze,{className:"h-4 w-4 text-blue-500"})}),e.jsx(ts,{teamMemberId:t,teamMemberName:s.name,sourceItem:{title:`Action Item: ${T.description}`,description:`Due date: ${T.due_date?Q(H(T.due_date),"MMM d, yyyy"):"None"}
Status: ${T.status}`,type:"action_item",id:`action-${f.id}-${ee}`},variant:"ghost",size:"sm"})]})})]},ee))})]})]})]})})]},f.id)})})})]})}),e.jsx(Ot,{value:"agenda",className:"mt-0",children:e.jsx(pd,{teamMemberId:t,teamMemberName:s==null?void 0:s.name})}),e.jsx(Ot,{value:"personal-file",className:"mt-0",children:e.jsx(wd,{teamMemberId:t,teamMemberName:s==null?void 0:s.name})})]}),e.jsx(Sd,{teamMemberId:t,teamMemberName:s==null?void 0:s.name}),e.jsxs(me,{children:[e.jsxs(be,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"h-5 w-5"}),"Duty Assignments"]}),e.jsxs(E,{onClick:He,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Assign Duty"]})]}),ae.length>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(us,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[ae.length," duty conflict",ae.length>1?"s":""," detected"]})]})})]}),e.jsx(ue,{children:N.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Ms,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No duty assignments yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Assign DevOps duties, on-call responsibilities, or other duties"})]}):e.jsxs("div",{className:"space-y-4",children:[N.filter(f=>{const P=new Date,U=new Date(f.start_date),T=new Date(f.end_date);return P>=U&&P<=T}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),"Active Duties"]}),e.jsx("div",{className:"space-y-3",children:N.filter(f=>{const P=new Date,U=new Date(f.start_date),T=new Date(f.end_date);return P>=U&&P<=T}).map(f=>e.jsx(gn,{duty:f,teamMember:s,onEdit:Ie,onDelete:rs,compact:!0},f.id))})]}),N.filter(f=>{const P=new Date,U=new Date(f.start_date);return P<U}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(it,{className:"h-4 w-4"}),"Upcoming Duties"]}),e.jsx("div",{className:"space-y-3",children:N.filter(f=>{const P=new Date,U=new Date(f.start_date);return P<U}).sort((f,P)=>new Date(f.start_date)-new Date(P.start_date)).map(f=>e.jsx(gn,{duty:f,teamMember:s,onEdit:Ie,onDelete:rs,compact:!0},f.id))})]}),N.filter(f=>{const P=new Date,U=new Date(f.end_date);return P>U}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(Io,{className:"h-4 w-4"}),"Past Duties (",N.filter(f=>{const P=new Date,U=new Date(f.end_date);return P>U}).length,")"]}),e.jsxs("div",{className:"space-y-2",children:[N.filter(f=>{const P=new Date,U=new Date(f.end_date);return P>U}).sort((f,P)=>new Date(P.end_date)-new Date(f.end_date)).slice(0,3).map(f=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ms,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-sm",children:f.title}),e.jsx(te,{variant:"secondary",className:"text-xs",children:f.type==="devops"?"DevOps":f.type==="on_call"?"On-Call":"Other"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:Q(H(f.end_date),"MMM d, yyyy")})]},f.id)),N.filter(f=>{const P=new Date,U=new Date(f.end_date);return P>U}).length>3&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-2",children:["Showing 3 of ",N.filter(f=>{const P=new Date,U=new Date(f.end_date);return P>U}).length," past duties"]})]})]}),ae.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(us,{className:"h-4 w-4 text-orange-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-orange-800 text-sm",children:"Duty Conflicts Detected"}),e.jsx("div",{className:"mt-2 space-y-2",children:ae.map(({duty:f,conflicts:P})=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-orange-700",children:[e.jsx("strong",{children:f.title})," conflicts with:"]}),e.jsx("ul",{className:"list-disc list-inside ml-4 text-orange-600",children:P.map(U=>e.jsxs("li",{children:[U.title," (",Q(H(U.start_date),"MMM d")," - ",Q(H(U.end_date),"MMM d"),")"]},U.id))})]},f.id))})]})]})})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(me,{children:[e.jsx(be,{children:e.jsx(Ne,{children:"Team Member Info"})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-4",children:[s.department&&e.jsxs("div",{children:[e.jsx(V,{children:"Department"}),e.jsx("p",{className:"text-gray-600",children:s.department})]}),((G=s.skills)==null?void 0:G.length)>0&&e.jsxs("div",{children:[e.jsx(V,{children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.skills.map((f,P)=>e.jsx(te,{variant:"secondary",children:f},P))})]}),s.notes&&e.jsxs("div",{children:[e.jsx(V,{children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:s.notes})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Birthday"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),s.birthday?Q(H(s.birthday),"PPP"):"Set birthday"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:s.birthday?H(s.birthday):void 0,onSelect:async f=>{if(!f)return;const P=f.toISOString(),U={...s};try{const T=await Fe.update(s.id,{birthday:P});r(ee=>({...ee,birthday:P}));try{await na.handleTeamMemberUpdate(s.id,T,U)}catch(ee){console.error("Failed to update birthday events:",ee)}}catch(T){console.error("Failed to update birthday:",T)}}})})]})]})]})})]}),e.jsx(bd,{teamMemberId:t,showBreakdown:!0,showYearSelector:!0,onStatsChange:F}),e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Next 1:1 Meeting"]})}),e.jsx(ue,{children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Scheduled Date"}),e.jsx("p",{className:"text-gray-900 font-medium",children:Q(H(_.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:_.hasCalendarEvent?e.jsxs(te,{variant:"outline",className:"text-green-700 border-green-200 bg-green-50",children:[e.jsx(Yt,{className:"h-3 w-3 mr-1"}),"Calendar Event Created"]}):e.jsxs(te,{variant:"outline",className:"text-yellow-700 border-yellow-200 bg-yellow-50",children:[e.jsx(ms,{className:"h-3 w-3 mr-1"}),"No Calendar Event"]})})]}),_.calendarEvent&&e.jsxs("div",{children:[e.jsx(V,{children:"Calendar Event"}),e.jsx("p",{className:"text-sm text-gray-600",children:_.calendarEvent.title})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{Nt(_.meetingDate),Le(!0)},children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),"Reschedule"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:Se,className:"text-red-600 hover:text-red-700",children:[e.jsx(vi,{className:"h-4 w-4 mr-1"}),"Cancel"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsx(E,{variant:"outline",size:"sm",onClick:async()=>{try{console.log("Starting duplicate cleanup...");const f=await Me.cleanupAllDuplicateEvents();console.log("Cleanup results:",f),alert(`Cleanup completed! Removed ${f.totalCleaned} duplicate events.`),Xe()}catch(f){console.error("Cleanup failed:",f),alert("Cleanup failed. Check console for details.")}},className:"text-blue-600 hover:text-blue-700",children:"🧹 Clean Duplicates"})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ee,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No upcoming 1:1 scheduled"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Schedule your next meeting from any 1:1 record"})]})})]}),e.jsxs(me,{children:[e.jsx(be,{children:e.jsx(Ne,{children:"Quick Stats"})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Last 1:1"}),e.jsx("p",{className:"text-gray-600",children:n[0]?Q(H(n[0].date),"PPP"):"No meetings yet"})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Meeting Frequency"}),e.jsx("p",{className:"text-gray-600",children:n.length>1?(()=>{const f=n.filter(U=>U.date).sort((U,T)=>new Date(T.date)-new Date(U.date));if(f.length<2)return"Insufficient data";const P=Math.round((new Date(f[0].date)-new Date(f[1].date))/(1e3*60*60*24));return P<=10?"Weekly":P<=20?"Bi-weekly":P<=35?"Monthly":"Irregular"})():"No pattern yet"})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Open Action Items"}),e.jsx("p",{className:"text-gray-600",children:n.reduce((f,P)=>{var U;return f+(((U=P.action_items)==null?void 0:U.filter(T=>T.status!=="completed").length)||0)},0)})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Agenda Items"}),e.jsxs("p",{className:"text-gray-600",children:[l.length," total, ",l.filter(f=>!f.isDiscussed).length," pending"]})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Total 1:1s"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:n.length}),n.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(since ",Q(H(n[n.length-1].date),"MMM yyyy"),")"]})]})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Current Duties"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:N.filter(f=>{const P=new Date,U=new Date(f.start_date),T=new Date(f.end_date);return P>=U&&P<=T}).length}),ae.length>0&&e.jsxs(te,{variant:"destructive",className:"text-xs",children:[ae.length," conflict",ae.length>1?"s":""]})]})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Total Duties"}),e.jsx("p",{className:"text-gray-600",children:N.length})]})]})})]}),e.jsxs(me,{children:[e.jsxs(be,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5"}),"Next Agenda Items"]}),e.jsx(kt,{children:"Items from other meetings where you are tagged"})]}),e.jsxs(ue,{children:[l.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(es,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No agenda items yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You'll see items here when others tag you in their meeting notes"})]}):e.jsx(la,{agendaItems:l.slice(0,5),teamMembers:d.reduce((f,P)=>(f[P.id]=P,f),{}),onMarkDiscussed:se,showActions:!0,emptyMessage:"No agenda items found"}),l.length>5&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Showing 5 of ",l.length," items"]})})]})]})]})]})]}),e.jsx(Ye,{open:D,onOpenChange:C,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"New 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),Y.date?Q(H(Y.date),"PPP"):"Select date"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:Y.date?H(Y.date):void 0,onSelect:f=>W(P=>({...P,date:f==null?void 0:f.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Mood"}),e.jsxs(fe,{value:Y.mood,onValueChange:f=>W(P=>({...P,mood:f})),children:[e.jsx(xe,{children:e.jsx(je,{})}),e.jsxs(ge,{children:[e.jsx(k,{value:"great",children:"Great 😄"}),e.jsx(k,{value:"good",children:"Good 🙂"}),e.jsx(k,{value:"neutral",children:"Neutral 😐"}),e.jsx(k,{value:"concerned",children:"Concerned 😟"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Notes"}),Array.isArray(Y.notes)&&Y.notes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mb-2",children:Y.notes.map((f,P)=>{var U,T,ee,ye;return e.jsxs("li",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{children:f.text}),((U=f.referenced_entity)==null?void 0:U.id)&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[f.referenced_entity.type==="team_member"&&((T=d.find(oe=>oe.id===f.referenced_entity.id))==null?void 0:T.name),f.referenced_entity.type==="stakeholder"&&((ee=j.find(oe=>oe.id===f.referenced_entity.id))==null?void 0:ee.name),f.referenced_entity.type==="project"&&((ye=x.find(oe=>oe.id===f.referenced_entity.id))==null?void 0:ye.name)]}),e.jsx(E,{variant:"ghost",size:"xs",className:"ml-2",onClick:()=>W(oe=>({...oe,notes:oe.notes.filter(($t,Wt)=>Wt!==P)})),children:"Remove"})]},P)})}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(ie,{className:"flex-1",placeholder:"Note text...",value:q.text,onChange:f=>L(P=>({...P,text:f.target.value}))}),e.jsxs(fe,{value:_e,onValueChange:f=>{qe(f),$e(""),L(P=>({...P,referenced_entity:{type:f,id:""}}))},children:[e.jsx(xe,{className:"w-32",children:e.jsx(je,{placeholder:"No tag"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"none",children:"No tag"}),e.jsx(k,{value:"team_member",children:"Team Members"}),e.jsx(k,{value:"stakeholder",children:"Stakeholders"}),e.jsx(k,{value:"project",children:"Projects"})]})]}),_e!=="none"&&e.jsxs(fe,{value:Te,onValueChange:f=>{$e(f),L(P=>({...P,referenced_entity:{type:_e,id:f}}))},children:[e.jsx(xe,{className:"w-40",children:e.jsx(je,{placeholder:"Select name"})}),e.jsxs(ge,{children:[_e==="team_member"&&d.filter(f=>f.id!==t).map(f=>e.jsx(k,{value:f.id,children:f.name},f.id)),_e==="stakeholder"&&j.map(f=>e.jsx(k,{value:f.id,children:f.name},f.id)),_e==="project"&&x.map(f=>e.jsx(k,{value:f.id,children:f.name},f.id))]})]}),e.jsx(E,{onClick:()=>{q.text&&(W(f=>({...f,notes:[...Array.isArray(f.notes)?f.notes:[],{text:q.text,referenced_entity:_e==="none"?{}:{type:_e,id:Te},created_by:t,timestamp:new Date().toISOString()}]})),L({text:"",referenced_entity:{type:"team_member",id:""}}),qe("none"),$e(""))},disabled:!q.text||_e!=="none"&&!Te,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Next Meeting Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),Y.next_meeting_date?Q(H(Y.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:Y.next_meeting_date?H(Y.next_meeting_date):void 0,onSelect:f=>W(P=>({...P,next_meeting_date:f==null?void 0:f.toISOString()}))})})]})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(E,{onClick:Xs,children:"Create Meeting"})]})]})}),e.jsx(Ye,{open:I,onOpenChange:R,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Add Action Item"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Description"}),e.jsx(ie,{value:ne.description,onChange:f=>ce(P=>({...P,description:f.target.value})),placeholder:"What needs to be done?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Due Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),ne.due_date?Q(H(ne.due_date),"PPP"):"Set due date"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:ne.due_date?H(ne.due_date):void 0,onSelect:f=>ce(P=>({...P,due_date:f==null?void 0:f.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Link to Task (Optional)"}),e.jsxs(fe,{value:ne.linked_task_id,onValueChange:f=>ce(P=>({...P,linked_task_id:f})),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select a task"})}),e.jsxs(ge,{children:[e.jsx(k,{value:null,children:"None"}),m.map(f=>e.jsx(k,{value:f.id,children:f.title},f.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Link to Project (Optional)"}),e.jsxs(fe,{value:ne.linked_project_id,onValueChange:f=>ce(P=>({...P,linked_project_id:f})),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select a project"})}),e.jsxs(ge,{children:[e.jsx(k,{value:null,children:"None"}),x.map(f=>e.jsx(k,{value:f.id,children:f.name},f.id))]})]})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsx(E,{onClick:Qs,children:"Add Action Item"})]})]})}),e.jsx(Ye,{open:Oe,onOpenChange:Le,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Reschedule Next 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Current Date"}),e.jsx("p",{className:"text-sm text-gray-600",children:_&&Q(H(_.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"New Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),ot?Q(H(ot),"PPP"):"Select new date"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:ot?H(ot):void 0,onSelect:f=>Nt((f==null?void 0:f.toISOString())||"")})})]})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>{Le(!1),Nt("")},children:"Cancel"}),e.jsx(E,{onClick:K,disabled:!ot,children:"Reschedule Meeting"})]})]})}),e.jsx(Ye,{open:le,onOpenChange:re,children:e.jsx(Be,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:e.jsx(Cd,{duty:Z,teamMembers:d,onSave:Es,onCancel:()=>{re(!1),z(null)}})})})]})}function nl(){const a=Ba(),[t,s]=c.useState([]),[r,n]=c.useState([]),[i,l]=c.useState([]),[o,m]=c.useState({}),[u,x]=c.useState(""),[h,d]=c.useState(!1),[p,j]=c.useState(null),[y,b]=c.useState(!0),[F,N]=c.useState(null),[w,S]=c.useState({name:"",role:"",email:"",phone:"",department:"",organization:"",collaboration_context:"",relationship_type:"cross_team",availability:"full_time",skills:[],notes:"",avatar:""});c.useEffect(()=>{v()},[]);const v=async()=>{var O;b(!0),N(null);try{const[q,L,M]=await Promise.all([js.list().catch(()=>[]),xt.list().catch(()=>[]),Fe.list().catch(()=>[])]);s(L||[]),l(M||[]);let g={};try{g=await((O=Bt.getAgendaSummaryForAllPeers)==null?void 0:O.call(Bt))||{}}catch(W){console.error("Failed to load agenda data:",W)}m(g);const Y=(q||[]).map(W=>{const ne=(L||[]).filter(qe=>{var Te,$e;return((($e=(Te=qe.metadata)==null?void 0:Te.meeting)==null?void 0:$e.participants)||[]).includes(W.name)});let ce=null;ne.length>0&&(ce=ne.reduce((qe,Te)=>{const $e=new Date(Te.created_date);return!qe||$e>qe?$e:qe},null));const _e=g[W.id]||{count:0,recentItems:[],hasUnresolved:!1};return{...W,tasks:ne,taskCount:ne.length,lastActivity:ce?ce.toISOString():null,agenda:_e}});n(Y)}catch(q){console.error("Failed to load peers:",q),N("Failed to load peers. Please try again.")}finally{b(!1)}},D=()=>{S({name:"",role:"",email:"",phone:"",department:"",organization:"",collaboration_context:"",relationship_type:"cross_team",availability:"full_time",skills:[],notes:"",avatar:""}),j(null),d(!0)},C=O=>{O&&(S({name:O.name||"",role:O.role||"",email:O.email||"",phone:O.phone||"",department:O.department||"",organization:O.organization||"",collaboration_context:O.collaboration_context||"",relationship_type:O.relationship_type||"cross_team",availability:O.availability||"full_time",skills:Array.isArray(O.skills)?O.skills:[],notes:O.notes||"",avatar:O.avatar||""}),j(O),d(!0))},I=(O,q)=>{if(O==="skills"){const L=Array.isArray(q)?q:[];S(M=>({...M,[O]:L}))}else S(L=>({...L,[O]:q}))},R=async()=>{try{p?await js.update(p.id,w):await js.create(w),d(!1),await v()}catch(O){console.error("Failed to save peer:",O),N("Failed to save peer. Please try again.")}},$=async O=>{try{await js.delete(O),await v()}catch(q){console.error("Failed to delete peer:",q),N("Failed to delete peer. Please try again.")}},J=u?r.filter(O=>O.name.toLowerCase().includes(u.toLowerCase())||(O.role||"").toLowerCase().includes(u.toLowerCase())||(O.department||"").toLowerCase().includes(u.toLowerCase())||(O.organization||"").toLowerCase().includes(u.toLowerCase())||(O.collaboration_context||"").toLowerCase().includes(u.toLowerCase())||(O.relationship_type||"").toLowerCase().includes(u.toLowerCase())||Array.isArray(O.skills)&&O.skills.some(q=>q.toLowerCase().includes(u.toLowerCase()))):r,le=O=>O.split(" ").map(q=>q[0]).join("").toUpperCase().substring(0,2),re=O=>{const q=["bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-purple-100 text-purple-800","bg-pink-100 text-pink-800","bg-yellow-100 text-yellow-800","bg-indigo-100 text-indigo-800","bg-red-100 text-red-800","bg-orange-100 text-orange-800"],L=O.split("").reduce((M,g)=>M+g.charCodeAt(0),0)%q.length;return q[L]},Z=O=>{if(!O)return"No recent activity";const q=new Date(O),M=new Date-q,g=Math.floor(M/(1e3*60*60*24));return g===0?"Today":g===1?"Yesterday":g<7?`${g} days ago`:g<30?`${Math.floor(g/7)} week${Math.floor(g/7)>1?"s":""} ago`:g<365?`${Math.floor(g/30)} month${Math.floor(g/30)>1?"s":""} ago`:`${Math.floor(g/365)} year${Math.floor(g/365)>1?"s":""} ago`},z=O=>{const q={full_time:"bg-green-100 text-green-800",part_time:"bg-blue-100 text-blue-800",contractor:"bg-orange-100 text-orange-800",remote:"bg-purple-100 text-purple-800"},L={full_time:"Full-time",part_time:"Part-time",contractor:"Contractor",remote:"Remote"};return e.jsx(te,{className:q[O]||"bg-gray-100 text-gray-800",children:L[O]||O})},ae=O=>{a(qt("PeerProfile")+`?id=${O}`)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Peers"}),e.jsxs(E,{onClick:D,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add Peer"]})]}),F&&e.jsx(mt,{variant:"destructive",className:"mb-6",children:e.jsx(ut,{children:F})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ie,{placeholder:"Search peers by name, role, organization, department, context, or skills...",value:u,onChange:O=>x(O.target.value),className:"pl-9"})]}),y?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading peers..."})]}):J.length===0?e.jsx("div",{className:"text-center p-12 border border-dashed rounded-lg",children:u?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No peers found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search term"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No peers yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add peers to track cross-team and external collaborators"}),e.jsxs(E,{onClick:D,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add First Peer"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:J.map(O=>{const q=re(O.name);return e.jsxs(me,{className:"overflow-hidden",children:[e.jsxs(be,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 cursor-pointer group",onClick:()=>ae(O.id),children:[e.jsxs(bs,{className:`h-12 w-12 ${O.avatar?"":q} ring-2 ring-white transition-transform group-hover:scale-105`,children:[O.avatar?e.jsx(pa,{src:O.avatar,alt:O.name}):null,e.jsx(Ns,{children:le(O.name)})]}),e.jsxs("div",{children:[e.jsx(Ne,{className:"group-hover:text-indigo-600 transition-colors",children:O.name}),O.role&&e.jsx(kt,{className:"mt-1",children:O.role}),O.organization&&e.jsxs(kt,{className:"mt-1 flex items-center gap-1",children:[e.jsx(Ao,{className:"h-3 w-3"}),O.organization]})]})]}),e.jsxs(ss,{children:[e.jsx(as,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(La,{className:"h-4 w-4"})})}),e.jsxs(Qt,{align:"end",children:[e.jsxs(et,{onClick:()=>C(O),children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(et,{onClick:()=>$(O.id),className:"text-red-600",children:[e.jsx(Dt,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[O.department&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(oi,{className:"h-3 w-3"}),O.department]}),O.relationship_type&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"h-3 w-3"}),O.relationship_type.replace(/_/g," ")]}),O.collaboration_context&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"h-3 w-3"}),O.collaboration_context]}),O.availability&&z(O.availability),O.agenda&&e.jsx(Zi,{count:O.agenda.count,unresolvedCount:O.agenda.hasUnresolved?O.agenda.count:0,hasUnresolved:O.agenda.hasUnresolved,onClick:()=>ae(O.id),memberName:O.name,size:"sm"})]})]}),e.jsxs(ue,{className:"space-y-4",children:[Array.isArray(O.skills)&&O.skills.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(ci,{className:"h-3.5 w-3.5"}),"Skills"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:Array.isArray(O.skills)&&O.skills.map((L,M)=>e.jsx(te,{variant:"outline",className:"text-xs",children:L},M))})]}),O.notes&&e.jsx("p",{className:"text-sm text-gray-600",children:O.notes}),Array.isArray(O.tasks)&&O.tasks.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Recent Meetings"}),e.jsx("div",{className:"space-y-2",children:O.tasks.filter(L=>L.type==="meeting").sort((L,M)=>new Date(M.created_date)-new Date(L.created_date)).slice(0,2).map(L=>e.jsx("div",{className:"p-2 bg-gray-50 rounded-md text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"truncate",children:L.title}),e.jsxs(te,{variant:"outline",className:"ml-2 flex items-center gap-1 whitespace-nowrap",children:[e.jsx(di,{className:"h-3 w-3"}),L.status]})]})},L.id))})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),Z(O.lastActivity)]}),O.taskCount>0&&e.jsxs("span",{children:[O.taskCount," meetings"]})]}),i.length>0&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-2",children:"Add to team member agendas:"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.slice(0,2).map(L=>e.jsx(ts,{teamMemberId:L.id,teamMemberName:L.name,sourceItem:{title:`Peer: ${O.name}`,description:`${O.role?`${O.role} - `:""}${O.organization||""}${O.collaboration_context?` | Context: ${O.collaboration_context}`:""}${O.notes?` | ${O.notes}`:""}`,type:"peer",id:O.id,relationship_type:O.relationship_type,department:O.department},variant:"ghost",size:"xs",showAgendaAction:!0,showPersonalFileAction:!0},L.id)),i.length>2&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",i.length-2," more"]})]})]})]}),O.email&&e.jsx(Hs,{className:"border-t pt-4",children:e.jsxs("a",{href:`mailto:${O.email}`,className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(mi,{className:"h-3.5 w-3.5"}),O.email]})})]},O.id)})})]}),e.jsx(Ye,{open:h,onOpenChange:d,children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsx(Ge,{children:e.jsx(We,{children:p?"Edit Peer":"Add Peer"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:"Name"}),e.jsx(ie,{id:"name",value:w.name,onChange:O=>I("name",O.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"role",children:"Role / Position"}),e.jsx(ie,{id:"role",value:w.role,onChange:O=>I("role",O.target.value),placeholder:"e.g. Product Manager"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"department",children:"Department"}),e.jsx(ie,{id:"department",value:w.department,onChange:O=>I("department",O.target.value),placeholder:"e.g. Engineering"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"organization",children:"Group"}),e.jsx(ie,{id:"organization",value:w.organization,onChange:O=>I("organization",O.target.value),placeholder:"e.g. Acme Corp"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"email",children:"Email"}),e.jsx(ie,{id:"email",type:"email",value:w.email,onChange:O=>I("email",O.target.value),placeholder:"Email address"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"phone",children:"Phone"}),e.jsx(ie,{id:"phone",type:"tel",value:w.phone,onChange:O=>I("phone",O.target.value),placeholder:"Phone number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"relationship_type",children:"Relationship Type"}),e.jsxs(fe,{value:w.relationship_type,onValueChange:O=>I("relationship_type",O),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select relationship type"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"cross_team",children:"Cross-team"}),e.jsx(k,{value:"external_partner",children:"External Partner"}),e.jsx(k,{value:"client_contact",children:"Client Contact"}),e.jsx(k,{value:"contractor",children:"Contractor"}),e.jsx(k,{value:"other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"collaboration_context",children:"Collaboration Context"}),e.jsx(ie,{id:"collaboration_context",value:w.collaboration_context,onChange:O=>I("collaboration_context",O.target.value),placeholder:"e.g. Project Apollo, Vendor Management"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"availability",children:"Availability"}),e.jsxs(fe,{value:w.availability,onValueChange:O=>I("availability",O),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select availability"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"full_time",children:"Full-time"}),e.jsx(k,{value:"part_time",children:"Part-time"}),e.jsx(k,{value:"contractor",children:"Contractor"}),e.jsx(k,{value:"remote",children:"Remote"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"skills",children:"Skills"}),e.jsx(Ua,{value:w.skills||[],onChange:O=>I("skills",O),placeholder:"Enter skills, press Enter or comma to add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Press Enter or comma after each skill"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"avatar",children:"Avatar URL (optional)"}),e.jsx(ie,{id:"avatar",value:w.avatar,onChange:O=>I("avatar",O.target.value),placeholder:"https://example.com/avatar.jpg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"notes",children:"Notes"}),e.jsx(Rt,{id:"notes",value:w.notes,onChange:O=>I("notes",O.target.value),placeholder:"Additional information about this peer",rows:3})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(E,{onClick:R,children:p?"Update":"Add"})]})]})})]})}const Od=({peerId:a,year:t,showBreakdown:s=!1,showYearSelector:r=!1,onStatsChange:n,className:i=""})=>{const l=new Date().getFullYear(),[o,m]=c.useState(t||l),[u,x]=c.useState(null),[h,d]=c.useState(!0),[p,j]=c.useState(null),y=c.useMemo(()=>{const D=[];for(let C=0;C<3;C++)D.push(l-C);return D},[l]),b=async D=>{if(!a){x(null),d(!1);return}try{d(!0),j(null);const C=await St.getYearlyStatsForPeer(a,D);x(C),n&&n(C)}catch(C){console.error("Failed to load peer out of office stats:",C),j(C.message),x(null)}finally{d(!1)}};c.useEffect(()=>{b(o)},[a,o]);const F=D=>{m(parseInt(D))},N=D=>St.getReasonType(D)||{name:D,color:"#6b7280"},w=c.useMemo(()=>!u||!u.reasonBreakdown?[]:Object.entries(u.reasonBreakdown).map(([D,C])=>({reason:D,days:C,display:N(D)})).sort((D,C)=>C.days-D.days),[u]);if(h)return e.jsxs(me,{className:`animate-pulse ${i}`,children:[e.jsx(be,{className:"pb-2",children:e.jsxs(Ne,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(ue,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]})]});if(p)return e.jsxs(me,{className:`border-red-200 ${i}`,children:[e.jsx(be,{className:"pb-2",children:e.jsxs(Ne,{className:"text-sm font-medium text-red-600 flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(ue,{children:[e.jsx("p",{className:"text-sm text-red-600",children:"Failed to load stats"}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>b(o),className:"mt-2",children:"Retry"})]})]});const S=(u==null?void 0:u.totalDays)||0,v=o===l;return e.jsxs(me,{className:i,children:[e.jsx(be,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ne,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Out of Office Days"]}),r&&e.jsxs(fe,{value:o.toString(),onValueChange:F,children:[e.jsx(xe,{className:"w-20 h-8 text-xs",children:e.jsx(je,{})}),e.jsx(ge,{children:y.map(D=>e.jsx(k,{value:D.toString(),children:D},D))})]})]})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:S}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[S===1?"day":"days"," in ",o,v&&e.jsx(te,{variant:"secondary",className:"ml-2 text-xs",children:"Current"})]})]}),s&&w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(hi,{className:"h-3 w-3"}),"Breakdown"]}),e.jsx("div",{className:"space-y-1",children:w.map(({reason:D,days:C,display:I})=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:I.color}}),e.jsx("span",{children:I.name})]}),e.jsxs("span",{className:"font-medium",children:[C," ",C===1?"day":"days"]})]},D))})]}),S===0&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),"No out of office periods in ",o]})]})})]})};function Dd({peerId:a,peerName:t,outOfOfficePeriods:s=[],onAdd:r,onRemove:n}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Out-of-Office Management"}),e.jsx("div",{className:"space-y-2",children:s.length===0?e.jsxs("p",{className:"text-gray-500",children:["No out-of-office periods recorded for ",t,"."]}):s.map(i=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:"outline",children:i.status}),e.jsxs("span",{children:[i.start_date," - ",i.end_date]}),i.notes&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.notes,")"]}),e.jsx("button",{className:"text-red-500 ml-2",onClick:()=>n(i.id),children:"Remove"})]},i.id))}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:r,children:"Add Out-of-Office"})]})}function il(){var Ss;const[a]=Or(),t=a.get("id"),[s,r]=c.useState(null),[n,i]=c.useState([]),[l,o]=c.useState([]),[m,u]=c.useState([]),[x,h]=c.useState([]),[d,p]=c.useState([]),[j,y]=c.useState([]),[b,F]=c.useState(null),[N,w]=c.useState(!0),[S,v]=c.useState(!1),[D,C]=c.useState(!1),[I,R]=c.useState(null),[$,J]=c.useState({text:"",referenced_entity:{type:"peer",id:""}}),[le,re]=c.useState(null),[Z,z]=c.useState({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),[ae,O]=c.useState({description:"",due_date:"",linked_task_id:"",linked_project_id:"",status:"open"}),[q,L]=c.useState("none"),[M,g]=c.useState(""),[Y,W]=c.useState(null),[ne,ce]=c.useState(null),[_e,qe]=c.useState(!1),[Te,$e]=c.useState(""),[Ft,ft]=c.useState(()=>{try{return JSON.parse(localStorage.getItem("discussedNotes")||"{}")}catch{return{}}});c.useEffect(()=>{t&&_()},[t]);const _=async()=>{var A;w(!0);try{const se=await js.get(t);r(se);const K=(await Re.list()).filter(Ie=>Ie.peer_id===t);i(K);try{const Ie=await((A=Bt.getAgendaItemsForPeer)==null?void 0:A.call(Bt,t))||[];o(Ie)}catch(Ie){console.error("Error loading agenda items:",Ie),o([])}const Se=await xt.list(),He=await Pt.list();u(Se),h(He),p(await js.list()),y(await cs.list()),await de(K)}catch(se){console.error("Error loading peer data:",se)}finally{w(!1)}},de=async A=>{var se;try{const he=A.filter(K=>K.next_meeting_date).sort((K,Se)=>new Date(K.next_meeting_date)-new Date(Se.next_meeting_date));if(he.length>0){const K=he[0];let Se=null;if(K.next_meeting_calendar_event_id)try{const He=await((se=Me.getOneOnOneMeetingsForPeer)==null?void 0:se.call(Me,t));Se=He==null?void 0:He.find(Ie=>Ie.id===K.next_meeting_calendar_event_id)}catch(He){console.error("Error loading calendar event:",He)}ce({oneOnOne:K,calendarEvent:Se,hasCalendarEvent:!!Se,meetingDate:K.next_meeting_date})}else ce(null)}catch(he){console.error("Error loading next meeting info:",he),ce(null)}},Oe=async()=>{var A;try{const se=await Re.create({...Z,notes:Array.isArray(Z.notes)?Z.notes:[],peer_id:t});if(Z.next_meeting_date&&s)try{const he=await((A=Me.createAndLinkOneOnOneMeetingForPeer)==null?void 0:A.call(Me,se.id,t,Z.next_meeting_date));console.log("Calendar event created successfully:",he==null?void 0:he.calendarEvent)}catch(he){console.error("Error creating calendar event:",he)}v(!1),z({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),_()}catch(se){console.error("Error creating 1:1 meeting:",se)}},Le=async()=>{if(I)try{const A={...I,action_items:[...I.action_items||[],ae]};await Re.update(I.id,A),C(!1),_()}catch(A){console.error("Error adding action item:",A)}},ot=async A=>{if(!$.text)return;let se=null;q!=="none"&&M&&(se={type:q,id:M});const he=n.find(He=>He.id===A);if(!he)return;const K={text:$.text,referenced_entity:se,created_by:t,timestamp:new Date().toISOString()},Se=Array.isArray(he.notes)?[...he.notes,K]:[K];await Re.update(A,{...he,notes:Se}),J({text:"",referenced_entity:{type:"peer",id:""}}),re(null),_()},Nt=async(A,se,he)=>{try{const K=n.find(He=>He.id===A);if(!K)return;const Se=[...K.action_items];Se[se]={...Se[se],status:he},await Re.update(A,{...K,action_items:Se}),_()}catch(K){console.error("Error updating action item status:",K)}},Qe=async A=>{var se;try{try{await((se=Me.unlinkCalendarEventFromOneOnOne)==null?void 0:se.call(Me,A))}catch(he){console.error("Error deleting associated calendar event:",he)}await Re.delete(A),_()}catch(he){console.error("Error deleting meeting:",he)}},Ke=async A=>{var se;try{await((se=Bt.markAgendaItemDiscussed)==null?void 0:se.call(Bt,A.meetingId,A.timestamp))&&_()}catch(he){console.error("Error marking agenda item as discussed:",he)}},Xe=async(A,se)=>{var he,K;try{const Se=n.find(Ie=>Ie.id===A);if(!Se)return;const He={...Se,next_meeting_date:se};if(await Re.update(A,He),se&&s)try{await((he=Me.updateOneOnOneCalendarEventForPeer)==null?void 0:he.call(Me,A,se)),console.log("Calendar event updated successfully for meeting:",A)}catch(Ie){console.error("Error updating calendar event:",Ie)}else if(!se&&Se.next_meeting_calendar_event_id)try{await((K=Me.unlinkCalendarEventFromOneOnOne)==null?void 0:K.call(Me,A)),console.log("Calendar event removed for meeting:",A)}catch(Ie){console.error("Error removing calendar event:",Ie)}_()}catch(Se){console.error("Error updating next meeting date:",Se)}},Fs=async()=>{if(!(!ne||!Te))try{await Xe(ne.oneOnOne.id,Te),qe(!1),$e("")}catch(A){console.error("Error rescheduling meeting:",A)}},Xs=async()=>{if(ne)try{await Xe(ne.oneOnOne.id,"")}catch(A){console.error("Error canceling meeting:",A)}};if(N)return e.jsx("div",{className:"p-6",children:"Loading..."});if(!s)return e.jsx("div",{className:"p-6",children:"Peer not found"});const Qs=A=>({open:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[A]||"bg-gray-100 text-gray-800",Js=A=>({great:"😄",good:"🙂",neutral:"😐",concerned:"😟"})[A]||"😐";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(ca,{to:"/peers",children:e.jsxs(E,{variant:"ghost",children:[e.jsx(xa,{className:"h-4 w-4 mr-2"}),"Back to Peers"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(bs,{className:"h-16 w-16",children:s.avatar?e.jsx(pa,{src:s.avatar,alt:s.name}):e.jsx(Ns,{children:s.name.split(" ").map(A=>A[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s.name}),e.jsx("p",{className:"text-gray-500",children:s.role||s.title})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Ne,{children:"1:1 Meetings"}),e.jsxs(E,{onClick:()=>v(!0),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"New 1:1"]})]})}),e.jsx(ue,{children:n.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(es,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No 1:1 meetings recorded yet"})]}):e.jsx("div",{className:"space-y-6",children:n.sort((A,se)=>new Date(se.date)-new Date(A.date)).map(A=>{var se,he;return e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[Q(H(A.date),"PPP"),e.jsx("span",{className:"text-xl",children:Js(A.mood)})]}),e.jsx(kt,{className:"flex items-center gap-2",children:Y===A.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Next meeting:"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",size:"sm",className:"h-8 text-xs",children:[e.jsx(Ee,{className:"mr-1 h-3 w-3"}),A.next_meeting_date?Q(H(A.next_meeting_date),"MMM d"):"Select date"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:A.next_meeting_date?H(A.next_meeting_date):void 0,onSelect:K=>{const Se=(K==null?void 0:K.toISOString())||"";Xe(A.id,Se),W(null)}})})]}),e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>W(null),children:"Cancel"}),A.next_meeting_date&&e.jsx(E,{variant:"ghost",size:"sm",className:"h-8 px-2 text-red-500",onClick:()=>{Xe(A.id,""),W(null)},children:"Clear"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Next meeting: ",A.next_meeting_date?Q(H(A.next_meeting_date),"PPP"):"Not scheduled"]}),e.jsx(E,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>W(A.id),children:"Edit"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{R(A),C(!0)},children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Add Action Item"]}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>Qe(A.id),title:"Delete meeting",children:e.jsx(Dt,{className:"h-5 w-5 text-red-500"})})]})]})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-4",children:[Array.isArray(A.notes)&&A.notes.filter(K=>!K.referenced_entity||!K.referenced_entity.id||String(K.referenced_entity.id)!==String(t)).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),e.jsx("ul",{className:"list-disc pl-5",children:A.notes.filter(K=>!K.referenced_entity||!K.referenced_entity.id||String(K.referenced_entity.id)!==String(t)).map((K,Se)=>{var He,Ie,Es,rs;return e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{children:K.text}),((He=K.referenced_entity)==null?void 0:He.id)&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[K.referenced_entity.type==="peer"&&((Ie=d.find(Gt=>String(Gt.id)===String(K.referenced_entity.id)))==null?void 0:Ie.name),K.referenced_entity.type==="stakeholder"&&((Es=j.find(Gt=>String(Gt.id)===String(K.referenced_entity.id)))==null?void 0:Es.name),K.referenced_entity.type==="project"&&((rs=x.find(Gt=>String(Gt.id)===String(K.referenced_entity.id)))==null?void 0:rs.name)]})]},Se)})})]}),e.jsxs("div",{className:"mt-2 flex gap-2 items-end",children:[e.jsx(ie,{className:"flex-1",placeholder:"Note text...",value:le===A.id?$.text:"",onChange:K=>{re(A.id),J(Se=>({...Se,text:K.target.value}))}}),e.jsxs(fe,{value:le===A.id?q:"none",onValueChange:K=>{re(A.id),L(K),g(""),J(Se=>({...Se,referenced_entity:K==="none"?null:{type:K,id:""}}))},children:[e.jsx(xe,{className:"w-32",children:e.jsx(je,{placeholder:"No tag"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"none",children:"No tag"}),e.jsx(k,{value:"peer",children:"Peers"}),e.jsx(k,{value:"stakeholder",children:"Stakeholders"}),e.jsx(k,{value:"project",children:"Projects"})]})]}),q!=="none"&&le===A.id&&e.jsxs(fe,{value:M,onValueChange:K=>{g(K),J(Se=>({...Se,referenced_entity:{type:q,id:K}}))},children:[e.jsx(xe,{className:"w-40",children:e.jsx(je,{placeholder:"Select name"})}),e.jsxs(ge,{children:[q==="peer"&&d.filter(K=>K.id.toString()!==(t==null?void 0:t.toString())).map(K=>e.jsx(k,{value:K.id,children:K.name},K.id)),q==="stakeholder"&&j.map(K=>e.jsx(k,{value:K.id,children:K.name},K.id)),q==="project"&&x.map(K=>e.jsx(k,{value:K.id,children:K.name},K.id))]})]}),e.jsx(E,{onClick:()=>{re(A.id),ot(A.id)},disabled:!$.text||q!=="none"&&!M||le!==A.id,children:"Add"})]}),((se=A.topics_discussed)==null?void 0:se.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Topics Discussed"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:A.topics_discussed.map((K,Se)=>e.jsx(te,{variant:"secondary",children:K},Se))})]}),((he=A.action_items)==null?void 0:he.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Action Items"}),e.jsxs(fa,{children:[e.jsx(ya,{children:e.jsxs(hs,{children:[e.jsx(tt,{children:"Description"}),e.jsx(tt,{children:"Due Date"}),e.jsx(tt,{children:"Status"}),e.jsx(tt,{children:"Links"}),e.jsx(tt,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ja,{children:A.action_items.map((K,Se)=>e.jsxs(hs,{children:[e.jsx(st,{children:K.description}),e.jsx(st,{children:K.due_date?Q(H(K.due_date),"MMM d, yyyy"):"No due date"}),e.jsx(st,{children:e.jsx(te,{className:Qs(K.status),children:K.status})}),e.jsx(st,{children:(K.linked_task_id||K.linked_project_id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[K.linked_task_id&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ra,{className:"h-3 w-3"}),"Task"]}),K.linked_project_id&&e.jsxs(te,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ra,{className:"h-3 w-3"}),"Project"]})]})}),e.jsx(st,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>Nt(A.id,Se,"completed"),disabled:K.status==="completed",children:e.jsx(Yt,{className:"h-4 w-4 text-green-500"})}),e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>Nt(A.id,Se,"in_progress"),disabled:K.status==="in_progress",children:e.jsx(Ze,{className:"h-4 w-4 text-blue-500"})})]})})]},Se))})]})]})]})})]},A.id)})})})]}),e.jsx(Dd,{peerId:t,peerName:s==null?void 0:s.name})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(me,{children:[e.jsx(be,{children:e.jsx(Ne,{children:"Peer Info"})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-4",children:[s.company&&e.jsxs("div",{children:[e.jsx(V,{children:"Company"}),e.jsx("p",{className:"text-gray-600",children:s.company})]}),s.department&&e.jsxs("div",{children:[e.jsx(V,{children:"Department"}),e.jsx("p",{className:"text-gray-600",children:s.department})]}),((Ss=s.skills)==null?void 0:Ss.length)>0&&e.jsxs("div",{children:[e.jsx(V,{children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.skills.map((A,se)=>e.jsx(te,{variant:"secondary",children:A},se))})]}),s.notes&&e.jsxs("div",{children:[e.jsx(V,{children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:s.notes})]}),s.contact_info&&e.jsxs("div",{children:[e.jsx(V,{children:"Contact Info"}),e.jsx("p",{className:"text-gray-600",children:s.contact_info})]})]})})]}),e.jsx(Od,{peerId:t,showBreakdown:!0,showYearSelector:!0,onStatsChange:F}),e.jsxs(me,{children:[e.jsx(be,{children:e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Next 1:1 Meeting"]})}),e.jsx(ue,{children:ne?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Scheduled Date"}),e.jsx("p",{className:"text-gray-900 font-medium",children:Q(H(ne.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:ne.hasCalendarEvent?e.jsxs(te,{variant:"outline",className:"text-green-700 border-green-200 bg-green-50",children:[e.jsx(Yt,{className:"h-3 w-3 mr-1"}),"Calendar Event Created"]}):e.jsxs(te,{variant:"outline",className:"text-yellow-700 border-yellow-200 bg-yellow-50",children:[e.jsx(ms,{className:"h-3 w-3 mr-1"}),"No Calendar Event"]})})]}),ne.calendarEvent&&e.jsxs("div",{children:[e.jsx(V,{children:"Calendar Event"}),e.jsx("p",{className:"text-sm text-gray-600",children:ne.calendarEvent.title})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{$e(ne.meetingDate),qe(!0)},children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),"Reschedule"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:Xs,className:"text-red-600 hover:text-red-700",children:[e.jsx(vi,{className:"h-4 w-4 mr-1"}),"Cancel"]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Ee,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No upcoming 1:1 scheduled"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Schedule your next meeting from any 1:1 record"})]})})]}),e.jsxs(me,{children:[e.jsx(be,{children:e.jsx(Ne,{children:"Quick Stats"})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(V,{children:"Last 1:1"}),e.jsx("p",{className:"text-gray-600",children:n[0]?Q(H(n[0].date),"PPP"):"No meetings yet"})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Meeting Frequency"}),e.jsx("p",{className:"text-gray-600",children:n.length>1?(()=>{const A=n.filter(he=>he.date).sort((he,K)=>new Date(K.date)-new Date(he.date));if(A.length<2)return"Insufficient data";const se=Math.round((new Date(A[0].date)-new Date(A[1].date))/(1e3*60*60*24));return se<=10?"Weekly":se<=20?"Bi-weekly":se<=35?"Monthly":"Irregular"})():"No pattern yet"})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Open Action Items"}),e.jsx("p",{className:"text-gray-600",children:n.reduce((A,se)=>{var he;return A+(((he=se.action_items)==null?void 0:he.filter(K=>K.status!=="completed").length)||0)},0)})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Agenda Items"}),e.jsxs("p",{className:"text-gray-600",children:[l.length," total, ",l.filter(A=>!A.isDiscussed).length," pending"]})]}),e.jsxs("div",{children:[e.jsx(V,{children:"Total 1:1s"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:n.length}),n.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(since ",Q(H(n[n.length-1].date),"MMM yyyy"),")"]})]})]})]})})]}),e.jsxs(me,{children:[e.jsxs(be,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5"}),"Next Agenda Items"]}),e.jsx(kt,{children:"Items from other meetings where you are tagged"})]}),e.jsxs(ue,{children:[l.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(es,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No agenda items yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You'll see items here when others tag you in their meeting notes"})]}):e.jsx(la,{agendaItems:l.slice(0,5),peers:d.reduce((A,se)=>(A[se.id]=se,A),{}),onMarkDiscussed:Ke,showActions:!0,emptyMessage:"No agenda items found"}),l.length>5&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Showing 5 of ",l.length," items"]})})]})]})]})]})]}),e.jsx(Ye,{open:S,onOpenChange:v,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"New 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),Z.date?Q(H(Z.date),"PPP"):"Select date"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:Z.date?H(Z.date):void 0,onSelect:A=>z(se=>({...se,date:A==null?void 0:A.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Mood"}),e.jsxs(fe,{value:Z.mood,onValueChange:A=>z(se=>({...se,mood:A})),children:[e.jsx(xe,{children:e.jsx(je,{})}),e.jsxs(ge,{children:[e.jsx(k,{value:"great",children:"Great 😄"}),e.jsx(k,{value:"good",children:"Good 🙂"}),e.jsx(k,{value:"neutral",children:"Neutral 😐"}),e.jsx(k,{value:"concerned",children:"Concerned 😟"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Notes"}),Array.isArray(Z.notes)&&Z.notes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mb-2",children:Z.notes.map((A,se)=>{var he,K,Se,He;return e.jsxs("li",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{children:A.text}),((he=A.referenced_entity)==null?void 0:he.id)&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[A.referenced_entity.type==="peer"&&((K=d.find(Ie=>Ie.id===A.referenced_entity.id))==null?void 0:K.name),A.referenced_entity.type==="stakeholder"&&((Se=j.find(Ie=>Ie.id===A.referenced_entity.id))==null?void 0:Se.name),A.referenced_entity.type==="project"&&((He=x.find(Ie=>Ie.id===A.referenced_entity.id))==null?void 0:He.name)]}),e.jsx(E,{variant:"ghost",size:"xs",className:"ml-2",onClick:()=>z(Ie=>({...Ie,notes:Ie.notes.filter((Es,rs)=>rs!==se)})),children:"Remove"})]},se)})}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(ie,{className:"flex-1",placeholder:"Note text...",value:$.text,onChange:A=>J(se=>({...se,text:A.target.value}))}),e.jsxs(fe,{value:q,onValueChange:A=>{L(A),g(""),J(se=>({...se,referenced_entity:{type:A,id:""}}))},children:[e.jsx(xe,{className:"w-32",children:e.jsx(je,{placeholder:"No tag"})}),e.jsxs(ge,{children:[e.jsx(k,{value:"none",children:"No tag"}),e.jsx(k,{value:"peer",children:"Peers"}),e.jsx(k,{value:"stakeholder",children:"Stakeholders"}),e.jsx(k,{value:"project",children:"Projects"})]})]}),q!=="none"&&e.jsxs(fe,{value:M,onValueChange:A=>{g(A),J(se=>({...se,referenced_entity:{type:q,id:A}}))},children:[e.jsx(xe,{className:"w-40",children:e.jsx(je,{placeholder:"Select name"})}),e.jsxs(ge,{children:[q==="peer"&&d.filter(A=>A.id!==t).map(A=>e.jsx(k,{value:A.id,children:A.name},A.id)),q==="stakeholder"&&j.map(A=>e.jsx(k,{value:A.id,children:A.name},A.id)),q==="project"&&x.map(A=>e.jsx(k,{value:A.id,children:A.name},A.id))]})]}),e.jsx(E,{onClick:()=>{$.text&&(z(A=>({...A,notes:[...Array.isArray(A.notes)?A.notes:[],{text:$.text,referenced_entity:q==="none"?{}:{type:q,id:M},created_by:t,timestamp:new Date().toISOString()}]})),J({text:"",referenced_entity:{type:"peer",id:""}}),L("none"),g(""))},disabled:!$.text||q!=="none"&&!M,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Next Meeting Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),Z.next_meeting_date?Q(H(Z.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:Z.next_meeting_date?H(Z.next_meeting_date):void 0,onSelect:A=>z(se=>({...se,next_meeting_date:A==null?void 0:A.toISOString()}))})})]})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(E,{onClick:Oe,children:"Create Meeting"})]})]})}),e.jsx(Ye,{open:D,onOpenChange:C,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Add Action Item"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Description"}),e.jsx(ie,{value:ae.description,onChange:A=>O(se=>({...se,description:A.target.value})),placeholder:"What needs to be done?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Due Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),ae.due_date?Q(H(ae.due_date),"PPP"):"Set due date"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:ae.due_date?H(ae.due_date):void 0,onSelect:A=>O(se=>({...se,due_date:A==null?void 0:A.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Link to Task (Optional)"}),e.jsxs(fe,{value:ae.linked_task_id,onValueChange:A=>O(se=>({...se,linked_task_id:A})),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select a task"})}),e.jsxs(ge,{children:[e.jsx(k,{value:null,children:"None"}),m.map(A=>e.jsx(k,{value:A.id,children:A.title},A.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Link to Project (Optional)"}),e.jsxs(fe,{value:ae.linked_project_id,onValueChange:A=>O(se=>({...se,linked_project_id:A})),children:[e.jsx(xe,{children:e.jsx(je,{placeholder:"Select a project"})}),e.jsxs(ge,{children:[e.jsx(k,{value:null,children:"None"}),x.map(A=>e.jsx(k,{value:A.id,children:A.name},A.id))]})]})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(E,{onClick:Le,children:"Add Action Item"})]})]})}),e.jsx(Ye,{open:_e,onOpenChange:qe,children:e.jsxs(Be,{className:"sm:max-w-lg",children:[e.jsx(Ge,{children:e.jsx(We,{children:"Reschedule Next 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Current Date"}),e.jsx("p",{className:"text-sm text-gray-600",children:ne&&Q(H(ne.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"New Date"}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),Te?Q(H(Te),"PPP"):"Select new date"]})}),e.jsx(lt,{className:"w-auto p-0",children:e.jsx(it,{mode:"single",selected:Te?H(Te):void 0,onSelect:A=>$e((A==null?void 0:A.toISOString())||"")})})]})]})]}),e.jsxs(bt,{children:[e.jsx(E,{variant:"outline",onClick:()=>{qe(!1),$e("")},children:"Cancel"}),e.jsx(E,{onClick:Fs,disabled:!Te,children:"Reschedule Meeting"})]})]})})]})}const kd=()=>{const[a,t]=c.useState({username:"",password:""}),[s,r]=c.useState({}),[n,i]=c.useState(!1),[l,o]=c.useState(""),[m,u]=c.useState(0),{login:x,error:h,clearError:d}=Dr(),p=()=>{const b={};return a.username.trim()||(b.username="Username is required"),a.password.trim()||(b.password="Password is required"),r(b),Object.keys(b).length===0},j=b=>{const{name:F,value:N}=b.target;t(w=>({...w,[F]:N})),s[F]&&r(w=>({...w,[F]:""})),l&&o(""),h&&d&&d()},y=async b=>{var F,N;if(b.preventDefault(),!!p()){i(!0),o("");try{const w=await x(a.username,a.password);if(w.success)u(0);else{u(v=>v+1);let S=w.error||"Login failed. Please try again.";m>=2&&((F=w.error)!=null&&F.includes("Invalid username or password"))?S='Invalid username or password. Default credentials are username: "admin", password: "password123"':m>=1&&((N=w.error)!=null&&N.includes("storage"))&&(S=`${w.error} Try refreshing the page or using a different browser.`),o(S)}}catch(w){console.error("Login error:",w),u(v=>v+1);let S="Authentication failed. Please try again.";w.type==="STORAGE_UNAVAILABLE"?S="Browser storage is not available. Please enable cookies and local storage.":w.type==="STORAGE_QUOTA_EXCEEDED"?S="Browser storage is full. Please clear some browser data and try again.":m>=2&&(S="Repeated authentication failures. Please refresh the page or contact support."),o(S)}finally{i(!1)}}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:e.jsxs(me,{className:"w-full max-w-md",children:[e.jsxs(be,{className:"space-y-1",children:[e.jsx(Ne,{className:"text-2xl font-bold text-center",children:"Sign In"}),e.jsx(kt,{className:"text-center",children:"Enter your credentials to access the application"})]}),e.jsx(ue,{children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[h&&e.jsx(mt,{variant:"destructive",children:e.jsx(ut,{children:h})}),l&&e.jsx(mt,{variant:"destructive",children:e.jsx(ut,{children:l})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"username",children:"Username"}),e.jsx(ie,{id:"username",name:"username",type:"text",placeholder:"Enter your username",value:a.username,onChange:j,className:s.username?"border-destructive":"",disabled:n}),s.username&&e.jsx("p",{className:"text-sm text-destructive",children:s.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"password",children:"Password"}),e.jsx(ie,{id:"password",name:"password",type:"password",placeholder:"Enter your password",value:a.password,onChange:j,className:s.password?"border-destructive":"",disabled:n}),s.password&&e.jsx("p",{className:"text-sm text-destructive",children:s.password})]}),e.jsx(E,{type:"submit",className:"w-full",disabled:n,children:n?"Signing In...":"Sign In"}),m>=1&&e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.jsx("strong",{children:"Having trouble signing in?"})}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("li",{children:["• Default username: ",e.jsx("code",{className:"bg-background px-1 rounded",children:"admin"})]}),e.jsxs("li",{children:["• Default password: ",e.jsx("code",{className:"bg-background px-1 rounded",children:"password123"})]}),e.jsx("li",{children:"• Make sure cookies and local storage are enabled"}),e.jsx("li",{children:"• Try refreshing the page if you see storage errors"})]})]})]})})]})})},Td=({children:a})=>{const{isAuthenticated:t,loading:s}=Dr();return s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Pr,{})}):t?a:e.jsx(kd,{})},pn={Tasks:hr,Calendar:Hi,Metrics:Ki,Stakeholders:Xi,Projects:Qi,Settings:Ji,Team:el,ProjectDetails:tl,TeamMemberProfile:rl,Peers:nl,PeerProfile:il};function Id(a){a.endsWith("/")&&(a=a.slice(0,-1));let t=a.split("/").pop();return t.includes("?")&&(t=t.split("?")[0]),Object.keys(pn).find(r=>r.toLowerCase()===t.toLowerCase())||Object.keys(pn)[0]}function Ad(){const a=Ho(),t=Id(a.pathname);return e.jsx(Ic,{currentPageName:t,children:e.jsxs(Ko,{children:[e.jsx(Lt,{path:"/",element:e.jsx(hr,{})}),e.jsx(Lt,{path:"/Tasks",element:e.jsx(hr,{})}),e.jsx(Lt,{path:"/Calendar",element:e.jsx(Hi,{})}),e.jsx(Lt,{path:"/Metrics",element:e.jsx(Ki,{})}),e.jsx(Lt,{path:"/Stakeholders",element:e.jsx(Xi,{})}),e.jsx(Lt,{path:"/Projects",element:e.jsx(Qi,{})}),e.jsx(Lt,{path:"/Settings",element:e.jsx(Ji,{})}),e.jsx(Lt,{path:"/Team",element:e.jsx(el,{})}),e.jsx(Lt,{path:"/ProjectDetails",element:e.jsx(tl,{})}),e.jsx(Lt,{path:"/TeamMemberProfile",element:e.jsx(rl,{})}),e.jsx(Lt,{path:"/Peers",element:e.jsx(nl,{})}),e.jsx(Lt,{path:"/PeerProfile",element:e.jsx(il,{})})]})})}function Md(){return e.jsx(qo,{children:e.jsx(Td,{children:e.jsx(Ad,{})})})}var zr="ToastProvider",[Yr,Pd,Rd]=Po("Toast"),[ll,xm]=Mo("Toast",[Rd]),[Fd,Wa]=ll(zr),ol=a=>{const{__scopeToast:t,label:s="Notification",duration:r=5e3,swipeDirection:n="right",swipeThreshold:i=50,children:l}=a,[o,m]=c.useState(null),[u,x]=c.useState(0),h=c.useRef(!1),d=c.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${zr}\`. Expected non-empty \`string\`.`),e.jsx(Yr.Provider,{scope:t,children:e.jsx(Fd,{scope:t,label:s,duration:r,swipeDirection:n,swipeThreshold:i,toastCount:u,viewport:o,onViewportChange:m,onToastAdd:c.useCallback(()=>x(p=>p+1),[]),onToastRemove:c.useCallback(()=>x(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:d,children:l})})};ol.displayName=zr;var cl="ToastViewport",$d=["F8"],wr="toast.viewportPause",br="toast.viewportResume",dl=c.forwardRef((a,t)=>{const{__scopeToast:s,hotkey:r=$d,label:n="Notifications ({hotkey})",...i}=a,l=Wa(cl,s),o=Pd(s),m=c.useRef(null),u=c.useRef(null),x=c.useRef(null),h=c.useRef(null),d=wi(t,h,l.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),j=l.toastCount>0;c.useEffect(()=>{const b=F=>{var w;r.length!==0&&r.every(S=>F[S]||F.code===S)&&((w=h.current)==null||w.focus())};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[r]),c.useEffect(()=>{const b=m.current,F=h.current;if(j&&b&&F){const N=()=>{if(!l.isClosePausedRef.current){const D=new CustomEvent(wr);F.dispatchEvent(D),l.isClosePausedRef.current=!0}},w=()=>{if(l.isClosePausedRef.current){const D=new CustomEvent(br);F.dispatchEvent(D),l.isClosePausedRef.current=!1}},S=D=>{!b.contains(D.relatedTarget)&&w()},v=()=>{b.contains(document.activeElement)||w()};return b.addEventListener("focusin",N),b.addEventListener("focusout",S),b.addEventListener("pointermove",N),b.addEventListener("pointerleave",v),window.addEventListener("blur",N),window.addEventListener("focus",w),()=>{b.removeEventListener("focusin",N),b.removeEventListener("focusout",S),b.removeEventListener("pointermove",N),b.removeEventListener("pointerleave",v),window.removeEventListener("blur",N),window.removeEventListener("focus",w)}}},[j,l.isClosePausedRef]);const y=c.useCallback(({tabbingDirection:b})=>{const N=o().map(w=>{const S=w.ref.current,v=[S,...Qd(S)];return b==="forwards"?v:v.reverse()});return(b==="forwards"?N.reverse():N).flat()},[o]);return c.useEffect(()=>{const b=h.current;if(b){const F=N=>{var v,D,C;const w=N.altKey||N.ctrlKey||N.metaKey;if(N.key==="Tab"&&!w){const I=document.activeElement,R=N.shiftKey;if(N.target===b&&R){(v=u.current)==null||v.focus();return}const le=y({tabbingDirection:R?"backwards":"forwards"}),re=le.findIndex(Z=>Z===I);nr(le.slice(re+1))?N.preventDefault():R?(D=u.current)==null||D.focus():(C=x.current)==null||C.focus()}};return b.addEventListener("keydown",F),()=>b.removeEventListener("keydown",F)}},[o,y]),e.jsxs(Ro,{ref:m,role:"region","aria-label":n.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:j?void 0:"none"},children:[j&&e.jsx(Nr,{ref:u,onFocusFromOutsideViewport:()=>{const b=y({tabbingDirection:"forwards"});nr(b)}}),e.jsx(Yr.Slot,{scope:s,children:e.jsx(qs.ol,{tabIndex:-1,...i,ref:d})}),j&&e.jsx(Nr,{ref:x,onFocusFromOutsideViewport:()=>{const b=y({tabbingDirection:"backwards"});nr(b)}})]})});dl.displayName=cl;var ml="ToastFocusProxy",Nr=c.forwardRef((a,t)=>{const{__scopeToast:s,onFocusFromOutsideViewport:r,...n}=a,i=Wa(ml,s);return e.jsx(bi,{"aria-hidden":!0,tabIndex:0,...n,ref:t,style:{position:"fixed"},onFocus:l=>{var u;const o=l.relatedTarget;!((u=i.viewport)!=null&&u.contains(o))&&r()}})});Nr.displayName=ml;var wa="Toast",Ld="toast.swipeStart",Vd="toast.swipeMove",Bd="toast.swipeCancel",Ud="toast.swipeEnd",ul=c.forwardRef((a,t)=>{const{forceMount:s,open:r,defaultOpen:n,onOpenChange:i,...l}=a,[o,m]=Fo({prop:r,defaultProp:n??!0,onChange:i,caller:wa});return e.jsx($o,{present:s||o,children:e.jsx(Gd,{open:o,...l,ref:t,onClose:()=>m(!1),onPause:Fa(a.onPause),onResume:Fa(a.onResume),onSwipeStart:Jt(a.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Jt(a.onSwipeMove,u=>{const{x,y:h}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${x}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:Jt(a.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Jt(a.onSwipeEnd,u=>{const{x,y:h}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${x}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),m(!1)})})})});ul.displayName=wa;var[zd,Yd]=ll(wa,{onClose(){}}),Gd=c.forwardRef((a,t)=>{const{__scopeToast:s,type:r="foreground",duration:n,open:i,onClose:l,onEscapeKeyDown:o,onPause:m,onResume:u,onSwipeStart:x,onSwipeMove:h,onSwipeCancel:d,onSwipeEnd:p,...j}=a,y=Wa(wa,s),[b,F]=c.useState(null),N=wi(t,Z=>F(Z)),w=c.useRef(null),S=c.useRef(null),v=n||y.duration,D=c.useRef(0),C=c.useRef(v),I=c.useRef(0),{onToastAdd:R,onToastRemove:$}=y,J=Fa(()=>{var z;(b==null?void 0:b.contains(document.activeElement))&&((z=y.viewport)==null||z.focus()),l()}),le=c.useCallback(Z=>{!Z||Z===1/0||(window.clearTimeout(I.current),D.current=new Date().getTime(),I.current=window.setTimeout(J,Z))},[J]);c.useEffect(()=>{const Z=y.viewport;if(Z){const z=()=>{le(C.current),u==null||u()},ae=()=>{const O=new Date().getTime()-D.current;C.current=C.current-O,window.clearTimeout(I.current),m==null||m()};return Z.addEventListener(wr,ae),Z.addEventListener(br,z),()=>{Z.removeEventListener(wr,ae),Z.removeEventListener(br,z)}}},[y.viewport,v,m,u,le]),c.useEffect(()=>{i&&!y.isClosePausedRef.current&&le(v)},[i,v,y.isClosePausedRef,le]),c.useEffect(()=>(R(),()=>$()),[R,$]);const re=c.useMemo(()=>b?jl(b):null,[b]);return y.viewport?e.jsxs(e.Fragment,{children:[re&&e.jsx(Wd,{__scopeToast:s,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:re}),e.jsx(zd,{scope:s,onClose:J,children:Xo.createPortal(e.jsx(Yr.ItemSlot,{scope:s,children:e.jsx(Lo,{asChild:!0,onEscapeKeyDown:Jt(o,()=>{y.isFocusedToastEscapeKeyDownRef.current||J(),y.isFocusedToastEscapeKeyDownRef.current=!1}),children:e.jsx(qs.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":y.swipeDirection,...j,ref:N,style:{userSelect:"none",touchAction:"none",...a.style},onKeyDown:Jt(a.onKeyDown,Z=>{Z.key==="Escape"&&(o==null||o(Z.nativeEvent),Z.nativeEvent.defaultPrevented||(y.isFocusedToastEscapeKeyDownRef.current=!0,J()))}),onPointerDown:Jt(a.onPointerDown,Z=>{Z.button===0&&(w.current={x:Z.clientX,y:Z.clientY})}),onPointerMove:Jt(a.onPointerMove,Z=>{if(!w.current)return;const z=Z.clientX-w.current.x,ae=Z.clientY-w.current.y,O=!!S.current,q=["left","right"].includes(y.swipeDirection),L=["left","up"].includes(y.swipeDirection)?Math.min:Math.max,M=q?L(0,z):0,g=q?0:L(0,ae),Y=Z.pointerType==="touch"?10:2,W={x:M,y:g},ne={originalEvent:Z,delta:W};O?(S.current=W,Oa(Vd,h,ne,{discrete:!1})):fn(W,y.swipeDirection,Y)?(S.current=W,Oa(Ld,x,ne,{discrete:!1}),Z.target.setPointerCapture(Z.pointerId)):(Math.abs(z)>Y||Math.abs(ae)>Y)&&(w.current=null)}),onPointerUp:Jt(a.onPointerUp,Z=>{const z=S.current,ae=Z.target;if(ae.hasPointerCapture(Z.pointerId)&&ae.releasePointerCapture(Z.pointerId),S.current=null,w.current=null,z){const O=Z.currentTarget,q={originalEvent:Z,delta:z};fn(z,y.swipeDirection,y.swipeThreshold)?Oa(Ud,p,q,{discrete:!0}):Oa(Bd,d,q,{discrete:!0}),O.addEventListener("click",L=>L.preventDefault(),{once:!0})}})})})}),y.viewport)})]}):null}),Wd=a=>{const{__scopeToast:t,children:s,...r}=a,n=Wa(wa,t),[i,l]=c.useState(!1),[o,m]=c.useState(!1);return Kd(()=>l(!0)),c.useEffect(()=>{const u=window.setTimeout(()=>m(!0),1e3);return()=>window.clearTimeout(u)},[]),o?null:e.jsx(Vo,{asChild:!0,children:e.jsx(bi,{...r,children:i&&e.jsxs(e.Fragment,{children:[n.label," ",s]})})})},qd="ToastTitle",hl=c.forwardRef((a,t)=>{const{__scopeToast:s,...r}=a;return e.jsx(qs.div,{...r,ref:t})});hl.displayName=qd;var Hd="ToastDescription",xl=c.forwardRef((a,t)=>{const{__scopeToast:s,...r}=a;return e.jsx(qs.div,{...r,ref:t})});xl.displayName=Hd;var gl="ToastAction",pl=c.forwardRef((a,t)=>{const{altText:s,...r}=a;return s.trim()?e.jsx(yl,{altText:s,asChild:!0,children:e.jsx(Gr,{...r,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${gl}\`. Expected non-empty \`string\`.`),null)});pl.displayName=gl;var fl="ToastClose",Gr=c.forwardRef((a,t)=>{const{__scopeToast:s,...r}=a,n=Yd(fl,s);return e.jsx(yl,{asChild:!0,children:e.jsx(qs.button,{type:"button",...r,ref:t,onClick:Jt(a.onClick,n.onClose)})})});Gr.displayName=fl;var yl=c.forwardRef((a,t)=>{const{__scopeToast:s,altText:r,...n}=a;return e.jsx(qs.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...n,ref:t})});function jl(a){const t=[];return Array.from(a.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&t.push(r.textContent),Xd(r)){const n=r.ariaHidden||r.hidden||r.style.display==="none",i=r.dataset.radixToastAnnounceExclude==="";if(!n)if(i){const l=r.dataset.radixToastAnnounceAlt;l&&t.push(l)}else t.push(...jl(r))}}),t}function Oa(a,t,s,{discrete:r}){const n=s.originalEvent.currentTarget,i=new CustomEvent(a,{bubbles:!0,cancelable:!0,detail:s});t&&n.addEventListener(a,t,{once:!0}),r?Bo(n,i):n.dispatchEvent(i)}var fn=(a,t,s=0)=>{const r=Math.abs(a.x),n=Math.abs(a.y),i=r>n;return t==="left"||t==="right"?i&&r>s:!i&&n>s};function Kd(a=()=>{}){const t=Fa(a);Uo(()=>{let s=0,r=0;return s=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(r)}},[t])}function Xd(a){return a.nodeType===a.ELEMENT_NODE}function Qd(a){const t=[],s=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const n=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||n?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t}function nr(a){const t=document.activeElement;return a.some(s=>s===t?!0:(s.focus(),document.activeElement!==t))}var Jd=ol,vl=dl,wl=ul,bl=hl,Nl=xl,_l=pl,Sl=Gr;const Zd=Jd,El=c.forwardRef(({className:a,...t},s)=>e.jsx(vl,{ref:s,className:B("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",a),...t}));El.displayName=vl.displayName;const em=ga("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Cl=c.forwardRef(({className:a,variant:t,...s},r)=>e.jsx(wl,{ref:r,className:B(em({variant:t}),a),...s}));Cl.displayName=wl.displayName;const tm=c.forwardRef(({className:a,...t},s)=>e.jsx(_l,{ref:s,className:B("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a),...t}));tm.displayName=_l.displayName;const Ol=c.forwardRef(({className:a,...t},s)=>e.jsx(Sl,{ref:s,className:B("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":"",...t,children:e.jsx(Et,{className:"h-4 w-4"})}));Ol.displayName=Sl.displayName;const Dl=c.forwardRef(({className:a,...t},s)=>e.jsx(bl,{ref:s,className:B("text-sm font-semibold",a),...t}));Dl.displayName=bl.displayName;const kl=c.forwardRef(({className:a,...t},s)=>e.jsx(Nl,{ref:s,className:B("text-sm opacity-90",a),...t}));kl.displayName=Nl.displayName;function sm(){const{toasts:a}=Ui();return e.jsxs(Zd,{children:[a.map(function({id:t,title:s,description:r,action:n,...i}){return e.jsxs(Cl,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(Dl,{children:s}),r&&e.jsx(kl,{children:r})]}),n,e.jsx(Ol,{})]},t)}),e.jsx(El,{})]})}class am extends da.Component{constructor(s){super(s);rt(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null})});rt(this,"handleGoHome",()=>{this.handleRetry(),window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null,errorId:null}}static getDerivedStateFromError(s){return{hasError:!0,errorId:Date.now().toString()}}componentDidCatch(s,r){console.error("Error caught by boundary:",s,r),this.setState({error:s,errorInfo:r}),this.props.onError&&this.props.onError(s,r)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs(me,{className:"w-full max-w-md",children:[e.jsxs(be,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 p-3 bg-red-100 rounded-full w-fit",children:e.jsx(us,{className:"h-8 w-8 text-red-600"})}),e.jsx(Ne,{className:"text-xl text-gray-900",children:"Something went wrong"}),e.jsx(kt,{children:this.props.fallbackMessage||"We're sorry, but something unexpected happened. Please try again."})]}),e.jsxs(ue,{className:"space-y-4",children:[!1,this.state.errorId&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["Error ID: ",this.state.errorId]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:this.handleRetry,variant:"outline",className:"flex-1",children:[e.jsx(Ws,{className:"h-4 w-4 mr-2"}),"Try Again"]}),e.jsxs(E,{onClick:this.handleGoHome,className:"flex-1",children:[e.jsx(zo,{className:"h-4 w-4 mr-2"}),"Go Home"]})]})]})]})}):this.props.children}}class _r{static async runMigrations(){localStorage.getItem(this.MIGRATION_KEY)!==this.MIGRATION_VERSION&&(console.log("Running data migrations..."),await this.migrateTasksSchema(),await this.migrateProjectsSchema(),await this.migrateStakeholdersSchema(),await this.migrateTeamMembersSchema(),await this.migrateOneOnOnesSchema(),await this.migrateTaskAttributesSchema(),localStorage.setItem(this.MIGRATION_KEY,this.MIGRATION_VERSION),console.log("Data migration completed successfully"))}static async migrateTasksSchema(){const t=this.getData("tasks");if(!t.length)return;const s=t.map(r=>({...r,due_date:r.due_date||null,assignee:r.assignee||null,estimated_hours:r.estimated_hours||null,actual_hours:r.actual_hours||null,completion_date:r.completion_date||(r.status==="done"?r.updated_date:null)}));this.setData("tasks",s),console.log(`Migrated ${s.length} tasks`)}static async migrateProjectsSchema(){const t=this.getData("projects");if(!t.length)return;const s=t.map(r=>({...r,deadline:r.deadline||null,budget:r.budget||null,cost:r.cost||null,priority_level:r.priority_level||"medium",progress_percentage:r.progress_percentage||0}));this.setData("projects",s),console.log(`Migrated ${s.length} projects`)}static async migrateStakeholdersSchema(){const t=this.getData("stakeholders");if(!t.length)return;const s=t.map(r=>{const n={...r,phone:r.phone||null,contact_info:r.contact_info||null,company:r.company||r.organization||null};return delete n.organization,n});this.setData("stakeholders",s),console.log(`Migrated ${s.length} stakeholders`)}static async migrateTeamMembersSchema(){const t=this.getData("team_members");if(!t.length)return;const s=t.map(r=>({...r,phone:r.phone||null,company:r.company||null,last_activity:r.last_activity||null}));this.setData("team_members",s),console.log(`Migrated ${s.length} team members`)}static async migrateOneOnOnesSchema(){const t=this.getData("one_on_ones");if(!t.length)return;const s=t.map(r=>{const n={...r,updated_date:r.updated_date||r.created_date,status:r.status||"scheduled",location:r.location||null,team_member_id:r.team_member_id||r.participant_id||null};return delete n.participant_id,n});this.setData("one_on_ones",s),console.log(`Migrated ${s.length} one-on-ones`)}static async migrateTaskAttributesSchema(){const t=this.getData("task_attributes");if(!t.length)return;const s=t.map(r=>({...r,updated_date:r.updated_date||r.created_date}));this.setData("task_attributes",s),console.log(`Migrated ${s.length} task attributes`)}static getData(t){try{const s=localStorage.getItem(t);return s?JSON.parse(s):[]}catch(s){return console.error(`Error reading data from localStorage key "${t}":`,s),[]}}static setData(t,s){try{localStorage.setItem(t,JSON.stringify(s))}catch(r){throw console.error(`Error saving data to localStorage key "${t}":`,r),r}}static async calculateLastActivity(){const t=this.getData("team_members"),s=this.getData("tasks"),r=this.getData("meetings"),n=t.map(i=>{let l=null;const o=s.filter(x=>{var h,d,p;return(p=(d=(h=x.metadata)==null?void 0:h.meeting)==null?void 0:d.participants)==null?void 0:p.includes(i.name)}),m=r.filter(x=>{var h,d;return((h=x.participants)==null?void 0:h.includes(i.id))||((d=x.participants)==null?void 0:d.includes(i.name))}),u=[...o.map(x=>({date:x.updated_date||x.created_date,type:"task"})),...m.map(x=>({date:x.updated_date||x.created_date,type:"meeting"}))];return u.length>0&&(l=u.sort((h,d)=>new Date(d.date)-new Date(h.date))[0].date),{...i,last_activity:l}});this.setData("team_members",n),console.log("Updated last_activity for all team members")}}rt(_r,"MIGRATION_VERSION","1.0.0"),rt(_r,"MIGRATION_KEY","pe_manager_migration_version");function rm(){return c.useEffect(()=>{_r.runMigrations().catch(a=>{console.error("Data migration failed:",a)})},[]),e.jsxs(am,{fallbackMessage:"The application encountered an error. Please refresh the page or try again later.",children:[e.jsx(Md,{}),e.jsx(sm,{})]})}class nm extends da.Component{constructor(s){super(s);rt(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorType:"unknown"})});rt(this,"handleForceLogout",()=>{try{localStorage.removeItem("auth_token")}catch{}this.handleRetry(),window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null,errorType:"unknown"}}static getDerivedStateFromError(s){var n,i,l,o,m;let r="unknown";return(n=s.message)!=null&&n.includes("localStorage")?r="storage":(i=s.message)!=null&&i.includes("authentication")||(l=s.message)!=null&&l.includes("auth")?r="authentication":((o=s.message)!=null&&o.includes("network")||(m=s.message)!=null&&m.includes("fetch"))&&(r="network"),{hasError:!0,errorType:r}}componentDidCatch(s,r){console.error("Authentication error caught by boundary:",s,r),this.setState({error:s,errorInfo:r}),this.props.onAuthError&&this.props.onAuthError(s,r,this.state.errorType)}getErrorMessage(){switch(this.state.errorType){case"storage":return{title:"Storage Error",message:"Unable to access browser storage. Please check your browser settings and try again.",suggestion:"Make sure cookies and local storage are enabled in your browser."};case"authentication":return{title:"Authentication Error",message:"There was a problem with the authentication system.",suggestion:"Please try logging in again or contact support if the problem persists."};case"network":return{title:"Connection Error",message:"Unable to connect to the authentication service.",suggestion:"Please check your internet connection and try again."};default:return{title:"Authentication System Error",message:"An unexpected error occurred in the authentication system.",suggestion:"Please try again or contact support if the problem persists."}}}render(){if(this.state.hasError){const s=this.getErrorMessage();return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(me,{className:"w-full max-w-md",children:[e.jsxs(be,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 p-3 bg-destructive/10 rounded-full w-fit",children:e.jsx(us,{className:"h-8 w-8 text-destructive"})}),e.jsx(Ne,{className:"text-xl",children:s.title}),e.jsx(kt,{children:s.message})]}),e.jsxs(ue,{className:"space-y-4",children:[e.jsx(mt,{children:e.jsx(ut,{children:s.suggestion})}),!1,e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{onClick:this.handleRetry,variant:"outline",className:"flex-1",children:[e.jsx(Ws,{className:"h-4 w-4 mr-2"}),"Try Again"]}),e.jsxs(E,{onClick:this.handleForceLogout,className:"flex-1",children:[e.jsx(Yo,{className:"h-4 w-4 mr-2"}),"Reset Login"]})]})]})]})})}return this.props.children}}hc.createRoot(document.getElementById("root")).render(e.jsx(nm,{children:e.jsx(Tc,{children:e.jsx(rm,{})})}));
