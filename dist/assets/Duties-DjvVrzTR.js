import{j as e,a7 as G,a8 as Q,a4 as J,d as he,ag as ge,b0 as pe,a2 as je,e as ae,_ as re,Q as ye,a5 as ve,a6 as be}from"./chunk-CDfVSsCp.js";import{a as m}from"./chunk-pjYta8vt.js";import{d as I,l as P,L as E,I as le,B as D,C as O,f as k,a as _e,c as fe,g as Ne,h as De}from"./index-CjGPc2b_.js";import{D as Ce,e as we,f as Se,g as Me,i as Ae,S as Y,a as B,b as U,c as V,d as C,h as Te,B as $}from"./chunk-2Vqr1Avx.js";import{T as Fe}from"./chunk-BRoLf8OO.js";import{f,h as ne,p as g,o as Ee,s as de,b as ie,e as ce,d as Z,k as Oe,l as ke,m as ee}from"./chunk-DGzW4aIb.js";import{D as $e,a as Re,b as Ie,d as oe}from"./chunk-BrWpdzOD.js";import{A as Pe,a as Ye,b as Be,c as Ue,d as Ve,e as qe,f as He,g as ze,h as Le}from"./chunk-BATFaH_q.js";const W=[{value:"devops",label:"DevOps",duration:14,color:"indigo"},{value:"dev_on_duty",label:"Dev On Duty",duration:7,color:"teal"},{value:"replacement",label:"Replacement (SM Cover)",duration:null,color:"amber"}],We=["Metering","Reporting"],me=({open:a,onOpenChange:N,onSubmit:w,initialData:x=null,preselectedTeam:S=null,preselectedDate:i=null,isLoading:c=!1})=>{const[r,u]=m.useState({team:"",team_member_id:"",duty_type:"",start_date:"",end_date:"",notes:""}),[M,p]=m.useState([]),[h,y]=m.useState(!1),[n,v]=m.useState({});m.useEffect(()=>{if(a){if(x)u({team:x.team||"",team_member_id:x.team_member_id||"",duty_type:x.duty_type||"",start_date:x.start_date?x.start_date.split("T")[0]:"",end_date:x.end_date?x.end_date.split("T")[0]:"",notes:x.notes||""});else{const t=i?f(i,"yyyy-MM-dd"):f(new Date,"yyyy-MM-dd");u({team:S||"",team_member_id:"",duty_type:"",start_date:t,end_date:"",notes:""})}v({})}},[a,x,S,i]),m.useEffect(()=>{r.team&&a?R(r.team):p([])},[r.team,a]);const R=async t=>{y(!0);try{const o=await I.getTeamMembers(t);p(o)}catch(o){P.error("Failed to load team members",{error:String(o),team:t}),p([])}finally{y(!1)}},q=t=>{u(o=>{const s={...o,duty_type:t},l=W.find(d=>d.value===t);if(l?.duration&&o.start_date){const d=new Date(o.start_date),j=ne(d,l.duration-1);s.end_date=f(j,"yyyy-MM-dd")}return s})},T=t=>{u(o=>{const s={...o,start_date:t},l=W.find(d=>d.value===o.duty_type);if(l?.duration&&t){const d=new Date(t),j=ne(d,l.duration-1);s.end_date=f(j,"yyyy-MM-dd")}return s})},b=(t,o)=>{u(s=>({...s,[t]:o})),n[t]&&v(s=>({...s,[t]:""}))},K=()=>{const t={};return r.team||(t.team="Team is required"),r.team_member_id||(t.team_member_id="Team member is required"),r.duty_type||(t.duty_type="Duty type is required"),r.start_date||(t.start_date="Start date is required"),r.end_date||(t.end_date="End date is required"),r.start_date&&r.end_date&&r.start_date>r.end_date&&(t.end_date="End date must be after start date"),v(t),Object.keys(t).length===0},H=async t=>{if(t.preventDefault(),!K())return;const o={team:r.team,team_member_id:r.team_member_id,duty_type:r.duty_type,start_date:r.start_date,end_date:r.end_date,notes:r.notes.trim()||null};await w(o)},A=!!x,F=W.find(t=>t.value===r.duty_type);return e.jsx(Ce,{open:a,onOpenChange:N,children:e.jsxs(we,{className:"sm:max-w-lg",children:[e.jsxs(Se,{children:[e.jsx(Me,{children:A?"Edit Duty Assignment":"Add Duty Assignment"}),e.jsx(Ae,{children:A?"Update the duty assignment details.":"Schedule a duty rotation assignment for a team member."})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"team",children:"Team *"}),e.jsxs(Y,{value:r.team,onValueChange:t=>{b("team",t),b("team_member_id","")},disabled:c,children:[e.jsx(B,{className:n.team?"border-destructive":"",children:e.jsx(U,{placeholder:"Select team"})}),e.jsx(V,{children:We.map(t=>e.jsx(C,{value:t,children:t},t))})]}),n.team&&e.jsx("p",{className:"text-sm text-destructive",children:n.team})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"team_member",children:"Team Member *"}),e.jsxs(Y,{value:r.team_member_id,onValueChange:t=>b("team_member_id",t),disabled:c||!r.team||h,children:[e.jsx(B,{className:n.team_member_id?"border-destructive":"",children:e.jsx(U,{placeholder:h?"Loading...":r.team?M.length===0?"No members in this team":"Select team member":"Select a team first"})}),e.jsx(V,{children:M.map(t=>e.jsxs(C,{value:t.id,children:[t.name," ",t.role?`(${t.role})`:""]},t.id))})]}),n.team_member_id&&e.jsx("p",{className:"text-sm text-destructive",children:n.team_member_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"duty_type",children:"Duty Type *"}),e.jsxs(Y,{value:r.duty_type,onValueChange:q,disabled:c,children:[e.jsx(B,{className:n.duty_type?"border-destructive":"",children:e.jsx(U,{placeholder:"Select duty type"})}),e.jsx(V,{children:W.map(t=>e.jsx(C,{value:t.value,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full bg-${t.color}-500`}),t.label,t.duration&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.duration===7?"1 week":"2 weeks",")"]})]})},t.value))})]}),n.duty_type&&e.jsx("p",{className:"text-sm text-destructive",children:n.duty_type})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(le,{id:"start_date",type:"date",value:r.start_date,onChange:t=>T(t.target.value),disabled:c,className:n.start_date?"border-destructive":""}),n.start_date&&e.jsx("p",{className:"text-sm text-destructive",children:n.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"end_date",children:"End Date *"}),e.jsx(le,{id:"end_date",type:"date",value:r.end_date,onChange:t=>b("end_date",t.target.value),disabled:c,className:n.end_date?"border-destructive":""}),n.end_date&&e.jsx("p",{className:"text-sm text-destructive",children:n.end_date}),F?.duration&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Auto-calculated for ",F.duration," days"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"notes",children:"Notes (optional)"}),e.jsx(Fe,{id:"notes",placeholder:"Any additional notes about this duty assignment...",value:r.notes,onChange:t=>b("notes",t.target.value),disabled:c,rows:2})]})]}),e.jsxs(Te,{children:[e.jsx(D,{variant:"outline",onClick:()=>N(!1),disabled:c,children:"Cancel"}),e.jsx(D,{onClick:H,disabled:c,children:c?"Saving...":A?"Update Duty":"Create Duty"})]})]})})},xe={devops:{label:"DevOps",icon:J,bgClass:"bg-indigo-100",textClass:"text-indigo-800",borderClass:"border-indigo-200",badgeClass:"bg-indigo-100 text-indigo-800"},dev_on_duty:{label:"Dev On Duty",icon:Q,bgClass:"bg-teal-100",textClass:"text-teal-800",borderClass:"border-teal-200",badgeClass:"bg-teal-100 text-teal-800"},replacement:{label:"Replacement",icon:G,bgClass:"bg-amber-100",textClass:"text-amber-800",borderClass:"border-amber-200",badgeClass:"bg-amber-100 text-amber-800"}},te=({duty:a,onEdit:N,onDelete:w,compact:x=!1,isLoading:S=!1})=>{const i=xe[a.duty_type]||xe.devops,c=i.icon,u=(()=>{if(a.start_date&&a.end_date){const h=g(a.start_date),y=g(a.end_date);return Ee(y,h)+1}return null})(),M=()=>{if(!a.start_date)return"No date";const h=f(g(a.start_date),"MMM d");if(!a.end_date)return h;const y=f(g(a.end_date),"MMM d"),n=g(a.start_date).getFullYear(),v=new Date().getFullYear();return n!==v?`${h} - ${f(g(a.end_date),"MMM d, yyyy")}`:`${h} - ${y}`},p=()=>{const h=new Date;h.setHours(0,0,0,0);const y=g(a.start_date),n=g(a.end_date);return h>=y&&h<=n};return x?e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-md ${i.bgClass} ${i.borderClass} border`,children:[e.jsx(c,{className:`h-4 w-4 ${i.textClass}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`text-sm font-medium ${i.textClass} truncate`,children:a.team_member_name}),e.jsx("div",{className:"text-xs text-gray-600",children:M()})]}),p()&&e.jsx($,{variant:"outline",className:"text-[10px] px-1 py-0 bg-green-100 text-green-700 border-green-200",children:"Active"})]}):e.jsx(O,{className:`${i.borderClass} border-l-4`,children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-lg ${i.bgClass}`,children:e.jsx(c,{className:`h-5 w-5 ${i.textClass}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:a.team_member_name}),e.jsx($,{variant:"outline",className:i.badgeClass,children:i.label}),p()&&e.jsx($,{variant:"outline",className:"bg-green-100 text-green-700 border-green-200",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),M()]}),u&&e.jsxs("span",{className:"text-xs",children:["(",u," day",u!==1?"s":"",")"]})]}),a.notes&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:a.notes})]})]}),(N||w)&&e.jsxs($e,{children:[e.jsx(Re,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",disabled:S,children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs(Ie,{align:"end",children:[N&&e.jsxs(oe,{onClick:()=>N(a),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Edit"]}),w&&e.jsxs(Pe,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(oe,{onSelect:h=>h.preventDefault(),className:"text-red-600",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Delete"]})}),e.jsxs(Be,{children:[e.jsxs(Ue,{children:[e.jsx(Ve,{children:"Delete Duty Assignment?"}),e.jsxs(qe,{children:["This will permanently delete the ",i.label," duty assignment for ",a.team_member_name,". This action cannot be undone."]})]}),e.jsxs(He,{children:[e.jsx(ze,{children:"Cancel"}),e.jsx(Le,{onClick:()=>w(a.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]})})})},Ge=["All","Metering","Reporting"];function at(){const[a,N]=m.useState([]),[w,x]=m.useState(!0),[S,i]=m.useState(null),[c,r]=m.useState(new Date),[u,M]=m.useState("All"),[p,h]=m.useState("All"),[y,n]=m.useState(!1),[v,R]=m.useState(null),[q,T]=m.useState(!1);m.useEffect(()=>{b()},[c,u,p]);const b=async()=>{x(!0),i(null);try{const s=de(ie(c)),l=ce(Z(c,2)),d={};u!=="All"&&(d.team=u),p!=="All"&&(d.duty_type=p);const j=await I.listByDateRange(f(s,"yyyy-MM-dd"),f(l,"yyyy-MM-dd"),d);N(Array.isArray(j)?j:[])}catch(s){P.error("Failed to load duty schedules",{error:String(s)}),i("Failed to load duty schedules. Please try again."),N([])}finally{x(!1)}},K=async s=>{T(!0);try{await I.create(s),await b(),n(!1)}catch(l){P.error("Failed to create duty",{error:String(l)}),i("Failed to create duty. Please try again.")}finally{T(!1)}},H=async s=>{if(v){T(!0);try{await I.update(v.id,s),await b(),R(null)}catch(l){P.error("Failed to update duty",{error:String(l)}),i("Failed to update duty. Please try again.")}finally{T(!1)}}},A=async s=>{try{await I.delete(s),await b()}catch(l){P.error("Failed to delete duty",{error:String(l)}),i("Failed to delete duty. Please try again.")}},F=s=>{R(s)},t=m.useMemo(()=>{const s=[];for(let l=0;l<3;l++){const d=Z(c,l),j=de(d),z=ce(d),L=a.filter(_=>{if(!_.start_date||!_.end_date)return!1;const X=Oe(g(_.start_date)),se=ke(g(_.end_date));return ee(j,{start:X,end:se})||ee(z,{start:X,end:se})||ee(X,{start:j,end:z})}),ue={devops:L.filter(_=>_.duty_type==="devops"),dev_on_duty:L.filter(_=>_.duty_type==="dev_on_duty"),replacement:L.filter(_=>_.duty_type==="replacement")};s.push({date:d,label:f(d,"MMMM yyyy"),duties:L,grouped:ue})}return s},[a,c]),o=m.useMemo(()=>{const s=new Date,l=a.filter(d=>{const j=g(d.start_date),z=g(d.end_date);return s>=j&&s<=z});return{total:a.length,active:l.length,devops:a.filter(d=>d.duty_type==="devops").length,dev_on_duty:a.filter(d=>d.duty_type==="dev_on_duty").length,replacement:a.filter(d=>d.duty_type==="replacement").length}},[a]);return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(ae,{className:"h-8 w-8"}),"Duties Schedule"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage duty rotation assignments for your teams"})]}),e.jsxs(D,{onClick:()=>n(!0),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Duty"]})]}),S&&e.jsx(_e,{variant:"destructive",className:"mb-6",children:e.jsx(fe,{children:S})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsxs(Y,{value:u,onValueChange:M,children:[e.jsx(B,{className:"w-[140px]",children:e.jsx(U,{})}),e.jsx(V,{children:Ge.map(s=>e.jsx(C,{value:s,children:s==="All"?"All Teams":s},s))})]})]}),e.jsxs(Y,{value:p,onValueChange:h,children:[e.jsx(B,{className:"w-[160px]",children:e.jsx(U,{})}),e.jsxs(V,{children:[e.jsx(C,{value:"All",children:"All Types"}),e.jsx(C,{value:"devops",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-3 w-3 text-indigo-600"}),"DevOps"]})}),e.jsx(C,{value:"dev_on_duty",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-3 w-3 text-teal-600"}),"Dev On Duty"]})}),e.jsx(C,{value:"replacement",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-3 w-3 text-amber-600"}),"Replacement"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx(D,{variant:"outline",size:"icon",onClick:()=>r(ie(c)),children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(D,{variant:"outline",onClick:()=>r(new Date),children:"Today"}),e.jsx(D,{variant:"outline",size:"icon",onClick:()=>r(Z(c,1)),children:e.jsx(be,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6",children:[e.jsx(O,{children:e.jsxs(k,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:o.active}),e.jsx("div",{className:"text-sm text-gray-500",children:"Active Now"})]})}),e.jsx(O,{className:"border-indigo-200",children:e.jsxs(k,{className:"p-4 flex items-center gap-3",children:[e.jsx(J,{className:"h-8 w-8 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.devops}),e.jsx("div",{className:"text-sm text-gray-500",children:"DevOps"})]})]})}),e.jsx(O,{className:"border-teal-200",children:e.jsxs(k,{className:"p-4 flex items-center gap-3",children:[e.jsx(Q,{className:"h-8 w-8 text-teal-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.dev_on_duty}),e.jsx("div",{className:"text-sm text-gray-500",children:"Dev On Duty"})]})]})}),e.jsx(O,{className:"border-amber-200",children:e.jsxs(k,{className:"p-4 flex items-center gap-3",children:[e.jsx(G,{className:"h-8 w-8 text-amber-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.replacement}),e.jsx("div",{className:"text-sm text-gray-500",children:"Replacement"})]})]})})]}),w?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading duty schedules..."})]}):a.length===0?e.jsxs("div",{className:"text-center p-12 border border-dashed rounded-lg",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No duties scheduled"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Start by adding duty assignments for your teams."}),e.jsxs(D,{onClick:()=>n(!0),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add First Duty"]})]}):e.jsx("div",{className:"space-y-6",children:t.map(s=>e.jsxs(O,{children:[e.jsx(Ne,{className:"pb-2",children:e.jsx(De,{className:"text-lg",children:s.label})}),e.jsx(k,{children:s.duties.length===0?e.jsx("p",{className:"text-gray-500 text-sm py-4 text-center",children:"No duties scheduled for this month"}):e.jsxs("div",{className:"space-y-4",children:[s.grouped.devops.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"h-4 w-4 text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium text-indigo-800",children:"DevOps (2 weeks)"}),e.jsx($,{variant:"outline",className:"bg-indigo-50 text-indigo-700",children:s.grouped.devops.length})]}),e.jsx("div",{className:"space-y-2",children:s.grouped.devops.map(l=>e.jsx(te,{duty:l,onEdit:F,onDelete:A},l.id))})]}),s.grouped.dev_on_duty.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"h-4 w-4 text-teal-600"}),e.jsx("span",{className:"text-sm font-medium text-teal-800",children:"Dev On Duty (1 week)"}),e.jsx($,{variant:"outline",className:"bg-teal-50 text-teal-700",children:s.grouped.dev_on_duty.length})]}),e.jsx("div",{className:"space-y-2",children:s.grouped.dev_on_duty.map(l=>e.jsx(te,{duty:l,onEdit:F,onDelete:A},l.id))})]}),s.grouped.replacement.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Replacement (SM Cover)"}),e.jsx($,{variant:"outline",className:"bg-amber-50 text-amber-700",children:s.grouped.replacement.length})]}),e.jsx("div",{className:"space-y-2",children:s.grouped.replacement.map(l=>e.jsx(te,{duty:l,onEdit:F,onDelete:A},l.id))})]})]})})]},s.label))}),e.jsx(me,{open:y,onOpenChange:n,onSubmit:K,preselectedTeam:u!=="All"?u:null,isLoading:q}),e.jsx(me,{open:!!v,onOpenChange:s=>!s&&R(null),onSubmit:H,initialData:v,isLoading:q})]})})}export{at as default};
