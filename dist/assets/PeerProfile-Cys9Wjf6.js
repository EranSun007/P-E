import{j as e,d as S,aG as Ke,aa as me,ab as Ze,Y as Pe,ae as Me,a0 as es,aU as Ae,Q as Ee,o as ss,aW as ts}from"./chunk-8WlaufA8.js";import{a as n,k as as,L as ns}from"./chunk-pjYta8vt.js";import{g as b,i as D,j as P,h as M,B as i,E as Ie,z as $,T as rs,P as ls,S as is,p as cs,q as ds,s as os,k as Te,I as we,L as c}from"./index-BK5E59O8.js";import{A as Fe}from"./chunk-B6BcMUO9.js";import{CalendarService as Z}from"./calendarService-BLiLHtBa.js";import{O as Le,A as xs}from"./chunk-2Qq0zNiP.js";import{B as O,D as Se,a as Ce,b as ke,c as Oe,d as be}from"./chunk-Cg2ZZDgQ.js";import{S as F,a as L,b as R,c as z,d}from"./chunk-DktN3Kjy.js";import{P as ee,a as se,b as te,C as ae}from"./chunk-N38jzkpe.js";import{T as hs,a as ms,b as Re,c as ne,d as js,e as re}from"./chunk-B-BuOqLK.js";import{f as y,p}from"./chunk-BQPSriyy.js";import"./chunk-kzSEtJwL.js";const us=({peerId:q,year:h,showBreakdown:l=!1,showYearSelector:Q=!1,onStatsChange:m,className:f=""})=>{const v=new Date().getFullYear(),[w,je]=n.useState(h||v),[B,C]=n.useState(null),[ue,k]=n.useState(!0),[ge,Y]=n.useState(null),pe=n.useMemo(()=>{const o=[];for(let x=0;x<3;x++)o.push(v-x);return o},[v]),fe=async o=>{if(!q){C(null),k(!1);return}try{k(!0),Y(null);const x=await Le.getYearlyStatsForPeer(q,o);C(x),m&&m(x)}catch(x){console.error("Failed to load peer out of office stats:",x),Y(x.message),C(null)}finally{k(!1)}};n.useEffect(()=>{fe(w)},[q,w]);const Ne=o=>{je(parseInt(o))},ye=o=>Le.getReasonType(o)||{name:o,color:"#6b7280"},J=n.useMemo(()=>!B||!B.reasonBreakdown?[]:Object.entries(B.reasonBreakdown).map(([o,x])=>({reason:o,days:x,display:ye(o)})).sort((o,x)=>x.days-o.days),[B]);if(ue)return e.jsxs(b,{className:`animate-pulse ${f}`,children:[e.jsx(D,{className:"pb-2",children:e.jsxs(P,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(M,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]})]});if(ge)return e.jsxs(b,{className:`border-red-200 ${f}`,children:[e.jsx(D,{className:"pb-2",children:e.jsxs(P,{className:"text-sm font-medium text-red-600 flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(M,{children:[e.jsx("p",{className:"text-sm text-red-600",children:"Failed to load stats"}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>fe(w),className:"mt-2",children:"Retry"})]})]});const X=B?.totalDays||0,G=w===v;return e.jsxs(b,{className:f,children:[e.jsx(D,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(P,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"Out of Office Days"]}),Q&&e.jsxs(F,{value:w.toString(),onValueChange:Ne,children:[e.jsx(L,{className:"w-20 h-8 text-xs",children:e.jsx(R,{})}),e.jsx(z,{children:pe.map(o=>e.jsx(d,{value:o.toString(),children:o},o))})]})]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:X}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[X===1?"day":"days"," in ",w,G&&e.jsx(O,{variant:"secondary",className:"ml-2 text-xs",children:"Current"})]})]}),l&&J.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(Ke,{className:"h-3 w-3"}),"Breakdown"]}),e.jsx("div",{className:"space-y-1",children:J.map(({reason:o,days:x,display:V})=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:V.color}}),e.jsx("span",{children:V.name})]}),e.jsxs("span",{className:"font-medium",children:[x," ",x===1?"day":"days"]})]},o))})]}),X===0&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),"No out of office periods in ",w]})]})})]})};function gs({peerId:q,peerName:h,outOfOfficePeriods:l=[],onAdd:Q,onRemove:m}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Out-of-Office Management"}),e.jsx("div",{className:"space-y-2",children:l.length===0?e.jsxs("p",{className:"text-gray-500",children:["No out-of-office periods recorded for ",h,"."]}):l.map(f=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"outline",children:f.status}),e.jsxs("span",{children:[f.start_date," - ",f.end_date]}),f.notes&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",f.notes,")"]}),e.jsx("button",{className:"text-red-500 ml-2",onClick:()=>m(f.id),children:"Remove"})]},f.id))}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:Q,children:"Add Out-of-Office"})]})}function Ds(){const[q]=as(),h=q.get("id"),[l,Q]=n.useState(null),[m,f]=n.useState([]),[v,w]=n.useState([]),[je,B]=n.useState([]),[C,ue]=n.useState([]),[k,ge]=n.useState([]),[Y,pe]=n.useState([]),[fe,Ne]=n.useState(null),[ye,J]=n.useState(!0),[X,G]=n.useState(!1),[o,x]=n.useState(!1),[V,ze]=n.useState(null),[A,E]=n.useState({text:"",referenced_entity:{type:"peer",id:""}}),[le,ie]=n.useState(null),[g,U]=n.useState({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),[I,ce]=n.useState({description:"",due_date:"",linked_task_id:"",linked_project_id:"",status:"open"}),[j,ve]=n.useState("none"),[H,K]=n.useState(""),[Be,de]=n.useState(null),[N,_e]=n.useState(null),[Ye,oe]=n.useState(!1),[W,xe]=n.useState("");n.useState(()=>{try{return JSON.parse(localStorage.getItem("discussedNotes")||"{}")}catch{return{}}}),n.useEffect(()=>{h&&T()},[h]);const T=async()=>{J(!0);try{const s=await Ie.get(h);Q(s);const a=(await $.list()).filter(_=>_.peer_id===h);f(a);try{const _=await Fe.getAgendaItemsForPeer?.(h)||[];w(_)}catch(_){console.error("Error loading agenda items:",_),w([])}const r=await rs.list(),u=await ls.list();B(r),ue(u),ge(await Ie.list()),pe(await is.list()),await Ve(a)}catch(s){console.error("Error loading peer data:",s)}finally{J(!1)}},Ve=async s=>{try{const t=s.filter(a=>a.next_meeting_date).sort((a,r)=>new Date(a.next_meeting_date)-new Date(r.next_meeting_date));if(t.length>0){const a=t[0];let r=null;if(a.next_meeting_calendar_event_id)try{r=(await Z.getOneOnOneMeetingsForPeer?.(h))?.find(_=>_.id===a.next_meeting_calendar_event_id)}catch(u){console.error("Error loading calendar event:",u)}_e({oneOnOne:a,calendarEvent:r,hasCalendarEvent:!!r,meetingDate:a.next_meeting_date})}else _e(null)}catch(t){console.error("Error loading next meeting info:",t),_e(null)}},He=async()=>{try{const s=await $.create({...g,notes:Array.isArray(g.notes)?g.notes:[],peer_id:h});if(g.next_meeting_date&&l)try{const t=await Z.createAndLinkOneOnOneMeetingForPeer?.(s.id,h,g.next_meeting_date);console.log("Calendar event created successfully:",t?.calendarEvent)}catch(t){console.error("Error creating calendar event:",t)}G(!1),U({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),T()}catch(s){console.error("Error creating 1:1 meeting:",s)}},We=async()=>{if(V)try{const s={...V,action_items:[...V.action_items||[],I]};await $.update(V.id,s),x(!1),T()}catch(s){console.error("Error adding action item:",s)}},$e=async s=>{if(!A.text)return;let t=null;j!=="none"&&H&&(t={type:j,id:H});const a=m.find(_=>_.id===s);if(!a)return;const r={text:A.text,referenced_entity:t,created_by:h,timestamp:new Date().toISOString()},u=Array.isArray(a.notes)?[...a.notes,r]:[r];await $.update(s,{...a,notes:u}),E({text:"",referenced_entity:{type:"peer",id:""}}),ie(null),T()},De=async(s,t,a)=>{try{const r=m.find(_=>_.id===s);if(!r)return;const u=[...r.action_items];u[t]={...u[t],status:a},await $.update(s,{...r,action_items:u}),T()}catch(r){console.error("Error updating action item status:",r)}},qe=async s=>{try{try{await Z.unlinkCalendarEventFromOneOnOne?.(s)}catch(t){console.error("Error deleting associated calendar event:",t)}await $.delete(s),T()}catch(t){console.error("Error deleting meeting:",t)}},Ge=async s=>{try{await Fe.markAgendaItemDiscussed?.(s.meetingId,s.timestamp)&&T()}catch(t){console.error("Error marking agenda item as discussed:",t)}},he=async(s,t)=>{try{const a=m.find(u=>u.id===s);if(!a)return;const r={...a,next_meeting_date:t};if(await $.update(s,r),t&&l)try{await Z.updateOneOnOneCalendarEventForPeer?.(s,t),console.log("Calendar event updated successfully for meeting:",s)}catch(u){console.error("Error updating calendar event:",u)}else if(!t&&a.next_meeting_calendar_event_id)try{await Z.unlinkCalendarEventFromOneOnOne?.(s),console.log("Calendar event removed for meeting:",s)}catch(u){console.error("Error removing calendar event:",u)}T()}catch(a){console.error("Error updating next meeting date:",a)}},Ue=async()=>{if(!(!N||!W))try{await he(N.oneOnOne.id,W),oe(!1),xe("")}catch(s){console.error("Error rescheduling meeting:",s)}},Qe=async()=>{if(N)try{await he(N.oneOnOne.id,"")}catch(s){console.error("Error canceling meeting:",s)}};if(ye)return e.jsx("div",{className:"p-6",children:"Loading..."});if(!l)return e.jsx("div",{className:"p-6",children:"Peer not found"});const Je=s=>({open:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[s]||"bg-gray-100 text-gray-800",Xe=s=>({great:"ðŸ˜„",good:"ðŸ™‚",neutral:"ðŸ˜",concerned:"ðŸ˜Ÿ"})[s]||"ðŸ˜";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(ns,{to:"/peers",children:e.jsxs(i,{variant:"ghost",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Back to Peers"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(cs,{className:"h-16 w-16",children:l.avatar?e.jsx(ds,{src:l.avatar,alt:l.name}):e.jsx(os,{children:l.name.split(" ").map(s=>s[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:l.name}),e.jsx("p",{className:"text-gray-500",children:l.role||l.title})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(b,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(P,{children:"1:1 Meetings"}),e.jsxs(i,{onClick:()=>G(!0),children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"New 1:1"]})]})}),e.jsx(M,{children:m.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Me,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No 1:1 meetings recorded yet"})]}):e.jsx("div",{className:"space-y-6",children:m.sort((s,t)=>new Date(t.date)-new Date(s.date)).map(s=>e.jsxs(b,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[y(p(s.date),"PPP"),e.jsx("span",{className:"text-xl",children:Xe(s.mood)})]}),e.jsx(Te,{className:"flex items-center gap-2",children:Be===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Next meeting:"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(i,{variant:"outline",size:"sm",className:"h-8 text-xs",children:[e.jsx(S,{className:"mr-1 h-3 w-3"}),s.next_meeting_date?y(p(s.next_meeting_date),"MMM d"):"Select date"]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:s.next_meeting_date?p(s.next_meeting_date):void 0,onSelect:t=>{const a=t?.toISOString()||"";he(s.id,a),de(null)}})})]}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>de(null),children:"Cancel"}),s.next_meeting_date&&e.jsx(i,{variant:"ghost",size:"sm",className:"h-8 px-2 text-red-500",onClick:()=>{he(s.id,""),de(null)},children:"Clear"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Next meeting: ",s.next_meeting_date?y(p(s.next_meeting_date),"PPP"):"Not scheduled"]}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>de(s.id),children:"Edit"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{ze(s),x(!0)},children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Add Action Item"]}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>qe(s.id),title:"Delete meeting",children:e.jsx(es,{className:"h-5 w-5 text-red-500"})})]})]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[Array.isArray(s.notes)&&s.notes.filter(t=>!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(h)).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),e.jsx("ul",{className:"list-disc pl-5",children:s.notes.filter(t=>!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(h)).map((t,a)=>e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{children:t.text}),t.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[t.referenced_entity.type==="peer"&&k.find(r=>String(r.id)===String(t.referenced_entity.id))?.name,t.referenced_entity.type==="stakeholder"&&Y.find(r=>String(r.id)===String(t.referenced_entity.id))?.name,t.referenced_entity.type==="project"&&C.find(r=>String(r.id)===String(t.referenced_entity.id))?.name]})]},a))})]}),e.jsxs("div",{className:"mt-2 flex gap-2 items-end",children:[e.jsx(we,{className:"flex-1",placeholder:"Note text...",value:le===s.id?A.text:"",onChange:t=>{ie(s.id),E(a=>({...a,text:t.target.value}))}}),e.jsxs(F,{value:le===s.id?j:"none",onValueChange:t=>{ie(s.id),ve(t),K(""),E(a=>({...a,referenced_entity:t==="none"?null:{type:t,id:""}}))},children:[e.jsx(L,{className:"w-32",children:e.jsx(R,{placeholder:"No tag"})}),e.jsxs(z,{children:[e.jsx(d,{value:"none",children:"No tag"}),e.jsx(d,{value:"peer",children:"Peers"}),e.jsx(d,{value:"stakeholder",children:"Stakeholders"}),e.jsx(d,{value:"project",children:"Projects"})]})]}),j!=="none"&&le===s.id&&e.jsxs(F,{value:H,onValueChange:t=>{K(t),E(a=>({...a,referenced_entity:{type:j,id:t}}))},children:[e.jsx(L,{className:"w-40",children:e.jsx(R,{placeholder:"Select name"})}),e.jsxs(z,{children:[j==="peer"&&k.filter(t=>t.id.toString()!==h?.toString()).map(t=>e.jsx(d,{value:t.id,children:t.name},t.id)),j==="stakeholder"&&Y.map(t=>e.jsx(d,{value:t.id,children:t.name},t.id)),j==="project"&&C.map(t=>e.jsx(d,{value:t.id,children:t.name},t.id))]})]}),e.jsx(i,{onClick:()=>{ie(s.id),$e(s.id)},disabled:!A.text||j!=="none"&&!H||le!==s.id,children:"Add"})]}),s.topics_discussed?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Topics Discussed"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.topics_discussed.map((t,a)=>e.jsx(O,{variant:"secondary",children:t},a))})]}),s.action_items?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Action Items"}),e.jsxs(hs,{children:[e.jsx(ms,{children:e.jsxs(Re,{children:[e.jsx(ne,{children:"Description"}),e.jsx(ne,{children:"Due Date"}),e.jsx(ne,{children:"Status"}),e.jsx(ne,{children:"Links"}),e.jsx(ne,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(js,{children:s.action_items.map((t,a)=>e.jsxs(Re,{children:[e.jsx(re,{children:t.description}),e.jsx(re,{children:t.due_date?y(p(t.due_date),"MMM d, yyyy"):"No due date"}),e.jsx(re,{children:e.jsx(O,{className:Je(t.status),children:t.status})}),e.jsx(re,{children:(t.linked_task_id||t.linked_project_id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[t.linked_task_id&&e.jsxs(O,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),"Task"]}),t.linked_project_id&&e.jsxs(O,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),"Project"]})]})}),e.jsx(re,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>De(s.id,a,"completed"),disabled:t.status==="completed",children:e.jsx(Ee,{className:"h-4 w-4 text-green-500"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>De(s.id,a,"in_progress"),disabled:t.status==="in_progress",children:e.jsx(me,{className:"h-4 w-4 text-blue-500"})})]})})]},a))})]})]})]})})]},s.id))})})]}),e.jsx(gs,{peerId:h,peerName:l?.name})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(D,{children:e.jsx(P,{children:"Peer Info"})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[l.company&&e.jsxs("div",{children:[e.jsx(c,{children:"Company"}),e.jsx("p",{className:"text-gray-600",children:l.company})]}),l.department&&e.jsxs("div",{children:[e.jsx(c,{children:"Department"}),e.jsx("p",{className:"text-gray-600",children:l.department})]}),l.skills?.length>0&&e.jsxs("div",{children:[e.jsx(c,{children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:l.skills.map((s,t)=>e.jsx(O,{variant:"secondary",children:s},t))})]}),l.notes&&e.jsxs("div",{children:[e.jsx(c,{children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:l.notes})]}),l.contact_info&&e.jsxs("div",{children:[e.jsx(c,{children:"Contact Info"}),e.jsx("p",{className:"text-gray-600",children:l.contact_info})]})]})})]}),e.jsx(us,{peerId:h,showBreakdown:!0,showYearSelector:!0,onStatsChange:Ne}),e.jsxs(b,{children:[e.jsx(D,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Next 1:1 Meeting"]})}),e.jsx(M,{children:N?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Scheduled Date"}),e.jsx("p",{className:"text-gray-900 font-medium",children:y(p(N.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:N.hasCalendarEvent?e.jsxs(O,{variant:"outline",className:"text-green-700 border-green-200 bg-green-50",children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"Calendar Event Created"]}):e.jsxs(O,{variant:"outline",className:"text-yellow-700 border-yellow-200 bg-yellow-50",children:[e.jsx(ss,{className:"h-3 w-3 mr-1"}),"No Calendar Event"]})})]}),N.calendarEvent&&e.jsxs("div",{children:[e.jsx(c,{children:"Calendar Event"}),e.jsx("p",{className:"text-sm text-gray-600",children:N.calendarEvent.title})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{xe(N.meetingDate),oe(!0)},children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Reschedule"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:Qe,className:"text-red-600 hover:text-red-700",children:[e.jsx(ts,{className:"h-4 w-4 mr-1"}),"Cancel"]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(S,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No upcoming 1:1 scheduled"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Schedule your next meeting from any 1:1 record"})]})})]}),e.jsxs(b,{children:[e.jsx(D,{children:e.jsx(P,{children:"Quick Stats"})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Last 1:1"}),e.jsx("p",{className:"text-gray-600",children:m[0]?y(p(m[0].date),"PPP"):"No meetings yet"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Meeting Frequency"}),e.jsx("p",{className:"text-gray-600",children:m.length>1?(()=>{const s=m.filter(a=>a.date).sort((a,r)=>new Date(r.date)-new Date(a.date));if(s.length<2)return"Insufficient data";const t=Math.round((new Date(s[0].date)-new Date(s[1].date))/(1e3*60*60*24));return t<=10?"Weekly":t<=20?"Bi-weekly":t<=35?"Monthly":"Irregular"})():"No pattern yet"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Open Action Items"}),e.jsx("p",{className:"text-gray-600",children:m.reduce((s,t)=>s+(t.action_items?.filter(a=>a.status!=="completed").length||0),0)})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Agenda Items"}),e.jsxs("p",{className:"text-gray-600",children:[v.length," total, ",v.filter(s=>!s.isDiscussed).length," pending"]})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Total 1:1s"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:m.length}),m.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(since ",y(p(m[m.length-1].date),"MMM yyyy"),")"]})]})]})]})})]}),e.jsxs(b,{children:[e.jsxs(D,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Next Agenda Items"]}),e.jsx(Te,{children:"Items from other meetings where you are tagged"})]}),e.jsxs(M,{children:[v.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Me,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No agenda items yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You'll see items here when others tag you in their meeting notes"})]}):e.jsx(xs,{agendaItems:v.slice(0,5),peers:k.reduce((s,t)=>(s[t.id]=t,s),{}),onMarkDiscussed:Ge,showActions:!0,emptyMessage:"No agenda items found"}),v.length>5&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Showing 5 of ",v.length," items"]})})]})]})]})]})]}),e.jsx(Se,{open:X,onOpenChange:G,children:e.jsxs(Ce,{className:"sm:max-w-lg",children:[e.jsx(ke,{children:e.jsx(Oe,{children:"New 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Date"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),g.date?y(p(g.date),"PPP"):"Select date"]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:g.date?p(g.date):void 0,onSelect:s=>U(t=>({...t,date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Mood"}),e.jsxs(F,{value:g.mood,onValueChange:s=>U(t=>({...t,mood:s})),children:[e.jsx(L,{children:e.jsx(R,{})}),e.jsxs(z,{children:[e.jsx(d,{value:"great",children:"Great ðŸ˜„"}),e.jsx(d,{value:"good",children:"Good ðŸ™‚"}),e.jsx(d,{value:"neutral",children:"Neutral ðŸ˜"}),e.jsx(d,{value:"concerned",children:"Concerned ðŸ˜Ÿ"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Notes"}),Array.isArray(g.notes)&&g.notes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mb-2",children:g.notes.map((s,t)=>e.jsxs("li",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{children:s.text}),s.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[s.referenced_entity.type==="peer"&&k.find(a=>a.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="stakeholder"&&Y.find(a=>a.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="project"&&C.find(a=>a.id===s.referenced_entity.id)?.name]}),e.jsx(i,{variant:"ghost",size:"xs",className:"ml-2",onClick:()=>U(a=>({...a,notes:a.notes.filter((r,u)=>u!==t)})),children:"Remove"})]},t))}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(we,{className:"flex-1",placeholder:"Note text...",value:A.text,onChange:s=>E(t=>({...t,text:s.target.value}))}),e.jsxs(F,{value:j,onValueChange:s=>{ve(s),K(""),E(t=>({...t,referenced_entity:{type:s,id:""}}))},children:[e.jsx(L,{className:"w-32",children:e.jsx(R,{placeholder:"No tag"})}),e.jsxs(z,{children:[e.jsx(d,{value:"none",children:"No tag"}),e.jsx(d,{value:"peer",children:"Peers"}),e.jsx(d,{value:"stakeholder",children:"Stakeholders"}),e.jsx(d,{value:"project",children:"Projects"})]})]}),j!=="none"&&e.jsxs(F,{value:H,onValueChange:s=>{K(s),E(t=>({...t,referenced_entity:{type:j,id:s}}))},children:[e.jsx(L,{className:"w-40",children:e.jsx(R,{placeholder:"Select name"})}),e.jsxs(z,{children:[j==="peer"&&k.filter(s=>s.id!==h).map(s=>e.jsx(d,{value:s.id,children:s.name},s.id)),j==="stakeholder"&&Y.map(s=>e.jsx(d,{value:s.id,children:s.name},s.id)),j==="project"&&C.map(s=>e.jsx(d,{value:s.id,children:s.name},s.id))]})]}),e.jsx(i,{onClick:()=>{A.text&&(U(s=>({...s,notes:[...Array.isArray(s.notes)?s.notes:[],{text:A.text,referenced_entity:j==="none"?{}:{type:j,id:H},created_by:h,timestamp:new Date().toISOString()}]})),E({text:"",referenced_entity:{type:"peer",id:""}}),ve("none"),K(""))},disabled:!A.text||j!=="none"&&!H,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Next Meeting Date"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),g.next_meeting_date?y(p(g.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:g.next_meeting_date?p(g.next_meeting_date):void 0,onSelect:s=>U(t=>({...t,next_meeting_date:s?.toISOString()}))})})]})]})]}),e.jsxs(be,{children:[e.jsx(i,{variant:"outline",onClick:()=>G(!1),children:"Cancel"}),e.jsx(i,{onClick:He,children:"Create Meeting"})]})]})}),e.jsx(Se,{open:o,onOpenChange:x,children:e.jsxs(Ce,{className:"sm:max-w-lg",children:[e.jsx(ke,{children:e.jsx(Oe,{children:"Add Action Item"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Description"}),e.jsx(we,{value:I.description,onChange:s=>ce(t=>({...t,description:s.target.value})),placeholder:"What needs to be done?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Due Date"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),I.due_date?y(p(I.due_date),"PPP"):"Set due date"]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:I.due_date?p(I.due_date):void 0,onSelect:s=>ce(t=>({...t,due_date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Link to Task (Optional)"}),e.jsxs(F,{value:I.linked_task_id,onValueChange:s=>ce(t=>({...t,linked_task_id:s})),children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Select a task"})}),e.jsxs(z,{children:[e.jsx(d,{value:null,children:"None"}),je.map(s=>e.jsx(d,{value:s.id,children:s.title},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Link to Project (Optional)"}),e.jsxs(F,{value:I.linked_project_id,onValueChange:s=>ce(t=>({...t,linked_project_id:s})),children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Select a project"})}),e.jsxs(z,{children:[e.jsx(d,{value:null,children:"None"}),C.map(s=>e.jsx(d,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs(be,{children:[e.jsx(i,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(i,{onClick:We,children:"Add Action Item"})]})]})}),e.jsx(Se,{open:Ye,onOpenChange:oe,children:e.jsxs(Ce,{className:"sm:max-w-lg",children:[e.jsx(ke,{children:e.jsx(Oe,{children:"Reschedule Next 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Current Date"}),e.jsx("p",{className:"text-sm text-gray-600",children:N&&y(p(N.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"New Date"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),W?y(p(W),"PPP"):"Select new date"]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:W?p(W):void 0,onSelect:s=>xe(s?.toISOString()||"")})})]})]})]}),e.jsxs(be,{children:[e.jsx(i,{variant:"outline",onClick:()=>{oe(!1),xe("")},children:"Cancel"}),e.jsx(i,{onClick:Ue,disabled:!W,children:"Reschedule Meeting"})]})]})})]})}export{Ds as default};
