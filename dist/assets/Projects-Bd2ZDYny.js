import{j as e,ar as G,q as xe,n as ge,aB as ue,r as je,aK as pe,aL as ve,T as Ne,D as k,_ as fe,A as ye}from"./chunk-BlD_ekKQ.js";import{a as m,h as be,d as we}from"./chunk-BKwDNIOR.js";import{A as Ce,u as _e,B as g,a as Pe,c as Se,C as F,h as J,i as X,j as I,o as ke,p as De,L as c,I as D,q as Ae,P as O,r as B,s as L,t as A,l as E}from"./index-BPpXP9wP.js";import{B as p,D as Ee,a as Me,b as Te,c as Fe,e as Ie,d as Oe}from"./chunk-CmitwiBI.js";import{P as Y}from"./chunk-CdPUXhzC.js";import{S as Be}from"./chunk-Dptei7s9.js";import{D as Le,a as Re,b as Ve,d as Z}from"./chunk-D-Q6W0fT.js";import{S as R,a as V,b as $,c as H,d as x}from"./chunk-DBni0BOz.js";import{C as U}from"./chunk-D12Apl6f.js";import{T as $e}from"./chunk-B-ktFKGP.js";import{d as ee}from"./chunk-NOAukTlf.js";import{R as He,P as Ue,a as qe,C as ze,T as Ke,c as Qe}from"./chunk-Ct3-qmTO.js";import{b as v,p as u}from"./chunk-P_BNsj9B.js";import"./chunk-BdHZTqfh.js";const We=({value:N,onCommit:l})=>{const[j,f]=m.useState(N);return m.useEffect(()=>{f(N)},[N]),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[j,"%"]})]}),e.jsx(Be,{value:[j],min:0,max:100,step:5,onValueChange:y=>f(y[0]),onValueCommit:y=>l(y[0]),className:"cursor-pointer"})]})};function os(){const N=be(),{projects:l,tasks:j,stakeholders:f,loading:y,refreshAll:se}=m.useContext(Ce),[b,ae]=m.useState({}),[te,w]=m.useState(!1),[q,_]=m.useState(null),[d,z]=m.useState(null),[t,P]=m.useState({name:"",description:"",status:"not_started",start_date:"",end_date:"",deadline:"",owner:"",budget:"",cost:"",priority_level:"medium",color:M(),tags:[],stakeholder_id:""}),[re,le]=m.useState({});m.useEffect(()=>{const s=Array.isArray(j)?j:[],a={};(Array.isArray(l)?l:[]).forEach(r=>{a[r.id]=s.filter(i=>i.project===r.name)}),ae(a)},[l,j]);function M(){const s=["indigo","blue","green","amber","red","purple","pink","teal"];return s[Math.floor(Math.random()*s.length)]}const T=async()=>{_(null);try{await se()}catch(s){E.error("Failed to refresh projects",{error:String(s)}),_("Failed to load projects. Please try again.")}},o=(s,a)=>{if(s==="tags"){const r=Array.isArray(a)?a:[];P(i=>({...i,[s]:r}))}else P(r=>({...r,[s]:a}))},K=()=>{P({name:"",description:"",status:"not_started",start_date:"",end_date:"",deadline:"",owner:"",budget:"",cost:"",priority_level:"medium",color:M(),tags:[],stakeholder_id:""}),z(null),w(!0)},ne=s=>{s&&(P({name:s.name||"",description:s.description||"",status:s.status||"not_started",start_date:s.start_date||"",end_date:s.end_date||"",deadline:s.deadline||"",owner:s.owner||"",budget:s.budget||"",cost:s.cost||"",priority_level:s.priority_level||"medium",color:s.color||M(),tags:Array.isArray(s.tags)?s.tags:[],stakeholder_id:s.stakeholder_id||""}),z(s),w(!0))},ie=async()=>{try{d?await A.update(d.id,t):await A.create(t),w(!1),await T()}catch(s){E.error("Failed to save project",{error:String(s)}),_("Failed to save project. Please try again.")}},de=async s=>{try{await A.delete(s),await T()}catch(a){E.error("Failed to delete project",{error:String(a)}),_("Failed to delete project. Please try again.")}},oe=async(s,a)=>{try{await A.update(s,{progress_percentage:a}),await T()}catch(r){E.error("Failed to update progress",{error:String(r)})}},Q=s=>({indigo:"bg-indigo-500",blue:"bg-blue-500",green:"bg-green-500",amber:"bg-amber-500",red:"bg-red-500",purple:"bg-purple-500",pink:"bg-pink-500",teal:"bg-teal-500"})[s]||"bg-gray-500",ce=s=>{const a={not_started:"bg-gray-100 text-gray-800 border-gray-200",in_progress:"bg-blue-100 text-blue-800 border-blue-200",on_hold:"bg-amber-100 text-amber-800 border-amber-200",completed:"bg-green-100 text-green-800 border-green-200"},r={not_started:"Not Started",in_progress:"In Progress",on_hold:"On Hold",completed:"Completed"};return e.jsx(p,{className:a[s],children:r[s]})},me=s=>{const a=Array.isArray(b[s])?b[s]:[],r={total:a.length,done:0,in_progress:0,todo:0,backlog:0,blocked:0};return a.forEach(i=>{i&&i.status&&(r[i.status]=(r[i.status]||0)+1)}),r},he=s=>{le(a=>({...a,[s]:!a[s]}))},W=()=>{const s={not_started:0,in_progress:0,completed:0,on_hold:0};return l.forEach(a=>{s[a.status]=(s[a.status]||0)+1}),[{name:"Not Started",value:s.not_started,color:"#94a3b8"},{name:"In Progress",value:s.in_progress,color:"#60a5fa"},{name:"Completed",value:s.completed,color:"#4ade80"},{name:"On Hold",value:s.on_hold,color:"#fbbf24"}]},{updatePageContext:S}=_e(),h=we.useMemo(()=>(Array.isArray(l)?l:[]).map(s=>({...s,tasks:b[s.id]||[]})),[l,b]);return m.useEffect(()=>{const s=ee(h,{},d);S({page:"/projects",summary:s,selection:d?{id:d.id,type:"project"}:null,data:{projectCount:h.length,activeCount:h.filter(a=>a.status==="in_progress").length,completedCount:h.filter(a=>a.status==="completed").length}})},[h,d,S]),m.useEffect(()=>{const s=()=>{const a=ee(h,{},d);S({page:"/projects",summary:a,selection:d?{id:d.id,type:"project"}:null,data:{projectCount:h.length,activeCount:h.filter(r=>r.status==="in_progress").length,completedCount:h.filter(r=>r.status==="completed").length}})};return window.addEventListener("ai-context-refresh",s),()=>window.removeEventListener("ai-context-refresh",s)},[h,d,S]),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Projects"}),e.jsxs(g,{onClick:K,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"New Project"]})]}),q&&e.jsx(Pe,{variant:"destructive",className:"mb-6",children:e.jsx(Se,{children:q})}),e.jsxs(F,{className:"mb-6",children:[e.jsx(J,{children:e.jsx(X,{children:"Projects Overview"})}),e.jsx(I,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64",children:e.jsx(He,{width:"100%",height:"100%",children:e.jsxs(Ue,{children:[e.jsx(qe,{data:W(),cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:s,percent:a})=>`${s} ${(a*100).toFixed(0)}%`,children:W().map((s,a)=>e.jsx(ze,{fill:s.color},a))}),e.jsx(Ke,{}),e.jsx(Qe,{})]})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Active Projects"}),e.jsx("span",{children:l.filter(s=>s.status==="in_progress").length})]}),e.jsx(Y,{value:l.filter(s=>s.status==="in_progress").length/l.length*100})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Completed Projects"}),e.jsx("span",{children:l.filter(s=>s.status==="completed").length})]}),e.jsx(Y,{value:l.filter(s=>s.status==="completed").length/l.length*100,className:"bg-green-100"})]})]})]})]})})]}),y?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading projects..."})]}):l.length===0?e.jsx(F,{className:"bg-gray-50 border-dashed",children:e.jsxs(I,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(xe,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No projects yet"}),e.jsx("p",{className:"text-gray-500 text-center mb-4",children:"Create your first project to organize your tasks"}),e.jsxs(g,{onClick:K,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Create Project"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(s=>{const a=re[s.id]!==!1,r=s.progress_percentage??0,i=me(s.id);return e.jsxs(F,{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1.5 h-full ${Q(s.color)}`}),e.jsx(J,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>he(s.id),children:a?e.jsx(ge,{className:"h-4 w-4"}):e.jsx(ue,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx(X,{className:"truncate hover:text-indigo-600 cursor-pointer transition-colors",onClick:()=>N(ke("ProjectDetails")+`?id=${s.id}`),children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[ce(s.status),s.stakeholder_id&&e.jsxs(p,{variant:"outline",className:"text-xs",children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),(f||[]).find(n=>n.id===s.stakeholder_id)?.name||"Stakeholder"]})]})]})]}),e.jsxs(Le,{children:[e.jsx(Re,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(Ve,{align:"end",children:[e.jsxs(Z,{onClick:()=>ne(s),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(Z,{onClick:()=>de(s.id),className:"text-red-600",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})}),a&&e.jsxs(I,{children:[s.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:s.description}),Array.isArray(s.tags)&&s.tags.length>0&&e.jsx("div",{className:"mb-3 flex flex-wrap gap-1",children:s.tags.map(n=>e.jsx(p,{variant:"outline",className:"text-xs",children:n},n))}),s.start_date&&s.end_date&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-4",children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[v(u(s.start_date),"MMM d")," - ",v(u(s.end_date),"MMM d, yyyy")]})]}),s.owner&&e.jsx("div",{className:"mb-4",children:e.jsxs(p,{variant:"outline",className:"text-gray-600",children:["Owner: ",s.owner]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Recent Updates"}),e.jsx(De,{className:"h-32 rounded-md border p-2",children:b[s.id]?.flatMap(n=>(n.updates||[]).map(C=>({...C,taskTitle:n.title}))).sort((n,C)=>new Date(C.date)-new Date(n.date)).map((n,C)=>e.jsx("div",{className:"mb-2 last:mb-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fe,{className:"h-4 w-4 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:n.text}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:v(u(n.date),"MMM d, yyyy")}),e.jsxs("span",{className:"text-xs text-gray-400",children:["in ",n.taskTitle]})]})]})]})},C))})]}),e.jsx(We,{value:r,onCommit:n=>oe(s.id,n)}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"h-4 w-4 text-indigo-500 mr-1"}),e.jsxs("span",{className:"text-sm",children:[i.total," tasks"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[i.done>0&&e.jsxs(p,{variant:"outline",className:"bg-green-50",children:[i.done," done"]}),i.in_progress>0&&e.jsxs(p,{variant:"outline",className:"bg-blue-50",children:[i.in_progress," in progress"]})]})]})]})]},s.id)})})]}),e.jsx(Ee,{open:te,onOpenChange:w,children:e.jsxs(Me,{className:"sm:max-w-md",children:[e.jsxs(Te,{children:[e.jsx(Fe,{children:d?"Edit Project":"Create New Project"}),e.jsx(Ie,{children:d?"Update the project details below.":"Fill in the details to create a new project."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Project Name"}),e.jsx(D,{id:"name",value:t.name,onChange:s=>o("name",s.target.value),placeholder:"Enter project name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx(Ae,{id:"description",value:t.description,onChange:s=>o("description",s.target.value),placeholder:"Enter project description",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"status",children:"Status"}),e.jsxs(R,{value:t.status,onValueChange:s=>o("status",s),children:[e.jsx(V,{children:e.jsx($,{placeholder:"Select status"})}),e.jsxs(H,{children:[e.jsx(x,{value:"not_started",children:"Not Started"}),e.jsx(x,{value:"in_progress",children:"In Progress"}),e.jsx(x,{value:"on_hold",children:"On Hold"}),e.jsx(x,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"owner",children:"Project Owner"}),e.jsx(D,{id:"owner",value:t.owner,onChange:s=>o("owner",s.target.value),placeholder:"Project owner"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Start Date"}),e.jsxs(O,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),t.start_date?v(u(t.start_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(L,{className:"w-auto p-0",children:e.jsx(U,{mode:"single",selected:t.start_date?u(t.start_date):void 0,onSelect:s=>o("start_date",s?s.toISOString():"")})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"End Date"}),e.jsxs(O,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),t.end_date?v(u(t.end_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(L,{className:"w-auto p-0",children:e.jsx(U,{mode:"single",selected:t.end_date?u(t.end_date):void 0,onSelect:s=>o("end_date",s?s.toISOString():"")})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Deadline (Critical Date)"}),e.jsxs(O,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),t.deadline?v(u(t.deadline),"PPP"):e.jsx("span",{children:"Set deadline (optional)"})]})}),e.jsx(L,{className:"w-auto p-0",children:e.jsx(U,{mode:"single",selected:t.deadline?u(t.deadline):void 0,onSelect:s=>o("deadline",s?s.toISOString():"")})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"priority_level",children:"Priority"}),e.jsxs(R,{value:t.priority_level,onValueChange:s=>o("priority_level",s),children:[e.jsx(V,{children:e.jsx($,{placeholder:"Select priority"})}),e.jsxs(H,{children:[e.jsx(x,{value:"low",children:"Low"}),e.jsx(x,{value:"medium",children:"Medium"}),e.jsx(x,{value:"high",children:"High"}),e.jsx(x,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"budget",children:"Budget"}),e.jsx(D,{id:"budget",type:"number",step:"0.01",min:"0",value:t.budget,onChange:s=>o("budget",s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"cost",children:"Actual Cost"}),e.jsx(D,{id:"cost",type:"number",step:"0.01",min:"0",value:t.cost,onChange:s=>o("cost",s.target.value),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Project Tags"}),e.jsx($e,{value:t.tags||[],onChange:s=>o("tags",s),placeholder:"Add service-related tags..."}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tags for service categorization (e.g., software, consulting, support)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Assigned Stakeholder"}),e.jsxs(R,{value:t.stakeholder_id||"none",onValueChange:s=>o("stakeholder_id",s==="none"?null:s),children:[e.jsx(V,{children:e.jsx($,{placeholder:"Select stakeholder"})}),e.jsxs(H,{children:[e.jsx(x,{value:"none",children:"No stakeholder assigned"}),(f||[]).map(s=>e.jsxs(x,{value:s.id,children:[s.name,s.company?` (${s.company})`:""]},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Color"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["indigo","blue","green","amber","red","purple","pink","teal"].map(s=>e.jsx("button",{type:"button",className:`w-8 h-8 rounded-full ${Q(s)} border-2 ${t.color===s?"border-black":"border-transparent"}`,onClick:()=>o("color",s)},s))})]})]}),e.jsxs(Oe,{children:[e.jsx(g,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(g,{onClick:ie,children:d?"Update Project":"Create Project"})]})]})})]})}export{os as default};
