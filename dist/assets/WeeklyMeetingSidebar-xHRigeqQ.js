import{j as e,a1 as I,o as q,p as K,a5 as F}from"./chunk-DHGN2BiO.js";import{a as n,R as J}from"./chunk-pjYta8vt.js";import{B as D}from"./chunk-C6AVtkQH.js";import{g as Q,c as O,i as X,j as Z,h as ee,A as se,b as te,B as R}from"./index-ByFAet0J.js";import{E as B,a as ae}from"./chunk-Cmp1bz9x.js";import{E as p}from"./chunk-DZDJsQre.js";import{s as re,e as ne,E as ie,f as i,p as w,i as L,G as V}from"./chunk-CZDJnSNg.js";import"./chunk-CMJ2xOR1.js";import"./chunk-DIbawoHp.js";import"./chunk-BKHKgTH6.js";import"./chunk-UtEqcWk6.js";import"./chunk-Dt0Bnklg.js";import"./chunk-PmtS5Ynq.js";import"./chunk-D3uHh-f_.js";import"./calendarSynchronizationService-C_BUFLgK.js";import"./calendarService-jP3ReSQA.js";function Me({currentWeek:f=new Date,meetings:v=[],onMeetingClick:E,onDateNavigate:M,agendaCounts:W={},className:Y="",isLoading:y=!1,error:g=null,onRetry:j=null,showRetryButton:G=!0,errorContext:le={}}){const[c,b]=n.useState(null),[o,T]=n.useState(0),d=n.useMemo(()=>re(f,{weekStartsOn:1}),[f]),m=n.useMemo(()=>ne(f,{weekStartsOn:1}),[f]),u=n.useMemo(()=>ie({start:d,end:m}),[d,m]),C=n.useMemo(()=>{try{b(null);const s={};return u.forEach(t=>{const a=i(t,"yyyy-MM-dd");s[a]={date:t,meetings:[]}}),v.forEach(t=>{try{if(!t.start_date)return;const a=w(t.start_date),l=t.end_date?w(t.end_date):a;u.forEach(r=>{const k=i(r,"yyyy-MM-dd");(L(a,r)||L(l,r)||a<r&&l>r)&&a<=m&&l>=d&&s[k].meetings.push(t)})}catch(a){console.warn(`Error processing meeting ${t.id}:`,a)}}),s}catch(s){const t=p.handleError(s,{operation:"process weekly meetings",showToast:!1,context:{weekStart:d,weekEnd:m,meetingsCount:v.length}});b(t);const a={};return u.forEach(l=>{const r=i(l,"yyyy-MM-dd");a[r]={date:l,meetings:[]}}),a}},[v,u,d,m]),N=n.useMemo(()=>Object.values(C).reduce((s,t)=>s+t.meetings.length,0),[C]),H=n.useCallback(s=>{try{if(s.all_day)return"All day";if(!s.start_date)return"";const t=i(w(s.start_date),"h:mm a");if(s.end_date){const a=i(w(s.end_date),"h:mm a");if(t!==a)return`${t} - ${a}`}return t}catch(t){return console.warn(`Error formatting meeting time for ${s.id}:`,t),"Time unavailable"}},[]),_=n.useCallback((s,t)=>{try{const a=p.wrapOperation(async()=>{E&&await E(s,t)},{operationName:"Navigate to Meeting",showLoading:!1,showSuccess:!1,retryOptions:{maxRetries:1,baseDelay:500},errorOptions:{severity:p.SEVERITY.LOW,context:{meetingId:s.id,meetingTitle:s.title,date:t.toISOString()}}});return a&&typeof a.catch=="function"?a.catch(l=>{console.warn("Meeting click failed:",l)}):a}catch(a){console.warn("Meeting click failed:",a)}},[E]),$=n.useCallback(s=>{try{const t=p.wrapOperation(async()=>{M&&await M(s)},{operationName:"Navigate to Date",showLoading:!1,showSuccess:!1,retryOptions:{maxRetries:1,baseDelay:500},errorOptions:{severity:p.SEVERITY.LOW,context:{date:s.toISOString()}}});return t&&typeof t.catch=="function"?t.catch(a=>{console.warn("Date navigation failed:",a)}):t}catch(t){console.warn("Date navigation failed:",t)}},[M]),U=n.useCallback(()=>{if(j){const s=o+1;T(s),b(null);const t=Math.min(1e3*Math.pow(2,s-1),5e3);setTimeout(()=>{j()},t)}},[j,o]);J.useEffect(()=>{!g&&!c&&T(0)},[g,c]);const A=(s,t,...a)=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),t(...a))};return e.jsxs(Q,{className:O("w-80 h-fit",Y),children:[e.jsxs(X,{className:"pb-3",children:[e.jsxs(Z,{className:"text-lg flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"This Week",N>0&&e.jsxs(D,{variant:"secondary",className:"ml-auto",children:[N," meeting",N!==1?"s":""]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i(d,"MMM d")," - ",i(m,"MMM d, yyyy")]})]}),e.jsxs(ee,{className:"space-y-3",children:[(g||c)&&e.jsxs(se,{variant:"destructive",className:"mb-3",role:"alert","aria-live":"polite",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(te,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:g||c?.userMessage||"Error processing meetings"}),G&&j&&e.jsx(R,{variant:"outline",size:"sm",onClick:U,disabled:y,className:"ml-2","aria-label":`Retry loading meetings${o>0?` (attempt ${o+1})`:""}`,children:y?e.jsx(K,{className:"h-3 w-3 animate-spin"}):"Retry"})]}),c?.suggestions&&c.suggestions.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("p",{className:"font-medium",children:"Suggestions:"}),e.jsx("ul",{className:"list-disc list-inside space-y-0.5",children:c.suggestions.slice(0,2).map((s,t)=>e.jsx("li",{children:s},t))})]}),o>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Retry attempt: ",o]})]})})]}),y&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",role:"status","aria-label":"Loading meetings",children:[e.jsx(K,{className:"h-8 w-8 mx-auto mb-3 animate-spin"}),e.jsx("p",{className:"text-sm",children:"Loading meetings..."}),o>0&&e.jsxs("p",{className:"text-xs mt-1",children:["Retrying... (attempt ",o+1,")"]})]}),!y&&N===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",role:"status","aria-label":"No meetings this week",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm font-medium",children:"No meetings this week"}),e.jsx("p",{className:"text-xs mt-1",children:"Your calendar is clear for the week"})]}):u.map(s=>{const t=i(s,"yyyy-MM-dd"),a=C[t];return a.meetings.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{variant:"ghost",className:O("w-full justify-start p-2 h-auto font-medium text-left",V(s)&&"bg-blue-50 text-blue-900"),onClick:()=>$(s),onKeyDown:r=>A(r,$,s),"aria-label":`Navigate to ${i(s,"EEEE, MMMM d")}`,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm",children:[i(s,"EEEE"),V(s)&&e.jsx(D,{variant:"secondary",className:"ml-2 text-xs",children:"Today"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:i(s,"MMM d")})]}),e.jsx(D,{variant:"outline",className:"text-xs",children:a.meetings.length})]})}),e.jsx("div",{className:"space-y-1 ml-2",children:a.meetings.map((r,k)=>{const x=B.getEventStyling(r,B.VARIANTS.SIDEBAR),z=x.icon,S=H(r),h=W[r.id];return e.jsx(R,{variant:"ghost",className:O("w-full justify-start p-2 h-auto text-left border hover:opacity-80 transition-opacity"),style:{backgroundColor:x.colors.light,color:x.colors.text,borderColor:x.colors.border},onClick:()=>_(r,s),onKeyDown:P=>A(P,_,r,s),"aria-label":`${r.title} at ${S||"no specific time"}`,children:e.jsxs("div",{className:"flex items-start gap-2 w-full min-w-0",children:[e.jsx(z,{className:"h-4 w-4 mt-0.5 flex-shrink-0",style:{color:x.colors.primary},"aria-hidden":"true"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:r.title}),r.event_type==="one_on_one"&&h&&h.count>0&&e.jsx(ae,{count:h.unresolvedCount||h.count,hasUnresolved:h.hasUnresolved,className:"flex-shrink-0"})]}),S&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(F,{className:"h-3 w-3 opacity-60","aria-hidden":"true"}),e.jsx("p",{className:"text-xs opacity-80",children:S})]}),r.description&&e.jsx("p",{className:"text-xs opacity-70 mt-1 line-clamp-2",children:r.description})]})]})},`${r.id}-${k}`)})})]},t):null})]})]})}export{Me as default};
