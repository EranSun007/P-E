const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TaskCreationForm-NRsPR7xV.js","assets/chunk-8WlaufA8.js","assets/chunk-pjYta8vt.js","assets/chunk-KzYfAQy1.js","assets/index-BK5E59O8.js","assets/chunk-BQPSriyy.js","assets/index-CO3VviEi.css","assets/chunk-DSRmHbBO.js","assets/chunk-DktN3Kjy.js","assets/chunk-N38jzkpe.js","assets/chunk-Cg2ZZDgQ.js","assets/chunk-BdHZTqfh.js","assets/chunk-UjCvYLMJ.js"])))=>i.map(i=>d[i]);
import{T as u,B as p,g as j,h as f,i as M,j as F,k as L,l as A,_ as E}from"./index-BK5E59O8.js";import{j as e,Y as g,f as S,af as R,ag as P,ah as B}from"./chunk-8WlaufA8.js";import{a as n}from"./chunk-pjYta8vt.js";import{B as V,D as O,a as z,b as K,c as Y}from"./chunk-Cg2ZZDgQ.js";import{R as H,L as W,X,Y as q,T as I,a as w}from"./chunk-An1cF_3A.js";import{f as N}from"./chunk-BQPSriyy.js";const U=n.lazy(()=>E(()=>import("./TaskCreationForm-NRsPR7xV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])));function ae(){const[$,v]=n.useState([]),[y,k]=n.useState([]),[b,c]=n.useState(!1);n.useEffect(()=>{x()},[]);const x=async()=>{try{const a=await u.list();v(a);const t=a.filter(s=>s.type==="metric");k(t)}catch(a){console.error("Failed to load tasks:",a)}},_=async a=>{if(!a){c(!1);return}try{await u.create({...a,type:"metric"}),await x(),c(!1)}catch(t){console.error("Failed to create metric:",t)}},h=y.reduce((a,t)=>{const s=t.metadata?.metric?.kpi_name;return s&&(a[s]||(a[s]=[]),a[s].push(t)),a},{}),D=a=>{if(!a||a.length<2)return{trend:"neutral",percentage:0};const t=[...a].sort((m,T)=>new Date(m.created_date)-new Date(T.created_date)),s=t[t.length-1],o=t[t.length-2],r=parseFloat(s.metadata?.metric?.current_value)||0,i=parseFloat(o.metadata?.metric?.current_value)||0;if(r===i)return{trend:"neutral",percentage:0};const l=r-i,d=i!==0?Math.abs(Math.round(l/i*100)):0;return{trend:l>0?"up":"down",percentage:d}},C=a=>a.filter(t=>t.metadata?.metric?.current_value).map(t=>({date:N(new Date(t.created_date),"MMM dd"),value:parseFloat(t.metadata?.metric?.current_value)||0,target:parseFloat(t.metadata?.metric?.target_value)||void 0})).sort((t,s)=>new Date(t.date)-new Date(s.date));return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Metrics Dashboard"}),e.jsxs(p,{onClick:()=>c(!0),children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Track New Metric"]})]}),Object.keys(h).length===0?e.jsx(j,{className:"bg-gray-50 border-dashed",children:e.jsxs(f,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(S,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No metrics being tracked"}),e.jsx("p",{className:"text-gray-500 text-center mb-4",children:"Start tracking your key product metrics to monitor performance"}),e.jsxs(p,{onClick:()=>c(!0),children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Add First Metric"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(h).map(([a,t])=>{const s=D(t),o=C(t),r=t.sort((d,m)=>new Date(m.created_date)-new Date(d.created_date))[0],i=r.metadata?.metric?.current_value,l=r.metadata?.metric?.target_value;return e.jsxs(j,{className:"overflow-hidden",children:[e.jsx(M,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(F,{children:a}),e.jsx(L,{children:r.metadata?.metric?.measurement_frequency||"Tracked periodically"})]}),e.jsxs(V,{variant:"outline",children:[t.length," updates"]})]})}),e.jsxs(f,{className:"pb-0",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("div",{className:"text-2xl font-bold",children:i}),s.percentage>0&&e.jsxs("div",{className:`flex items-center ${s.trend==="up"?"text-green-600":"text-red-600"}`,children:[s.trend==="up"?e.jsx(R,{className:"h-4 w-4 mr-1"}):e.jsx(P,{className:"h-4 w-4 mr-1"}),s.percentage,"%"]})]}),l&&e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(B,{className:"h-3 w-3 mr-1 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Target: ",l]})]}),e.jsx("div",{className:"h-36 mt-4",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(W,{data:o,children:[e.jsx(X,{dataKey:"date",tick:{fontSize:12},tickLine:!1,axisLine:!1}),e.jsx(q,{tick:{fontSize:12},tickLine:!1,axisLine:!1,width:30}),e.jsx(I,{}),e.jsx(w,{type:"monotone",dataKey:"value",stroke:"#6366F1",strokeWidth:2,dot:{r:3},activeDot:{r:5}}),o.some(d=>d.target!==void 0)&&e.jsx(w,{type:"monotone",dataKey:"target",stroke:"#E5E7EB",strokeWidth:1,strokeDasharray:"4 4",dot:!1})]})})})]}),e.jsx(A,{className:"pt-4",children:e.jsxs("div",{className:"text-xs text-gray-500",children:["Last updated: ",N(new Date(r.created_date),"PPp")]})})]},a)})}),e.jsx(O,{open:b,onOpenChange:c,children:e.jsxs(z,{className:"sm:max-w-lg",children:[e.jsx(K,{children:e.jsx(Y,{children:"Track New Metric"})}),e.jsx(n.Suspense,{fallback:e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Loading task form..."})]}),children:e.jsx(U,{onCreateTask:_,initialTaskData:{status:"todo",priority:"medium",type:"metric",metadata:{metric:{}}}})})]})})]})})}export{ae as default};
