import{j as e,N as me,aT as ze,aU as ps,D as Qe,az as gs,L as z,aF as Cs,U as He,aV as js,$ as _e,n as be,aW as ks,aX as Ss,ad as Ds,ae as Fs,X as Ps,K as fs,v as Es,aY as Ts,aZ as pe,a_ as Is,a$ as Ce,aC as As,T as ke,b0 as Ls,b1 as Xe,aQ as Ze,Q as Oe,aw as es,b2 as Rs,a8 as ss,p as Os,b3 as as,b4 as rs}from"./chunk-WPKCbDK8.js";import{a as r}from"./chunk-BKwDNIOR.js";import{C as V,h as ee,i as se,m as re,j as q,a as K,b as Be,c as Y,L,I as G,q as Ms,B as g,y as we,z as ys,U as Me,k as Ue,E as Us,F as xe,G as ts}from"./index-CnhOL4vI.js";import{T as $s,a as Gs,b as Hs,c as _s}from"./chunk-3WTxq07n.js";import{T as Ve,a as qe,b as ge,c as H,d as Ke,e as _}from"./chunk-qi7vZLzc.js";import{B as te}from"./chunk-DIYexMSd.js";import{D as ne,a as le,b as ie,c as ce,e as oe,d as de}from"./chunk-D8_EjMoV.js";import{D as Ye,a as Je,b as We,d as je}from"./chunk-Di6AD2c4.js";import{R as Bs,a as ns}from"./chunk-p5_VtM_5.js";import{S as zs,a as Vs,b as qs,c as Ks,d as ls}from"./chunk-BOs1hDSJ.js";import{S as Ys}from"./chunk-Cwx6QR2c.js";import{u as Js,a as is,D as cs,c as os,S as $e,v as Ge,b as ds,d as ms,s as Ws,K as Qs,P as Xs,e as ws,C as Ns,f as Zs}from"./chunk-Sjx62m6H.js";import"./chunk-DGs6foQ1.js";import"./chunk-BwuEqr1N.js";function ea(){const[n,f]=r.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[v,w]=r.useState(null),[k,p]=r.useState(null),[N,u]=r.useState(!1),P=(o,j)=>{f(E=>({...E,[o]:j}))},b=async o=>{if(o.preventDefault(),w(null),p(null),n.newPassword!==n.confirmPassword){w("New passwords do not match.");return}if(n.newPassword.length<6){w("New password must be at least 6 characters long.");return}u(!0);try{const j=await we.changePassword(n.currentPassword,n.newPassword);if(!j.success){w(j.error||"Failed to change password.");return}p("Password changed successfully!"),f({currentPassword:"",newPassword:"",confirmPassword:""})}catch(j){w(j.message||"Failed to change password. Please try again.")}finally{u(!1)}};return e.jsxs(V,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Change Password"}),e.jsx(re,{children:"Update your password here. Your new password must be at least 6 characters long."})]}),e.jsxs("form",{onSubmit:b,children:[e.jsxs(q,{className:"space-y-4",children:[v&&e.jsxs(K,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(Be,{children:"Error"}),e.jsx(Y,{children:v})]}),k&&e.jsxs(K,{children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx(Be,{children:"Success"}),e.jsx(Y,{children:k})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"currentPassword",children:"Current Password"}),e.jsx(G,{id:"currentPassword",type:"password",value:n.currentPassword,onChange:o=>P("currentPassword",o.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"newPassword",children:"New Password"}),e.jsx(G,{id:"newPassword",type:"password",value:n.newPassword,onChange:o=>P("newPassword",o.target.value),required:!0,minLength:6})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(G,{id:"confirmPassword",type:"password",value:n.confirmPassword,onChange:o=>P("confirmPassword",o.target.value),required:!0})]})]}),e.jsx(Ms,{children:e.jsxs(g,{type:"submit",disabled:N,children:[e.jsx(ps,{className:"h-4 w-4 mr-2"}),N?"Saving...":"Save Changes"]})})]})]})}const ve="https://pe-manager-backend.cfapps.eu01-canary.hana.ondemand.com/api";function sa(){const{user:n}=ys(),[f,v]=r.useState([]),[w,k]=r.useState(!0),[p,N]=r.useState(null),[u,P]=r.useState(null),[b,o]=r.useState(!1),[j,E]=r.useState(!1),[R,B]=r.useState(null),[C,I]=r.useState({username:"",password:"",email:"",name:"",role:"user"}),[$,A]=r.useState(""),[x,d]=r.useState(!1),l=n?.role==="admin";r.useEffect(()=>{l&&h()},[l]);const h=async()=>{k(!0),N(null);try{const t=we.getToken(),m=await fetch(`${ve}/users`,{headers:{Authorization:`Bearer ${t}`}});if(!m.ok)throw new Error("Failed to load users");const O=await m.json();v(O)}catch(t){N(t.message)}finally{k(!1)}},S=async()=>{d(!0),N(null);try{const t=we.getToken(),m=await fetch(`${ve}/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(C)}),O=await m.json();if(!m.ok)throw new Error(O.message||"Failed to create user");P(`User "${C.username}" created successfully!`),o(!1),I({username:"",password:"",email:"",name:"",role:"user"}),h()}catch(t){N(t.message)}finally{d(!1)}},J=async t=>{try{const m=we.getToken(),O=await fetch(`${ve}/users/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({is_active:!t.is_active})});if(!O.ok){const M=await O.json();throw new Error(M.message||"Failed to update user")}P(`User "${t.username}" ${t.is_active?"deactivated":"activated"} successfully!`),h()}catch(m){N(m.message)}},X=async()=>{if(!(!R||!$)){d(!0),N(null);try{const t=we.getToken(),m=await fetch(`${ve}/users/${R.id}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({newPassword:$})});if(!m.ok){const O=await m.json();throw new Error(O.message||"Failed to reset password")}P(`Password for "${R.username}" reset successfully!`),E(!1),B(null),A("")}catch(t){N(t.message)}finally{d(!1)}}},T=t=>{B(t),A(""),E(!0)};return l?e.jsxs(V,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5"}),"User Management"]}),e.jsx(re,{children:"Create and manage user accounts for your team"})]}),e.jsxs(g,{onClick:()=>o(!0),children:[e.jsx(gs,{className:"h-4 w-4 mr-2"}),"Add User"]})]})}),e.jsxs(q,{className:"space-y-4",children:[p&&e.jsxs(K,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(Y,{children:p})]}),u&&e.jsxs(K,{children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx(Y,{children:u})]}),w?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-gray-400"})}):f.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found. Create your first user!"}):e.jsxs(Ve,{children:[e.jsx(qe,{children:e.jsxs(ge,{children:[e.jsx(H,{children:"Username"}),e.jsx(H,{children:"Name"}),e.jsx(H,{children:"Email"}),e.jsx(H,{children:"Role"}),e.jsx(H,{children:"Status"}),e.jsx(H,{children:"Last Login"}),e.jsx(H,{className:"w-[80px]",children:"Actions"})]})}),e.jsx(Ke,{children:f.map(t=>e.jsxs(ge,{children:[e.jsx(_,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.role==="admin"?e.jsx(Cs,{className:"h-4 w-4 text-amber-500"}):e.jsx(He,{className:"h-4 w-4 text-gray-400"}),t.username,t.id===n?.id&&e.jsx(te,{variant:"outline",className:"ml-1",children:"You"})]})}),e.jsx(_,{children:t.name||"-"}),e.jsx(_,{children:t.email||"-"}),e.jsx(_,{children:e.jsx(te,{variant:t.role==="admin"?"default":"secondary",children:t.role})}),e.jsx(_,{children:e.jsx(te,{variant:t.is_active?"outline":"destructive",children:t.is_active?"Active":"Inactive"})}),e.jsx(_,{children:t.last_login?new Date(t.last_login).toLocaleDateString():"Never"}),e.jsx(_,{children:e.jsxs(Ye,{children:[e.jsx(Je,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(js,{className:"h-4 w-4"})})}),e.jsxs(We,{align:"end",children:[e.jsx(je,{onClick:()=>T(t),children:"Reset Password"}),t.id!==n?.id&&e.jsx(je,{onClick:()=>J(t),className:t.is_active?"text-red-600":"text-green-600",children:t.is_active?"Deactivate":"Activate"})]})]})})]},t.id))})]})]}),e.jsx(ne,{open:b,onOpenChange:o,children:e.jsxs(le,{children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Create New User"}),e.jsx(oe,{children:"Add a new user to the system. They will be able to login with the credentials you provide."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"username",children:"Username *"}),e.jsx(G,{id:"username",value:C.username,onChange:t=>I(m=>({...m,username:t.target.value})),placeholder:"Enter username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"password",children:"Password *"}),e.jsx(G,{id:"password",type:"password",value:C.password,onChange:t=>I(m=>({...m,password:t.target.value})),placeholder:"Enter password (min 6 characters)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"name",children:"Full Name"}),e.jsx(G,{id:"name",value:C.name,onChange:t=>I(m=>({...m,name:t.target.value})),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",children:"Email"}),e.jsx(G,{id:"email",type:"email",value:C.email,onChange:t=>I(m=>({...m,email:t.target.value})),placeholder:"Enter email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"role",children:"Role"}),e.jsxs(zs,{value:C.role,onValueChange:t=>I(m=>({...m,role:t})),children:[e.jsx(Vs,{children:e.jsx(qs,{placeholder:"Select role"})}),e.jsxs(Ks,{children:[e.jsx(ls,{value:"user",children:"User"}),e.jsx(ls,{value:"admin",children:"Admin"})]})]})]})]}),e.jsxs(de,{children:[e.jsx(g,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(g,{onClick:S,disabled:x||!C.username||!C.password,children:x?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create User"})]})]})}),e.jsx(ne,{open:j,onOpenChange:E,children:e.jsxs(le,{children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Reset Password"}),e.jsxs(oe,{children:["Set a new password for ",R?.username,". They will need to use this password to login."]})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"newPassword",children:"New Password"}),e.jsx(G,{id:"newPassword",type:"password",value:$,onChange:t=>A(t.target.value),placeholder:"Enter new password (min 6 characters)"})]})}),e.jsxs(de,{children:[e.jsx(g,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),e.jsx(g,{onClick:X,disabled:x||!$||$.length<6,children:x?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Resetting..."]}):"Reset Password"})]})]})})]}):e.jsxs(V,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5"}),"User Management"]})}),e.jsx(q,{children:e.jsxs(K,{children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(Y,{children:"You must be an administrator to manage users."})]})})]})}function aa(){const[n,f]=r.useState(null),[v,w]=r.useState(!0),[k,p]=r.useState(!1),[N,u]=r.useState(""),[P,b]=r.useState(!1),[o,j]=r.useState(null),[E,R]=r.useState(null),[B,C]=r.useState(!1);r.useEffect(()=>{I()},[]);const I=async()=>{w(!0),j(null);try{const x=await Me.getGitHubStatus();f(x)}catch(x){console.error("Failed to load GitHub status:",x),j("Failed to check GitHub connection status")}finally{w(!1)}},$=async x=>{if(x.preventDefault(),!N.trim()){j("Please enter a GitHub Personal Access Token");return}p(!0),j(null),R(null);try{const d=await Me.setGitHubToken(N.trim());f({connected:!0,user:d.user}),u(""),R(`Connected to GitHub as ${d.user.login}`)}catch(d){console.error("Failed to connect GitHub:",d),j(d.message||"Failed to connect to GitHub. Please check your token.")}finally{p(!1)}},A=async()=>{p(!0),j(null);try{await Me.deleteGitHubToken(),f({connected:!1}),C(!1),R("Disconnected from GitHub")}catch(x){console.error("Failed to disconnect GitHub:",x),j("Failed to disconnect from GitHub")}finally{p(!1)}};return v?e.jsx(V,{children:e.jsxs(q,{className:"flex items-center justify-center py-8",children:[e.jsx(z,{className:"h-6 w-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading GitHub status..."})]})}):e.jsxs(V,{children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"GitHub Integration"]}),e.jsx(re,{children:"Connect your GitHub account to track repository progress, pull requests, issues, and commits"})]}),e.jsxs(q,{className:"space-y-6",children:[o&&e.jsxs(K,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(Y,{children:o})]}),E&&e.jsxs(K,{children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(Y,{children:E})]}),n?.connected?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[n.user?.avatar_url&&e.jsx("img",{src:n.user.avatar_url,alt:n.user.login,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:n.user?.name||n.user?.login}),e.jsxs(te,{variant:"outline",className:"bg-green-100 text-green-800 border-green-300",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Connected"]})]}),e.jsxs("a",{href:`https://github.com/${n.user?.login}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1",children:["@",n.user?.login,e.jsx(ks,{className:"h-3 w-3"})]})]})]}),e.jsxs(g,{variant:"outline",onClick:()=>C(!0),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Disconnect"]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"Your GitHub Personal Access Token is securely stored. You can now:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Track repositories from the GitHub page"}),e.jsx("li",{children:"View pull requests, issues, and commits"}),e.jsx("li",{children:"Monitor repository metrics and progress"})]})]})]}):e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"github-token",children:"Personal Access Token"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{id:"github-token",type:P?"text":"password",value:N,onChange:x=>u(x.target.value),placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>b(!P),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:P?e.jsx(Ds,{className:"h-4 w-4"}):e.jsx(Fs,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Create a token at"," ",e.jsx("a",{href:"https://github.com/settings/tokens?type=beta",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"GitHub Settings → Developer Settings → Personal Access Tokens"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Required token permissions:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-green-600"}),e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"repo"})," - Read access to repositories"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-green-600"}),e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"read:user"})," - Read your profile"]})]})]}),e.jsx(g,{type:"submit",disabled:k||!N.trim(),children:k?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Connect GitHub"]})})]})]}),e.jsx(ne,{open:B,onOpenChange:C,children:e.jsxs(le,{children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Disconnect GitHub?"}),e.jsx(oe,{children:"This will remove your GitHub token and stop syncing repository data. Your tracked repositories will be kept, but metrics won't update until you reconnect."})]}),e.jsxs(de,{children:[e.jsx(g,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(g,{variant:"destructive",onClick:A,disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Disconnecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"h-4 w-4 mr-2"}),"Disconnect"]})})]})]})})]})}const hs=[{key:"bug_inflow_rate",label:"Bug Inflow Rate",description:"Weekly bug creation rate"},{key:"median_ttfr_hours",label:"Time to First Response",description:"Median hours to first response"},{key:"sla_vh_percent",label:"SLA Compliance (VH)",description:"Very High priority SLA compliance"},{key:"sla_high_percent",label:"SLA Compliance (High)",description:"High priority SLA compliance"},{key:"backlog_health_score",label:"Backlog Health Score",description:"Overall backlog health metric"}];function ra(){const[n,f]=r.useState({}),[v,w]=r.useState(!0),[k,p]=r.useState(null),[N,u]=r.useState(null),[P,b]=r.useState(null),[o,j]=r.useState(""),[E,R]=r.useState(!1),[B,C]=r.useState(!1);r.useEffect(()=>{I()},[]);const I=async()=>{w(!0),u(null);try{const d=await Ue.emailPreferences.list(),l={};let h="";d.forEach(S=>{l[S.kpi_key]={enabled:S.enabled,email:S.email},S.email&&!h&&(h=S.email)}),f(l),j(h)}catch(d){console.error("Failed to load email preferences:",d),u("Failed to load email preferences. Please try again.")}finally{w(!1)}},$=async(d,l)=>{if(u(null),b(null),l&&!o){u("Please enter an email address before enabling notifications.");return}p(d);try{await Ue.emailPreferences.update(d,{enabled:l,email:o}),f(h=>({...h,[d]:{enabled:l,email:o}})),b(`${l?"Enabled":"Disabled"} notifications for ${hs.find(h=>h.key===d)?.label||d}`),setTimeout(()=>b(null),3e3)}catch(h){console.error("Failed to update preference:",h),u("Failed to update notification preference. Please try again.")}finally{p(null)}},A=d=>{j(d),R(!0),u(null),b(null)},x=async()=>{if(!o){u("Please enter a valid email address.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){u("Please enter a valid email address.");return}C(!0),u(null),b(null);try{const l=Object.entries(n).filter(([h,S])=>S.enabled).map(([h])=>h);for(const h of l)await Ue.emailPreferences.update(h,{enabled:!0,email:o});f(h=>{const S={...h};return l.forEach(J=>{S[J]&&(S[J].email=o)}),S}),R(!1),b(l.length>0?`Email updated for ${l.length} notification(s).`:"Email saved."),setTimeout(()=>b(null),3e3)}catch(l){console.error("Failed to save email:",l),u("Failed to save email address. Please try again.")}finally{C(!1)}};return v?e.jsx(V,{children:e.jsxs(q,{className:"flex items-center justify-center py-12",children:[e.jsx(z,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Loading preferences..."})]})}):e.jsxs(V,{children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"h-5 w-5"}),"Email Notifications"]}),e.jsx(re,{children:"Receive email alerts when KPIs cross into red zone thresholds"})]}),e.jsxs(q,{className:"space-y-6",children:[N&&e.jsxs(K,{variant:"destructive",children:[e.jsx(Es,{className:"h-4 w-4"}),e.jsx(Y,{children:N})]}),P&&e.jsxs(K,{children:[e.jsx(ze,{className:"h-4 w-4 text-green-600"}),e.jsx(Y,{className:"text-green-700",children:P})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(L,{htmlFor:"notification-email",className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"h-4 w-4"}),"Notification Email"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(G,{id:"notification-email",type:"email",placeholder:"you@example.com",value:o,onChange:d=>A(d.target.value),className:"flex-1"}),e.jsx(g,{onClick:x,disabled:!E||B,variant:E?"default":"outline",children:B?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"All KPI alert emails will be sent to this address."})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"KPI Alert Preferences"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enable or disable email notifications for individual KPIs when they enter red zone status."}),e.jsx("div",{className:"space-y-3",children:hs.map(d=>{const h=n[d.key]?.enabled||!1,S=k===d.key;return e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg border bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:d.label}),e.jsx("p",{className:"text-sm text-gray-500",children:d.description})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[S&&e.jsx(z,{className:"h-4 w-4 animate-spin text-gray-400"}),e.jsx(Ys,{checked:h,onCheckedChange:J=>$(d.key,J),disabled:S,"aria-label":`Enable email notifications for ${d.label}`})]})]},d.key)})})]}),e.jsxs("div",{className:"rounded-lg bg-blue-50 p-4 text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"How it works"}),e.jsx("p",{children:"When you upload a CSV with KPI data, the system automatically checks thresholds. If any enabled KPI crosses into the red zone, you'll receive an email alert with details and a link to the dashboard."})]})]})]})}const ta=[{id:"tasks",name:"Tasks",icon:"CheckSquare"},{id:"calendar",name:"Calendar",icon:"Calendar"},{id:"duties",name:"Duties",icon:"CalendarDays"},{id:"projects",name:"Projects",icon:"Folders"},{id:"metrics",name:"Metrics",icon:"BarChart2"},{id:"team",name:"Team",icon:"UserPlus"},{id:"stakeholders",name:"Stakeholders",icon:"Users"},{id:"peers",name:"Peers",icon:"Users"},{id:"github",name:"GitHub",icon:"Github"},{id:"jira",name:"Jira",icon:"Bug"},{id:"capture-inbox",name:"Capture Inbox",icon:"Inbox"},{id:"capture-rules",name:"Capture Rules",icon:"FileCode"},{id:"bug-dashboard",name:"Bug Dashboard",icon:"Bug"},{id:"knowledge-search",name:"Knowledge Search",icon:"Search"},{id:"team-sync",name:"Team Sync",icon:"Users"},{id:"team-status",name:"Team Status",icon:"Activity"}],na=[{id:"services",name:"My Services",icon:"Server"},{id:"roadmap",name:"My Roadmap",icon:"Map"},{id:"backlog",name:"My Backlog",icon:"ListTodo"},{id:"analytics",name:"Usage Analytics",icon:"TrendingUp"},{id:"feedback",name:"Customer Feedback",icon:"MessageSquare"},{id:"releases",name:"Releases",icon:"Rocket"}];function la({folder:n,getItemsCount:f,openEditDialog:v,openDeleteDialog:w}){const{attributes:k,listeners:p,setNodeRef:N,transform:u,transition:P,isDragging:b}=ws({id:n.id}),o={transform:Ns.Transform.toString(u),transition:P,opacity:b?.5:1};return e.jsxs(ge,{ref:N,style:o,children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{...k,...p,"aria-label":"Drag to reorder",className:"cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-100",style:{touchAction:"none"},children:e.jsx(Ce,{className:"h-4 w-4 text-gray-400"})}),e.jsx(pe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:n.name})]})}),e.jsx(_,{children:e.jsx(te,{variant:"secondary",children:f(n.id)})}),e.jsx(_,{children:e.jsxs(Ye,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(js,{className:"h-4 w-4"})]})}),e.jsxs(We,{align:"end",children:[e.jsxs(je,{onClick:()=>v(n),children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(je,{className:"text-red-600",onClick:()=>w(n),children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]})}function us({itemId:n,menuItems:f}){const v=f.find(o=>o.id===n),{attributes:w,listeners:k,setNodeRef:p,transform:N,transition:u,isDragging:P}=ws({id:n}),b={transform:Ns.Transform.toString(N),transition:u,opacity:P?.5:1};return v?e.jsxs("div",{ref:p,style:b,className:"flex items-center gap-2 py-2 px-3 bg-white border rounded mb-1",children:[e.jsx("button",{...w,...k,"aria-label":"Drag to reorder",className:"cursor-grab active:cursor-grabbing p-1 rounded hover:bg-gray-100",style:{touchAction:"none"},children:e.jsx(Ce,{className:"h-4 w-4 text-gray-400"})}),e.jsx("span",{className:"text-sm font-medium",children:v.name})]}):null}function xs({id:n,children:f,label:v,isEmpty:w}){const{isOver:k,setNodeRef:p}=Zs({id:n});return e.jsxs("div",{ref:p,className:`min-h-[80px] p-3 rounded-lg border-2 transition-colors ${k?"border-blue-400 bg-blue-50":"border-gray-200 bg-gray-50"}`,children:[v&&e.jsx("div",{className:"text-xs font-medium text-gray-500 mb-2",children:v}),f,w&&e.jsx("div",{className:"text-sm text-gray-400 italic text-center py-4",children:"Drop items here"})]})}function ia(){const{folders:n,items:f,config:v,saveConfig:w,resetToDefaults:k,loading:p,error:N,currentMode:u}=Us(),[P,b]=r.useState(!1),[o,j]=r.useState(null),[E,R]=r.useState(""),[B,C]=r.useState(!1),[I,$]=r.useState(null),[A,x]=r.useState(!1),[d,l]=r.useState(null),[h,S]=r.useState(null),[J,X]=r.useState(null),[T,t]=r.useState({}),m=u==="product"?na:ta,O=()=>{const a={root:[]};n.forEach(c=>{a[c.id]=[]}),f.forEach(c=>{c.folderId&&a[c.folderId]&&a[c.folderId].push(c.itemId)});const i=f.filter(c=>c.folderId).map(c=>c.itemId);return a.root=m.filter(c=>!i.includes(c.id)).map(c=>c.id),a},M=a=>{for(const[i,c]of Object.entries(T))if(c.includes(a))return i;return null};r.useEffect(()=>{t(O())},[n,f,m]);const ue=Js(is(Xs,{activationConstraint:{distance:8}}),is(Qs,{coordinateGetter:Ws})),fe=a=>f.filter(i=>i.folderId===a).length,ye=async()=>{if(window.confirm("Reset navigation to defaults? This will remove all folders and item assignments.")){x(!0),l(null);try{await k()||l("Failed to reset. Please try again.")}catch(a){console.error("Error resetting to defaults:",a),l("An unexpected error occurred. Please try again.")}finally{x(!1)}}},Se=()=>{j(null),R(""),b(!0),l(null)},De=a=>{j(a),R(a.name),b(!0),l(null)},Fe=a=>{$(a),C(!0),l(null)},Pe=async()=>{if(!E.trim()){l("Folder name is required.");return}if(E.trim().length>50){l("Folder name must be 50 characters or less.");return}x(!0),l(null);try{let a;if(o)a=n.map(c=>c.id===o.id?{...c,name:E.trim()}:c);else{const c=n.length>0?Math.max(...n.map(U=>U.order||0)):0,D={id:crypto.randomUUID(),name:E.trim(),order:c+1};a=[...n,D]}await w({...v,folders:a})?(b(!1),R(""),j(null)):l("Failed to save folder. Please try again.")}catch(a){console.error("Error saving folder:",a),l("An unexpected error occurred. Please try again.")}finally{x(!1)}},Ne=async()=>{if(I){x(!0),l(null);try{const a=n.filter(D=>D.id!==I.id),i=f.map(D=>D.folderId===I.id?{...D,folderId:null}:D);await w({...v,folders:a,items:i})?(C(!1),$(null)):l("Failed to delete folder. Please try again.")}catch(a){console.error("Error deleting folder:",a),l("An unexpected error occurred. Please try again.")}finally{x(!1)}}},Ee=({active:a})=>{S(a.id)},Te=async({active:a,over:i})=>{if(S(null),A||!i||a.id===i.id)return;const c=n.findIndex(F=>F.id===a.id),D=n.findIndex(F=>F.id===i.id);if(c===-1||D===-1)return;const W=ms(n,c,D).map((F,ae)=>({...F,order:ae+1}));x(!0),l(null);try{await w({...v,folders:W})||l("Failed to save folder order. Please try again.")}catch(F){console.error("Error saving folder order:",F),l("An unexpected error occurred. Please try again.")}finally{x(!1)}},Ie=({active:a})=>{X(a.id)},Ae=({active:a,over:i})=>{if(!i)return;const c=M(a.id);let D=i.id in T?i.id:M(i.id);!c||!D||c===D||t(U=>{const W=[...U[c]],F=[...U[D]],ae=W.indexOf(a.id);W.splice(ae,1);let s=F.length;return i.id!==D&&(s=F.indexOf(i.id),s===-1&&(s=F.length)),F.splice(s,0,a.id),{...U,[c]:W,[D]:F}})},Le=async({active:a,over:i})=>{if(X(null),A){t(O());return}if(!i){t(O());return}const c=M(a.id),D=i.id in T?i.id:M(i.id);if(!c||!D){t(O());return}if(c===D&&a.id!==i.id){const U=[...T[c]],W=U.indexOf(a.id),F=U.indexOf(i.id);if(W!==-1&&F!==-1){const ae=ms(U,W,F);t(s=>({...s,[c]:ae}))}}x(!0),l(null);try{const U=[];for(const[F,ae]of Object.entries(T))F!=="root"&&ae.forEach(s=>{U.push({itemId:s,folderId:F})});await w({...v,items:U})||(l("Failed to save item assignment. Please try again."),t(O()))}catch(U){console.error("Error saving item assignment:",U),l("An unexpected error occurred. Please try again."),t(O())}finally{x(!1)}};if(p)return e.jsx(V,{children:e.jsxs(q,{className:"flex items-center justify-center py-12",children:[e.jsx(z,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Loading navigation settings..."})]})});const he=d||N;return e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"Navigation Folders"]}),e.jsx(re,{children:"Create folders to organize your sidebar menu items"})]}),e.jsx(te,{variant:"outline",className:"ml-4",children:u==="product"?"Product Mode":"People Mode"})]})}),e.jsxs(q,{className:"space-y-4",children:[he&&e.jsxs(K,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(Y,{children:he})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(g,{onClick:Se,children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),"Add Folder"]})}),n.length===0?e.jsxs("div",{className:"text-center p-8 border border-dashed rounded-lg",children:[e.jsx(pe,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No folders. Create your first folder to organize navigation."})]}):e.jsxs(cs,{sensors:ue,collisionDetection:os,onDragStart:Ee,onDragEnd:Te,children:[e.jsx($e,{items:n.sort((a,i)=>(a.order||0)-(i.order||0)).map(a=>a.id),strategy:Ge,children:e.jsxs(Ve,{children:[e.jsx(qe,{children:e.jsxs(ge,{children:[e.jsx(H,{children:"Name"}),e.jsx(H,{children:"Items"}),e.jsx(H,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Ke,{children:n.sort((a,i)=>(a.order||0)-(i.order||0)).map(a=>e.jsx(la,{folder:a,getItemsCount:fe,openEditDialog:De,openDeleteDialog:Fe},a.id))})]})}),e.jsx(ds,{children:h?e.jsxs("div",{className:"bg-white border rounded shadow-lg p-3 flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-gray-400"}),e.jsx(pe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:n.find(a=>a.id===h)?.name})]}):null})]})]})]}),e.jsxs(V,{className:"mt-6",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Menu Items"}),e.jsx(re,{children:"Drag items between containers to organize your navigation"})]}),e.jsx(q,{children:e.jsxs(cs,{sensors:ue,collisionDetection:os,onDragStart:Ie,onDragOver:Ae,onDragEnd:Le,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Root Level"}),e.jsx(xs,{id:"root",isEmpty:(T.root||[]).length===0,children:e.jsx($e,{items:T.root||[],strategy:Ge,children:(T.root||[]).map(a=>e.jsx(us,{itemId:a,menuItems:m},a))})})]}),e.jsx("div",{className:"space-y-4",children:n.sort((a,i)=>(a.order||0)-(i.order||0)).map(a=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),a.name]}),e.jsx(xs,{id:a.id,isEmpty:(T[a.id]||[]).length===0,children:e.jsx($e,{items:T[a.id]||[],strategy:Ge,children:(T[a.id]||[]).map(i=>e.jsx(us,{itemId:i,menuItems:m},i))})})]},a.id))})]}),e.jsx(ds,{children:J?e.jsxs("div",{className:"bg-white border-2 border-blue-400 rounded shadow-lg p-2 flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:m.find(a=>a.id===J)?.name})]}):null})]})})]}),e.jsxs(V,{className:"mt-6",children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(se,{children:"Preview"}),e.jsx(re,{children:"See how your navigation will appear"})]}),e.jsxs(g,{variant:"outline",onClick:ye,disabled:A,children:[e.jsx(As,{className:"h-4 w-4 mr-2"}),"Reset to Defaults"]})]})}),e.jsx(q,{children:e.jsxs("div",{className:"space-y-2",children:[(T.root||[]).map(a=>{const i=m.find(c=>c.id===a);return i?e.jsx("div",{className:"flex items-center gap-2 py-1.5 px-3 rounded bg-gray-50",children:e.jsx("span",{className:"text-sm",children:i.name})},a):null}),n.sort((a,i)=>(a.order||0)-(i.order||0)).map(a=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 font-medium text-sm",children:[e.jsx(pe,{className:"h-4 w-4"}),a.name,e.jsx(te,{variant:"secondary",className:"text-xs",children:(T[a.id]||[]).length})]}),e.jsxs("div",{className:"ml-6 mt-2 space-y-1",children:[(T[a.id]||[]).map(i=>{const c=m.find(D=>D.id===i);return c?e.jsx("div",{className:"text-sm text-gray-600 py-0.5",children:c.name},i):null}),(T[a.id]||[]).length===0&&e.jsx("div",{className:"text-sm text-gray-400 italic",children:"No items"})]})]},a.id)),(T.root||[]).length===0&&n.length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"No items to display"})]})})]}),e.jsx(ne,{open:P,onOpenChange:b,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(ce,{children:o?"Edit Folder":"Create Folder"}),e.jsx(oe,{children:o?"Update the folder name.":"Enter a name for your new folder."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"folder-name",children:"Folder Name"}),e.jsx(G,{id:"folder-name",value:E,onChange:a=>R(a.target.value),placeholder:"Enter folder name",maxLength:50,autoFocus:!0}),e.jsxs("p",{className:"text-xs text-gray-500",children:[E.length,"/50 characters"]})]})}),e.jsxs(de,{children:[e.jsx(g,{variant:"outline",onClick:()=>b(!1),disabled:A,children:"Cancel"}),e.jsx(g,{onClick:Pe,disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):o?"Save":"Create"})]})]})}),e.jsx(ne,{open:B,onOpenChange:C,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Delete Folder"}),e.jsxs(oe,{children:['Are you sure you want to delete "',I?.name,'"?']})]}),e.jsxs(K,{variant:"warning",className:"my-4",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(Y,{children:"Items in this folder will be moved to the root level."})]}),e.jsxs(de,{children:[e.jsx(g,{variant:"outline",onClick:()=>C(!1),disabled:A,children:"Cancel"}),e.jsx(g,{variant:"destructive",onClick:Ne,disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Delete"]})})]})]})})]})}function ba(){const{user:n}=ys(),[f,v]=r.useState([]),[w,k]=r.useState(!0),[p,N]=r.useState("priorities"),[u,P]=r.useState(""),[b,o]=r.useState(!1),[j,E]=r.useState(null),[R,B]=r.useState(null),[C,I]=r.useState(!1),[$,A]=r.useState(null),[x,d]=r.useState(!1),[l,h]=r.useState(null),[S,J]=r.useState("merge"),[X,T]=r.useState(null),[t,m]=r.useState(!1),O=r.useRef(null),[M,ue]=r.useState({type:"priority",name:"",description:"",color:"",order:0,default:!1}),fe={priorities:"priority",taskTypes:"taskType",tags:"tag",statuses:"status"};r.useEffect(()=>{p!=="account"&&ye()},[p]);const ye=async()=>{k(!0),B(null);try{const s=await xe.list();if(s.length===0){await Se();const y=await xe.list();v(y)}else v(s)}catch(s){console.error("Failed to load attributes:",s),B("Failed to load task attributes. Please try again.")}finally{k(!1)}},Se=async()=>{const s=[{type:"priority",name:"low",description:"Low priority tasks",color:"blue",order:1,default:!0},{type:"priority",name:"medium",description:"Medium priority tasks",color:"yellow",order:2,default:!0},{type:"priority",name:"high",description:"High priority tasks",color:"orange",order:3,default:!0},{type:"priority",name:"urgent",description:"Urgent priority tasks",color:"red",order:4,default:!0},{type:"taskType",name:"generic",description:"Generic tasks",color:"gray",order:1,default:!0},{type:"taskType",name:"meeting",description:"Meeting tasks",color:"blue",order:2,default:!0},{type:"taskType",name:"metric",description:"Metric tracking tasks",color:"green",order:3,default:!0},{type:"taskType",name:"action",description:"Action items",color:"purple",order:4,default:!0},{type:"status",name:"backlog",description:"Backlog tasks",color:"gray",order:1,default:!0},{type:"status",name:"todo",description:"To-do tasks",color:"blue",order:2,default:!0},{type:"status",name:"in_progress",description:"In-progress tasks",color:"yellow",order:3,default:!0},{type:"status",name:"blocked",description:"Blocked tasks",color:"red",order:4,default:!0},{type:"status",name:"done",description:"Completed tasks",color:"green",order:5,default:!0},{type:"tag",name:"design",description:"Design-related tasks",color:"purple",order:1,default:!0},{type:"tag",name:"development",description:"Development tasks",color:"blue",order:2,default:!0},{type:"tag",name:"research",description:"Research tasks",color:"green",order:3,default:!0},{type:"tag",name:"planning",description:"Planning tasks",color:"yellow",order:4,default:!0}];await xe.bulkCreate(s)},De=s=>({blue:"bg-blue-100 text-blue-800 border-blue-200",green:"bg-green-100 text-green-800 border-green-200",red:"bg-red-100 text-red-800 border-red-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",purple:"bg-purple-100 text-purple-800 border-purple-200",orange:"bg-orange-100 text-orange-800 border-orange-200",pink:"bg-pink-100 text-pink-800 border-pink-200",indigo:"bg-indigo-100 text-indigo-800 border-indigo-200",gray:"bg-gray-100 text-gray-800 border-gray-200"})[s]||"bg-gray-100 text-gray-800 border-gray-200",Fe=s=>{switch(s){case"priority":return e.jsx(Xe,{className:"h-4 w-4"});case"taskType":return e.jsx(Ze,{className:"h-4 w-4"});case"tag":return e.jsx(es,{className:"h-4 w-4"});case"status":return e.jsx(Oe,{className:"h-4 w-4"});default:return null}},Pe=s=>{N(s)},Ne=f.filter(s=>s.type!==fe[p]?!1:u?s.name.toLowerCase().includes(u.toLowerCase())||s.description&&s.description.toLowerCase().includes(u.toLowerCase()):!0).sort((s,y)=>s.order-y.order),Ee=()=>{ue({type:fe[p],name:"",description:"",color:"blue",order:Te(),default:!1}),E(null),o(!0)},Te=()=>{const s=f.filter(Z=>Z.type===fe[p]);return s.length===0?1:Math.max(...s.map(Z=>Z.order||0))+1},Ie=s=>{ue({type:s.type,name:s.name||"",description:s.description||"",color:s.color||"blue",order:s.order||0,default:s.default||!1}),E(s),o(!0)},Ae=s=>{A(s),I(!0)},Le=async()=>{if($)try{await xe.delete($.id),await ye(),I(!1),A(null)}catch(s){console.error("Failed to delete attribute:",s),B("Failed to delete attribute. Please try again.")}},he=(s,y)=>{ue(Z=>({...Z,[s]:y}))},a=async()=>{try{j?await xe.update(j.id,M):await xe.create(M),o(!1),await ye()}catch(s){console.error("Failed to save attribute:",s),B("Failed to save attribute. Please try again.")}},i=n?.role==="admin",c=[{id:"priorities",label:"Priorities",icon:Xe},{id:"taskTypes",label:"Task Types",icon:Ze},{id:"statuses",label:"Statuses",icon:Oe},{id:"tags",label:"Tags",icon:es},{id:"account",label:"Account",icon:He},...i?[{id:"users",label:"Users",icon:He}]:[],{id:"github",label:"GitHub",icon:_e},{id:"notifications",label:"Notifications",icon:fs},{id:"navigation",label:"Navigation",icon:Rs},{id:"data",label:"Data",icon:ss}],D=async()=>{d(!0),h(null);try{const s=await ts.export(),y=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),Z=URL.createObjectURL(y),Q=document.createElement("a"),Re=new Date().toISOString().split("T")[0];Q.href=Z,Q.download=`pe-backup-${Re}.json`,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),URL.revokeObjectURL(Z),h({type:"success",text:"Backup downloaded successfully!"})}catch(s){console.error("Export failed:",s),h({type:"error",text:"Failed to export data. Please try again."})}finally{d(!1)}},U=s=>{const y=s.target.files[0];y&&(T(y),h(null))},W=()=>{if(!X){h({type:"error",text:"Please select a backup file first."});return}S==="replace"?m(!0):F()},F=async()=>{d(!0),h(null),m(!1);try{const s=await X.text(),y=JSON.parse(s),Z=await ts.import(y,S),{summary:Q}=Z,Re=Object.values(Q).reduce((bs,vs)=>bs+vs,0);h({type:"success",text:`Import completed! ${Re} records imported (${Q.tasks} tasks, ${Q.projects} projects, ${Q.teamMembers} team members, ${Q.stakeholders} stakeholders).`}),T(null),O.current&&(O.current.value="")}catch(s){console.error("Import failed:",s),h({type:"error",text:`Import failed: ${s.message}`})}finally{d(!1)}},ae=[{id:"blue",name:"Blue"},{id:"green",name:"Green"},{id:"red",name:"Red"},{id:"yellow",name:"Yellow"},{id:"purple",name:"Purple"},{id:"orange",name:"Orange"},{id:"pink",name:"Pink"},{id:"indigo",name:"Indigo"},{id:"gray",name:"Gray"}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Settings"}),e.jsxs($s,{defaultValue:"priorities",value:p,onValueChange:Pe,className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx(Gs,{className:"bg-gray-100",children:c.map(s=>e.jsxs(Hs,{value:s.id,className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{children:s.label})]},s.id))}),!["account","users","github","notifications","data","navigation"].includes(p)&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(G,{placeholder:`Search ${p}...`,value:u,onChange:s=>P(s.target.value),className:"pl-9"})]}),e.jsxs(g,{onClick:Ee,children:[e.jsx(gs,{className:"h-4 w-4 mr-2"}),"Add New"]})]})]}),R&&e.jsxs(K,{variant:"destructive",className:"mb-6",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(Be,{children:"Error"}),e.jsx(Y,{children:R})]}),c.map(s=>e.jsx(_s,{value:s.id,className:"space-y-4",children:s.id==="data"?e.jsxs(V,{children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5"}),"Data Management"]}),e.jsx(re,{children:"Export and import your data for backup and recovery"})]}),e.jsxs(q,{className:"space-y-6",children:[l&&e.jsxs(K,{variant:l.type==="error"?"destructive":"default",children:[l.type==="error"?e.jsx(me,{className:"h-4 w-4"}):e.jsx(Oe,{className:"h-4 w-4"}),e.jsx(Y,{children:l.text})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Export Backup"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Download all your data as a JSON file. This includes tasks, projects, stakeholders, team members, meetings, and more."}),e.jsx(g,{onClick:D,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Download Backup"]})})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4"}),"Import Backup"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Restore data from a previously exported backup file."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"backup-file",children:"Select Backup File"}),e.jsx(G,{id:"backup-file",type:"file",accept:".json",ref:O,onChange:U,className:"cursor-pointer"}),X&&e.jsxs("p",{className:"text-sm text-green-600",children:["Selected: ",X.name]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Import Mode"}),e.jsxs(Bs,{value:S,onValueChange:J,className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{value:"merge",id:"merge"}),e.jsxs(L,{htmlFor:"merge",className:"font-normal cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:"Merge"})," - Add imported records to existing data"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{value:"replace",id:"replace"}),e.jsxs(L,{htmlFor:"replace",className:"font-normal cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:"Replace"})," - Clear all existing data and import fresh"]})]})]})]}),e.jsx(g,{onClick:W,disabled:x||!X,children:x?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Import Data"]})})]})]})]}):s.id==="users"?e.jsx(sa,{}):s.id==="github"?e.jsx(aa,{}):s.id==="notifications"?e.jsx(ra,{}):s.id==="navigation"?e.jsx(ia,{}):s.id!=="account"?e.jsxs(V,{children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-5 w-5"}),s.label]}),e.jsxs(re,{children:["Manage ",s.label.toLowerCase()," for your tasks"]})]}),e.jsx(q,{children:w?e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading attributes..."})]}):Ne.length===0?e.jsx("div",{className:"text-center p-8 border border-dashed rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:u?`No ${s.label.toLowerCase()} found matching your search`:`No ${s.label.toLowerCase()} found. Add your first one!`})}):e.jsxs(Ve,{children:[e.jsx(qe,{children:e.jsxs(ge,{children:[e.jsx(H,{children:"Name"}),e.jsx(H,{children:"Description"}),e.jsx(H,{children:"Color"}),e.jsx(H,{children:"Order"}),e.jsx(H,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Ke,{children:Ne.map(y=>e.jsxs(ge,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(te,{variant:"outline",className:De(y.color),children:[Fe(y.type),e.jsx("span",{className:"ml-1",children:y.name})]}),y.default&&e.jsx(te,{variant:"outline",className:"text-xs",children:"Default"})]})}),e.jsx(_,{children:y.description||"-"}),e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${y.color?`bg-${y.color}-500`:"bg-gray-300"}`}),e.jsx("span",{className:"capitalize",children:y.color||"None"})]})}),e.jsx(_,{children:y.order}),e.jsx(_,{children:e.jsxs(Ye,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})]})}),e.jsxs(We,{align:"end",children:[e.jsx(je,{onClick:()=>Ie(y),children:"Edit"}),e.jsx(je,{className:"text-red-600",onClick:()=>Ae(y),children:"Delete"})]})]})})]},y.id))})]})})]}):e.jsx(ea,{})},s.id))]})]}),e.jsx(ne,{open:b,onOpenChange:o,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(ce,{children:j?`Edit ${M.type}`:`Create new ${M.type}`}),e.jsx(oe,{children:j?`Edit the details for this ${M.type}`:`Add a new ${M.type} for your tasks`})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"name",children:"Name"}),e.jsx(G,{id:"name",value:M.name,onChange:s=>he("name",s.target.value),placeholder:`Enter ${M.type} name`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"description",children:"Description"}),e.jsx(G,{id:"description",value:M.description,onChange:s=>he("description",s.target.value),placeholder:"Optional description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Color"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:ae.map(s=>e.jsxs(g,{type:"button",variant:M.color===s.id?"default":"outline",className:"justify-start",onClick:()=>he("color",s.id),children:[e.jsx("div",{className:`w-4 h-4 rounded-full bg-${s.id}-500 mr-2`}),s.name]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"order",children:"Display Order"}),e.jsx(G,{id:"order",type:"number",min:"1",value:M.order,onChange:s=>he("order",parseInt(s.target.value))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Lower numbers appear first in lists"})]})]}),e.jsxs(de,{children:[e.jsx(g,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsxs(g,{onClick:a,children:[e.jsx(ps,{className:"h-4 w-4 mr-2"}),j?"Update":"Create"]})]})]})}),e.jsx(ne,{open:C,onOpenChange:I,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Confirm Deletion"}),e.jsxs(oe,{children:["Are you sure you want to delete ",$?.name,"? This action cannot be undone."]})]}),e.jsxs(de,{className:"mt-4",children:[e.jsx(g,{variant:"outline",onClick:()=>I(!1),children:"Cancel"}),e.jsxs(g,{variant:"destructive",onClick:Le,children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}),e.jsx(ne,{open:t,onOpenChange:m,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Confirm Replace Import"}),e.jsx(oe,{children:'You selected "Replace" mode. This will DELETE ALL your existing data before importing the backup. This action cannot be undone. Are you sure you want to proceed?'})]}),e.jsxs(de,{className:"mt-4",children:[e.jsx(g,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsxs(g,{variant:"destructive",onClick:F,children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Delete All & Import"]})]})]})})]})}export{ba as default};
