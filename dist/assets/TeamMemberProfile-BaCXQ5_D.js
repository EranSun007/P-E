import{j as e,Y as ye,aC as Ze,N as Gt,aj as js,a0 as Ke,aD as nt,J as Rt,K as rt,aE as Vt,aF as Bs,aG as zt,d as te,ae as Ut,a5 as Ge,aH as Bt,aI as Ht,aJ as Yt,aK as lt,aL as it,aM as ct,aN as dt,aO as ot,aP as mt,aQ as Wt,aR as qt,a3 as ms,aS as Jt,k as Qt,aT as Hs,i as _s,l as Xt,ad as xs,aU as Zt,aV as Kt,a6 as ea,a9 as ws,aW as Ys,Q as Ws,T as qs,aX as sa,o as ta,aY as aa}from"./chunk-DHGN2BiO.js";import{a as r,k as na,L as ra}from"./chunk-pjYta8vt.js";import{g as V,i as X,j as Z,B as b,h as z,t as Ss,I as be,v as xt,w as ht,x as ut,c as B,y as jt,A as ze,b as Ue,L as M,O as ds,e as hs,D as re,p as pt,s as gt,z as Ae,T as la,P as ia,S as ca,q as da,k as bs}from"./index-ByFAet0J.js";import{A as Js}from"./chunk-zMH1QFF_.js";import{CalendarService as $e}from"./calendarService-jP3ReSQA.js";import{C as oa}from"./chunk-BKHKgTH6.js";import{E as os}from"./chunk-DSBO3d0u.js";import{A as us,O as ne}from"./chunk-CL12iECM.js";import{A as Qs,P as Xs}from"./chunk-PmtS5Ynq.js";import{a as ma,P as xa,A as Cs}from"./chunk-UtEqcWk6.js";import{T as Es,a as Ms,b as xe,c as he}from"./chunk-isMwlWi7.js";import{D as oe,a as me,b as Ne,c as we,B as U,f as Zs,d as Ds}from"./chunk-C6AVtkQH.js";import{S as Y,a as W,b as q,c as J,d as g}from"./chunk-D3uHh-f_.js";import{E as ha}from"./chunk-DIbawoHp.js";import{f as I,o as Oe,q as ua,r as ja,u as pa,F as ga,C as fa,v as va,w as ya,x as Na,y as wa,z as qe,A as ba,p as G}from"./chunk-CZDJnSNg.js";import{D as As,a as Os,b as ks,d as Ve}from"./chunk-DebkpaDS.js";import{T as Xe}from"./chunk-Dt0Bnklg.js";import{P as ge,a as fe,b as ve,C as de}from"./chunk-Cwmy-p0V.js";import{T as Da,a as _a,b as Ks,c as Je,d as Sa,e as Qe}from"./chunk-BFC3YuxX.js";import"./chunk-DZDJsQre.js";const Ca=({teamMemberId:a,teamMemberName:n})=>{const[x,d]=r.useState([]),[o,c]=r.useState(!0),[p,m]=r.useState(!1),[D,v]=r.useState("pending");r.useEffect(()=>{w()},[a]);const w=async()=>{c(!0);try{const C=await Qs.getByTeamMember(a);d(C)}catch(C){console.error("Error loading agenda items:",C)}finally{c(!1)}},P=async()=>{m(!1),await w()},f=async C=>{try{await Qs.update(C.id,{status:"discussed"}),await w()}catch(F){console.error("Error marking agenda item as discussed:",F)}},O=x.filter(C=>D==="pending"?C.status==="pending":D==="discussed"?C.status==="discussed":!0);return e.jsxs(V,{className:"w-full",children:[e.jsxs(X,{className:"flex flex-row items-center justify-between",children:[e.jsx(Z,{children:"1:1 Agenda"}),e.jsxs(b,{onClick:()=>m(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),e.jsx(z,{children:e.jsxs(Es,{defaultValue:"pending",value:D,onValueChange:v,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs(Ms,{children:[e.jsx(xe,{value:"pending",children:"Pending"}),e.jsx(xe,{value:"discussed",children:"Discussed"}),e.jsx(xe,{value:"all",children:"All"})]})}),e.jsx(he,{value:"pending",className:"mt-0",children:o?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(us,{items:O,loading:o,onComplete:f,emptyMessage:"No pending agenda items",emptyDescription:"Add items to discuss in your next 1:1 meeting."})}),e.jsx(he,{value:"discussed",className:"mt-0",children:o?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(us,{items:O,loading:o,showActions:!1,emptyMessage:"No discussed agenda items",emptyDescription:"Items marked as discussed will appear here."})}),e.jsx(he,{value:"all",className:"mt-0",children:o?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(us,{items:O,loading:o,onComplete:f,emptyMessage:"No agenda items found",emptyDescription:"All agenda items for this team member will appear here."})})]})}),e.jsx(oe,{open:p,onOpenChange:m,children:e.jsxs(me,{children:[e.jsx(Ne,{children:e.jsx(we,{children:"Add to 1:1 Agenda"})}),e.jsx(ma,{teamMemberId:a,onSubmit:P,onCancel:()=>m(!1)})]})})]})},Aa=({item:a,onEdit:n,onDelete:x,showActions:d=!0,className:o=""})=>{const c=f=>{switch(f){case"achievement":return"bg-green-100 text-green-800 border-green-200";case"feedback":return"bg-blue-100 text-blue-800 border-blue-200";case"concern":return"bg-red-100 text-red-800 border-red-200";case"goal":return"bg-purple-100 text-purple-800 border-purple-200";case"improvement":return"bg-orange-100 text-orange-800 border-orange-200";case"other":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},p=f=>{switch(f){case"achievement":return"Achievement";case"feedback":return"Feedback";case"concern":return"Concern";case"goal":return"Goal";case"improvement":return"Improvement";case"other":return"Other";default:return"Other"}},m=f=>{switch(f){case 5:return"text-red-600";case 4:return"text-orange-600";case 3:return"text-yellow-600";case 2:return"text-blue-600";case 1:return"text-gray-600";default:return"text-gray-600"}},D=f=>{switch(f){case 5:return"High";case 4:return"Medium-High";case 3:return"Medium";case 2:return"Medium-Low";case 1:return"Low";default:return"Medium"}},v=f=>Array.from({length:5},(O,C)=>e.jsx(nt,{className:`h-3 w-3 ${C<f?`fill-current ${m(f)}`:"text-gray-300"}`},C)),w=()=>{n&&n(a)},P=()=>{x&&x(a)};return e.jsx(V,{className:`transition-all hover:shadow-md ${o}`,children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h4",{className:"font-medium text-foreground leading-tight flex-1 mr-3",children:a.title}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs(U,{variant:"outline",className:c(a.category),children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"}),p(a.category)]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Importance:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[v(a.importance),e.jsx("span",{className:`text-xs font-medium ${m(a.importance)}`,children:D(a.importance)})]})]}),a.notes&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:e.jsx("p",{className:"whitespace-pre-wrap",children:a.notes})}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:a.tags.map((f,O)=>e.jsxs(U,{variant:"secondary",className:"text-xs",children:[e.jsx(Gt,{className:"h-2 w-2 mr-1"}),f]},O))}),a.sourceType&&a.sourceType!=="manual"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),"Source: ",a.sourceType]})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created ",I(new Date(a.createdAt),"MMM d, yyyy"),a.updatedAt!==a.createdAt&&e.jsxs("span",{children:[" • Updated ",I(new Date(a.updatedAt),"MMM d, yyyy")]})]}),d&&e.jsxs("div",{className:"flex items-center gap-1",children:[n&&e.jsxs(b,{variant:"ghost",size:"sm",onClick:w,className:"h-7 px-3 text-xs",children:[e.jsx(js,{className:"h-3 w-3 mr-1"}),"Edit"]}),x&&e.jsxs(b,{variant:"ghost",size:"sm",onClick:P,className:"h-7 px-3 text-xs text-destructive hover:text-destructive",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})]})})})},et=({items:a=[],loading:n=!1,onEdit:x,onDelete:d,showActions:o=!0,emptyMessage:c="No personal file items found",emptyDescription:p="Personal file items will appear here once they are added."})=>{const[m,D]=r.useState(""),[v,w]=r.useState("createdAt"),[P,f]=r.useState("desc"),[O,C]=r.useState("all"),[F,R]=r.useState("all"),H=r.useMemo(()=>{let k=a;if(m){const l=m.toLowerCase();k=k.filter(h=>h.title.toLowerCase().includes(l)||h.notes&&h.notes.toLowerCase().includes(l)||h.tags&&h.tags.some(u=>u.toLowerCase().includes(l)))}return O!=="all"&&(k=k.filter(l=>l.category===O)),F!=="all"&&(k=k.filter(l=>l.importance===parseInt(F))),k.sort((l,h)=>{let u,j;switch(v){case"title":u=l.title.toLowerCase(),j=h.title.toLowerCase();break;case"importance":u=l.importance,j=h.importance;break;case"category":u=l.category,j=h.category;break;case"updatedAt":u=new Date(l.updatedAt),j=new Date(h.updatedAt);break;case"createdAt":default:u=new Date(l.createdAt),j=new Date(h.createdAt);break}return P==="asc"?u<j?-1:u>j?1:0:u>j?-1:u<j?1:0}),k},[a,m,v,P,O,F]);return n?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Ss,{}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading personal file items..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(be,{placeholder:"Search personal file items...",value:m,onChange:k=>D(k.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Y,{value:O,onValueChange:C,children:[e.jsxs(W,{className:"w-36",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),e.jsx(q,{})]}),e.jsxs(J,{children:[e.jsx(g,{value:"all",children:"All Categories"}),e.jsx(g,{value:"achievement",children:"Achievement"}),e.jsx(g,{value:"feedback",children:"Feedback"}),e.jsx(g,{value:"concern",children:"Concern"}),e.jsx(g,{value:"goal",children:"Goal"}),e.jsx(g,{value:"improvement",children:"Improvement"}),e.jsx(g,{value:"other",children:"Other"})]})]}),e.jsxs(Y,{value:F,onValueChange:R,children:[e.jsxs(W,{className:"w-36",children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),e.jsx(q,{})]}),e.jsxs(J,{children:[e.jsx(g,{value:"all",children:"All Importance"}),e.jsx(g,{value:"5",children:"High"}),e.jsx(g,{value:"4",children:"Medium-High"}),e.jsx(g,{value:"3",children:"Medium"}),e.jsx(g,{value:"2",children:"Medium-Low"}),e.jsx(g,{value:"1",children:"Low"})]})]}),e.jsxs(Y,{value:`${v}-${P}`,onValueChange:k=>{const[l,h]=k.split("-");w(l),f(h)},children:[e.jsxs(W,{className:"w-40",children:[e.jsx(Vt,{className:"h-4 w-4 mr-2"}),e.jsx(q,{})]}),e.jsxs(J,{children:[e.jsx(g,{value:"createdAt-desc",children:"Newest First"}),e.jsx(g,{value:"createdAt-asc",children:"Oldest First"}),e.jsx(g,{value:"updatedAt-desc",children:"Recently Updated"}),e.jsx(g,{value:"importance-desc",children:"Importance: High to Low"}),e.jsx(g,{value:"importance-asc",children:"Importance: Low to High"}),e.jsx(g,{value:"title-asc",children:"Title: A to Z"}),e.jsx(g,{value:"title-desc",children:"Title: Z to A"}),e.jsx(g,{value:"category-asc",children:"Category: A to Z"})]})]})]})]}),a.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",H.length," of ",a.length," personal file items"]}),H.length===0?e.jsx(ha,{icon:Ze,title:a.length===0?c:"No matching items",description:a.length===0?p:"Try adjusting your search or filters"}):e.jsx("div",{className:"space-y-3",children:H.map(k=>e.jsx(Aa,{item:k,onEdit:x,onDelete:d,showActions:o},k.id))})]})},Oa=(a,n)=>{const d=a.sort((o,c)=>new Date(c.createdAt)-new Date(o.createdAt)).map(o=>{const c=new Date(o.createdAt).toLocaleDateString(),p=o.tags&&o.tags.length>0?`<div class="tags"><strong>Tags:</strong> ${o.tags.join(", ")}</div>`:"",m=`<div class="importance"><strong>Importance:</strong> ${o.importance}/5</div>`;return`
      <div class="item">
        <h3>${o.title}</h3>
        <div class="metadata">
          <div class="category"><strong>Category:</strong> ${o.category}</div>
          ${m}
          <div class="date"><strong>Date:</strong> ${c}</div>
          ${p}
        </div>
        <div class="notes">
          ${o.notes?`<p>${o.notes.replace(/\n/g,"<br>")}</p>`:"<p><em>No additional notes</em></p>"}
        </div>
      </div>
    `}).join("");return`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Personal File - ${n}</title>
      <style>
        @media print {
          body { margin: 0; }
          .no-print { display: none; }
        }
        
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333;
          max-width: 800px;
          margin: 0 auto;
          padding: 20px;
        }
        
        .header {
          border-bottom: 2px solid #333;
          padding-bottom: 20px;
          margin-bottom: 30px;
        }
        
        .header h1 {
          margin: 0 0 10px 0;
          color: #2563eb;
        }
        
        .header .meta {
          color: #666;
          font-size: 14px;
        }
        
        .item {
          margin-bottom: 30px;
          padding-bottom: 20px;
          border-bottom: 1px solid #eee;
        }
        
        .item:last-child {
          border-bottom: none;
        }
        
        .item h3 {
          margin: 0 0 10px 0;
          color: #1f2937;
        }
        
        .metadata {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
          margin-bottom: 15px;
          font-size: 14px;
          color: #666;
        }
        
        .metadata > div {
          background: #f8f9fa;
          padding: 4px 8px;
          border-radius: 4px;
        }
        
        .notes {
          margin-top: 10px;
        }
        
        .notes p {
          margin: 0;
          line-height: 1.5;
        }
        
        .tags {
          color: #059669;
        }
        
        .importance {
          color: #dc2626;
        }
        
        .print-button {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 10px 20px;
          background: #2563eb;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
        }
        
        .print-button:hover {
          background: #1d4ed8;
        }
        
        @media (max-width: 768px) {
          body {
            padding: 10px;
          }
          
          .metadata {
            flex-direction: column;
            gap: 5px;
          }
        }
      </style>
    </head>
    <body>
      <button class="print-button no-print" onclick="window.print()">Print</button>
      
      <div class="header">
        <h1>Personal File - ${n}</h1>
        <div class="meta">
          Generated: ${new Date().toLocaleDateString()} | 
          Total Items: ${a.length}
        </div>
      </div>
      
      <div class="content">
        ${d||"<p><em>No personal file items found.</em></p>"}
      </div>
    </body>
    </html>
  `},ka=(a,n)=>{const x=Oa(a,n),d=window.open("","_blank");d.document.write(x),d.document.close(),d.focus(),setTimeout(()=>{d.print()},250),xt(ut.PRINT,ht.PERSONAL_FILE_ITEM,"print_preview",{operation:"print",teamMemberName:n,itemCount:a.length,categories:[...new Set(a.map(o=>o.category))]})},Ea=(a,n)=>{const d=a.sort((v,w)=>new Date(w.createdAt)-new Date(v.createdAt)).map(v=>{const w=new Date(v.createdAt).toLocaleDateString(),P=v.tags&&v.tags.length>0?`
Tags: ${v.tags.join(", ")}`:"",f=`
Importance: ${v.importance}/5`;return`${v.title}
Category: ${v.category}${f}
Date: ${w}${P}

${v.notes||"No additional notes"}

${"=".repeat(50)}`}).join(`

`),c=`Personal File - ${n}
Generated: ${new Date().toLocaleDateString()}
Total Items: ${a.length}

PRIVACY NOTICE: This document contains sensitive performance-related information.
Handle according to your organization's data privacy policies.

${"=".repeat(50)}

`+d,p=new Blob([c],{type:"text/plain"}),m=URL.createObjectURL(p),D=document.createElement("a");D.href=m,D.download=`personal-file-${n.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(m),xt(ut.EXPORT,ht.PERSONAL_FILE_ITEM,"text_export",{operation:"export",teamMemberName:n,itemCount:a.length,categories:[...new Set(a.map(v=>v.category))],exportFormat:"text"})},Ma=({teamMemberId:a,teamMemberName:n})=>{const[x,d]=r.useState([]),[o,c]=r.useState(!0),[p,m]=r.useState(!1),[D,v]=r.useState(null),[w,P]=r.useState("all");r.useEffect(()=>{f()},[a]);const f=async()=>{c(!0);try{const h=await Xs.getByTeamMember(a);d(h)}catch(h){console.error("Error loading personal file items:",h),Oe.error("Failed to load personal file items")}finally{c(!1)}},O=async()=>{m(!1),v(null),await f()},C=h=>{v(h),m(!0)},F=async h=>{if(window.confirm("Are you sure you want to delete this personal file item?"))try{await Xs.delete(h.id),Oe.success("Personal file item deleted"),await f()}catch(u){console.error("Error deleting personal file item:",u),Oe.error("Failed to delete personal file item")}},R=()=>{try{Ea(x,n),Oe.success("Personal file exported successfully")}catch(h){console.error("Error exporting personal file:",h),Oe.error("Failed to export personal file")}},H=()=>{try{ka(x,n),Oe.success("Opening print preview...")}catch(h){console.error("Error printing personal file:",h),Oe.error("Failed to open print preview")}},k=x.filter(h=>w==="all"?!0:h.category===w),l=[...new Set(x.map(h=>h.category))].sort();return e.jsxs(V,{className:"w-full",children:[e.jsxs(X,{className:"flex flex-row items-center justify-between",children:[e.jsx(Z,{children:"Personal File"}),e.jsxs("div",{className:"flex gap-2",children:[x.length>0&&e.jsxs(As,{children:[e.jsx(Os,{asChild:!0,children:e.jsxs(b,{variant:"outline",children:[e.jsx(Bs,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(ks,{children:[e.jsxs(Ve,{onClick:R,children:[e.jsx(Bs,{className:"h-4 w-4 mr-2"}),"Export as Text"]}),e.jsxs(Ve,{onClick:H,children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"Print Preview"]})]})]}),e.jsxs(b,{onClick:()=>m(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Add Item"]})]})]}),e.jsx(z,{children:e.jsxs(Es,{defaultValue:"all",value:w,onValueChange:P,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs(Ms,{className:"grid-cols-auto",children:[e.jsx(xe,{value:"all",children:"All"}),l.map(h=>e.jsx(xe,{value:h,children:h.charAt(0).toUpperCase()+h.slice(1)},h))]})}),e.jsx(he,{value:"all",className:"mt-0",children:e.jsx(et,{items:k,loading:o,onEdit:C,onDelete:F,emptyMessage:"No personal file items found",emptyDescription:"Add items to build a comprehensive performance record."})}),l.map(h=>e.jsx(he,{value:h,className:"mt-0",children:e.jsx(et,{items:k,loading:o,onEdit:C,onDelete:F,emptyMessage:`No ${h} items found`,emptyDescription:`Items categorized as ${h} will appear here.`})},h))]})}),e.jsx(oe,{open:p,onOpenChange:h=>{m(h),h||v(null)},children:e.jsxs(me,{className:"max-w-2xl",children:[e.jsx(Ne,{children:e.jsx(we,{children:D?"Edit Personal File Item":"Add to Personal File"})}),e.jsx(xa,{teamMemberId:a,initialData:D,onSubmit:O,onCancel:()=>{m(!1),v(null)}})]})})]})},Pa=({teamMemberId:a,year:n,showBreakdown:x=!1,showYearSelector:d=!1,onStatsChange:o,className:c=""})=>{const p=new Date().getFullYear(),[m,D]=r.useState(n||p),[v,w]=r.useState(null),[P,f]=r.useState(!0),[O,C]=r.useState(null),F=r.useMemo(()=>{const j=[];for(let _=0;_<3;_++)j.push(p-_);return j},[p]),R=async j=>{if(!a){w(null),f(!1);return}try{f(!0),C(null);const _=await ne.getYearlyStats(a,j);w(_),o&&o(_)}catch(_){console.error("Failed to load out of office stats:",_),C(_.message),w(null)}finally{f(!1)}};r.useEffect(()=>{R(m)},[a,m]);const H=j=>{D(parseInt(j))},k=j=>ne.getReasonType(j)||{name:j,color:"#6b7280"},l=r.useMemo(()=>!v||!v.reasonBreakdown?[]:Object.entries(v.reasonBreakdown).map(([j,_])=>({reason:j,days:_,display:k(j)})).sort((j,_)=>_.days-j.days),[v]);if(P)return e.jsxs(V,{className:`animate-pulse ${c}`,children:[e.jsx(X,{className:"pb-2",children:e.jsxs(Z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(z,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]})]});if(O)return e.jsxs(V,{className:`border-red-200 ${c}`,children:[e.jsx(X,{className:"pb-2",children:e.jsxs(Z,{className:"text-sm font-medium text-red-600 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(z,{children:[e.jsx("p",{className:"text-sm text-red-600",children:"Failed to load stats"}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>R(m),className:"mt-2",children:"Retry"})]})]});const h=v?.totalDays||0,u=m===p;return e.jsxs(V,{className:c,children:[e.jsx(X,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Out of Office Days"]}),d&&e.jsxs(Y,{value:m.toString(),onValueChange:H,children:[e.jsx(W,{className:"w-20 h-8 text-xs",children:e.jsx(q,{})}),e.jsx(J,{children:F.map(j=>e.jsx(g,{value:j.toString(),children:j},j))})]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:h}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h===1?"day":"days"," in ",m,u&&e.jsx(U,{variant:"secondary",className:"ml-2 text-xs",children:"Current"})]})]}),x&&l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(Ut,{className:"h-3 w-3"}),"Breakdown"]}),e.jsx("div",{className:"space-y-1",children:l.map(({reason:j,days:_,display:y})=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:y.color}}),e.jsx("span",{children:y.name})]}),e.jsxs("span",{className:"font-medium",children:[_," ",_===1?"day":"days"]})]},j))})]}),h===0&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3"}),"No out of office periods in ",m]})]})})]})},ft=Bt,Fa=Ht,Ta=Yt,vt=r.forwardRef(({className:a,...n},x)=>e.jsx(mt,{className:B("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n,ref:x}));vt.displayName=mt.displayName;const Ps=r.forwardRef(({className:a,...n},x)=>e.jsxs(Ta,{children:[e.jsx(vt,{}),e.jsx(lt,{ref:x,className:B("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n})]}));Ps.displayName=lt.displayName;const Fs=({className:a,...n})=>e.jsx("div",{className:B("flex flex-col space-y-2 text-center sm:text-left",a),...n});Fs.displayName="AlertDialogHeader";const Ts=({className:a,...n})=>e.jsx("div",{className:B("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...n});Ts.displayName="AlertDialogFooter";const Is=r.forwardRef(({className:a,...n},x)=>e.jsx(it,{ref:x,className:B("text-lg font-semibold",a),...n}));Is.displayName=it.displayName;const $s=r.forwardRef(({className:a,...n},x)=>e.jsx(ct,{ref:x,className:B("text-sm text-muted-foreground",a),...n}));$s.displayName=ct.displayName;const Ls=r.forwardRef(({className:a,...n},x)=>e.jsx(ot,{ref:x,className:B(jt(),a),...n}));Ls.displayName=ot.displayName;const Gs=r.forwardRef(({className:a,...n},x)=>e.jsx(dt,{ref:x,className:B(jt({variant:"outline"}),"mt-2 sm:mt-0",a),...n}));Gs.displayName=dt.displayName;const st=({teamMemberId:a,initialData:n=null,onSubmit:x,onCancel:d,isLoading:o=!1})=>{const[c,p]=r.useState({start_date:"",end_date:"",reason:"",notes:""}),[m,D]=r.useState({}),[v,w]=r.useState([]),[P,f]=r.useState(!1),[O,C]=r.useState(!1),[F,R]=r.useState(!1);r.useEffect(()=>{n&&p({start_date:n.start_date||"",end_date:n.end_date||"",reason:n.reason||"",notes:n.notes||""})},[n]);const H=ne.getReasonTypes(),k=()=>{const y=ne.validatePeriod(c.start_date,c.end_date,c.reason,a),S={};return y.errors.forEach(E=>{E.includes("Start date")?S.start_date=E:E.includes("End date")?S.end_date=E:E.includes("Reason")?S.reason=E:(E.includes("Team member"),S.general=E)}),D(S),y.isValid},l=async()=>{if(!(!c.start_date||!c.end_date||!a))try{const y=await ne.checkOverlaps(a,c.start_date,c.end_date,n?.id);if(y.length>0){const S=y.map(E=>{const Be=I(new Date(E.start_date),"MMM dd, yyyy"),le=I(new Date(E.end_date),"MMM dd, yyyy");return`Overlaps with existing ${ne.getReasonType(E.reason)?.name||E.reason} period (${Be} - ${le})`});w(S)}else w([])}catch(y){console.error("Error checking overlaps:",y)}},h=(y,S)=>{p(E=>({...E,[y]:S})),m[y]&&D(E=>({...E,[y]:""})),m.general&&D(E=>({...E,general:""}))},u=(y,S)=>{if(S){const E=I(S,"yyyy-MM-dd");h(y,E),y==="start_date"?C(!1):R(!1)}},j=async y=>{if(y.preventDefault(),!!k()){f(!0);try{await l();const S={...c,team_member_id:a,created_date:n?.created_date||new Date().toISOString(),updated_date:new Date().toISOString()};n?.id&&(S.id=n.id),x&&await x(S)}catch(S){console.error("Error submitting form:",S),D({general:"Failed to save out of office period. Please try again."})}finally{f(!1)}}};r.useEffect(()=>{c.start_date&&c.end_date&&l()},[c.start_date,c.end_date,a]);const _=o||P;return e.jsxs(V,{className:"w-full max-w-2xl",children:[e.jsx(X,{children:e.jsx(Z,{children:n?"Edit Out of Office Period":"New Out of Office Period"})}),e.jsx(z,{children:e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[m.general&&e.jsx(ze,{variant:"destructive",children:e.jsx(Ue,{children:m.general})}),v.length>0&&e.jsx(ze,{children:e.jsx(Ue,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Warning: Period overlaps detected"}),v.map((y,S)=>e.jsx("p",{className:"text-sm",children:y},S))]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"start_date",children:"Start Date"}),e.jsxs(ge,{open:O,onOpenChange:C,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:B("w-full justify-start text-left font-normal",!c.start_date&&"text-muted-foreground",m.start_date&&"border-destructive"),disabled:_,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),c.start_date?I(new Date(c.start_date),"PPP"):e.jsx("span",{children:"Pick start date"})]})}),e.jsx(ve,{className:"w-auto p-0",align:"start",children:e.jsx(de,{mode:"single",selected:c.start_date?new Date(c.start_date):void 0,onSelect:y=>u("start_date",y),disabled:y=>y<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),m.start_date&&e.jsx("p",{className:"text-sm text-destructive",children:m.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"end_date",children:"End Date"}),e.jsxs(ge,{open:F,onOpenChange:R,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:B("w-full justify-start text-left font-normal",!c.end_date&&"text-muted-foreground",m.end_date&&"border-destructive"),disabled:_,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),c.end_date?I(new Date(c.end_date),"PPP"):e.jsx("span",{children:"Pick end date"})]})}),e.jsx(ve,{className:"w-auto p-0",align:"start",children:e.jsx(de,{mode:"single",selected:c.end_date?new Date(c.end_date):void 0,onSelect:y=>u("end_date",y),disabled:y=>{const S=new Date(new Date().setHours(0,0,0,0)),E=c.start_date?new Date(c.start_date):S;return y<Math.max(S,E)},initialFocus:!0})})]}),m.end_date&&e.jsx("p",{className:"text-sm text-destructive",children:m.end_date})]})]}),c.start_date&&c.end_date&&e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Duration: ",ne.calculateDaysInPeriod(c.start_date,c.end_date)," days"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"reason",children:"Reason"}),e.jsxs(Y,{value:c.reason,onValueChange:y=>h("reason",y),disabled:_,children:[e.jsx(W,{className:B(m.reason&&"border-destructive"),children:e.jsx(q,{placeholder:"Select a reason"})}),e.jsx(J,{children:H.map(y=>e.jsx(g,{value:y.value,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:y.color}}),e.jsx("span",{children:y.name})]})},y.value))})]}),m.reason&&e.jsx("p",{className:"text-sm text-destructive",children:m.reason})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(Xe,{id:"notes",placeholder:"Add any additional notes...",value:c.notes,onChange:y=>h("notes",y.target.value),disabled:_,rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[d&&e.jsx(b,{type:"button",variant:"outline",onClick:d,disabled:_,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:_,children:_?"Saving...":n?"Update":"Create"})]})]})})]})},Ia=({teamMemberId:a,teamMemberName:n})=>{const[x,d]=r.useState([]),[o,c]=r.useState([]),[p,m]=r.useState(!0),[D,v]=r.useState(""),[w,P]=r.useState("start_date"),[f,O]=r.useState("desc"),[C,F]=r.useState("all"),[R,H]=r.useState("all"),[k,l]=r.useState(!1),[h,u]=r.useState(null),[j,_]=r.useState(null),y=ne.getReasonTypes(),S=async()=>{try{m(!0),v("");const T=(await ds.list()).filter(L=>L.team_member_id===a);d(T)}catch(N){console.error("Error loading periods:",N),v("Failed to load out of office periods. Please try again.")}finally{m(!1)}},E=N=>{const T=new Date,L=new Date(N.start_date),ee=new Date(N.end_date);return T>=L&&T<=ee},Be=N=>{const T=new Date;return new Date(N.start_date)>T},le=N=>E(N)?"active":Be(N)?"upcoming":"past",es=()=>{let N=[...x];C!=="all"&&(N=N.filter(T=>T.reason===C)),R!=="all"&&(N=N.filter(T=>le(T)===R)),N.sort((T,L)=>{let ee,se;switch(w){case"start_date":ee=new Date(T.start_date),se=new Date(L.start_date);break;case"end_date":ee=new Date(T.end_date),se=new Date(L.end_date);break;case"reason":ee=T.reason,se=L.reason;break;case"duration":ee=ne.calculateDaysInPeriod(T.start_date,T.end_date),se=ne.calculateDaysInPeriod(L.start_date,L.end_date);break;default:ee=new Date(T.start_date),se=new Date(L.start_date)}return f==="asc"?ee<se?-1:ee>se?1:0:ee>se?-1:ee<se?1:0}),c(N)},Fe=async N=>{try{await ds.create(N),await S(),l(!1)}catch(T){throw console.error("Error creating period:",T),new Error("Failed to create out of office period")}},Te=async N=>{try{await ds.update(N.id,N),await S(),u(null)}catch(T){throw console.error("Error updating period:",T),new Error("Failed to update out of office period")}},gs=async N=>{try{await ds.delete(N),await S(),_(null)}catch(T){console.error("Error deleting period:",T),v("Failed to delete out of office period. Please try again.")}},fs=N=>{switch(N){case"active":return"destructive";case"upcoming":return"default";case"past":return"secondary";default:return"secondary"}},De=N=>ne.getReasonType(N);return r.useEffect(()=>{a&&S()},[a]),r.useEffect(()=>{es()},[x,w,f,C,R]),p?e.jsx(V,{children:e.jsx(z,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading out of office periods..."})})})}):e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Z,{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-5 w-5"}),e.jsx("span",{children:"Out of Office Periods"}),n&&e.jsxs("span",{className:"text-muted-foreground",children:["- ",n]})]}),e.jsxs(oe,{open:k,onOpenChange:l,children:[e.jsx(Zs,{asChild:!0,children:e.jsxs(b,{size:"sm",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Add Period"]})}),e.jsxs(me,{className:"max-w-2xl",children:[e.jsx(Ne,{children:e.jsx(we,{children:"Create Out of Office Period"})}),e.jsx(st,{teamMemberId:a,onSubmit:Fe,onCancel:()=>l(!1)})]})]})]})}),e.jsxs(z,{children:[D&&e.jsx(ze,{variant:"destructive",className:"mb-4",children:e.jsx(Ue,{children:D})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters:"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Reason:"}),e.jsxs(Y,{value:C,onValueChange:F,children:[e.jsx(W,{className:"w-32",children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(g,{value:"all",children:"All"}),y.map(N=>e.jsx(g,{value:N.value,children:N.name},N.value))]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Status:"}),e.jsxs(Y,{value:R,onValueChange:H,children:[e.jsx(W,{className:"w-32",children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(g,{value:"all",children:"All"}),e.jsx(g,{value:"active",children:"Active"}),e.jsx(g,{value:"upcoming",children:"Upcoming"}),e.jsx(g,{value:"past",children:"Past"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Sort by:"}),e.jsxs(Y,{value:w,onValueChange:P,children:[e.jsx(W,{className:"w-32",children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(g,{value:"start_date",children:"Start Date"}),e.jsx(g,{value:"end_date",children:"End Date"}),e.jsx(g,{value:"reason",children:"Reason"}),e.jsx(g,{value:"duration",children:"Duration"})]})]})]}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>O(f==="asc"?"desc":"asc"),children:f==="asc"?e.jsx(Wt,{className:"h-4 w-4"}):e.jsx(qt,{className:"h-4 w-4"})})]}),o.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:x.length===0?'No out of office periods found. Click "Add Period" to create one.':"No periods match the current filters."}):e.jsx("div",{className:"space-y-4",children:o.map(N=>{const T=De(N.reason),L=le(N),ee=ne.calculateDaysInPeriod(N.start_date,N.end_date);return e.jsx(V,{className:"border-l-4",style:{borderLeftColor:T?.color||"#6b7280"},children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:T?.color||"#6b7280"}}),e.jsx("span",{className:"font-medium",children:T?.name||N.reason})]}),e.jsx(U,{variant:fs(L),children:L.charAt(0).toUpperCase()+L.slice(1)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Start:"})," ",I(new Date(N.start_date),"MMM dd, yyyy")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"End:"})," ",I(new Date(N.end_date),"MMM dd, yyyy")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",ee," day",ee!==1?"s":""]})]}),N.notes&&e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",N.notes]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsxs(oe,{open:h?.id===N.id,onOpenChange:se=>!se&&u(null),children:[e.jsx(Zs,{asChild:!0,children:e.jsx(b,{variant:"outline",size:"sm",onClick:()=>u(N),children:e.jsx(js,{className:"h-4 w-4"})})}),e.jsxs(me,{className:"max-w-2xl",children:[e.jsx(Ne,{children:e.jsx(we,{children:"Edit Out of Office Period"})}),e.jsx(st,{teamMemberId:a,initialData:h,onSubmit:Te,onCancel:()=>u(null)})]})]}),e.jsxs(ft,{open:j?.id===N.id,onOpenChange:se=>!se&&_(null),children:[e.jsx(Fa,{asChild:!0,children:e.jsx(b,{variant:"outline",size:"sm",onClick:()=>_(N),children:e.jsx(Ke,{className:"h-4 w-4"})})}),e.jsxs(Ps,{children:[e.jsxs(Fs,{children:[e.jsx(Is,{children:"Delete Out of Office Period"}),e.jsxs($s,{children:["Are you sure you want to delete this ",T?.name||N.reason," period from ",I(new Date(N.start_date),"MMM dd, yyyy")," to ",I(new Date(N.end_date),"MMM dd, yyyy"),"? This action cannot be undone."]})]}),e.jsxs(Ts,{children:[e.jsx(Gs,{children:"Cancel"}),e.jsx(Ls,{onClick:()=>gs(N.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})})},N.id)})})]})]})},$a=[{value:"devops",label:"DevOps Duty"},{value:"on_call",label:"On-Call Duty"},{value:"other",label:"Other"}];function La({duty:a=null,onSave:n,onCancel:x,teamMembers:d=[]}){const[o,c]=r.useState({team_member_id:"",type:"",title:"",description:"",start_date:"",end_date:""}),[p,m]=r.useState({}),[D,v]=r.useState([]),[w,P]=r.useState(!1),[f,O]=r.useState([]);r.useEffect(()=>{d.length===0?C():O(d)},[d]),r.useEffect(()=>{a&&c({team_member_id:a.team_member_id||"",type:a.type||"",title:a.title||"",description:a.description||"",start_date:a.start_date?a.start_date.split("T")[0]:"",end_date:a.end_date?a.end_date.split("T")[0]:""})},[a]);const C=async()=>{try{const l=await hs.findAll();O(l)}catch(l){console.error("Failed to load team members:",l)}},F=(l,h)=>{c(u=>({...u,[l]:h})),p[l]&&m(u=>({...u,[l]:null}))},R=()=>{const l={};if(o.team_member_id||(l.team_member_id="Team member is required"),o.type||(l.type="Duty type is required"),o.title.trim()||(l.title="Title is required"),o.start_date||(l.start_date="Start date is required"),o.end_date||(l.end_date="End date is required"),o.start_date&&o.end_date){const h=new Date(o.start_date);new Date(o.end_date)<h&&(l.end_date="End date must be after start date")}return m(l),Object.keys(l).length===0},H=async()=>{if(!o.team_member_id||!o.start_date||!o.end_date)return[];try{return await re.getConflicts(o.team_member_id,o.start_date,o.end_date,a?.id)}catch(l){return console.error("Failed to check for conflicts:",l),[]}},k=async l=>{if(l.preventDefault(),!!R()){P(!0);try{const h=await H();if(v(h),h.length>0){P(!1);return}const u={...o,start_date:new Date(o.start_date).toISOString(),end_date:new Date(o.end_date).toISOString()};let j;a?j=await re.update(a.id,u):j=await re.create(u),n?.(j)}catch(h){console.error("Failed to save duty:",h),m({submit:h.message||"Failed to save duty"})}finally{P(!1)}}};return e.jsxs(V,{className:"w-full max-w-2xl",children:[e.jsx(X,{children:e.jsx(Z,{children:a?"Edit Duty Assignment":"Create Duty Assignment"})}),e.jsx(z,{children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"team_member_id",children:"Team Member *"}),e.jsxs(Y,{value:o.team_member_id,onValueChange:l=>F("team_member_id",l),children:[e.jsx(W,{children:e.jsx(q,{placeholder:"Select team member"})}),e.jsx(J,{children:f.map(l=>e.jsx(g,{value:l.id,children:l.name},l.id))})]}),p.team_member_id&&e.jsx("p",{className:"text-sm text-red-600",children:p.team_member_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"type",children:"Duty Type *"}),e.jsxs(Y,{value:o.type,onValueChange:l=>F("type",l),children:[e.jsx(W,{children:e.jsx(q,{placeholder:"Select duty type"})}),e.jsx(J,{children:$a.map(l=>e.jsx(g,{value:l.value,children:l.label},l.value))})]}),p.type&&e.jsx("p",{className:"text-sm text-red-600",children:p.type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"title",children:"Title *"}),e.jsx(be,{id:"title",value:o.title,onChange:l=>F("title",l.target.value),placeholder:"Enter duty title"}),p.title&&e.jsx("p",{className:"text-sm text-red-600",children:p.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"description",children:"Description"}),e.jsx(Xe,{id:"description",value:o.description,onChange:l=>F("description",l.target.value),placeholder:"Enter duty description (optional)",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(be,{id:"start_date",type:"date",value:o.start_date,onChange:l=>F("start_date",l.target.value)}),p.start_date&&e.jsx("p",{className:"text-sm text-red-600",children:p.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"end_date",children:"End Date *"}),e.jsx(be,{id:"end_date",type:"date",value:o.end_date,onChange:l=>F("end_date",l.target.value)}),p.end_date&&e.jsx("p",{className:"text-sm text-red-600",children:p.end_date})]})]}),D.length>0&&e.jsx(ze,{className:"border-orange-200 bg-orange-50",children:e.jsxs(Ue,{children:[e.jsx("strong",{children:"Warning: Duty conflicts detected!"}),e.jsx("ul",{className:"mt-2 list-disc list-inside",children:D.map(l=>e.jsxs("li",{children:[l.title," (",new Date(l.start_date).toLocaleDateString()," - ",new Date(l.end_date).toLocaleDateString(),")"]},l.id))}),e.jsx("p",{className:"mt-2 text-sm",children:"Please adjust the dates or confirm if you want to proceed with overlapping duties."})]})}),p.submit&&e.jsx(ze,{className:"border-red-200 bg-red-50",children:e.jsx(Ue,{className:"text-red-800",children:p.submit})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:x,disabled:w,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:w||D.length>0,children:w?"Saving...":a?"Update Duty":"Create Duty"})]})]})})]})}const tt={devops:{label:"DevOps Duty",icon:Qt,color:"bg-blue-100 text-blue-800 border-blue-200",badgeVariant:"secondary"},on_call:{label:"On-Call Duty",icon:Jt,color:"bg-red-100 text-red-800 border-red-200",badgeVariant:"destructive"},other:{label:"Other Duty",icon:ms,color:"bg-gray-100 text-gray-800 border-gray-200",badgeVariant:"outline"}};function at({duty:a,teamMember:n,onEdit:x,onDelete:d,showActions:o=!0,compact:c=!1}){const[p,m]=r.useState(!1),[D,v]=r.useState(!1);if(!a)return null;const w=tt[a.type]||tt.other,P=w.icon,f=new Date(a.start_date),O=new Date(a.end_date),C=new Date,F=C>=f&&C<=O,R=C>O,H=_=>_.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),k=()=>{const _=H(f),y=H(O);return _===y?_:`${_} - ${y}`},l=()=>{const _=Math.abs(O-f),y=Math.ceil(_/(1e3*60*60*24))+1;if(y===1)return"1 day";if(y<7)return`${y} days`;if(y<30){const S=Math.floor(y/7),E=y%7;return E===0?`${S} week${S>1?"s":""}`:`${S}w ${E}d`}else{const S=Math.floor(y/30),E=y%30;return E===0?`${S} month${S>1?"s":""}`:`${S}m ${E}d`}},h=()=>F?e.jsx(U,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"}):R?e.jsx(U,{variant:"secondary",className:"bg-gray-100 text-gray-600",children:"Completed"}):e.jsx(U,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Upcoming"}),u=async()=>{v(!0);try{await d?.(a),m(!1)}catch(_){console.error("Failed to delete duty:",_)}finally{v(!1)}},j=()=>n?.name?n.name.split(" ").map(_=>_[0]).join("").toUpperCase().slice(0,2):"?";return c?e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-white hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500",children:k()})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[h(),o&&e.jsxs(As,{children:[e.jsx(Os,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",children:e.jsx(Hs,{className:"h-4 w-4"})})}),e.jsxs(ks,{align:"end",children:[e.jsxs(Ve,{onClick:()=>x?.(a),children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(Ve,{onClick:()=>m(!0),className:"text-red-600",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(V,{className:`w-full ${F?"ring-2 ring-green-200":""}`,children:[e.jsx(X,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${w.color}`,children:e.jsx(P,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx(Z,{className:"text-lg",children:a.title}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(U,{variant:w.badgeVariant,children:w.label}),h()]})]})]}),o&&e.jsxs(As,{children:[e.jsx(Os,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",children:e.jsx(Hs,{className:"h-4 w-4"})})}),e.jsxs(ks,{align:"end",children:[e.jsxs(Ve,{onClick:()=>x?.(a),children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"Edit Duty"]}),e.jsxs(Ve,{onClick:()=>m(!0),className:"text-red-600",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Delete Duty"]})]})]})]})}),e.jsxs(z,{className:"space-y-4",children:[n&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(pt,{className:"h-8 w-8",children:e.jsx(gt,{className:"text-sm",children:j()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:n.name}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(_s,{className:"h-3 w-3 mr-1"}),"Assigned Team Member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 flex items-center mb-1",children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Duration"]}),e.jsx("p",{className:"font-medium",children:l()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Date Range"}),e.jsx("p",{className:"font-medium",children:k()})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),F&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round((C-f)/(O-f)*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(C-f)/(O-f)*100))}%`}})})]}),n&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsx(Cs,{teamMemberId:n.id,teamMemberName:n.name,sourceItem:{title:`${w.label}: ${a.title}`,description:`${a.description||""} (${k()})`,type:"duty",id:a.id,start_date:a.start_date,end_date:a.end_date,duty_type:a.type},variant:"outline",size:"sm"})})]})]}),e.jsx(ft,{open:p,onOpenChange:m,children:e.jsxs(Ps,{children:[e.jsxs(Fs,{children:[e.jsx(Is,{children:"Delete Duty Assignment"}),e.jsxs($s,{children:['Are you sure you want to delete "',a.title,'"? This action cannot be undone.',F&&e.jsx("span",{className:"block mt-2 text-orange-600 font-medium",children:"Warning: This duty is currently active."})]})]}),e.jsxs(Ts,{children:[e.jsx(Gs,{disabled:D,children:"Cancel"}),e.jsx(Ls,{onClick:u,disabled:D,className:"bg-red-600 hover:bg-red-700",children:D?"Deleting...":"Delete Duty"})]})]})})]})}function Ga(a,n){for(var x={};a.length;){var d=a[0],o=d.code,c=d.message,p=d.path.join(".");if(!x[p])if("unionErrors"in d){var m=d.unionErrors[0].errors[0];x[p]={message:m.message,type:m.code}}else x[p]={message:c,type:o};if("unionErrors"in d&&d.unionErrors.forEach(function(w){return w.errors.forEach(function(P){return a.push(P)})}),n){var D=x[p].types,v=D&&D[d.code];x[p]=pa(p,n,x,o,v?[].concat(v,d.message):d.message)}a.shift()}return x}function Ra(a,n,x){return x===void 0&&(x={}),function(d,o,c){try{return Promise.resolve(function(p,m){try{var D=Promise.resolve(a[x.mode==="sync"?"parse":"parseAsync"](d,n)).then(function(v){return c.shouldUseNativeValidation&&ua({},c),{errors:{},values:x.raw?Object.assign({},d):v}})}catch(v){return m(v)}return D&&D.then?D.then(void 0,m):D}(0,function(p){if(function(m){return Array.isArray(m?.errors)}(p))return{values:{},errors:ja(Ga(p.errors,!c.shouldUseNativeValidation&&c.criteriaMode==="all"),c)};throw p}))}catch(p){return Promise.reject(p)}}}const Va=ga,yt=r.createContext({}),Le=({...a})=>e.jsx(yt.Provider,{value:{name:a.name},children:e.jsx(fa,{...a})}),ps=()=>{const a=r.useContext(yt),n=r.useContext(Nt),{getFieldState:x,formState:d}=va(),o=x(a.name,d);if(!a)throw new Error("useFormField should be used within <FormField>");const{id:c}=n;return{id:c,name:a.name,formItemId:`${c}-form-item`,formDescriptionId:`${c}-form-item-description`,formMessageId:`${c}-form-item-message`,...o}},Nt=r.createContext({}),ke=r.forwardRef(({className:a,...n},x)=>{const d=r.useId();return e.jsx(Nt.Provider,{value:{id:d},children:e.jsx("div",{ref:x,className:B("space-y-2",a),...n})})});ke.displayName="FormItem";const Ee=r.forwardRef(({className:a,...n},x)=>{const{error:d,formItemId:o}=ps();return e.jsx(M,{ref:x,className:B(d&&"text-destructive",a),htmlFor:o,...n})});Ee.displayName="FormLabel";const Me=r.forwardRef(({...a},n)=>{const{error:x,formItemId:d,formDescriptionId:o,formMessageId:c}=ps();return e.jsx(Xt,{ref:n,id:d,"aria-describedby":x?`${o} ${c}`:`${o}`,"aria-invalid":!!x,...a})});Me.displayName="FormControl";const Re=r.forwardRef(({className:a,...n},x)=>{const{formDescriptionId:d}=ps();return e.jsx("p",{ref:x,id:d,className:B("text-[0.8rem] text-muted-foreground",a),...n})});Re.displayName="FormDescription";const Pe=r.forwardRef(({className:a,children:n,...x},d)=>{const{error:o,formMessageId:c}=ps(),p=o?String(o?.message):n;return p?e.jsx("p",{ref:d,id:c,className:B("text-[0.8rem] font-medium text-destructive",a),...x,children:p}):null});Pe.displayName="FormMessage";const za=Na({employeeId:qe().min(1,"Employee is required"),title:qe().min(5,"Title must be at least 5 characters").max(500,"Title must be less than 500 characters"),developmentNeed:qe().min(10,"Development need must be at least 10 characters").max(1e3,"Development need must be less than 1000 characters"),developmentActivity:qe().max(1e3,"Development activity must be less than 1000 characters").optional().or(ba("")),developmentGoalDescription:qe().min(20,"Goal description must be at least 20 characters").max(2e3,"Goal description must be less than 2000 characters"),status:wa(["active","completed","paused"]).default("active")}),Ua=({teamMembers:a=[],initialData:n=null,onSubmit:x,onCancel:d,isLoading:o=!1,isSubmitting:c=!1,prefilledEmployeeId:p=null,hideEmployeeSelection:m=!1})=>{const[D,v]=r.useState(""),w=ya({resolver:Ra(za),defaultValues:{employeeId:n?.employeeId||p||"",title:n?.title||"",developmentNeed:n?.developmentNeed||"",developmentActivity:n?.developmentActivity||"",developmentGoalDescription:n?.developmentGoalDescription||"",status:n?.status||"active"},mode:"onChange"}),{handleSubmit:P,formState:{errors:f,isValid:O},reset:C,clearErrors:F}=w;r.useEffect(()=>{n?C({employeeId:n.employeeId||p||"",title:n.title||"",developmentNeed:n.developmentNeed||"",developmentActivity:n.developmentActivity||"",developmentGoalDescription:n.developmentGoalDescription||"",status:n.status||"active"}):p&&C({employeeId:p,title:"",developmentNeed:"",developmentActivity:"",developmentGoalDescription:"",status:"active"})},[n,p,C]);const R=u=>{const j=a.find(_=>_.id===u);return j?j.name:"Unknown Employee"},H=async u=>{try{v(""),x&&await x(u)}catch(j){console.error("Form submission error:",j),v("Failed to save goal. Please try again.")}},k=u=>{f[u]&&F(u),D&&v("")},l=o||c,h=!!n;return o?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Ss,{}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading..."})]}):e.jsx(V,{className:"w-full",children:e.jsx(z,{className:"pt-6",children:e.jsx(Va,{...w,children:e.jsxs("form",{onSubmit:P(H),className:"space-y-6",children:[D&&e.jsx(ze,{variant:"destructive",children:e.jsx(Ue,{children:D})}),m?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{className:"flex items-center space-x-2",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{children:"Employee"})]}),e.jsx("div",{className:"p-3 bg-muted rounded-md border",children:e.jsx("span",{className:"text-sm font-medium",children:R(w.watch("employeeId"))})})]}):e.jsx(Le,{control:w.control,name:"employeeId",render:({field:u})=>e.jsxs(ke,{children:[e.jsxs(Ee,{className:"flex items-center space-x-2",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{children:"Employee"})]}),e.jsxs(Y,{onValueChange:j=>{u.onChange(j),k("employeeId")},value:u.value,disabled:l,children:[e.jsx(Me,{children:e.jsx(W,{className:B(f.employeeId&&"border-destructive"),"aria-invalid":!!f.employeeId,children:e.jsx(q,{placeholder:"Select an employee"})})}),e.jsx(J,{children:a.length===0?e.jsx(g,{value:"",disabled:!0,children:"No team members available"}):a.map(j=>e.jsx(g,{value:j.id,children:j.name},j.id))})]}),e.jsx(Pe,{})]})}),e.jsx(Le,{control:w.control,name:"title",render:({field:u})=>e.jsxs(ke,{children:[e.jsxs(Ee,{className:"flex items-center space-x-2",children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx("span",{children:"Goal Title"})]}),e.jsx(Me,{children:e.jsx(be,{placeholder:"Enter a clear and specific goal title",...u,onChange:j=>{u.onChange(j),k("title")},disabled:l,className:B(f.title&&"border-destructive"),"aria-invalid":!!f.title})}),e.jsx(Re,{children:"A concise title that describes the main objective of this development goal."}),e.jsx(Pe,{})]})}),e.jsx(Le,{control:w.control,name:"developmentNeed",render:({field:u})=>e.jsxs(ke,{children:[e.jsxs(Ee,{className:"flex items-center space-x-2",children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx("span",{children:"Development Need"})]}),e.jsx(Me,{children:e.jsx(Xe,{placeholder:"Describe the skills, knowledge, or competencies that need development...",...u,onChange:j=>{u.onChange(j),k("developmentNeed")},disabled:l,rows:3,className:B(f.developmentNeed&&"border-destructive"),"aria-invalid":!!f.developmentNeed})}),e.jsx(Re,{children:"Identify specific areas where the employee needs to grow or improve."}),e.jsx(Pe,{})]})}),e.jsx(Le,{control:w.control,name:"developmentActivity",render:({field:u})=>e.jsxs(ke,{children:[e.jsxs(Ee,{className:"flex items-center space-x-2",children:[e.jsx(Kt,{className:"h-4 w-4"}),e.jsx("span",{children:"Development Activity (Optional)"})]}),e.jsx(Me,{children:e.jsx(Xe,{placeholder:"Outline specific activities, training, or experiences that will support this goal...",...u,onChange:j=>{u.onChange(j),k("developmentActivity")},disabled:l,rows:3,className:B(f.developmentActivity&&"border-destructive"),"aria-invalid":!!f.developmentActivity})}),e.jsx(Re,{children:"Planned activities, training sessions, or experiences that will help achieve this goal."}),e.jsx(Pe,{})]})}),e.jsx(Le,{control:w.control,name:"developmentGoalDescription",render:({field:u})=>e.jsxs(ke,{children:[e.jsxs(Ee,{className:"flex items-center space-x-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Goal Description"})]}),e.jsx(Me,{children:e.jsx(Xe,{placeholder:"Provide a detailed description of the goal, including specific objectives, success criteria, and expected outcomes...",...u,onChange:j=>{u.onChange(j),k("developmentGoalDescription")},disabled:l,rows:4,className:B(f.developmentGoalDescription&&"border-destructive"),"aria-invalid":!!f.developmentGoalDescription})}),e.jsx(Re,{children:"A comprehensive description of what the employee should achieve and how success will be measured."}),e.jsx(Pe,{})]})}),h&&e.jsx(Le,{control:w.control,name:"status",render:({field:u})=>e.jsxs(ke,{children:[e.jsx(Ee,{children:"Goal Status"}),e.jsxs(Y,{onValueChange:u.onChange,value:u.value,disabled:l,children:[e.jsx(Me,{children:e.jsx(W,{children:e.jsx(q,{})})}),e.jsxs(J,{children:[e.jsx(g,{value:"active",children:"Active"}),e.jsx(g,{value:"completed",children:"Completed"}),e.jsx(g,{value:"paused",children:"Paused"})]})]}),e.jsx(Re,{children:"Current status of this development goal."}),e.jsx(Pe,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["Title: ",w.watch("title")?.length||0,"/500"]}),e.jsxs("div",{children:["Development Need: ",w.watch("developmentNeed")?.length||0,"/1000"]}),e.jsxs("div",{children:["Goal Description: ",w.watch("developmentGoalDescription")?.length||0,"/2000"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[d&&e.jsx(b,{type:"button",variant:"outline",onClick:d,disabled:l,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:l||!O,className:"min-w-24",children:l?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx("span",{children:h?"Updating...":"Creating..."})]}):e.jsx("span",{children:h?"Update Goal":"Create Goal"})})]}),!1]})})})})};function mn(){const[a]=na(),n=a.get("id"),x=a.get("tab")||"meetings",[d,o]=r.useState(null),[c,p]=r.useState([]),[m,D]=r.useState([]),[v,w]=r.useState([]),[P,f]=r.useState([]),[O,C]=r.useState([]),[F,R]=r.useState([]),[H,k]=r.useState(null),[l,h]=r.useState([]),[u,j]=r.useState([]),[_,y]=r.useState(!0),[S,E]=r.useState(!1),[Be,le]=r.useState(!1),[es,Fe]=r.useState(!1),[Te,gs]=r.useState(null),[fs,De]=r.useState(!1),[N,T]=r.useState(null),[L,ee]=r.useState([]),[se,He]=r.useState(!1),[Ye,ss]=r.useState(null),[ue,je]=r.useState({text:"",referenced_entity:{type:"team_member",id:""}}),[ts,as]=r.useState(null),[K,Ie]=r.useState({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),[pe,ns]=r.useState({description:"",due_date:"",linked_task_id:"",linked_project_id:"",status:"open"}),[Q,vs]=r.useState("none"),[_e,We]=r.useState(""),[wt,rs]=r.useState(null),[ae,ys]=r.useState(null),[bt,ls]=r.useState(!1),[Se,is]=r.useState("");r.useState(()=>{try{return JSON.parse(localStorage.getItem("discussedNotes")||"{}")}catch{return{}}}),r.useEffect(()=>{n&&ie()},[n]);const ie=async()=>{y(!0);try{const s=await hs.get(n);o(s);const i=(await Ae.list()).filter(ce=>ce.team_member_id===n);p(i);try{const ce=await Js.getAgendaItemsForMember(n);D(ce)}catch(ce){console.error("Error loading agenda items:",ce),D([])}const A=await la.list(),$=await ia.list();w(A),f($),C(await hs.list()),R(await ca.list());const Ce=await re.getByTeamMember(n);h(Ce);try{const ce=await os.getGoalsByEmployee(n);j(ce)}catch(ce){console.error("Error loading goals:",ce),j([])}await Dt(i)}catch(s){console.error("Error loading team member data:",s)}finally{y(!1)}},Dt=async s=>{try{const t=s.filter(i=>i.next_meeting_date).sort((i,A)=>new Date(i.next_meeting_date)-new Date(A.next_meeting_date));if(t.length>0){const i=t[0];let A=null;if(i.next_meeting_calendar_event_id)try{A=(await $e.getOneOnOneMeetingsForTeamMember(n)).find(Ce=>Ce.id===i.next_meeting_calendar_event_id)}catch($){console.error("Error loading calendar event:",$)}ys({oneOnOne:i,calendarEvent:A,hasCalendarEvent:!!A,meetingDate:i.next_meeting_date})}else ys(null)}catch(t){console.error("Error loading next meeting info:",t),ys(null)}},_t=async()=>{try{const s=await Ae.create({...K,notes:Array.isArray(K.notes)?K.notes:[],team_member_id:n});if(K.next_meeting_date&&d)try{const t=await $e.createAndLinkOneOnOneMeeting(s.id,n,K.next_meeting_date);console.log("Calendar event created successfully:",t.calendarEvent)}catch(t){console.error("Error creating calendar event:",t)}le(!1),Ie({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),ie()}catch(s){console.error("Error creating 1:1 meeting:",s)}},St=async()=>{if(Te)try{const s={...Te,action_items:[...Te.action_items||[],pe]};await Ae.update(Te.id,s),Fe(!1),ie()}catch(s){console.error("Error adding action item:",s)}},Ct=async s=>{if(!ue.text)return;let t=null;Q!=="none"&&_e&&(t={type:Q,id:_e});const i=c.find(Ce=>Ce.id===s);if(!i)return;const A={text:ue.text,referenced_entity:t,created_by:n,timestamp:new Date().toISOString()},$=Array.isArray(i.notes)?[...i.notes,A]:[A];await Ae.update(s,{...i,notes:$}),je({text:"",referenced_entity:{type:"team_member",id:""}}),as(null),ie()},Rs=async(s,t,i)=>{try{const A=c.find(Ce=>Ce.id===s);if(!A)return;const $=[...A.action_items];$[t]={...$[t],status:i},await Ae.update(s,{...A,action_items:$}),ie()}catch(A){console.error("Error updating action item status:",A)}},At=async s=>{try{try{await $e.unlinkCalendarEventFromOneOnOne(s)}catch(t){console.error("Error deleting associated calendar event:",t)}await Ae.delete(s),ie()}catch(t){console.error("Error deleting meeting:",t)}},Ot=async s=>{try{await Js.markAgendaItemDiscussed(s.meetingId,s.timestamp)&&ie()}catch(t){console.error("Error marking agenda item as discussed:",t)}},cs=async(s,t)=>{try{const i=c.find($=>$.id===s);if(!i)return;const A={...i,next_meeting_date:t};if(await Ae.update(s,A),t&&d)try{await $e.updateOneOnOneCalendarEvent(s,t),console.log("Calendar event updated successfully for meeting:",s)}catch($){console.error("Error updating calendar event:",$)}else if(!t&&i.next_meeting_calendar_event_id)try{await $e.unlinkCalendarEventFromOneOnOne(s),console.log("Calendar event removed for meeting:",s)}catch($){console.error("Error removing calendar event:",$)}ie()}catch(i){console.error("Error updating next meeting date:",i)}},kt=async()=>{if(!(!ae||!Se))try{await cs(ae.oneOnOne.id,Se),ls(!1),is("")}catch(s){console.error("Error rescheduling meeting:",s)}},Et=async()=>{if(ae)try{await cs(ae.oneOnOne.id,"")}catch(s){console.error("Error canceling meeting:",s)}},Mt=()=>{T(null),De(!0)},Vs=s=>{T(s),De(!0)},Pt=async s=>{try{N?await re.update(N.id,s):await re.create(s),De(!1),T(null);const t=await re.getByTeamMember(n);h(t),await Ns()}catch(t){console.error("Error saving duty:",t)}},zs=async s=>{try{await re.delete(s.id);const t=await re.getByTeamMember(n);h(t),await Ns()}catch(t){console.error("Error deleting duty:",t)}},Ns=async()=>{try{const s=[];for(const t of l){const i=await re.getConflicts(t.team_member_id,t.start_date,t.end_date,t.id);i.length>0&&s.push({duty:t,conflicts:i})}ee(s)}catch(s){console.error("Error checking duty conflicts:",s)}};r.useEffect(()=>{l.length>0&&Ns()},[l]);const Us=()=>{ss(null),He(!0)},Ft=s=>{ss(s),He(!0)},Tt=async s=>{try{E(!0);const t={...s,employeeId:n};if(Ye){const i=await os.updateGoal(Ye.id,t);j(A=>A.map($=>$.id===Ye.id?i:$))}else{const i=await os.createGoal(t);j(A=>[i,...A])}He(!1),ss(null)}catch(t){throw console.error("Error saving goal:",t),t}finally{E(!1)}},It=async s=>{try{E(!0),await os.deleteGoal(s),j(t=>t.filter(i=>i.id!==s))}catch(t){console.error("Error deleting goal:",t)}finally{E(!1)}};if(_)return e.jsx("div",{className:"p-6",children:"Loading..."});if(!d)return e.jsx("div",{className:"p-6",children:"Team member not found"});const $t=s=>({open:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[s]||"bg-gray-100 text-gray-800",Lt=s=>({great:"😄",good:"🙂",neutral:"😐",concerned:"😟"})[s]||"😐";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(ra,{to:"/team",children:e.jsxs(b,{variant:"ghost",children:[e.jsx(ea,{className:"h-4 w-4 mr-2"}),"Back to Team"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(pt,{className:"h-16 w-16",children:d.avatar?e.jsx(da,{src:d.avatar,alt:d.name}):e.jsx(gt,{children:d.name.split(" ").map(s=>s[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:d.name}),e.jsx("p",{className:"text-gray-500",children:d.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(Es,{defaultValue:x,className:"w-full",children:[e.jsxs(Ms,{className:"grid grid-cols-4 mb-4",children:[e.jsxs(xe,{value:"meetings",children:[e.jsx(ws,{className:"h-4 w-4 mr-2"}),"1:1 Meetings"]}),e.jsxs(xe,{value:"agenda",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"1:1 Agenda"]}),e.jsxs(xe,{value:"goals",children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Goals"]}),e.jsxs(xe,{value:"personal-file",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Personal File"]})]}),e.jsx(he,{value:"meetings",className:"mt-0",children:e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Z,{children:"1:1 Meetings"}),e.jsxs(b,{onClick:()=>le(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"New 1:1"]})]})}),e.jsx(z,{children:c.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ws,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No 1:1 meetings recorded yet"})]}):e.jsx("div",{className:"space-y-6",children:c.sort((s,t)=>new Date(t.date)-new Date(s.date)).map(s=>e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[I(G(s.date),"PPP"),e.jsx("span",{className:"text-xl",children:Lt(s.mood)})]}),e.jsx(bs,{className:"flex items-center gap-2",children:wt===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Next meeting:"}),e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs(b,{variant:"outline",size:"sm",className:"h-8 text-xs",children:[e.jsx(te,{className:"mr-1 h-3 w-3"}),s.next_meeting_date?I(G(s.next_meeting_date),"MMM d"):"Select date"]})}),e.jsx(ve,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:s.next_meeting_date?G(s.next_meeting_date):void 0,onSelect:t=>{const i=t?.toISOString()||"";cs(s.id,i),rs(null)}})})]}),e.jsx(b,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>rs(null),children:"Cancel"}),s.next_meeting_date&&e.jsx(b,{variant:"ghost",size:"sm",className:"h-8 px-2 text-red-500",onClick:()=>{cs(s.id,""),rs(null)},children:"Clear"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Next meeting: ",s.next_meeting_date?I(G(s.next_meeting_date),"PPP"):"Not scheduled"]}),e.jsx(b,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>rs(s.id),children:"Edit"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>{gs(s),Fe(!0)},children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Add Action Item"]}),e.jsx(b,{variant:"ghost",size:"icon",onClick:()=>At(s.id),title:"Delete meeting",children:e.jsx(Ke,{className:"h-5 w-5 text-red-500"})})]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-4",children:[Array.isArray(s.notes)&&s.notes.filter(t=>!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(n)).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),e.jsx("ul",{className:"list-disc pl-5",children:s.notes.filter(t=>!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(n)).map((t,i)=>e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{children:t.text}),t.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[t.referenced_entity.type==="team_member"&&O.find(A=>String(A.id)===String(t.referenced_entity.id))?.name,t.referenced_entity.type==="stakeholder"&&F.find(A=>String(A.id)===String(t.referenced_entity.id))?.name,t.referenced_entity.type==="project"&&P.find(A=>String(A.id)===String(t.referenced_entity.id))?.name]}),e.jsx("div",{className:"mt-1",children:e.jsx(Cs,{teamMemberId:n,teamMemberName:d.name,sourceItem:{title:`Note from 1:1 on ${I(G(s.date),"MMM d, yyyy")}`,description:t.text,type:"note",id:`note-${s.id}-${i}`},variant:"ghost",size:"xs"})})]},i))})]}),e.jsxs("div",{className:"mt-2 flex gap-2 items-end",children:[e.jsx(be,{className:"flex-1",placeholder:"Note text...",value:ts===s.id?ue.text:"",onChange:t=>{as(s.id),je(i=>({...i,text:t.target.value}))}}),e.jsxs(Y,{value:ts===s.id?Q:"none",onValueChange:t=>{as(s.id),vs(t),We(""),je(i=>({...i,referenced_entity:t==="none"?null:{type:t,id:""}}))},children:[e.jsx(W,{className:"w-32",children:e.jsx(q,{placeholder:"No tag"})}),e.jsxs(J,{children:[e.jsx(g,{value:"none",children:"No tag"}),e.jsx(g,{value:"team_member",children:"Team Members"}),e.jsx(g,{value:"stakeholder",children:"Stakeholders"}),e.jsx(g,{value:"project",children:"Projects"})]})]}),Q!=="none"&&ts===s.id&&e.jsxs(Y,{value:_e,onValueChange:t=>{We(t),je(i=>({...i,referenced_entity:{type:Q,id:t}}))},children:[e.jsx(W,{className:"w-40",children:e.jsx(q,{placeholder:"Select name"})}),e.jsxs(J,{children:[Q==="team_member"&&O.filter(t=>t.id.toString()!==n?.toString()).map(t=>e.jsx(g,{value:t.id,children:t.name},t.id)),Q==="stakeholder"&&F.map(t=>e.jsx(g,{value:t.id,children:t.name},t.id)),Q==="project"&&P.map(t=>e.jsx(g,{value:t.id,children:t.name},t.id))]})]}),e.jsx(b,{onClick:()=>{as(s.id),Ct(s.id)},disabled:!ue.text||Q!=="none"&&!_e||ts!==s.id,children:"Add"})]}),s.topics_discussed?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Topics Discussed"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.topics_discussed.map((t,i)=>e.jsx(U,{variant:"secondary",children:t},i))})]}),s.action_items?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Action Items"}),e.jsxs(Da,{children:[e.jsx(_a,{children:e.jsxs(Ks,{children:[e.jsx(Je,{children:"Description"}),e.jsx(Je,{children:"Due Date"}),e.jsx(Je,{children:"Status"}),e.jsx(Je,{children:"Links"}),e.jsx(Je,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Sa,{children:s.action_items.map((t,i)=>e.jsxs(Ks,{children:[e.jsx(Qe,{children:t.description}),e.jsx(Qe,{children:t.due_date?I(G(t.due_date),"MMM d, yyyy"):"No due date"}),e.jsx(Qe,{children:e.jsx(U,{className:$t(t.status),children:t.status})}),e.jsx(Qe,{children:(t.linked_task_id||t.linked_project_id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[t.linked_task_id&&e.jsxs(U,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"h-3 w-3"}),"Task"]}),t.linked_project_id&&e.jsxs(U,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"h-3 w-3"}),"Project"]})]})}),e.jsx(Qe,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>Rs(s.id,i,"completed"),disabled:t.status==="completed",children:e.jsx(Ws,{className:"h-4 w-4 text-green-500"})}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>Rs(s.id,i,"in_progress"),disabled:t.status==="in_progress",children:e.jsx(Ge,{className:"h-4 w-4 text-blue-500"})}),e.jsx(Cs,{teamMemberId:n,teamMemberName:d.name,sourceItem:{title:`Action Item: ${t.description}`,description:`Due date: ${t.due_date?I(G(t.due_date),"MMM d, yyyy"):"None"}
Status: ${t.status}`,type:"action_item",id:`action-${s.id}-${i}`},variant:"ghost",size:"sm"})]})})]},i))})]})]})]})})]},s.id))})})]})}),e.jsx(he,{value:"agenda",className:"mt-0",children:e.jsx(Ca,{teamMemberId:n,teamMemberName:d?.name})}),e.jsx(he,{value:"goals",className:"mt-0",children:e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"h-5 w-5"}),"Development Goals"]}),e.jsxs(b,{onClick:Us,disabled:S,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Create Goal"]})]}),e.jsxs(bs,{children:["Track and manage ",d?.name,"'s development goals and growth objectives"]})]}),e.jsx(z,{children:S?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-indigo-600 border-t-transparent rounded-full"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading goals..."})]}):u.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No goals found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first goal for this team member."}),e.jsxs(b,{onClick:Us,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Create First Goal"]})]}):e.jsx("div",{className:"space-y-4",children:u.sort((s,t)=>new Date(t.createdAt)-new Date(s.createdAt)).map(s=>e.jsxs(V,{className:"border-l-4 border-l-blue-500",children:[e.jsx(X,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{className:"text-lg leading-tight",children:s.title}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{variant:s.status==="active"?"default":s.status==="completed"?"secondary":"outline",children:s.status}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Created ",I(new Date(s.createdAt),"MMM dd, yyyy")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>Ft(s),disabled:S,children:"Edit"}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>It(s.id),className:"text-destructive hover:text-destructive",disabled:S,children:"Delete"})]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Development Need"}),e.jsx("p",{className:"text-sm",children:s.developmentNeed||"No development need specified"})]}),s.developmentActivity&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Development Activity"}),e.jsx("p",{className:"text-sm",children:s.developmentActivity})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Goal Description"}),e.jsx("p",{className:"text-sm",children:s.developmentGoalDescription})]})]})})]},s.id))})})]})}),e.jsx(he,{value:"personal-file",className:"mt-0",children:e.jsx(Ma,{teamMemberId:n,teamMemberName:d?.name})})]}),e.jsx(Ia,{teamMemberId:n,teamMemberName:d?.name}),e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-5 w-5"}),"Duty Assignments"]}),e.jsxs(b,{onClick:Mt,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Assign Duty"]})]}),L.length>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(qs,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[L.length," duty conflict",L.length>1?"s":""," detected"]})]})})]}),e.jsx(z,{children:l.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ms,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No duty assignments yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Assign DevOps duties, on-call responsibilities, or other duties"})]}):e.jsxs("div",{className:"space-y-4",children:[l.filter(s=>{const t=new Date,i=new Date(s.start_date),A=new Date(s.end_date);return t>=i&&t<=A}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Active Duties"]}),e.jsx("div",{className:"space-y-3",children:l.filter(s=>{const t=new Date,i=new Date(s.start_date),A=new Date(s.end_date);return t>=i&&t<=A}).map(s=>e.jsx(at,{duty:s,teamMember:d,onEdit:Vs,onDelete:zs,compact:!0},s.id))})]}),l.filter(s=>{const t=new Date,i=new Date(s.start_date);return t<i}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Upcoming Duties"]}),e.jsx("div",{className:"space-y-3",children:l.filter(s=>{const t=new Date,i=new Date(s.start_date);return t<i}).sort((s,t)=>new Date(s.start_date)-new Date(t.start_date)).map(s=>e.jsx(at,{duty:s,teamMember:d,onEdit:Vs,onDelete:zs,compact:!0},s.id))})]}),l.filter(s=>{const t=new Date,i=new Date(s.end_date);return t>i}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(sa,{className:"h-4 w-4"}),"Past Duties (",l.filter(s=>{const t=new Date,i=new Date(s.end_date);return t>i}).length,")"]}),e.jsxs("div",{className:"space-y-2",children:[l.filter(s=>{const t=new Date,i=new Date(s.end_date);return t>i}).sort((s,t)=>new Date(t.end_date)-new Date(s.end_date)).slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ms,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-sm",children:s.title}),e.jsx(U,{variant:"secondary",className:"text-xs",children:s.type==="devops"?"DevOps":s.type==="on_call"?"On-Call":"Other"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:I(G(s.end_date),"MMM d, yyyy")})]},s.id)),l.filter(s=>{const t=new Date,i=new Date(s.end_date);return t>i}).length>3&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-2",children:["Showing 3 of ",l.filter(s=>{const t=new Date,i=new Date(s.end_date);return t>i}).length," past duties"]})]})]}),L.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(qs,{className:"h-4 w-4 text-orange-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-orange-800 text-sm",children:"Duty Conflicts Detected"}),e.jsx("div",{className:"mt-2 space-y-2",children:L.map(({duty:s,conflicts:t})=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-orange-700",children:[e.jsx("strong",{children:s.title})," conflicts with:"]}),e.jsx("ul",{className:"list-disc list-inside ml-4 text-orange-600",children:t.map(i=>e.jsxs("li",{children:[i.title," (",I(G(i.start_date),"MMM d")," - ",I(G(i.end_date),"MMM d"),")"]},i.id))})]},s.id))})]})]})})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(V,{children:[e.jsx(X,{children:e.jsx(Z,{children:"Team Member Info"})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-4",children:[d.department&&e.jsxs("div",{children:[e.jsx(M,{children:"Department"}),e.jsx("p",{className:"text-gray-600",children:d.department})]}),d.skills?.length>0&&e.jsxs("div",{children:[e.jsx(M,{children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:d.skills.map((s,t)=>e.jsx(U,{variant:"secondary",children:s},t))})]}),d.notes&&e.jsxs("div",{children:[e.jsx(M,{children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:d.notes})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Birthday"}),e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),d.birthday?I(G(d.birthday),"PPP"):"Set birthday"]})}),e.jsx(ve,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:d.birthday?G(d.birthday):void 0,onSelect:async s=>{if(!s)return;const t=s.toISOString(),i={...d};try{const A=await hs.update(d.id,{birthday:t});o($=>({...$,birthday:t}));try{await oa.handleTeamMemberUpdate(d.id,A,i)}catch($){console.error("Failed to update birthday events:",$)}}catch(A){console.error("Failed to update birthday:",A)}}})})]})]})]})})]}),e.jsx(Pa,{teamMemberId:n,showBreakdown:!0,showYearSelector:!0,onStatsChange:k}),e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Next 1:1 Meeting"]})}),e.jsx(z,{children:ae?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Scheduled Date"}),e.jsx("p",{className:"text-gray-900 font-medium",children:I(G(ae.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:ae.hasCalendarEvent?e.jsxs(U,{variant:"outline",className:"text-green-700 border-green-200 bg-green-50",children:[e.jsx(Ws,{className:"h-3 w-3 mr-1"}),"Calendar Event Created"]}):e.jsxs(U,{variant:"outline",className:"text-yellow-700 border-yellow-200 bg-yellow-50",children:[e.jsx(ta,{className:"h-3 w-3 mr-1"}),"No Calendar Event"]})})]}),ae.calendarEvent&&e.jsxs("div",{children:[e.jsx(M,{children:"Calendar Event"}),e.jsx("p",{className:"text-sm text-gray-600",children:ae.calendarEvent.title})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>{is(ae.meetingDate),ls(!0)},children:[e.jsx(Ge,{className:"h-4 w-4 mr-1"}),"Reschedule"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:Et,className:"text-red-600 hover:text-red-700",children:[e.jsx(aa,{className:"h-4 w-4 mr-1"}),"Cancel"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsx(b,{variant:"outline",size:"sm",onClick:async()=>{try{console.log("Starting duplicate cleanup...");const s=await $e.cleanupAllDuplicateEvents();console.log("Cleanup results:",s),alert(`Cleanup completed! Removed ${s.totalCleaned} duplicate events.`),ie()}catch(s){console.error("Cleanup failed:",s),alert("Cleanup failed. Check console for details.")}},className:"text-blue-600 hover:text-blue-700",children:"🧹 Clean Duplicates"})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(te,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No upcoming 1:1 scheduled"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Schedule your next meeting from any 1:1 record"})]})})]}),e.jsxs(V,{children:[e.jsx(X,{children:e.jsx(Z,{children:"Quick Stats"})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Last 1:1"}),e.jsx("p",{className:"text-gray-600",children:c[0]?I(G(c[0].date),"PPP"):"No meetings yet"})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Meeting Frequency"}),e.jsx("p",{className:"text-gray-600",children:c.length>1?(()=>{const s=c.filter(i=>i.date).sort((i,A)=>new Date(A.date)-new Date(i.date));if(s.length<2)return"Insufficient data";const t=Math.round((new Date(s[0].date)-new Date(s[1].date))/(1e3*60*60*24));return t<=10?"Weekly":t<=20?"Bi-weekly":t<=35?"Monthly":"Irregular"})():"No pattern yet"})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Open Action Items"}),e.jsx("p",{className:"text-gray-600",children:c.reduce((s,t)=>s+(t.action_items?.filter(i=>i.status!=="completed").length||0),0)})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Agenda Items"}),e.jsxs("p",{className:"text-gray-600",children:[m.length," total, ",m.filter(s=>!s.isDiscussed).length," pending"]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Development Goals"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-gray-600",children:[u.length," total"]}),u.length>0&&e.jsxs("div",{className:"flex gap-1",children:[u.filter(s=>s.status==="active").length>0&&e.jsxs(U,{variant:"default",className:"text-xs",children:[u.filter(s=>s.status==="active").length," active"]}),u.filter(s=>s.status==="completed").length>0&&e.jsxs(U,{variant:"secondary",className:"text-xs",children:[u.filter(s=>s.status==="completed").length," completed"]})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Total 1:1s"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:c.length}),c.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(since ",I(G(c[c.length-1].date),"MMM yyyy"),")"]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Current Duties"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:l.filter(s=>{const t=new Date,i=new Date(s.start_date),A=new Date(s.end_date);return t>=i&&t<=A}).length}),L.length>0&&e.jsxs(U,{variant:"destructive",className:"text-xs",children:[L.length," conflict",L.length>1?"s":""]})]})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Total Duties"}),e.jsx("p",{className:"text-gray-600",children:l.length})]})]})})]}),e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"Next Agenda Items"]}),e.jsx(bs,{children:"Items from other meetings where you are tagged"})]}),e.jsxs(z,{children:[m.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ws,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No agenda items yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You'll see items here when others tag you in their meeting notes"})]}):e.jsx(us,{agendaItems:m.slice(0,5),teamMembers:O.reduce((s,t)=>(s[t.id]=t,s),{}),onMarkDiscussed:Ot,showActions:!0,emptyMessage:"No agenda items found"}),m.length>5&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Showing 5 of ",m.length," items"]})})]})]})]})]})]}),e.jsx(oe,{open:Be,onOpenChange:le,children:e.jsxs(me,{className:"sm:max-w-lg",children:[e.jsx(Ne,{children:e.jsx(we,{children:"New 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Date"}),e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),K.date?I(G(K.date),"PPP"):"Select date"]})}),e.jsx(ve,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:K.date?G(K.date):void 0,onSelect:s=>Ie(t=>({...t,date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Mood"}),e.jsxs(Y,{value:K.mood,onValueChange:s=>Ie(t=>({...t,mood:s})),children:[e.jsx(W,{children:e.jsx(q,{})}),e.jsxs(J,{children:[e.jsx(g,{value:"great",children:"Great 😄"}),e.jsx(g,{value:"good",children:"Good 🙂"}),e.jsx(g,{value:"neutral",children:"Neutral 😐"}),e.jsx(g,{value:"concerned",children:"Concerned 😟"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Notes"}),Array.isArray(K.notes)&&K.notes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mb-2",children:K.notes.map((s,t)=>e.jsxs("li",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{children:s.text}),s.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[s.referenced_entity.type==="team_member"&&O.find(i=>i.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="stakeholder"&&F.find(i=>i.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="project"&&P.find(i=>i.id===s.referenced_entity.id)?.name]}),e.jsx(b,{variant:"ghost",size:"xs",className:"ml-2",onClick:()=>Ie(i=>({...i,notes:i.notes.filter((A,$)=>$!==t)})),children:"Remove"})]},t))}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(be,{className:"flex-1",placeholder:"Note text...",value:ue.text,onChange:s=>je(t=>({...t,text:s.target.value}))}),e.jsxs(Y,{value:Q,onValueChange:s=>{vs(s),We(""),je(t=>({...t,referenced_entity:{type:s,id:""}}))},children:[e.jsx(W,{className:"w-32",children:e.jsx(q,{placeholder:"No tag"})}),e.jsxs(J,{children:[e.jsx(g,{value:"none",children:"No tag"}),e.jsx(g,{value:"team_member",children:"Team Members"}),e.jsx(g,{value:"stakeholder",children:"Stakeholders"}),e.jsx(g,{value:"project",children:"Projects"})]})]}),Q!=="none"&&e.jsxs(Y,{value:_e,onValueChange:s=>{We(s),je(t=>({...t,referenced_entity:{type:Q,id:s}}))},children:[e.jsx(W,{className:"w-40",children:e.jsx(q,{placeholder:"Select name"})}),e.jsxs(J,{children:[Q==="team_member"&&O.filter(s=>s.id!==n).map(s=>e.jsx(g,{value:s.id,children:s.name},s.id)),Q==="stakeholder"&&F.map(s=>e.jsx(g,{value:s.id,children:s.name},s.id)),Q==="project"&&P.map(s=>e.jsx(g,{value:s.id,children:s.name},s.id))]})]}),e.jsx(b,{onClick:()=>{ue.text&&(Ie(s=>({...s,notes:[...Array.isArray(s.notes)?s.notes:[],{text:ue.text,referenced_entity:Q==="none"?{}:{type:Q,id:_e},created_by:n,timestamp:new Date().toISOString()}]})),je({text:"",referenced_entity:{type:"team_member",id:""}}),vs("none"),We(""))},disabled:!ue.text||Q!=="none"&&!_e,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Next Meeting Date"}),e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),K.next_meeting_date?I(G(K.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(ve,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:K.next_meeting_date?G(K.next_meeting_date):void 0,onSelect:s=>Ie(t=>({...t,next_meeting_date:s?.toISOString()}))})})]})]})]}),e.jsxs(Ds,{children:[e.jsx(b,{variant:"outline",onClick:()=>le(!1),children:"Cancel"}),e.jsx(b,{onClick:_t,children:"Create Meeting"})]})]})}),e.jsx(oe,{open:es,onOpenChange:Fe,children:e.jsxs(me,{className:"sm:max-w-lg",children:[e.jsx(Ne,{children:e.jsx(we,{children:"Add Action Item"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Description"}),e.jsx(be,{value:pe.description,onChange:s=>ns(t=>({...t,description:s.target.value})),placeholder:"What needs to be done?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Due Date"}),e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),pe.due_date?I(G(pe.due_date),"PPP"):"Set due date"]})}),e.jsx(ve,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:pe.due_date?G(pe.due_date):void 0,onSelect:s=>ns(t=>({...t,due_date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Link to Task (Optional)"}),e.jsxs(Y,{value:pe.linked_task_id,onValueChange:s=>ns(t=>({...t,linked_task_id:s})),children:[e.jsx(W,{children:e.jsx(q,{placeholder:"Select a task"})}),e.jsxs(J,{children:[e.jsx(g,{value:null,children:"None"}),v.map(s=>e.jsx(g,{value:s.id,children:s.title},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Link to Project (Optional)"}),e.jsxs(Y,{value:pe.linked_project_id,onValueChange:s=>ns(t=>({...t,linked_project_id:s})),children:[e.jsx(W,{children:e.jsx(q,{placeholder:"Select a project"})}),e.jsxs(J,{children:[e.jsx(g,{value:null,children:"None"}),P.map(s=>e.jsx(g,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs(Ds,{children:[e.jsx(b,{variant:"outline",onClick:()=>Fe(!1),children:"Cancel"}),e.jsx(b,{onClick:St,children:"Add Action Item"})]})]})}),e.jsx(oe,{open:bt,onOpenChange:ls,children:e.jsxs(me,{className:"sm:max-w-lg",children:[e.jsx(Ne,{children:e.jsx(we,{children:"Reschedule Next 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Current Date"}),e.jsx("p",{className:"text-sm text-gray-600",children:ae&&I(G(ae.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"New Date"}),e.jsxs(ge,{children:[e.jsx(fe,{asChild:!0,children:e.jsxs(b,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),Se?I(G(Se),"PPP"):"Select new date"]})}),e.jsx(ve,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:Se?G(Se):void 0,onSelect:s=>is(s?.toISOString()||"")})})]})]})]}),e.jsxs(Ds,{children:[e.jsx(b,{variant:"outline",onClick:()=>{ls(!1),is("")},children:"Cancel"}),e.jsx(b,{onClick:kt,disabled:!Se,children:"Reschedule Meeting"})]})]})}),e.jsx(oe,{open:se,onOpenChange:He,children:e.jsxs(me,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ne,{children:e.jsx(we,{children:Ye?"Edit Goal":"Create New Goal"})}),e.jsx(Ua,{teamMembers:O,initialData:Ye,onSubmit:Tt,onCancel:()=>{He(!1),ss(null)},isSubmitting:S,prefilledEmployeeId:n,hideEmployeeSelection:!0})]})}),e.jsx(oe,{open:fs,onOpenChange:De,children:e.jsx(me,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:e.jsx(La,{duty:N,teamMembers:O,onSave:Pt,onCancel:()=>{De(!1),T(null)}})})})]})}export{mn as default};
