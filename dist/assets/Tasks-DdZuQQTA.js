import{j as e,p as se,av as te,X as z,aw as R,ax as ae,ay as re,az as ie,aA as le,aB as G,Q as ne,aC as ce,T as oe}from"./chunk-WPKCbDK8.js";import{a as c}from"./chunk-BKwDNIOR.js";import{I as de,B as g,A as he,u as me,a as ue,b as ge,c as xe,T as S,l as B}from"./index-CnhOL4vI.js";import pe from"./TaskCreationForm-DI4Hfilp.js";import{T as ye}from"./chunk-DBm2SumC.js";import{D as V,a as _,b as q,c as d}from"./chunk-Di6AD2c4.js";import{B as D}from"./chunk-DIYexMSd.js";import{S as Q,a as U,b as je,c as X,d as C}from"./chunk-BOs1hDSJ.js";import{T as fe,a as Ce,b as J,c as F,d as ke,e as E}from"./chunk-qi7vZLzc.js";import{f as K}from"./chunk-DR7VNuLi.js";import{b as Ne}from"./chunk-DGs6foQ1.js";import"./chunk-BwuEqr1N.js";import"./chunk-KzYfAQy1.js";import"./chunk-B8YrlogN.js";import"./chunk-BdHZTqfh.js";import"./chunk-DXrvJpCX.js";import"./chunk-233bsYkc.js";import"./chunk-D8_EjMoV.js";import"./chunk-CdSpngk7.js";import"./chunk-p5_VtM_5.js";function ve({filters:x={status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"},setFilters:j,availableTags:w=[]}){const s={status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none",...x};s.status=Array.isArray(s.status)?s.status:[],s.priority=Array.isArray(s.priority)?s.priority:[],s.type=Array.isArray(s.type)?s.type:[],s.tags=Array.isArray(s.tags)?s.tags:[];const h=()=>{j({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"})},k=s.status.length>0||s.priority.length>0||s.type.length>0||s.tags.length>0||s.strategic!==null||s.search,n=(r,o)=>{const p=s[r]||[];j(a=>p.includes(o)?{...a,[r]:p.filter(T=>T!==o)}:{...a,[r]:[...p,o]})},f=r=>{n("tags",r)},N=r=>{j(o=>({...o,search:r.target.value}))},v=r=>{j(o=>({...o,strategic:r==="all"?null:r==="strategic"}))},m=r=>{j(o=>({...o,groupBy:r}))};return e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(de,{placeholder:"Search tasks...",value:s.search,onChange:N,className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Filters",k&&e.jsx(D,{className:"h-5 w-5 p-0 flex items-center justify-center",children:s.status.length+s.type.length+s.priority.length+s.tags.length+(s.strategic!==null?1:0)})]})}),e.jsxs(q,{className:"w-56",align:"end",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Status"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{checked:s.status.includes("todo"),onCheckedChange:()=>n("status","todo"),children:"Todo"}),e.jsx(d,{checked:s.status.includes("in_progress"),onCheckedChange:()=>n("status","in_progress"),children:"In Progress"}),e.jsx(d,{checked:s.status.includes("blocked"),onCheckedChange:()=>n("status","blocked"),children:"Blocked"}),e.jsx(d,{checked:s.status.includes("done"),onCheckedChange:()=>n("status","done"),children:"Done"})]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Type"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{checked:s.type.includes("generic"),onCheckedChange:()=>n("type","generic"),children:"Generic"}),e.jsx(d,{checked:s.type.includes("meeting"),onCheckedChange:()=>n("type","meeting"),children:"Meeting"}),e.jsx(d,{checked:s.type.includes("metric"),onCheckedChange:()=>n("type","metric"),children:"Metric"}),e.jsx(d,{checked:s.type.includes("action"),onCheckedChange:()=>n("type","action"),children:"Action"})]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{className:"mb-2 font-medium text-sm",children:"Priority"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{checked:s.priority.includes("low"),onCheckedChange:()=>n("priority","low"),children:"Low"}),e.jsx(d,{checked:s.priority.includes("medium"),onCheckedChange:()=>n("priority","medium"),children:"Medium"}),e.jsx(d,{checked:s.priority.includes("high"),onCheckedChange:()=>n("priority","high"),children:"High"}),e.jsx(d,{checked:s.priority.includes("urgent"),onCheckedChange:()=>n("priority","urgent"),children:"Urgent"})]})]}),k&&e.jsx("div",{className:"border-t p-2",children:e.jsxs(g,{variant:"ghost",className:"w-full text-sm h-8 text-blue-600",onClick:h,children:[e.jsx(z,{className:"h-3.5 w-3.5 mr-1"})," Clear filters"]})})]})]}),e.jsxs(Q,{value:s.strategic===null?"all":s.strategic?"strategic":"tactical",onValueChange:v,children:[e.jsx(U,{className:"w-[130px]",children:e.jsx(je,{placeholder:"Focus"})}),e.jsxs(X,{children:[e.jsx(C,{value:"all",children:"All tasks"}),e.jsx(C,{value:"strategic",children:"Strategic"}),e.jsx(C,{value:"tactical",children:"Tactical"})]})]})]})]}),s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx(R,{className:"h-4 w-4 text-gray-500"}),s.tags.map(r=>e.jsxs(D,{variant:"secondary",className:"flex gap-1 items-center cursor-pointer",onClick:()=>f(r),children:[r,e.jsx(z,{className:"h-3 w-3"})]},r)),e.jsx(g,{variant:"ghost",size:"sm",className:"h-7 text-xs text-blue-600",onClick:()=>j(r=>({...r,tags:[]})),children:"Clear tags"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[w.length>0&&e.jsxs(V,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(R,{className:"h-3.5 w-3.5 mr-1"})," Tags"]})}),e.jsx(q,{children:e.jsx("div",{className:"grid grid-cols-2 gap-1 p-1",children:w.slice(0,10).map(r=>e.jsxs(g,{variant:"ghost",size:"sm",className:`text-xs justify-start ${s.tags.includes(r)?"bg-slate-100":""}`,onClick:()=>f(r),children:[s.tags.includes(r)&&e.jsx(ae,{className:"h-3 w-3 mr-1"}),r]},r))})})]}),e.jsx("div",{children:e.jsxs(Q,{value:s.groupBy,onValueChange:m,children:[e.jsx(U,{className:"text-sm h-9",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-3.5 w-3.5 mr-2"}),"Group by"]})}),e.jsxs(X,{children:[e.jsx(C,{value:"none",children:"No grouping"}),e.jsx(C,{value:"type",children:"Type"}),e.jsx(C,{value:"priority",children:"Priority"}),e.jsx(C,{value:"strategic",children:"Strategic/Tactical"})]})]})})]}),k&&e.jsxs(g,{variant:"ghost",size:"sm",onClick:h,className:"text-sm text-blue-600",children:[e.jsx(z,{className:"h-3.5 w-3.5 mr-1"})," Clear all filters"]})]})]})}function Qe(){const{tasks:x,loading:j,refreshAll:w}=c.useContext(he),{updatePageContext:s}=me(),[h,k]=c.useState([]),[n,f]=c.useState(!1),[N,v]=c.useState(null),[m,r]=c.useState(null),[o,p]=c.useState(null),[a,T]=c.useState({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"}),[O,I]=c.useState([]);c.useEffect(()=>{k(Array.isArray(x)?x:[])},[x]),c.useEffect(()=>{const t=new Set;(Array.isArray(h)?h:[]).forEach(l=>{Array.isArray(l?.tags)&&l.tags.forEach(i=>t.add(i))}),I(Array.from(t))},[h]);const M=async()=>{p(null);try{await w();const t=Array.isArray(x)?x:[],l=new Set;t.forEach(i=>{Array.isArray(i.tags)&&i.tags.forEach(u=>l.add(u))}),I(Array.from(l))}catch(t){B.error("Failed to refresh tasks",{error:String(t)}),p("Failed to load tasks. Please try again.")}},W=async t=>{if(!t){f(!1),v(null);return}try{N?await S.update(N.id,t):await S.create(t),await M(),f(!1),v(null)}catch(l){B.error("Failed to save task",{error:String(l)}),p("Failed to save task. Please try again.")}},$=async t=>{try{await S.delete(t.id),await M()}catch(l){B.error("Failed to delete task",{error:String(l)}),p("Failed to delete task. Please try again.")}},Y=t=>{v(t),f(!0)},H=async(t,l)=>{try{await S.update(t.id,{...t,status:l}),await M()}catch(i){B.error("Failed to update task status",{error:String(i)}),p("Failed to update task status. Please try again.")}},y=(t=>{const l=Array.isArray(t)?t:[],i={...a,status:Array.isArray(a.status)?a.status:[],priority:Array.isArray(a.priority)?a.priority:[],type:Array.isArray(a.type)?a.type:[],tags:Array.isArray(a.tags)?a.tags:[]};return l.filter(u=>{if(i.status.length>0&&!i.status.includes(u.status)||i.type.length>0&&!i.type.includes(u.type)||i.priority.length>0&&!i.priority.includes(u.priority))return!1;if(i.tags.length>0){const b=Array.isArray(u.tags)?u.tags:[];if(!i.tags.some(L=>b.includes(L)))return!1}if(i.strategic!==null&&u.strategic!==i.strategic)return!1;if(i.search){const b=i.search.toLowerCase(),L=(u.title||"").toLowerCase().includes(b),ee=(u.description||"").toLowerCase().includes(b);if(!L&&!ee)return!1}return!0})})(h),Z=y.filter(t=>t?.status!=="done"),P=y.filter(t=>t?.status==="done"),A=c.useCallback(()=>{const t=[];return a.status?.length>0&&t.push(`status: ${a.status.join(", ")}`),a.priority?.length>0&&t.push(`priority: ${a.priority.join(", ")}`),a.type?.length>0&&t.push(`type: ${a.type.join(", ")}`),a.tags?.length>0&&t.push(`tags: ${a.tags.join(", ")}`),a.search&&t.push(`search: "${a.search}"`),a.strategic!==null&&t.push(a.strategic?"strategic only":"tactical only"),t.length>0?t.join("; "):null},[a]);return c.useEffect(()=>{const t=K(y,{status:a.status?.join(", "),priority:a.priority?.join(", "),type:a.type?.join(", "),search:a.search},m);s({page:"/tasks",summary:t,selection:m?{id:m.id,type:"task"}:null,data:{taskCount:y.length,totalTaskCount:h.length,filters:A()}})},[y,a,m,s,A,h.length]),c.useEffect(()=>{const t=()=>{const l=K(y,{status:a.status?.join(", "),priority:a.priority?.join(", "),type:a.type?.join(", "),search:a.search},m);s({page:"/tasks",summary:l,selection:m?{id:m.id,type:"task"}:null,data:{taskCount:y.length,totalTaskCount:h.length,filters:A()}})};return window.addEventListener("ai-context-refresh",t),()=>window.removeEventListener("ai-context-refresh",t)},[y,a,m,s,A,h.length]),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tasks"}),!n&&e.jsxs(g,{onClick:()=>f(!0),className:"mt-4 sm:mt-0",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"New Task"]})]}),o&&e.jsxs(ue,{variant:"destructive",className:"mb-6",children:[e.jsx(ge,{children:"Error"}),e.jsx(xe,{children:o})]}),e.jsx(le,{mode:"wait",children:n?e.jsx(G.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-8",children:e.jsx(pe,{onCreateTask:W,initialTaskData:N})}):e.jsxs(G.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(ve,{filters:a,setFilters:T,availableTags:O}),j?e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading tasks..."})]}):e.jsx(e.Fragment,{children:y.length===0?e.jsxs("div",{className:"text-center p-12 border border-dashed rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No tasks found"}),e.jsx("p",{className:"text-gray-500",children:x.length===0?"Create your first task to get started":"Try adjusting your filters to see more tasks"}),x.length>0&&e.jsx(g,{variant:"outline",className:"mt-4",onClick:()=>T({status:[],priority:[],type:[],search:"",tags:[],strategic:null,groupBy:"none"}),children:"Clear all filters"})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{children:e.jsx(ye,{tasks:Z,onEditTask:Y,onDeleteTask:$,onStatusChange:H,groupBy:a.groupBy==="none"?null:a.groupBy})}),P.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-gray-600",children:[e.jsx(ne,{className:"h-5 w-5"}),"Completed Tasks (",P.length,")"]}),e.jsx("div",{className:"bg-white rounded-lg border shadow-sm overflow-hidden",children:e.jsxs(fe,{children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(F,{children:"Task"}),e.jsx(F,{children:"Type"}),e.jsx(F,{children:"Completed Date"}),e.jsx(F,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ke,{children:P.map(t=>e.jsxs(J,{children:[e.jsxs(E,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t.title}),t.project&&e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["in ",t.project]})]}),t.tags?.length>0&&e.jsx("div",{className:"flex gap-1 mt-1",children:t.tags.map(l=>e.jsx(D,{variant:"secondary",className:"text-xs",children:l},l))})]}),e.jsx(E,{children:e.jsx(D,{variant:"outline",children:t.type})}),e.jsx(E,{children:Ne(new Date(t.updated_date),"MMM d, yyyy")}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>H(t,"todo"),title:"Mark as Todo",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>$(t),className:"text-red-500",title:"Delete",children:e.jsx(oe,{className:"h-4 w-4"})})]})})]},t.id))})]})})]})]})})]})})]})})}export{Qe as default};
