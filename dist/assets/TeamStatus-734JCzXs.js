import{j as e,ax as I,N as L,a5 as B,l as E,W as v,aI as P,m as A,L as $,D as H}from"./chunk-WPKCbDK8.js";import{a as d}from"./chunk-BKwDNIOR.js";import{z as O,k as R,C as u,j as g,n as U,o as W,H as z,K as F,p as V,B as C}from"./index-B5nMAt-E.js";import{g as w,d as _,l as K,b as k}from"./chunk-DRrmMohU.js";import{T as q,a as G,b as J}from"./chunk-CqsX0BiM.js";import{B as h}from"./chunk-zVvAqB5a.js";import{b as y}from"./chunk-DGs6foQ1.js";import"./chunk-BwuEqr1N.js";const Q=[{id:"all",label:"All Teams"},{id:"metering",label:"Metering"},{id:"reporting",label:"Reporting"}],T=d.createContext(null);function X({children:t}){const[s,r]=d.useState([]),[a,n]=d.useState("metering"),[i,o]=d.useState(null),[c,l]=d.useState(!0),[x,p]=d.useState(null),{isAuthenticated:f}=O();d.useEffect(()=>{if(!i){const m=w();o(m.currentSprint.id)}},[i]);const M=d.useMemo(()=>{const m=w(),N=_(m.id);return K(N,2)},[]),j=d.useCallback(async()=>{if(!f||!i){r([]),l(!1);return}try{l(!0),p(null);const m=k(i);if(!m){r([]);return}const N=await R.knowledge.searchInsights({teamDepartment:a==="all"?void 0:a,startDate:m.startDate.toISOString().split("T")[0],endDate:m.endDate.toISOString().split("T")[0],category:"team_summary"});r(N.summaries||[])}catch(m){console.error("Failed to fetch team summaries:",m),p(m.message),r([])}finally{l(!1)}},[f,a,i]);d.useEffect(()=>{j()},[j]);const D={summaries:s,currentTeam:a,setCurrentTeam:n,currentWeek:i,setCurrentWeek:o,availableSprints:M,loading:c,error:x,refresh:j};return e.jsx(T.Provider,{value:D,children:t})}function Y(){const t=d.useContext(T);if(!t)throw new Error("useTeamStatus must be used within a TeamStatusProvider");return t}function Z({summaries:t=[]}){const s=t.reduce((r,a)=>({completed:r.completed+(a.completedCount||0),blockers:r.blockers+(a.blockerCount||0),velocity:r.velocity+(a.completedCount||0)}),{completed:0,blockers:0,velocity:0});return e.jsx(u,{children:e.jsx(g,{className:"py-4",children:e.jsxs("div",{className:"grid grid-cols-3 divide-x",children:[e.jsxs("div",{className:"text-center px-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(I,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold",children:s.completed})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Completed"})]}),e.jsxs("div",{className:"text-center px-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(L,{className:`h-4 w-4 ${s.blockers>0?"text-red-600":"text-muted-foreground"}`}),e.jsx("span",{className:"text-2xl font-bold",children:s.blockers})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Blockers"})]}),e.jsxs("div",{className:"text-center px-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(B,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-2xl font-bold",children:s.velocity})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Velocity"})]})]})})})}function S(t){const{blockerCount:s=0,completedCount:r=0,lastUpdateDays:a=0,itemCount:n=0}=t;return s>=2?{status:"red",reasoning:`${s} blockers - immediate attention needed`}:a>3?{status:"red",reasoning:`No updates in ${a} days`}:s===1?{status:"yellow",reasoning:"1 blocker - monitor progress"}:r===0&&n>0&&a>1?{status:"yellow",reasoning:"Low activity, no completed items"}:{status:"green",reasoning:r>0?`${r} items completed, on track`:"No blockers, steady progress"}}function ee(t){const s={green:"border-l-green-500",yellow:"border-l-yellow-500",red:"border-l-red-500"};return s[t]||s.green}function b(t){const s={green:"text-green-700 border-green-500",yellow:"text-yellow-700 border-yellow-500",red:"text-red-700 border-red-500"};return s[t]||s.green}function se({member:t,summary:s}){const[r,a]=d.useState(!1),n=d.useMemo(()=>S(s),[s]),i=ee(n.status),o=t?.name?t.name.split(" ").map(c=>c[0]).join("").toUpperCase().slice(0,2):"??";return e.jsx(U,{open:r,onOpenChange:a,children:e.jsxs(u,{className:`border-l-4 ${i} hover:shadow-md transition-shadow`,children:[e.jsxs(W,{className:"w-full text-left p-4 flex items-center gap-3",children:[e.jsx(z,{className:"h-10 w-10",children:e.jsx(F,{className:"text-sm",children:o})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium",children:t?.name||"Unknown"}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.oneLine||"No updates this week"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[s.completedCount>0&&e.jsxs(h,{variant:"secondary",className:"text-xs",children:[s.completedCount," done"]}),s.blockerCount>0&&e.jsxs(h,{variant:"destructive",className:"text-xs",children:[s.blockerCount," blocker",s.blockerCount>1?"s":""]})]}),e.jsx(E,{className:`h-4 w-4 text-muted-foreground transition-transform flex-shrink-0 ${r?"rotate-180":""}`})]}),e.jsxs(V,{className:"px-4 pb-4 space-y-3",children:[s.items&&s.items.length>0&&e.jsx("div",{className:"text-sm space-y-2 pl-13",children:s.items.map((c,l)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("span",{children:c.text})]},c.id||l))}),e.jsxs("div",{className:"text-xs text-muted-foreground pt-2 border-t pl-13",children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",n.reasoning]})]})]})})}function te({currentWeek:t,availableSprints:s=[],onWeekChange:r}){const a=t?k(t):null,n=s.findIndex(f=>f.id===t),i=n>0,o=n<s.length-1,c=()=>{i&&r(s[n-1].id)},l=()=>{o&&r(s[n+1].id)};if(!a)return e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{children:"Select a week"})]});const p=a.label==="a"?"1-2":"3-4";return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{variant:"outline",size:"icon",onClick:c,disabled:!i,"aria-label":"Previous week",children:e.jsx(P,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-center min-w-[220px]",children:[e.jsxs("div",{className:"font-medium flex items-center justify-center gap-2",children:[e.jsx(v,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Weeks ",p," - Sprint ",a.id]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[y(a.startDate,"MMM d")," - ",y(a.endDate,"MMM d, yyyy")]})]}),e.jsx(C,{variant:"outline",size:"icon",onClick:l,disabled:!o,"aria-label":"Next week",children:e.jsx(A,{className:"h-4 w-4"})})]})}function re({summaries:t=[]}){const s=t.reduce((r,a)=>{const n=S(a);return r[n.status]=(r[n.status]||0)+1,r},{});return t.length===0?null:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.green>0&&e.jsxs(h,{variant:"outline",className:b("green"),children:[s.green," green"]}),s.yellow>0&&e.jsxs(h,{variant:"outline",className:b("yellow"),children:[s.yellow," yellow"]}),s.red>0&&e.jsxs(h,{variant:"outline",className:b("red"),children:[s.red," red"]})]})}function ae(){const{summaries:t,currentTeam:s,setCurrentTeam:r,currentWeek:a,setCurrentWeek:n,availableSprints:i,loading:o,error:c}=Y();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Team Status"}),e.jsx("p",{className:"text-muted-foreground",children:"Weekly health and progress summaries"})]}),e.jsx(te,{currentWeek:a,availableSprints:i,onWeekChange:n})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx(q,{value:s,onValueChange:r,children:e.jsx(G,{children:Q.map(l=>e.jsx(J,{value:l.id,children:l.label},l.id))})}),!o&&t.length>0&&e.jsx(re,{summaries:t})]}),o&&e.jsx(u,{children:e.jsxs(g,{className:"py-12 text-center",children:[e.jsx($,{className:"h-8 w-8 mx-auto animate-spin text-muted-foreground"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading team summaries..."})]})}),c&&!o&&e.jsx(u,{className:"border-destructive",children:e.jsx(g,{className:"py-8 text-center",children:e.jsxs("p",{className:"text-destructive",children:["Failed to load summaries: ",c]})})}),!o&&!c&&t.length===0&&e.jsx(u,{children:e.jsxs(g,{className:"py-12 text-center",children:[e.jsx(H,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-2",children:"No team summaries for this week"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Data will appear once daily summaries are stored via MCP"})]})}),!o&&!c&&t.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Z,{summaries:t}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Team Members"}),e.jsx("div",{className:"grid gap-3",children:t.map((l,x)=>e.jsx(se,{member:l.member||{name:l.memberName||`Member ${x+1}`},summary:l},l.memberId||x))})]})]})]})}function ue(){return e.jsx(X,{children:e.jsx(ae,{})})}export{ue as default};
