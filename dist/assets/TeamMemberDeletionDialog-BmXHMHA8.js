import{j as e,T as D,aB as I,d as R,bI as H,a0 as O}from"./chunk-8WlaufA8.js";import{a as i}from"./chunk-pjYta8vt.js";import{D as B,a as U,b as G,c as M,d as K}from"./chunk-Cg2ZZDgQ.js";import{A as V,b as W,L as d,B as y,v as c,w as o,x as m}from"./index-BK5E59O8.js";import{P as v,A as f,R as Y,a as N}from"./chunk-Bw8oe1_L.js";import{C as $}from"./chunk-DHsBTIyN.js";import{o as h}from"./chunk-BQPSriyy.js";const ae=({open:x,onOpenChange:T,teamMember:a,onConfirm:A,onCancel:_})=>{const[t,w]=i.useState([]),[l,C]=i.useState([]),[r,u]=i.useState("archive"),[g,p]=i.useState(!1),[j,b]=i.useState(!1),[F,E]=i.useState(!0);i.useEffect(()=>{x&&a&&P()},[x,a]);const P=async()=>{E(!0);try{const[s,n]=await Promise.all([v.getByTeamMember(a.id),f.getByTeamMember(a.id)]);w(s),C(n)}catch(s){console.error("Error loading related data:",s),h.error("Failed to load related data")}finally{E(!1)}},k=async()=>{if(!g){h.error("Please confirm that you want to delete this team member");return}b(!0);try{if(r==="delete")await Promise.all([...t.map(s=>v.delete(s.id)),...l.map(s=>f.delete(s.id))]),c(m.DELETE,o.PERSONAL_FILE_ITEM,"bulk_delete",{operation:"team_member_deletion",teamMemberId:a.id,teamMemberName:a.name,deletedItemsCount:t.length,dataHandling:"delete"}),c(m.DELETE,o.AGENDA_ITEM,"bulk_delete",{operation:"team_member_deletion",teamMemberId:a.id,teamMemberName:a.name,deletedItemsCount:l.length,dataHandling:"delete"});else if(r==="archive"){const s={archived:!0,archivedAt:new Date().toISOString()};await Promise.all([...t.map(n=>v.update(n.id,s)),...l.map(n=>f.update(n.id,s))]),c(m.UPDATE,o.PERSONAL_FILE_ITEM,"bulk_archive",{operation:"team_member_deletion",teamMemberId:a.id,teamMemberName:a.name,archivedItemsCount:t.length,dataHandling:"archive"}),c(m.UPDATE,o.AGENDA_ITEM,"bulk_archive",{operation:"team_member_deletion",teamMemberId:a.id,teamMemberName:a.name,archivedItemsCount:l.length,dataHandling:"archive"})}c(m.DELETE,o.TEAM_MEMBER,a.id,{operation:"delete_team_member",teamMemberName:a.name,dataHandling:r,personalFileItemsCount:t.length,agendaItemsCount:l.length}),await A(a.id,r),h.success(`Team member deleted successfully. Data was ${r==="delete"?"deleted":r==="archive"?"archived":"preserved"}.`),p(!1),u("archive")}catch(s){console.error("Error deleting team member:",s),h.error("Failed to delete team member. Please try again.")}finally{b(!1)}},L=()=>{p(!1),u("archive"),_()};if(!a)return null;const S=t.length>0||l.length>0;return e.jsx(B,{open:x,onOpenChange:T,children:e.jsxs(U,{className:"max-w-2xl",children:[e.jsx(G,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-red-500"}),"Delete Team Member"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(V,{children:[e.jsx(D,{className:"h-4 w-4"}),e.jsxs(W,{children:["You are about to delete ",e.jsx("strong",{children:a.name}),". This action cannot be undone."]})]}),F?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2",children:"Loading related data..."})]}):S?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-yellow-800 mb-2",children:"Related Data Found"}),e.jsxs("div",{className:"space-y-2 text-sm text-yellow-700",children:[t.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.length," personal file item(s)"]})]}),l.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs("span",{children:[l.length," agenda item(s)"]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"text-base font-medium",children:"What should happen to this data?"}),e.jsxs(Y,{value:r,onValueChange:u,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"archive",id:"archive"}),e.jsxs(d,{htmlFor:"archive",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(H,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Archive data"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Keep data but mark it as archived (recommended)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"keep",id:"keep"}),e.jsxs(d,{htmlFor:"keep",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(I,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Keep data active"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Preserve all data in its current state"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"delete",id:"delete"}),e.jsxs(d,{htmlFor:"delete",className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(O,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Delete all data"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Permanently remove all related data (cannot be undone)"})]})]})]})]})]})]}):e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("p",{className:"text-green-800",children:"No related personal file items or agenda items found."})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"confirm",checked:g,onCheckedChange:p}),e.jsxs(d,{htmlFor:"confirm",className:"text-sm",children:["I understand that this action cannot be undone and confirm the deletion of"," ",e.jsx("strong",{children:a.name})]})]})]}),e.jsxs(K,{children:[e.jsx(y,{variant:"outline",onClick:L,disabled:j,children:"Cancel"}),e.jsx(y,{variant:"destructive",onClick:k,disabled:!g||j,children:j?"Deleting...":"Delete Team Member"})]})]})})};export{ae as default};
