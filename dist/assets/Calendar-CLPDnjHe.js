import{j as e,A as Q,av as X,aw as Y,ax as L,E as xe,r as Z,D as es,ar as ue,ay as ss,az as ts,aA as ge,aB as fe,n as as,m as rs}from"./chunk-BlD_ekKQ.js";import{a as i,d as ns}from"./chunk-BKwDNIOR.js";import{A as ls,d as is,u as ds,D as cs,l as b,e as os,f as O,T as ms,B as j,g as _,C as K,h as ee,i as se,j as te}from"./index-BPpXP9wP.js";import{a as pe}from"./chunk-NOAukTlf.js";import{a as ae}from"./chunk-uiVOWrDz.js";import{D as ye,a as je,b as ve,c as be,B as f}from"./chunk-CmitwiBI.js";import hs from"./TaskCreationForm-Prd0TgOH.js";import{T as xs,a as us}from"./chunk-BugMYHNG.js";import{s as w,e as S,d as Ne,b as h,p,g as B,h as I,i as D,j as P,k as E,l as W,m as U,n as we,o as gs,q as Se}from"./chunk-P_BNsj9B.js";import"./chunk-KzYfAQy1.js";import"./chunk-DBni0BOz.js";import"./chunk-D12Apl6f.js";import"./chunk-BdHZTqfh.js";import"./chunk-B-ktFKGP.js";import"./chunk-fsVcrzvE.js";import"./chunk-D-Q6W0fT.js";import"./chunk-DVqya-Gr.js";function Fs(){const{tasks:q,teamMembers:H,meetings:V,refreshAll:De}=i.useContext(ls),{isPresentationMode:N}=is(),[re,Ce]=i.useState([]),[Me,ke]=i.useState([]),[ne,Te]=i.useState([]),[Oe,le]=i.useState([]),[ie,de]=i.useState([]),[ce,G]=i.useState([]),[d,F]=i.useState(new Date),[m,k]=i.useState(new Date),[o,oe]=i.useState(null),[_e,T]=i.useState(!1),[Ee,A]=i.useState(!1),[J,z]=i.useState(null),[Fe,me]=i.useState(!1),[C,Ae]=i.useState(()=>localStorage.getItem("calendar-month-collapsed")==="true"),[v,ze]=i.useState({tasks:!0,leave:!0,timeOff:!0,duties:!0,dutySchedule:!0,meetings:!0});i.useEffect(()=>{localStorage.setItem("calendar-month-collapsed",String(C))},[C]),i.useEffect(()=>{Ce(Array.isArray(q)?q:[])},[q]),i.useEffect(()=>{ke(Array.isArray(H)?H:[])},[H]),i.useEffect(()=>{Te(Array.isArray(V)?V:[])},[V]),i.useEffect(()=>{(async()=>{try{const a=await cs.list();le(Array.isArray(a)?a:[])}catch(a){b.error("Failed to load DevOps duties",{error:String(a)}),le([])}})()},[]),i.useEffect(()=>{(async()=>{try{const a=w(B(d)),n=S(I(d,1)),l=await os.listByDateRange(h(a,"yyyy-MM-dd"),h(n,"yyyy-MM-dd"));de(Array.isArray(l)?l:[])}catch(a){b.error("Failed to load duty schedules",{error:String(a)}),de([])}})()},[d]),i.useEffect(()=>{(async()=>{try{const a=w(B(d)),n=S(I(d,1)),l=await O.listByDateRange(h(a,"yyyy-MM-dd"),h(n,"yyyy-MM-dd"));G(Array.isArray(l)?l:[])}catch(a){b.error("Failed to load time off entries",{error:String(a)}),G([])}})()},[d]);const Re=s=>{ze(a=>({...a,[s]:!a[s]}))},$e=async()=>{try{await De()}catch(s){b.error("Failed to refresh tasks (calendar)",{error:String(s)})}},he=async()=>{try{const s=w(B(d)),a=S(I(d,1)),n=await O.listByDateRange(h(s,"yyyy-MM-dd"),h(a,"yyyy-MM-dd"));G(Array.isArray(n)?n:[])}catch(s){b.error("Failed to reload time off entries",{error:String(s)})}},Le=async s=>{me(!0);try{J?await O.update(J.id,s):await O.create(s),await he(),A(!1),z(null)}catch(a){b.error("Failed to save time off",{error:String(a)})}finally{me(!1)}},Be=async s=>{try{await O.delete(s),await he()}catch(a){b.error("Failed to delete time off",{error:String(a)})}},Ie=async s=>{if(!s){T(!1);return}try{await ms.create({...s,due_date:s.due_date||m.toISOString()}),await $e(),T(!1)}catch(a){b.error("Failed to create task (calendar)",{error:String(a)})}},Pe=()=>{F(B(d))},We=()=>{F(I(d,1))},Ue=s=>{k(s)},qe=s=>{k(s),Se(s,d)||F(s)},He=()=>{const s=new Date;k(s),F(s)},Ve=s=>{oe(s)},R=s=>{const a=v.tasks?re.filter(t=>t.due_date&&D(p(t.due_date),s)):[],n=v.leave?Me.filter(t=>{if(!t?.leave_from||!t?.leave_to)return!1;try{const c=P(p(t.leave_from)),g=E(p(t.leave_to));return W(s,{start:c,end:g})}catch{return!1}}):[],l=v.duties?Oe.filter(t=>{if(!t.start_date)return!1;try{const c=P(p(t.start_date)),g=t.end_date?E(p(t.end_date)):E(c);return W(s,{start:c,end:g})}catch{return!1}}):[],u=v.meetings?ne.filter(t=>t.scheduled_date&&D(p(t.scheduled_date),s)):[],x=v.dutySchedule?ie.filter(t=>{if(!t.start_date||!t.end_date)return!1;try{const c=P(p(t.start_date)),g=E(p(t.end_date));return W(s,{start:c,end:g})}catch{return!1}}):[],r=v.timeOff?ce.filter(t=>{if(!t.start_date||!t.end_date)return!1;try{const c=P(p(t.start_date)),g=E(p(t.end_date));return W(s,{start:c,end:g})}catch{return!1}}):[];return{tasks:a,leaves:n,duties:l,meetings:u,dutySchedules:x,timeOffs:r,hasEvents:a.length>0||n.length>0||l.length>0||u.length>0||x.length>0||r.length>0}},Ge=()=>{const s=we(m);return Ne({start:s,end:U(s,6)})},{updatePageContext:$}=ds(),M=ns.useMemo(()=>{const s=w(d),a=S(d),n=Ne({start:s,end:a}),l=[];return n.forEach(u=>{const x=R(u);x.tasks.forEach(r=>l.push({type:"task",title:r.title,date:r.due_date,...r})),x.meetings.forEach(r=>l.push({type:"meeting",title:r.title||r.subject,start_date:r.scheduled_date,...r})),x.dutySchedules.forEach(r=>l.push({type:"duty",title:`${r.duty_type} - ${r.assignee_name||"Unassigned"}`,start_date:r.start_date,...r})),x.timeOffs.forEach(r=>l.push({type:"timeoff",title:`${r.person_name||"Someone"} - ${r.type||"Time Off"}`,start_date:r.start_date,...r}))}),l},[d,re,ne,ie,ce,v]);i.useEffect(()=>{const s={start:w(d),end:S(d)},a=pe(M,"month",m,s);$({page:"/calendar",summary:a,selection:o?{id:o.id,type:"task"}:null,data:{eventCount:M.length,viewMode:"month",currentMonth:h(d,"yyyy-MM"),viewingDate:h(m,"yyyy-MM-dd")}})},[M,d,m,o,$]),i.useEffect(()=>{const s=()=>{const a={start:w(d),end:S(d)},n=pe(M,"month",m,a);$({page:"/calendar",summary:n,selection:o?{id:o.id,type:"task"}:null,data:{eventCount:M.length,viewMode:"month",currentMonth:h(d,"yyyy-MM"),viewingDate:h(m,"yyyy-MM-dd")}})};return window.addEventListener("ai-context-refresh",s),()=>window.removeEventListener("ai-context-refresh",s)},[M,d,m,o,$]);const Je=()=>{const s=[{key:"tasks",label:"Tasks",icon:Q,activeClass:"bg-purple-100 text-purple-800 border-purple-300",color:"purple"},{key:"leave",label:"Leave",icon:X,activeClass:"bg-red-100 text-red-800 border-red-300",color:"red"},{key:"timeOff",label:"Time Off",icon:Y,activeClass:"bg-blue-100 text-blue-800 border-blue-300",color:"blue"},{key:"duties",label:"DevOps",icon:L,activeClass:"bg-indigo-100 text-indigo-800 border-indigo-300",color:"indigo"},{key:"dutySchedule",label:"Rotation",icon:xe,activeClass:"bg-emerald-100 text-emerald-800 border-emerald-300",color:"emerald"},{key:"meetings",label:"Meetings",icon:Z,activeClass:"bg-teal-100 text-teal-800 border-teal-300",color:"teal"}];return e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-1",children:"Show:"}),s.map(({key:a,label:n,icon:l,activeClass:u})=>e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>Re(a),className:_("h-8 px-3 text-xs font-medium transition-colors",v[a]?u:"bg-white text-gray-400 border-gray-200"),children:[e.jsx(l,{className:"h-3.5 w-3.5 mr-1.5"}),n]},a))]})},Qe=()=>{const s=R(m),a=D(m,new Date),n=s.tasks.length,l=s.leaves.length,u=s.timeOffs.length,x=s.meetings.length,r=s.duties.length+s.dutySchedules.length;return e.jsxs(K,{className:"mb-6 shadow-lg border-2 border-indigo-100",children:[e.jsxs(ee,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-2xl font-bold text-gray-900",children:a?"Today":h(m,"EEEE")}),e.jsx("p",{className:"text-lg text-gray-600 mt-1",children:h(m,"MMMM d, yyyy")})]}),e.jsxs("div",{className:"flex gap-2",children:[!a&&e.jsxs(j,{variant:"outline",size:"sm",onClick:He,children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Today"]}),!N&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{z(null),A(!0)},children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Time Off"]}),e.jsxs(j,{size:"sm",onClick:()=>T(!0),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Add Task"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 flex-wrap",children:[n>0&&e.jsxs(f,{className:"bg-purple-100 text-purple-800 border-purple-200 px-3 py-1",children:[e.jsx(Q,{className:"h-3.5 w-3.5 mr-1"}),n," Task",n!==1?"s":""]}),x>0&&e.jsxs(f,{className:"bg-teal-100 text-teal-800 border-teal-200 px-3 py-1",children:[e.jsx(Z,{className:"h-3.5 w-3.5 mr-1"}),x," Meeting",x!==1?"s":""]}),(l>0||u>0)&&e.jsxs(f,{className:"bg-red-100 text-red-800 border-red-200 px-3 py-1",children:[e.jsx(X,{className:"h-3.5 w-3.5 mr-1"}),l+u," OOO"]}),r>0&&e.jsxs(f,{className:"bg-indigo-100 text-indigo-800 border-indigo-200 px-3 py-1",children:[e.jsx(L,{className:"h-3.5 w-3.5 mr-1"}),r," Dut",r!==1?"ies":"y"]}),!s.hasEvents&&e.jsx(f,{variant:"outline",className:"text-gray-500 px-3 py-1",children:"No events scheduled"})]})]}),e.jsx(te,{className:"pt-0",children:s.hasEvents?e.jsxs("div",{className:"space-y-4",children:[s.tasks.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-purple-800 flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Tasks"]}),e.jsx("div",{className:"space-y-2",children:s.tasks.map(t=>e.jsxs("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 cursor-pointer transition-colors",onClick:()=>Ve(t),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-purple-900",children:t.title}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",className:"text-xs",children:t.type}),e.jsx(f,{variant:"outline",className:"text-xs",children:t.priority})]})]}),t.description&&e.jsx("p",{className:"text-sm text-purple-700 mt-1 line-clamp-2",children:t.description})]},t.id))})]}),s.meetings.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-teal-800 flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Meetings"]}),e.jsx("div",{className:"space-y-2",children:s.meetings.map(t=>e.jsxs("div",{className:"p-3 bg-teal-50 border border-teal-200 rounded-lg",children:[e.jsx("span",{className:"font-medium text-teal-900",children:t.title}),t.location&&e.jsx("p",{className:"text-sm text-teal-700 mt-1",children:t.location})]},t.id))})]}),s.timeOffs.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-800 flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Time Off"]}),e.jsx("div",{className:"space-y-2",children:s.timeOffs.map((t,c)=>e.jsx(us,{timeOff:t,compact:!1,showTeamMember:!0,index:c,onEdit:N?void 0:g=>{z(g),A(!0)},onDelete:N?void 0:Be},t.id))})]}),s.leaves.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-red-800 flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Team Leave"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.leaves.map((t,c)=>e.jsx(f,{className:"bg-red-100 text-red-800 border-red-200",children:N?`${ae(t.name,c,"Team Member")} - Leave`:`${t.name} - ${t.leave_title||"Leave"}`},t.id))})]}),s.dutySchedules.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-emerald-800 flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Duty Rotation"]}),e.jsx("div",{className:"space-y-2",children:s.dutySchedules.map((t,c)=>{const g={devops:{icon:L,bg:"bg-indigo-50",border:"border-indigo-200",text:"text-indigo-800",label:"DevOps"},dev_on_duty:{icon:ts,bg:"bg-teal-50",border:"border-teal-200",text:"text-teal-800",label:"Dev On Duty"},replacement:{icon:ss,bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-800",label:"SM Cover"}},y=g[t.duty_type]||g.devops,Ze=y.icon,Ke=N?ae(t.team_member_name,c,"Team Member"):t.team_member_name;return e.jsx("div",{className:`p-3 ${y.bg} border ${y.border} rounded-lg`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:`h-4 w-4 ${y.text}`}),e.jsx("span",{className:`font-medium ${y.text}`,children:y.label}),e.jsx("span",{className:y.text,children:"â€”"}),e.jsx("span",{className:y.text,children:Ke}),t.team&&e.jsx(f,{variant:"outline",className:"ml-auto text-xs",children:t.team})]})},t.id)})})]}),s.duties.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-indigo-800 flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"DevOps Tracking"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.duties.map((t,c)=>e.jsx(f,{className:"bg-indigo-100 text-indigo-800 border-indigo-200",children:N?ae(t.team_member_name,c,"Team Member"):t.team_member_name||"DevOps Duty"},t.id))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No events scheduled for this day"}),!N&&e.jsxs(j,{variant:"outline",onClick:()=>T(!0),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Add your first task"]})]})})]})},Xe=()=>{const s=Ge();return e.jsxs(K,{className:"mb-6",children:[e.jsx(ee,{className:"pb-2 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(se,{className:"text-lg font-semibold text-gray-700",children:"This Week"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>k(U(m,-7)),children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>k(U(m,7)),children:e.jsx(fe,{className:"h-4 w-4"})})]})]})}),e.jsx(te,{className:"pt-2 pb-4",children:e.jsx("div",{className:"grid grid-cols-7 gap-2",children:s.map(a=>{const n=R(a),l=D(a,m),u=D(a,new Date);return e.jsxs("button",{onClick:()=>Ue(a),className:_("flex flex-col items-center p-3 rounded-lg transition-all",l&&"bg-indigo-100 border-2 border-indigo-400",!l&&"hover:bg-gray-100 border-2 border-transparent",u&&!l&&"border-2 border-red-300"),children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:h(a,"EEE")}),e.jsx("span",{className:_("text-lg font-bold mt-1",l?"text-indigo-700":"text-gray-900",u&&"text-red-600"),children:h(a,"d")}),e.jsxs("div",{className:"flex gap-0.5 mt-2 min-h-[8px]",children:[n.tasks.length>0&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),n.meetings.length>0&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-teal-500"}),(n.leaves.length>0||n.timeOffs.length>0)&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),(n.duties.length>0||n.dutySchedules.length>0)&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"})]})]},a.toString())})})})]})},Ye=()=>{const s=w(d),a=S(s),n=we(s),l=gs(a),u=[];let x=n;for(;x<=l;)u.push(x),x=U(x,1);return e.jsxs(K,{className:_("transition-all",C&&""),children:[e.jsx(ee,{className:"pb-2 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(se,{className:"text-lg font-semibold text-gray-700",children:h(d,"MMMM yyyy")}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:Pe,children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:We,children:e.jsx(fe,{className:"h-4 w-4"})})]})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>Ae(!C),className:"text-gray-500",children:C?e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-4 w-4 mr-1"}),"Expand"]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"h-4 w-4 mr-1"}),"Collapse"]})})]})}),!C&&e.jsxs(te,{className:"pt-2 pb-4",children:[e.jsx("div",{className:"grid grid-cols-7 mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(r=>e.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-1",children:r},r))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:u.map(r=>{const t=R(r),c=Se(r,s),g=D(r,m),y=D(r,new Date);return e.jsxs("button",{onClick:()=>qe(r),className:_("aspect-square flex flex-col items-center justify-center rounded-md text-sm transition-colors relative",!c&&"text-gray-300",c&&"text-gray-700 hover:bg-gray-100",g&&"bg-indigo-100 text-indigo-800 font-bold",y&&!g&&"border-2 border-red-400 font-bold text-red-600"),children:[e.jsx("span",{children:h(r,"d")}),t.hasEvents&&c&&e.jsxs("div",{className:"flex gap-0.5 mt-0.5 absolute bottom-1",children:[t.tasks.length>0&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-500"}),t.meetings.length>0&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-teal-500"}),(t.leaves.length>0||t.timeOffs.length>0)&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),(t.duties.length>0||t.dutySchedules.length>0)&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-indigo-500"})]})]},r.toString())})})]})]})};return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Calendar"}),Je()]}),Qe(),Xe(),Ye(),e.jsx(ye,{open:_e,onOpenChange:T,children:e.jsxs(je,{className:"sm:max-w-lg",children:[e.jsx(ve,{children:e.jsxs(be,{children:["Add Task for ",h(m,"MMMM d, yyyy")]})}),e.jsx(hs,{onCreateTask:Ie,initialTaskData:{due_date:m.toISOString(),status:"todo",priority:"medium",type:"generic"}})]})}),e.jsx(ye,{open:!!o,onOpenChange:()=>oe(null),children:o&&e.jsxs(je,{className:"sm:max-w-lg",children:[e.jsx(ve,{children:e.jsx(be,{children:"Task Details"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:o.title}),e.jsxs("div",{className:"flex items-center mt-2 space-x-2",children:[e.jsx(f,{children:o.type}),e.jsxs(f,{variant:"outline",children:[o.priority," priority"]}),o.strategic&&e.jsx(f,{variant:"secondary",children:"Strategic"})]})]}),o.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Description"}),e.jsx("p",{children:o.description})]}),o.due_date&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Due Date"}),e.jsx("p",{children:h(p(o.due_date),"PPpp")})]}),o.stakeholders?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Stakeholders"}),e.jsx("p",{children:o.stakeholders.join(", ")})]}),o.tags?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-500",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:o.tags.map((s,a)=>e.jsx(f,{variant:"secondary",children:s},a))})]})]})]})}),e.jsx(xs,{open:Ee,onOpenChange:s=>{A(s),s||z(null)},onSubmit:Le,initialData:J,preselectedDate:m,isLoading:Fe})]})})}export{Fs as default};
