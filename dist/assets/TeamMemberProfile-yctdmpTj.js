import{j as e,Y as Me,aB as Qe,N as xt,am as Ze,a0 as Le,aC as Is,J as ht,K as Fs,aD as ut,aE as Ns,aF as jt,d as ee,aG as gt,aa as Oe,aH as pt,aI as ft,aJ as yt,aK as $s,aL as Ls,aM as Rs,aN as Vs,aO as zs,aP as Bs,aQ as Nt,aR as vt,a8 as qe,aS as wt,k as bt,aT as vs,i as _t,ab as Dt,ae as ts,aU as ws,Q as bs,T as _s,aV as St,o as Ct,aW as At}from"./chunk-8WlaufA8.js";import{a as n,k as Ot,L as kt}from"./chunk-pjYta8vt.js";import{g as U,i as K,j as X,B as y,h as H,t as Mt,I as be,v as Us,w as Hs,x as Ys,c as ae,y as Ws,A as Re,b as Ve,L as k,O as We,e as Ge,D as le,p as qs,s as Gs,z as ve,T as Pt,P as Tt,S as Et,q as It,k as Ds}from"./index-BK5E59O8.js";import{A as Ss}from"./chunk-B6BcMUO9.js";import{CalendarService as Ae}from"./calendarService-BLiLHtBa.js";import{C as Ft}from"./chunk-DTiRvVQj.js";import{A as Je,O as te}from"./chunk-2Qq0zNiP.js";import{A as Cs,P as As}from"./chunk-Bw8oe1_L.js";import{a as $t,P as Lt,A as ns}from"./chunk-cjCmUzJ1.js";import{T as ds,a as cs,b as ge,c as pe}from"./chunk-BtUKRQ1H.js";import{D as ue,a as je,b as _e,c as De,B as q,f as Os,d as as}from"./chunk-Cg2ZZDgQ.js";import{S as G,a as J,b as Q,c as Z,d as u}from"./chunk-DktN3Kjy.js";import{E as Rt}from"./chunk-kzSEtJwL.js";import{f as F,o as we,p as L}from"./chunk-BQPSriyy.js";import{D as rs,a as ls,b as is,d as ke}from"./chunk-DvQYMAQ6.js";import{T as Js}from"./chunk-DSRmHbBO.js";import{P as me,a as xe,b as he,C as de}from"./chunk-N38jzkpe.js";import{T as Vt,a as zt,b as ks,c as Fe,d as Bt,e as $e}from"./chunk-B-BuOqLK.js";import"./chunk-CJViCmxo.js";const Ut=({teamMemberId:a,teamMemberName:r})=>{const[c,P]=n.useState([]),[d,h]=n.useState(!0),[v,m]=n.useState(!1),[A,N]=n.useState("pending");n.useEffect(()=>{w()},[a]);const w=async()=>{h(!0);try{const D=await Cs.getByTeamMember(a);P(D)}catch(D){console.error("Error loading agenda items:",D)}finally{h(!1)}},$=async()=>{m(!1),await w()},g=async D=>{try{await Cs.update(D.id,{status:"discussed"}),await w()}catch(I){console.error("Error marking agenda item as discussed:",I)}},E=c.filter(D=>A==="pending"?D.status==="pending":A==="discussed"?D.status==="discussed":!0);return e.jsxs(U,{className:"w-full",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between",children:[e.jsx(X,{children:"1:1 Agenda"}),e.jsxs(y,{onClick:()=>m(!0),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),e.jsx(H,{children:e.jsxs(ds,{defaultValue:"pending",value:A,onValueChange:N,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs(cs,{children:[e.jsx(ge,{value:"pending",children:"Pending"}),e.jsx(ge,{value:"discussed",children:"Discussed"}),e.jsx(ge,{value:"all",children:"All"})]})}),e.jsx(pe,{value:"pending",className:"mt-0",children:d?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(Je,{items:E,loading:d,onComplete:g,emptyMessage:"No pending agenda items",emptyDescription:"Add items to discuss in your next 1:1 meeting."})}),e.jsx(pe,{value:"discussed",className:"mt-0",children:d?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(Je,{items:E,loading:d,showActions:!1,emptyMessage:"No discussed agenda items",emptyDescription:"Items marked as discussed will appear here."})}),e.jsx(pe,{value:"all",className:"mt-0",children:d?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):e.jsx(Je,{items:E,loading:d,onComplete:g,emptyMessage:"No agenda items found",emptyDescription:"All agenda items for this team member will appear here."})})]})}),e.jsx(ue,{open:v,onOpenChange:m,children:e.jsxs(je,{children:[e.jsx(_e,{children:e.jsx(De,{children:"Add to 1:1 Agenda"})}),e.jsx($t,{teamMemberId:a,onSubmit:$,onCancel:()=>m(!1)})]})})]})},Ht=({item:a,onEdit:r,onDelete:c,showActions:P=!0,className:d=""})=>{const h=g=>{switch(g){case"achievement":return"bg-green-100 text-green-800 border-green-200";case"feedback":return"bg-blue-100 text-blue-800 border-blue-200";case"concern":return"bg-red-100 text-red-800 border-red-200";case"goal":return"bg-purple-100 text-purple-800 border-purple-200";case"improvement":return"bg-orange-100 text-orange-800 border-orange-200";case"other":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},v=g=>{switch(g){case"achievement":return"Achievement";case"feedback":return"Feedback";case"concern":return"Concern";case"goal":return"Goal";case"improvement":return"Improvement";case"other":return"Other";default:return"Other"}},m=g=>{switch(g){case 5:return"text-red-600";case 4:return"text-orange-600";case 3:return"text-yellow-600";case 2:return"text-blue-600";case 1:return"text-gray-600";default:return"text-gray-600"}},A=g=>{switch(g){case 5:return"High";case 4:return"Medium-High";case 3:return"Medium";case 2:return"Medium-Low";case 1:return"Low";default:return"Medium"}},N=g=>Array.from({length:5},(E,D)=>e.jsx(Is,{className:`h-3 w-3 ${D<g?`fill-current ${m(g)}`:"text-gray-300"}`},D)),w=()=>{r&&r(a)},$=()=>{c&&c(a)};return e.jsx(U,{className:`transition-all hover:shadow-md ${d}`,children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h4",{className:"font-medium text-foreground leading-tight flex-1 mr-3",children:a.title}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsxs(q,{variant:"outline",className:h(a.category),children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),v(a.category)]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Importance:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[N(a.importance),e.jsx("span",{className:`text-xs font-medium ${m(a.importance)}`,children:A(a.importance)})]})]}),a.notes&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:e.jsx("p",{className:"whitespace-pre-wrap",children:a.notes})}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:a.tags.map((g,E)=>e.jsxs(q,{variant:"secondary",className:"text-xs",children:[e.jsx(xt,{className:"h-2 w-2 mr-1"}),g]},E))}),a.sourceType&&a.sourceType!=="manual"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),"Source: ",a.sourceType]})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created ",F(new Date(a.createdAt),"MMM d, yyyy"),a.updatedAt!==a.createdAt&&e.jsxs("span",{children:[" • Updated ",F(new Date(a.updatedAt),"MMM d, yyyy")]})]}),P&&e.jsxs("div",{className:"flex items-center gap-1",children:[r&&e.jsxs(y,{variant:"ghost",size:"sm",onClick:w,className:"h-7 px-3 text-xs",children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"}),"Edit"]}),c&&e.jsxs(y,{variant:"ghost",size:"sm",onClick:$,className:"h-7 px-3 text-xs text-destructive hover:text-destructive",children:[e.jsx(Le,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})]})})})},Ms=({items:a=[],loading:r=!1,onEdit:c,onDelete:P,showActions:d=!0,emptyMessage:h="No personal file items found",emptyDescription:v="Personal file items will appear here once they are added."})=>{const[m,A]=n.useState(""),[N,w]=n.useState("createdAt"),[$,g]=n.useState("desc"),[E,D]=n.useState("all"),[I,B]=n.useState("all"),Y=n.useMemo(()=>{let p=a;if(m){const i=m.toLowerCase();p=p.filter(o=>o.title.toLowerCase().includes(i)||o.notes&&o.notes.toLowerCase().includes(i)||o.tags&&o.tags.some(O=>O.toLowerCase().includes(i)))}return E!=="all"&&(p=p.filter(i=>i.category===E)),I!=="all"&&(p=p.filter(i=>i.importance===parseInt(I))),p.sort((i,o)=>{let O,b;switch(N){case"title":O=i.title.toLowerCase(),b=o.title.toLowerCase();break;case"importance":O=i.importance,b=o.importance;break;case"category":O=i.category,b=o.category;break;case"updatedAt":O=new Date(i.updatedAt),b=new Date(o.updatedAt);break;case"createdAt":default:O=new Date(i.createdAt),b=new Date(o.createdAt);break}return $==="asc"?O<b?-1:O>b?1:0:O>b?-1:O<b?1:0}),p},[a,m,N,$,E,I]);return r?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Mt,{}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading personal file items..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ht,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(be,{placeholder:"Search personal file items...",value:m,onChange:p=>A(p.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{value:E,onValueChange:D,children:[e.jsxs(J,{className:"w-36",children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),e.jsx(Q,{})]}),e.jsxs(Z,{children:[e.jsx(u,{value:"all",children:"All Categories"}),e.jsx(u,{value:"achievement",children:"Achievement"}),e.jsx(u,{value:"feedback",children:"Feedback"}),e.jsx(u,{value:"concern",children:"Concern"}),e.jsx(u,{value:"goal",children:"Goal"}),e.jsx(u,{value:"improvement",children:"Improvement"}),e.jsx(u,{value:"other",children:"Other"})]})]}),e.jsxs(G,{value:I,onValueChange:B,children:[e.jsxs(J,{className:"w-36",children:[e.jsx(Is,{className:"h-4 w-4 mr-2"}),e.jsx(Q,{})]}),e.jsxs(Z,{children:[e.jsx(u,{value:"all",children:"All Importance"}),e.jsx(u,{value:"5",children:"High"}),e.jsx(u,{value:"4",children:"Medium-High"}),e.jsx(u,{value:"3",children:"Medium"}),e.jsx(u,{value:"2",children:"Medium-Low"}),e.jsx(u,{value:"1",children:"Low"})]})]}),e.jsxs(G,{value:`${N}-${$}`,onValueChange:p=>{const[i,o]=p.split("-");w(i),g(o)},children:[e.jsxs(J,{className:"w-40",children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),e.jsx(Q,{})]}),e.jsxs(Z,{children:[e.jsx(u,{value:"createdAt-desc",children:"Newest First"}),e.jsx(u,{value:"createdAt-asc",children:"Oldest First"}),e.jsx(u,{value:"updatedAt-desc",children:"Recently Updated"}),e.jsx(u,{value:"importance-desc",children:"Importance: High to Low"}),e.jsx(u,{value:"importance-asc",children:"Importance: Low to High"}),e.jsx(u,{value:"title-asc",children:"Title: A to Z"}),e.jsx(u,{value:"title-desc",children:"Title: Z to A"}),e.jsx(u,{value:"category-asc",children:"Category: A to Z"})]})]})]})]}),a.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",Y.length," of ",a.length," personal file items"]}),Y.length===0?e.jsx(Rt,{icon:Qe,title:a.length===0?h:"No matching items",description:a.length===0?v:"Try adjusting your search or filters"}):e.jsx("div",{className:"space-y-3",children:Y.map(p=>e.jsx(Ht,{item:p,onEdit:c,onDelete:P,showActions:d},p.id))})]})},Yt=(a,r)=>{const P=a.sort((d,h)=>new Date(h.createdAt)-new Date(d.createdAt)).map(d=>{const h=new Date(d.createdAt).toLocaleDateString(),v=d.tags&&d.tags.length>0?`<div class="tags"><strong>Tags:</strong> ${d.tags.join(", ")}</div>`:"",m=`<div class="importance"><strong>Importance:</strong> ${d.importance}/5</div>`;return`
      <div class="item">
        <h3>${d.title}</h3>
        <div class="metadata">
          <div class="category"><strong>Category:</strong> ${d.category}</div>
          ${m}
          <div class="date"><strong>Date:</strong> ${h}</div>
          ${v}
        </div>
        <div class="notes">
          ${d.notes?`<p>${d.notes.replace(/\n/g,"<br>")}</p>`:"<p><em>No additional notes</em></p>"}
        </div>
      </div>
    `}).join("");return`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Personal File - ${r}</title>
      <style>
        @media print {
          body { margin: 0; }
          .no-print { display: none; }
        }
        
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333;
          max-width: 800px;
          margin: 0 auto;
          padding: 20px;
        }
        
        .header {
          border-bottom: 2px solid #333;
          padding-bottom: 20px;
          margin-bottom: 30px;
        }
        
        .header h1 {
          margin: 0 0 10px 0;
          color: #2563eb;
        }
        
        .header .meta {
          color: #666;
          font-size: 14px;
        }
        
        .item {
          margin-bottom: 30px;
          padding-bottom: 20px;
          border-bottom: 1px solid #eee;
        }
        
        .item:last-child {
          border-bottom: none;
        }
        
        .item h3 {
          margin: 0 0 10px 0;
          color: #1f2937;
        }
        
        .metadata {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
          margin-bottom: 15px;
          font-size: 14px;
          color: #666;
        }
        
        .metadata > div {
          background: #f8f9fa;
          padding: 4px 8px;
          border-radius: 4px;
        }
        
        .notes {
          margin-top: 10px;
        }
        
        .notes p {
          margin: 0;
          line-height: 1.5;
        }
        
        .tags {
          color: #059669;
        }
        
        .importance {
          color: #dc2626;
        }
        
        .print-button {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 10px 20px;
          background: #2563eb;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
        }
        
        .print-button:hover {
          background: #1d4ed8;
        }
        
        @media (max-width: 768px) {
          body {
            padding: 10px;
          }
          
          .metadata {
            flex-direction: column;
            gap: 5px;
          }
        }
      </style>
    </head>
    <body>
      <button class="print-button no-print" onclick="window.print()">Print</button>
      
      <div class="header">
        <h1>Personal File - ${r}</h1>
        <div class="meta">
          Generated: ${new Date().toLocaleDateString()} | 
          Total Items: ${a.length}
        </div>
      </div>
      
      <div class="content">
        ${P||"<p><em>No personal file items found.</em></p>"}
      </div>
    </body>
    </html>
  `},Wt=(a,r)=>{const c=Yt(a,r),P=window.open("","_blank");P.document.write(c),P.document.close(),P.focus(),setTimeout(()=>{P.print()},250),Us(Ys.PRINT,Hs.PERSONAL_FILE_ITEM,"print_preview",{operation:"print",teamMemberName:r,itemCount:a.length,categories:[...new Set(a.map(d=>d.category))]})},qt=(a,r)=>{const P=a.sort((N,w)=>new Date(w.createdAt)-new Date(N.createdAt)).map(N=>{const w=new Date(N.createdAt).toLocaleDateString(),$=N.tags&&N.tags.length>0?`
Tags: ${N.tags.join(", ")}`:"",g=`
Importance: ${N.importance}/5`;return`${N.title}
Category: ${N.category}${g}
Date: ${w}${$}

${N.notes||"No additional notes"}

${"=".repeat(50)}`}).join(`

`),h=`Personal File - ${r}
Generated: ${new Date().toLocaleDateString()}
Total Items: ${a.length}

PRIVACY NOTICE: This document contains sensitive performance-related information.
Handle according to your organization's data privacy policies.

${"=".repeat(50)}

`+P,v=new Blob([h],{type:"text/plain"}),m=URL.createObjectURL(v),A=document.createElement("a");A.href=m,A.download=`personal-file-${r.toLowerCase().replace(/\s+/g,"-")}-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(m),Us(Ys.EXPORT,Hs.PERSONAL_FILE_ITEM,"text_export",{operation:"export",teamMemberName:r,itemCount:a.length,categories:[...new Set(a.map(N=>N.category))],exportFormat:"text"})},Gt=({teamMemberId:a,teamMemberName:r})=>{const[c,P]=n.useState([]),[d,h]=n.useState(!0),[v,m]=n.useState(!1),[A,N]=n.useState(null),[w,$]=n.useState("all");n.useEffect(()=>{g()},[a]);const g=async()=>{h(!0);try{const o=await As.getByTeamMember(a);P(o)}catch(o){console.error("Error loading personal file items:",o),we.error("Failed to load personal file items")}finally{h(!1)}},E=async()=>{m(!1),N(null),await g()},D=o=>{N(o),m(!0)},I=async o=>{if(window.confirm("Are you sure you want to delete this personal file item?"))try{await As.delete(o.id),we.success("Personal file item deleted"),await g()}catch(O){console.error("Error deleting personal file item:",O),we.error("Failed to delete personal file item")}},B=()=>{try{qt(c,r),we.success("Personal file exported successfully")}catch(o){console.error("Error exporting personal file:",o),we.error("Failed to export personal file")}},Y=()=>{try{Wt(c,r),we.success("Opening print preview...")}catch(o){console.error("Error printing personal file:",o),we.error("Failed to open print preview")}},p=c.filter(o=>w==="all"?!0:o.category===w),i=[...new Set(c.map(o=>o.category))].sort();return e.jsxs(U,{className:"w-full",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between",children:[e.jsx(X,{children:"Personal File"}),e.jsxs("div",{className:"flex gap-2",children:[c.length>0&&e.jsxs(rs,{children:[e.jsx(ls,{asChild:!0,children:e.jsxs(y,{variant:"outline",children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(is,{children:[e.jsxs(ke,{onClick:B,children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Export as Text"]}),e.jsxs(ke,{onClick:Y,children:[e.jsx(jt,{className:"h-4 w-4 mr-2"}),"Print Preview"]})]})]}),e.jsxs(y,{onClick:()=>m(!0),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Add Item"]})]})]}),e.jsx(H,{children:e.jsxs(ds,{defaultValue:"all",value:w,onValueChange:$,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs(cs,{className:"grid-cols-auto",children:[e.jsx(ge,{value:"all",children:"All"}),i.map(o=>e.jsx(ge,{value:o,children:o.charAt(0).toUpperCase()+o.slice(1)},o))]})}),e.jsx(pe,{value:"all",className:"mt-0",children:e.jsx(Ms,{items:p,loading:d,onEdit:D,onDelete:I,emptyMessage:"No personal file items found",emptyDescription:"Add items to build a comprehensive performance record."})}),i.map(o=>e.jsx(pe,{value:o,className:"mt-0",children:e.jsx(Ms,{items:p,loading:d,onEdit:D,onDelete:I,emptyMessage:`No ${o} items found`,emptyDescription:`Items categorized as ${o} will appear here.`})},o))]})}),e.jsx(ue,{open:v,onOpenChange:o=>{m(o),o||N(null)},children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsx(_e,{children:e.jsx(De,{children:A?"Edit Personal File Item":"Add to Personal File"})}),e.jsx(Lt,{teamMemberId:a,initialData:A,onSubmit:E,onCancel:()=>{m(!1),N(null)}})]})})]})},Jt=({teamMemberId:a,year:r,showBreakdown:c=!1,showYearSelector:P=!1,onStatsChange:d,className:h=""})=>{const v=new Date().getFullYear(),[m,A]=n.useState(r||v),[N,w]=n.useState(null),[$,g]=n.useState(!0),[E,D]=n.useState(null),I=n.useMemo(()=>{const b=[];for(let f=0;f<3;f++)b.push(v-f);return b},[v]),B=async b=>{if(!a){w(null),g(!1);return}try{g(!0),D(null);const f=await te.getYearlyStats(a,b);w(f),d&&d(f)}catch(f){console.error("Failed to load out of office stats:",f),D(f.message),w(null)}finally{g(!1)}};n.useEffect(()=>{B(m)},[a,m]);const Y=b=>{A(parseInt(b))},p=b=>te.getReasonType(b)||{name:b,color:"#6b7280"},i=n.useMemo(()=>!N||!N.reasonBreakdown?[]:Object.entries(N.reasonBreakdown).map(([b,f])=>({reason:b,days:f,display:p(b)})).sort((b,f)=>f.days-b.days),[N]);if($)return e.jsxs(U,{className:`animate-pulse ${h}`,children:[e.jsx(K,{className:"pb-2",children:e.jsxs(X,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(H,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]})]});if(E)return e.jsxs(U,{className:`border-red-200 ${h}`,children:[e.jsx(K,{className:"pb-2",children:e.jsxs(X,{className:"text-sm font-medium text-red-600 flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(H,{children:[e.jsx("p",{className:"text-sm text-red-600",children:"Failed to load stats"}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>B(m),className:"mt-2",children:"Retry"})]})]});const o=N?.totalDays||0,O=m===v;return e.jsxs(U,{className:h,children:[e.jsx(K,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Out of Office Days"]}),P&&e.jsxs(G,{value:m.toString(),onValueChange:Y,children:[e.jsx(J,{className:"w-20 h-8 text-xs",children:e.jsx(Q,{})}),e.jsx(Z,{children:I.map(b=>e.jsx(u,{value:b.toString(),children:b},b))})]})]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:o}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[o===1?"day":"days"," in ",m,O&&e.jsx(q,{variant:"secondary",className:"ml-2 text-xs",children:"Current"})]})]}),c&&i.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(gt,{className:"h-3 w-3"}),"Breakdown"]}),e.jsx("div",{className:"space-y-1",children:i.map(({reason:b,days:f,display:j})=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:j.color}}),e.jsx("span",{children:j.name})]}),e.jsxs("span",{className:"font-medium",children:[f," ",f===1?"day":"days"]})]},b))})]}),o===0&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Oe,{className:"h-3 w-3"}),"No out of office periods in ",m]})]})})]})},Qs=pt,Qt=ft,Zt=yt,Zs=n.forwardRef(({className:a,...r},c)=>e.jsx(Bs,{className:ae("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:c}));Zs.displayName=Bs.displayName;const os=n.forwardRef(({className:a,...r},c)=>e.jsxs(Zt,{children:[e.jsx(Zs,{}),e.jsx($s,{ref:c,className:ae("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r})]}));os.displayName=$s.displayName;const ms=({className:a,...r})=>e.jsx("div",{className:ae("flex flex-col space-y-2 text-center sm:text-left",a),...r});ms.displayName="AlertDialogHeader";const xs=({className:a,...r})=>e.jsx("div",{className:ae("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...r});xs.displayName="AlertDialogFooter";const hs=n.forwardRef(({className:a,...r},c)=>e.jsx(Ls,{ref:c,className:ae("text-lg font-semibold",a),...r}));hs.displayName=Ls.displayName;const us=n.forwardRef(({className:a,...r},c)=>e.jsx(Rs,{ref:c,className:ae("text-sm text-muted-foreground",a),...r}));us.displayName=Rs.displayName;const js=n.forwardRef(({className:a,...r},c)=>e.jsx(zs,{ref:c,className:ae(Ws(),a),...r}));js.displayName=zs.displayName;const gs=n.forwardRef(({className:a,...r},c)=>e.jsx(Vs,{ref:c,className:ae(Ws({variant:"outline"}),"mt-2 sm:mt-0",a),...r}));gs.displayName=Vs.displayName;const Ps=({teamMemberId:a,initialData:r=null,onSubmit:c,onCancel:P,isLoading:d=!1})=>{const[h,v]=n.useState({start_date:"",end_date:"",reason:"",notes:""}),[m,A]=n.useState({}),[N,w]=n.useState([]),[$,g]=n.useState(!1),[E,D]=n.useState(!1),[I,B]=n.useState(!1);n.useEffect(()=>{r&&v({start_date:r.start_date||"",end_date:r.end_date||"",reason:r.reason||"",notes:r.notes||""})},[r]);const Y=te.getReasonTypes(),p=()=>{const j=te.validatePeriod(h.start_date,h.end_date,h.reason,a),_={};return j.errors.forEach(S=>{S.includes("Start date")?_.start_date=S:S.includes("End date")?_.end_date=S:S.includes("Reason")?_.reason=S:(S.includes("Team member"),_.general=S)}),A(_),j.isValid},i=async()=>{if(!(!h.start_date||!h.end_date||!a))try{const j=await te.checkOverlaps(a,h.start_date,h.end_date,r?.id);if(j.length>0){const _=j.map(S=>{const Pe=F(new Date(S.start_date),"MMM dd, yyyy"),Se=F(new Date(S.end_date),"MMM dd, yyyy");return`Overlaps with existing ${te.getReasonType(S.reason)?.name||S.reason} period (${Pe} - ${Se})`});w(_)}else w([])}catch(j){console.error("Error checking overlaps:",j)}},o=(j,_)=>{v(S=>({...S,[j]:_})),m[j]&&A(S=>({...S,[j]:""})),m.general&&A(S=>({...S,general:""}))},O=(j,_)=>{if(_){const S=F(_,"yyyy-MM-dd");o(j,S),j==="start_date"?D(!1):B(!1)}},b=async j=>{if(j.preventDefault(),!!p()){g(!0);try{await i();const _={...h,team_member_id:a,created_date:r?.created_date||new Date().toISOString(),updated_date:new Date().toISOString()};r?.id&&(_.id=r.id),c&&await c(_)}catch(_){console.error("Error submitting form:",_),A({general:"Failed to save out of office period. Please try again."})}finally{g(!1)}}};n.useEffect(()=>{h.start_date&&h.end_date&&i()},[h.start_date,h.end_date,a]);const f=d||$;return e.jsxs(U,{className:"w-full max-w-2xl",children:[e.jsx(K,{children:e.jsx(X,{children:r?"Edit Out of Office Period":"New Out of Office Period"})}),e.jsx(H,{children:e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[m.general&&e.jsx(Re,{variant:"destructive",children:e.jsx(Ve,{children:m.general})}),N.length>0&&e.jsx(Re,{children:e.jsx(Ve,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Warning: Period overlaps detected"}),N.map((j,_)=>e.jsx("p",{className:"text-sm",children:j},_))]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"start_date",children:"Start Date"}),e.jsxs(me,{open:E,onOpenChange:D,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:ae("w-full justify-start text-left font-normal",!h.start_date&&"text-muted-foreground",m.start_date&&"border-destructive"),disabled:f,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),h.start_date?F(new Date(h.start_date),"PPP"):e.jsx("span",{children:"Pick start date"})]})}),e.jsx(he,{className:"w-auto p-0",align:"start",children:e.jsx(de,{mode:"single",selected:h.start_date?new Date(h.start_date):void 0,onSelect:j=>O("start_date",j),disabled:j=>j<new Date(new Date().setHours(0,0,0,0)),initialFocus:!0})})]}),m.start_date&&e.jsx("p",{className:"text-sm text-destructive",children:m.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"end_date",children:"End Date"}),e.jsxs(me,{open:I,onOpenChange:B,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:ae("w-full justify-start text-left font-normal",!h.end_date&&"text-muted-foreground",m.end_date&&"border-destructive"),disabled:f,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),h.end_date?F(new Date(h.end_date),"PPP"):e.jsx("span",{children:"Pick end date"})]})}),e.jsx(he,{className:"w-auto p-0",align:"start",children:e.jsx(de,{mode:"single",selected:h.end_date?new Date(h.end_date):void 0,onSelect:j=>O("end_date",j),disabled:j=>{const _=new Date(new Date().setHours(0,0,0,0)),S=h.start_date?new Date(h.start_date):_;return j<Math.max(_,S)},initialFocus:!0})})]}),m.end_date&&e.jsx("p",{className:"text-sm text-destructive",children:m.end_date})]})]}),h.start_date&&h.end_date&&e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Duration: ",te.calculateDaysInPeriod(h.start_date,h.end_date)," days"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"reason",children:"Reason"}),e.jsxs(G,{value:h.reason,onValueChange:j=>o("reason",j),disabled:f,children:[e.jsx(J,{className:ae(m.reason&&"border-destructive"),children:e.jsx(Q,{placeholder:"Select a reason"})}),e.jsx(Z,{children:Y.map(j=>e.jsx(u,{value:j.value,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:j.color}}),e.jsx("span",{children:j.name})]})},j.value))})]}),m.reason&&e.jsx("p",{className:"text-sm text-destructive",children:m.reason})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(Js,{id:"notes",placeholder:"Add any additional notes...",value:h.notes,onChange:j=>o("notes",j.target.value),disabled:f,rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[P&&e.jsx(y,{type:"button",variant:"outline",onClick:P,disabled:f,children:"Cancel"}),e.jsx(y,{type:"submit",disabled:f,children:f?"Saving...":r?"Update":"Create"})]})]})})]})},Kt=({teamMemberId:a,teamMemberName:r})=>{const[c,P]=n.useState([]),[d,h]=n.useState([]),[v,m]=n.useState(!0),[A,N]=n.useState(""),[w,$]=n.useState("start_date"),[g,E]=n.useState("desc"),[D,I]=n.useState("all"),[B,Y]=n.useState("all"),[p,i]=n.useState(!1),[o,O]=n.useState(null),[b,f]=n.useState(null),j=te.getReasonTypes(),_=async()=>{try{m(!0),N("");const M=(await We.list()).filter(V=>V.team_member_id===a);P(M)}catch(x){console.error("Error loading periods:",x),N("Failed to load out of office periods. Please try again.")}finally{m(!1)}},S=x=>{const M=new Date,V=new Date(x.start_date),T=new Date(x.end_date);return M>=V&&M<=T},Pe=x=>{const M=new Date;return new Date(x.start_date)>M},Se=x=>S(x)?"active":Pe(x)?"upcoming":"past",ce=()=>{let x=[...c];D!=="all"&&(x=x.filter(M=>M.reason===D)),B!=="all"&&(x=x.filter(M=>Se(M)===B)),x.sort((M,V)=>{let T,z;switch(w){case"start_date":T=new Date(M.start_date),z=new Date(V.start_date);break;case"end_date":T=new Date(M.end_date),z=new Date(V.end_date);break;case"reason":T=M.reason,z=V.reason;break;case"duration":T=te.calculateDaysInPeriod(M.start_date,M.end_date),z=te.calculateDaysInPeriod(V.start_date,V.end_date);break;default:T=new Date(M.start_date),z=new Date(V.start_date)}return g==="asc"?T<z?-1:T>z?1:0:T>z?-1:T<z?1:0}),h(x)},Te=async x=>{try{await We.create(x),await _(),i(!1)}catch(M){throw console.error("Error creating period:",M),new Error("Failed to create out of office period")}},Ce=async x=>{try{await We.update(x.id,x),await _(),O(null)}catch(M){throw console.error("Error updating period:",M),new Error("Failed to update out of office period")}},ne=async x=>{try{await We.delete(x),await _(),f(null)}catch(M){console.error("Error deleting period:",M),N("Failed to delete out of office period. Please try again.")}},Ke=x=>{switch(x){case"active":return"destructive";case"upcoming":return"default";case"past":return"secondary";default:return"secondary"}},re=x=>te.getReasonType(x);return n.useEffect(()=>{a&&_()},[a]),n.useEffect(()=>{ce()},[c,w,g,D,B]),v?e.jsx(U,{children:e.jsx(H,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading out of office periods..."})})})}):e.jsxs(U,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("span",{children:"Out of Office Periods"}),r&&e.jsxs("span",{className:"text-muted-foreground",children:["- ",r]})]}),e.jsxs(ue,{open:p,onOpenChange:i,children:[e.jsx(Os,{asChild:!0,children:e.jsxs(y,{size:"sm",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Add Period"]})}),e.jsxs(je,{className:"max-w-2xl",children:[e.jsx(_e,{children:e.jsx(De,{children:"Create Out of Office Period"})}),e.jsx(Ps,{teamMemberId:a,onSubmit:Te,onCancel:()=>i(!1)})]})]})]})}),e.jsxs(H,{children:[A&&e.jsx(Re,{variant:"destructive",className:"mb-4",children:e.jsx(Ve,{children:A})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fs,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters:"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Reason:"}),e.jsxs(G,{value:D,onValueChange:I,children:[e.jsx(J,{className:"w-32",children:e.jsx(Q,{})}),e.jsxs(Z,{children:[e.jsx(u,{value:"all",children:"All"}),j.map(x=>e.jsx(u,{value:x.value,children:x.name},x.value))]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Status:"}),e.jsxs(G,{value:B,onValueChange:Y,children:[e.jsx(J,{className:"w-32",children:e.jsx(Q,{})}),e.jsxs(Z,{children:[e.jsx(u,{value:"all",children:"All"}),e.jsx(u,{value:"active",children:"Active"}),e.jsx(u,{value:"upcoming",children:"Upcoming"}),e.jsx(u,{value:"past",children:"Past"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:"Sort by:"}),e.jsxs(G,{value:w,onValueChange:$,children:[e.jsx(J,{className:"w-32",children:e.jsx(Q,{})}),e.jsxs(Z,{children:[e.jsx(u,{value:"start_date",children:"Start Date"}),e.jsx(u,{value:"end_date",children:"End Date"}),e.jsx(u,{value:"reason",children:"Reason"}),e.jsx(u,{value:"duration",children:"Duration"})]})]})]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>E(g==="asc"?"desc":"asc"),children:g==="asc"?e.jsx(Nt,{className:"h-4 w-4"}):e.jsx(vt,{className:"h-4 w-4"})})]}),d.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:c.length===0?'No out of office periods found. Click "Add Period" to create one.':"No periods match the current filters."}):e.jsx("div",{className:"space-y-4",children:d.map(x=>{const M=re(x.reason),V=Se(x),T=te.calculateDaysInPeriod(x.start_date,x.end_date);return e.jsx(U,{className:"border-l-4",style:{borderLeftColor:M?.color||"#6b7280"},children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:M?.color||"#6b7280"}}),e.jsx("span",{className:"font-medium",children:M?.name||x.reason})]}),e.jsx(q,{variant:Ke(V),children:V.charAt(0).toUpperCase()+V.slice(1)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Start:"})," ",F(new Date(x.start_date),"MMM dd, yyyy")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"End:"})," ",F(new Date(x.end_date),"MMM dd, yyyy")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",T," day",T!==1?"s":""]})]}),x.notes&&e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",x.notes]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsxs(ue,{open:o?.id===x.id,onOpenChange:z=>!z&&O(null),children:[e.jsx(Os,{asChild:!0,children:e.jsx(y,{variant:"outline",size:"sm",onClick:()=>O(x),children:e.jsx(Ze,{className:"h-4 w-4"})})}),e.jsxs(je,{className:"max-w-2xl",children:[e.jsx(_e,{children:e.jsx(De,{children:"Edit Out of Office Period"})}),e.jsx(Ps,{teamMemberId:a,initialData:o,onSubmit:Ce,onCancel:()=>O(null)})]})]}),e.jsxs(Qs,{open:b?.id===x.id,onOpenChange:z=>!z&&f(null),children:[e.jsx(Qt,{asChild:!0,children:e.jsx(y,{variant:"outline",size:"sm",onClick:()=>f(x),children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsxs(os,{children:[e.jsxs(ms,{children:[e.jsx(hs,{children:"Delete Out of Office Period"}),e.jsxs(us,{children:["Are you sure you want to delete this ",M?.name||x.reason," period from ",F(new Date(x.start_date),"MMM dd, yyyy")," to ",F(new Date(x.end_date),"MMM dd, yyyy"),"? This action cannot be undone."]})]}),e.jsxs(xs,{children:[e.jsx(gs,{children:"Cancel"}),e.jsx(js,{onClick:()=>ne(x.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})})},x.id)})})]})]})},Xt=[{value:"devops",label:"DevOps Duty"},{value:"on_call",label:"On-Call Duty"},{value:"other",label:"Other"}];function ea({duty:a=null,onSave:r,onCancel:c,teamMembers:P=[]}){const[d,h]=n.useState({team_member_id:"",type:"",title:"",description:"",start_date:"",end_date:""}),[v,m]=n.useState({}),[A,N]=n.useState([]),[w,$]=n.useState(!1),[g,E]=n.useState([]);n.useEffect(()=>{P.length===0?D():E(P)},[P]),n.useEffect(()=>{a&&h({team_member_id:a.team_member_id||"",type:a.type||"",title:a.title||"",description:a.description||"",start_date:a.start_date?a.start_date.split("T")[0]:"",end_date:a.end_date?a.end_date.split("T")[0]:""})},[a]);const D=async()=>{try{const i=await Ge.findAll();E(i)}catch(i){console.error("Failed to load team members:",i)}},I=(i,o)=>{h(O=>({...O,[i]:o})),v[i]&&m(O=>({...O,[i]:null}))},B=()=>{const i={};if(d.team_member_id||(i.team_member_id="Team member is required"),d.type||(i.type="Duty type is required"),d.title.trim()||(i.title="Title is required"),d.start_date||(i.start_date="Start date is required"),d.end_date||(i.end_date="End date is required"),d.start_date&&d.end_date){const o=new Date(d.start_date);new Date(d.end_date)<o&&(i.end_date="End date must be after start date")}return m(i),Object.keys(i).length===0},Y=async()=>{if(!d.team_member_id||!d.start_date||!d.end_date)return[];try{return await le.getConflicts(d.team_member_id,d.start_date,d.end_date,a?.id)}catch(i){return console.error("Failed to check for conflicts:",i),[]}},p=async i=>{if(i.preventDefault(),!!B()){$(!0);try{const o=await Y();if(N(o),o.length>0){$(!1);return}const O={...d,start_date:new Date(d.start_date).toISOString(),end_date:new Date(d.end_date).toISOString()};let b;a?b=await le.update(a.id,O):b=await le.create(O),r?.(b)}catch(o){console.error("Failed to save duty:",o),m({submit:o.message||"Failed to save duty"})}finally{$(!1)}}};return e.jsxs(U,{className:"w-full max-w-2xl",children:[e.jsx(K,{children:e.jsx(X,{children:a?"Edit Duty Assignment":"Create Duty Assignment"})}),e.jsx(H,{children:e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"team_member_id",children:"Team Member *"}),e.jsxs(G,{value:d.team_member_id,onValueChange:i=>I("team_member_id",i),children:[e.jsx(J,{children:e.jsx(Q,{placeholder:"Select team member"})}),e.jsx(Z,{children:g.map(i=>e.jsx(u,{value:i.id,children:i.name},i.id))})]}),v.team_member_id&&e.jsx("p",{className:"text-sm text-red-600",children:v.team_member_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"type",children:"Duty Type *"}),e.jsxs(G,{value:d.type,onValueChange:i=>I("type",i),children:[e.jsx(J,{children:e.jsx(Q,{placeholder:"Select duty type"})}),e.jsx(Z,{children:Xt.map(i=>e.jsx(u,{value:i.value,children:i.label},i.value))})]}),v.type&&e.jsx("p",{className:"text-sm text-red-600",children:v.type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"title",children:"Title *"}),e.jsx(be,{id:"title",value:d.title,onChange:i=>I("title",i.target.value),placeholder:"Enter duty title"}),v.title&&e.jsx("p",{className:"text-sm text-red-600",children:v.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"description",children:"Description"}),e.jsx(Js,{id:"description",value:d.description,onChange:i=>I("description",i.target.value),placeholder:"Enter duty description (optional)",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(be,{id:"start_date",type:"date",value:d.start_date,onChange:i=>I("start_date",i.target.value)}),v.start_date&&e.jsx("p",{className:"text-sm text-red-600",children:v.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"end_date",children:"End Date *"}),e.jsx(be,{id:"end_date",type:"date",value:d.end_date,onChange:i=>I("end_date",i.target.value)}),v.end_date&&e.jsx("p",{className:"text-sm text-red-600",children:v.end_date})]})]}),A.length>0&&e.jsx(Re,{className:"border-orange-200 bg-orange-50",children:e.jsxs(Ve,{children:[e.jsx("strong",{children:"Warning: Duty conflicts detected!"}),e.jsx("ul",{className:"mt-2 list-disc list-inside",children:A.map(i=>e.jsxs("li",{children:[i.title," (",new Date(i.start_date).toLocaleDateString()," - ",new Date(i.end_date).toLocaleDateString(),")"]},i.id))}),e.jsx("p",{className:"mt-2 text-sm",children:"Please adjust the dates or confirm if you want to proceed with overlapping duties."})]})}),v.submit&&e.jsx(Re,{className:"border-red-200 bg-red-50",children:e.jsx(Ve,{className:"text-red-800",children:v.submit})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:c,disabled:w,children:"Cancel"}),e.jsx(y,{type:"submit",disabled:w||A.length>0,children:w?"Saving...":a?"Update Duty":"Create Duty"})]})]})})]})}const Ts={devops:{label:"DevOps Duty",icon:bt,color:"bg-blue-100 text-blue-800 border-blue-200",badgeVariant:"secondary"},on_call:{label:"On-Call Duty",icon:wt,color:"bg-red-100 text-red-800 border-red-200",badgeVariant:"destructive"},other:{label:"Other Duty",icon:qe,color:"bg-gray-100 text-gray-800 border-gray-200",badgeVariant:"outline"}};function Es({duty:a,teamMember:r,onEdit:c,onDelete:P,showActions:d=!0,compact:h=!1}){const[v,m]=n.useState(!1),[A,N]=n.useState(!1);if(!a)return null;const w=Ts[a.type]||Ts.other,$=w.icon,g=new Date(a.start_date),E=new Date(a.end_date),D=new Date,I=D>=g&&D<=E,B=D>E,Y=f=>f.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),p=()=>{const f=Y(g),j=Y(E);return f===j?f:`${f} - ${j}`},i=()=>{const f=Math.abs(E-g),j=Math.ceil(f/(1e3*60*60*24))+1;if(j===1)return"1 day";if(j<7)return`${j} days`;if(j<30){const _=Math.floor(j/7),S=j%7;return S===0?`${_} week${_>1?"s":""}`:`${_}w ${S}d`}else{const _=Math.floor(j/30),S=j%30;return S===0?`${_} month${_>1?"s":""}`:`${_}m ${S}d`}},o=()=>I?e.jsx(q,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"}):B?e.jsx(q,{variant:"secondary",className:"bg-gray-100 text-gray-600",children:"Completed"}):e.jsx(q,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Upcoming"}),O=async()=>{N(!0);try{await P?.(a),m(!1)}catch(f){console.error("Failed to delete duty:",f)}finally{N(!1)}},b=()=>r?.name?r.name.split(" ").map(f=>f[0]).join("").toUpperCase().slice(0,2):"?";return h?e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-white hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($,{className:"h-4 w-4 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500",children:p()})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[o(),d&&e.jsxs(rs,{children:[e.jsx(ls,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(vs,{className:"h-4 w-4"})})}),e.jsxs(is,{align:"end",children:[e.jsxs(ke,{onClick:()=>c?.(a),children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(ke,{onClick:()=>m(!0),className:"text-red-600",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{className:`w-full ${I?"ring-2 ring-green-200":""}`,children:[e.jsx(K,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${w.color}`,children:e.jsx($,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx(X,{className:"text-lg",children:a.title}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(q,{variant:w.badgeVariant,children:w.label}),o()]})]})]}),d&&e.jsxs(rs,{children:[e.jsx(ls,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(vs,{className:"h-4 w-4"})})}),e.jsxs(is,{align:"end",children:[e.jsxs(ke,{onClick:()=>c?.(a),children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Edit Duty"]}),e.jsxs(ke,{onClick:()=>m(!0),className:"text-red-600",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Delete Duty"]})]})]})]})}),e.jsxs(H,{className:"space-y-4",children:[r&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(qs,{className:"h-8 w-8",children:e.jsx(Gs,{className:"text-sm",children:b()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(_t,{className:"h-3 w-3 mr-1"}),"Assigned Team Member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 flex items-center mb-1",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Duration"]}),e.jsx("p",{className:"font-medium",children:i()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Date Range"}),e.jsx("p",{className:"font-medium",children:p()})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),I&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round((D-g)/(E-g)*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(D-g)/(E-g)*100))}%`}})})]}),r&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsx(ns,{teamMemberId:r.id,teamMemberName:r.name,sourceItem:{title:`${w.label}: ${a.title}`,description:`${a.description||""} (${p()})`,type:"duty",id:a.id,start_date:a.start_date,end_date:a.end_date,duty_type:a.type},variant:"outline",size:"sm"})})]})]}),e.jsx(Qs,{open:v,onOpenChange:m,children:e.jsxs(os,{children:[e.jsxs(ms,{children:[e.jsx(hs,{children:"Delete Duty Assignment"}),e.jsxs(us,{children:['Are you sure you want to delete "',a.title,'"? This action cannot be undone.',I&&e.jsx("span",{className:"block mt-2 text-orange-600 font-medium",children:"Warning: This duty is currently active."})]})]}),e.jsxs(xs,{children:[e.jsx(gs,{disabled:A,children:"Cancel"}),e.jsx(js,{onClick:O,disabled:A,className:"bg-red-600 hover:bg-red-700",children:A?"Deleting...":"Delete Duty"})]})]})})]})}function Na(){const[a]=Ot(),r=a.get("id"),[c,P]=n.useState(null),[d,h]=n.useState([]),[v,m]=n.useState([]),[A,N]=n.useState([]),[w,$]=n.useState([]),[g,E]=n.useState([]),[D,I]=n.useState([]),[B,Y]=n.useState(null),[p,i]=n.useState([]),[o,O]=n.useState(!0),[b,f]=n.useState(!1),[j,_]=n.useState(!1),[S,Pe]=n.useState(null),[Se,ce]=n.useState(!1),[Te,Ce]=n.useState(null),[ne,Ke]=n.useState([]),[re,x]=n.useState({text:"",referenced_entity:{type:"team_member",id:""}}),[M,V]=n.useState(null),[T,z]=n.useState({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),[oe,ze]=n.useState({description:"",due_date:"",linked_task_id:"",linked_project_id:"",status:"open"}),[W,Xe]=n.useState("none"),[fe,Ee]=n.useState(""),[Ks,Be]=n.useState(null),[se,es]=n.useState(null),[Xs,Ue]=n.useState(!1),[ye,He]=n.useState("");n.useState(()=>{try{return JSON.parse(localStorage.getItem("discussedNotes")||"{}")}catch{return{}}}),n.useEffect(()=>{r&&ie()},[r]);const ie=async()=>{O(!0);try{const s=await Ge.get(r);P(s);const l=(await ve.list()).filter(Ie=>Ie.team_member_id===r);h(l);try{const Ie=await Ss.getAgendaItemsForMember(r);m(Ie)}catch(Ie){console.error("Error loading agenda items:",Ie),m([])}const C=await Pt.list(),R=await Tt.list();N(C),$(R),E(await Ge.list()),I(await Et.list());const Ne=await le.getByTeamMember(r);i(Ne),await et(l)}catch(s){console.error("Error loading team member data:",s)}finally{O(!1)}},et=async s=>{try{const t=s.filter(l=>l.next_meeting_date).sort((l,C)=>new Date(l.next_meeting_date)-new Date(C.next_meeting_date));if(t.length>0){const l=t[0];let C=null;if(l.next_meeting_calendar_event_id)try{C=(await Ae.getOneOnOneMeetingsForTeamMember(r)).find(Ne=>Ne.id===l.next_meeting_calendar_event_id)}catch(R){console.error("Error loading calendar event:",R)}es({oneOnOne:l,calendarEvent:C,hasCalendarEvent:!!C,meetingDate:l.next_meeting_date})}else es(null)}catch(t){console.error("Error loading next meeting info:",t),es(null)}},st=async()=>{try{const s=await ve.create({...T,notes:Array.isArray(T.notes)?T.notes:[],team_member_id:r});if(T.next_meeting_date&&c)try{const t=await Ae.createAndLinkOneOnOneMeeting(s.id,r,T.next_meeting_date);console.log("Calendar event created successfully:",t.calendarEvent)}catch(t){console.error("Error creating calendar event:",t)}f(!1),z({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),ie()}catch(s){console.error("Error creating 1:1 meeting:",s)}},tt=async()=>{if(S)try{const s={...S,action_items:[...S.action_items||[],oe]};await ve.update(S.id,s),_(!1),ie()}catch(s){console.error("Error adding action item:",s)}},at=async s=>{if(!re.text)return;let t=null;W!=="none"&&fe&&(t={type:W,id:fe});const l=d.find(Ne=>Ne.id===s);if(!l)return;const C={text:re.text,referenced_entity:t,created_by:r,timestamp:new Date().toISOString()},R=Array.isArray(l.notes)?[...l.notes,C]:[C];await ve.update(s,{...l,notes:R}),x({text:"",referenced_entity:{type:"team_member",id:""}}),V(null),ie()},ps=async(s,t,l)=>{try{const C=d.find(Ne=>Ne.id===s);if(!C)return;const R=[...C.action_items];R[t]={...R[t],status:l},await ve.update(s,{...C,action_items:R}),ie()}catch(C){console.error("Error updating action item status:",C)}},nt=async s=>{try{try{await Ae.unlinkCalendarEventFromOneOnOne(s)}catch(t){console.error("Error deleting associated calendar event:",t)}await ve.delete(s),ie()}catch(t){console.error("Error deleting meeting:",t)}},rt=async s=>{try{await Ss.markAgendaItemDiscussed(s.meetingId,s.timestamp)&&ie()}catch(t){console.error("Error marking agenda item as discussed:",t)}},Ye=async(s,t)=>{try{const l=d.find(R=>R.id===s);if(!l)return;const C={...l,next_meeting_date:t};if(await ve.update(s,C),t&&c)try{await Ae.updateOneOnOneCalendarEvent(s,t),console.log("Calendar event updated successfully for meeting:",s)}catch(R){console.error("Error updating calendar event:",R)}else if(!t&&l.next_meeting_calendar_event_id)try{await Ae.unlinkCalendarEventFromOneOnOne(s),console.log("Calendar event removed for meeting:",s)}catch(R){console.error("Error removing calendar event:",R)}ie()}catch(l){console.error("Error updating next meeting date:",l)}},lt=async()=>{if(!(!se||!ye))try{await Ye(se.oneOnOne.id,ye),Ue(!1),He("")}catch(s){console.error("Error rescheduling meeting:",s)}},it=async()=>{if(se)try{await Ye(se.oneOnOne.id,"")}catch(s){console.error("Error canceling meeting:",s)}},dt=()=>{Ce(null),ce(!0)},fs=s=>{Ce(s),ce(!0)},ct=async s=>{try{Te?await le.update(Te.id,s):await le.create(s),ce(!1),Ce(null);const t=await le.getByTeamMember(r);i(t),await ss()}catch(t){console.error("Error saving duty:",t)}},ys=async s=>{try{await le.delete(s.id);const t=await le.getByTeamMember(r);i(t),await ss()}catch(t){console.error("Error deleting duty:",t)}},ss=async()=>{try{const s=[];for(const t of p){const l=await le.getConflicts(t.team_member_id,t.start_date,t.end_date,t.id);l.length>0&&s.push({duty:t,conflicts:l})}Ke(s)}catch(s){console.error("Error checking duty conflicts:",s)}};if(n.useEffect(()=>{p.length>0&&ss()},[p]),o)return e.jsx("div",{className:"p-6",children:"Loading..."});if(!c)return e.jsx("div",{className:"p-6",children:"Team member not found"});const ot=s=>({open:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[s]||"bg-gray-100 text-gray-800",mt=s=>({great:"😄",good:"🙂",neutral:"😐",concerned:"😟"})[s]||"😐";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(kt,{to:"/team",children:e.jsxs(y,{variant:"ghost",children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Back to Team"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(qs,{className:"h-16 w-16",children:c.avatar?e.jsx(It,{src:c.avatar,alt:c.name}):e.jsx(Gs,{children:c.name.split(" ").map(s=>s[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:c.name}),e.jsx("p",{className:"text-gray-500",children:c.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(ds,{defaultValue:"meetings",className:"w-full",children:[e.jsxs(cs,{className:"grid grid-cols-3 mb-4",children:[e.jsxs(ge,{value:"meetings",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"1:1 Meetings"]}),e.jsxs(ge,{value:"agenda",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"1:1 Agenda"]}),e.jsxs(ge,{value:"personal-file",children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Personal File"]})]}),e.jsx(pe,{value:"meetings",className:"mt-0",children:e.jsxs(U,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(X,{children:"1:1 Meetings"}),e.jsxs(y,{onClick:()=>f(!0),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"New 1:1"]})]})}),e.jsx(H,{children:d.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ts,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No 1:1 meetings recorded yet"})]}):e.jsx("div",{className:"space-y-6",children:d.sort((s,t)=>new Date(t.date)-new Date(s.date)).map(s=>e.jsxs(U,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[F(L(s.date),"PPP"),e.jsx("span",{className:"text-xl",children:mt(s.mood)})]}),e.jsx(Ds,{className:"flex items-center gap-2",children:Ks===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Next meeting:"}),e.jsxs(me,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(y,{variant:"outline",size:"sm",className:"h-8 text-xs",children:[e.jsx(ee,{className:"mr-1 h-3 w-3"}),s.next_meeting_date?F(L(s.next_meeting_date),"MMM d"):"Select date"]})}),e.jsx(he,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:s.next_meeting_date?L(s.next_meeting_date):void 0,onSelect:t=>{const l=t?.toISOString()||"";Ye(s.id,l),Be(null)}})})]}),e.jsx(y,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>Be(null),children:"Cancel"}),s.next_meeting_date&&e.jsx(y,{variant:"ghost",size:"sm",className:"h-8 px-2 text-red-500",onClick:()=>{Ye(s.id,""),Be(null)},children:"Clear"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Next meeting: ",s.next_meeting_date?F(L(s.next_meeting_date),"PPP"):"Not scheduled"]}),e.jsx(y,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>Be(s.id),children:"Edit"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>{Pe(s),_(!0)},children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Add Action Item"]}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>nt(s.id),title:"Delete meeting",children:e.jsx(Le,{className:"h-5 w-5 text-red-500"})})]})]})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[Array.isArray(s.notes)&&s.notes.filter(t=>!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(r)).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),e.jsx("ul",{className:"list-disc pl-5",children:s.notes.filter(t=>!t.referenced_entity||!t.referenced_entity.id||String(t.referenced_entity.id)!==String(r)).map((t,l)=>e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{children:t.text}),t.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[t.referenced_entity.type==="team_member"&&g.find(C=>String(C.id)===String(t.referenced_entity.id))?.name,t.referenced_entity.type==="stakeholder"&&D.find(C=>String(C.id)===String(t.referenced_entity.id))?.name,t.referenced_entity.type==="project"&&w.find(C=>String(C.id)===String(t.referenced_entity.id))?.name]}),e.jsx("div",{className:"mt-1",children:e.jsx(ns,{teamMemberId:r,teamMemberName:c.name,sourceItem:{title:`Note from 1:1 on ${F(L(s.date),"MMM d, yyyy")}`,description:t.text,type:"note",id:`note-${s.id}-${l}`},variant:"ghost",size:"xs"})})]},l))})]}),e.jsxs("div",{className:"mt-2 flex gap-2 items-end",children:[e.jsx(be,{className:"flex-1",placeholder:"Note text...",value:M===s.id?re.text:"",onChange:t=>{V(s.id),x(l=>({...l,text:t.target.value}))}}),e.jsxs(G,{value:M===s.id?W:"none",onValueChange:t=>{V(s.id),Xe(t),Ee(""),x(l=>({...l,referenced_entity:t==="none"?null:{type:t,id:""}}))},children:[e.jsx(J,{className:"w-32",children:e.jsx(Q,{placeholder:"No tag"})}),e.jsxs(Z,{children:[e.jsx(u,{value:"none",children:"No tag"}),e.jsx(u,{value:"team_member",children:"Team Members"}),e.jsx(u,{value:"stakeholder",children:"Stakeholders"}),e.jsx(u,{value:"project",children:"Projects"})]})]}),W!=="none"&&M===s.id&&e.jsxs(G,{value:fe,onValueChange:t=>{Ee(t),x(l=>({...l,referenced_entity:{type:W,id:t}}))},children:[e.jsx(J,{className:"w-40",children:e.jsx(Q,{placeholder:"Select name"})}),e.jsxs(Z,{children:[W==="team_member"&&g.filter(t=>t.id.toString()!==r?.toString()).map(t=>e.jsx(u,{value:t.id,children:t.name},t.id)),W==="stakeholder"&&D.map(t=>e.jsx(u,{value:t.id,children:t.name},t.id)),W==="project"&&w.map(t=>e.jsx(u,{value:t.id,children:t.name},t.id))]})]}),e.jsx(y,{onClick:()=>{V(s.id),at(s.id)},disabled:!re.text||W!=="none"&&!fe||M!==s.id,children:"Add"})]}),s.topics_discussed?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Topics Discussed"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.topics_discussed.map((t,l)=>e.jsx(q,{variant:"secondary",children:t},l))})]}),s.action_items?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Action Items"}),e.jsxs(Vt,{children:[e.jsx(zt,{children:e.jsxs(ks,{children:[e.jsx(Fe,{children:"Description"}),e.jsx(Fe,{children:"Due Date"}),e.jsx(Fe,{children:"Status"}),e.jsx(Fe,{children:"Links"}),e.jsx(Fe,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Bt,{children:s.action_items.map((t,l)=>e.jsxs(ks,{children:[e.jsx($e,{children:t.description}),e.jsx($e,{children:t.due_date?F(L(t.due_date),"MMM d, yyyy"):"No due date"}),e.jsx($e,{children:e.jsx(q,{className:ot(t.status),children:t.status})}),e.jsx($e,{children:(t.linked_task_id||t.linked_project_id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[t.linked_task_id&&e.jsxs(q,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(ws,{className:"h-3 w-3"}),"Task"]}),t.linked_project_id&&e.jsxs(q,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(ws,{className:"h-3 w-3"}),"Project"]})]})}),e.jsx($e,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>ps(s.id,l,"completed"),disabled:t.status==="completed",children:e.jsx(bs,{className:"h-4 w-4 text-green-500"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>ps(s.id,l,"in_progress"),disabled:t.status==="in_progress",children:e.jsx(Oe,{className:"h-4 w-4 text-blue-500"})}),e.jsx(ns,{teamMemberId:r,teamMemberName:c.name,sourceItem:{title:`Action Item: ${t.description}`,description:`Due date: ${t.due_date?F(L(t.due_date),"MMM d, yyyy"):"None"}
Status: ${t.status}`,type:"action_item",id:`action-${s.id}-${l}`},variant:"ghost",size:"sm"})]})})]},l))})]})]})]})})]},s.id))})})]})}),e.jsx(pe,{value:"agenda",className:"mt-0",children:e.jsx(Ut,{teamMemberId:r,teamMemberName:c?.name})}),e.jsx(pe,{value:"personal-file",className:"mt-0",children:e.jsx(Gt,{teamMemberId:r,teamMemberName:c?.name})})]}),e.jsx(Kt,{teamMemberId:r,teamMemberName:c?.name}),e.jsxs(U,{children:[e.jsxs(K,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"Duty Assignments"]}),e.jsxs(y,{onClick:dt,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Assign Duty"]})]}),ne.length>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[ne.length," duty conflict",ne.length>1?"s":""," detected"]})]})})]}),e.jsx(H,{children:p.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(qe,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No duty assignments yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Assign DevOps duties, on-call responsibilities, or other duties"})]}):e.jsxs("div",{className:"space-y-4",children:[p.filter(s=>{const t=new Date,l=new Date(s.start_date),C=new Date(s.end_date);return t>=l&&t<=C}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Active Duties"]}),e.jsx("div",{className:"space-y-3",children:p.filter(s=>{const t=new Date,l=new Date(s.start_date),C=new Date(s.end_date);return t>=l&&t<=C}).map(s=>e.jsx(Es,{duty:s,teamMember:c,onEdit:fs,onDelete:ys,compact:!0},s.id))})]}),p.filter(s=>{const t=new Date,l=new Date(s.start_date);return t<l}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Upcoming Duties"]}),e.jsx("div",{className:"space-y-3",children:p.filter(s=>{const t=new Date,l=new Date(s.start_date);return t<l}).sort((s,t)=>new Date(s.start_date)-new Date(t.start_date)).map(s=>e.jsx(Es,{duty:s,teamMember:c,onEdit:fs,onDelete:ys,compact:!0},s.id))})]}),p.filter(s=>{const t=new Date,l=new Date(s.end_date);return t>l}).length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(St,{className:"h-4 w-4"}),"Past Duties (",p.filter(s=>{const t=new Date,l=new Date(s.end_date);return t>l}).length,")"]}),e.jsxs("div",{className:"space-y-2",children:[p.filter(s=>{const t=new Date,l=new Date(s.end_date);return t>l}).sort((s,t)=>new Date(t.end_date)-new Date(s.end_date)).slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qe,{className:"h-3 w-3 text-gray-500"}),e.jsx("span",{className:"text-sm",children:s.title}),e.jsx(q,{variant:"secondary",className:"text-xs",children:s.type==="devops"?"DevOps":s.type==="on_call"?"On-Call":"Other"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:F(L(s.end_date),"MMM d, yyyy")})]},s.id)),p.filter(s=>{const t=new Date,l=new Date(s.end_date);return t>l}).length>3&&e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-2",children:["Showing 3 of ",p.filter(s=>{const t=new Date,l=new Date(s.end_date);return t>l}).length," past duties"]})]})]}),ne.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_s,{className:"h-4 w-4 text-orange-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-orange-800 text-sm",children:"Duty Conflicts Detected"}),e.jsx("div",{className:"mt-2 space-y-2",children:ne.map(({duty:s,conflicts:t})=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-orange-700",children:[e.jsx("strong",{children:s.title})," conflicts with:"]}),e.jsx("ul",{className:"list-disc list-inside ml-4 text-orange-600",children:t.map(l=>e.jsxs("li",{children:[l.title," (",F(L(l.start_date),"MMM d")," - ",F(L(l.end_date),"MMM d"),")"]},l.id))})]},s.id))})]})]})})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(U,{children:[e.jsx(K,{children:e.jsx(X,{children:"Team Member Info"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[c.department&&e.jsxs("div",{children:[e.jsx(k,{children:"Department"}),e.jsx("p",{className:"text-gray-600",children:c.department})]}),c.skills?.length>0&&e.jsxs("div",{children:[e.jsx(k,{children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:c.skills.map((s,t)=>e.jsx(q,{variant:"secondary",children:s},t))})]}),c.notes&&e.jsxs("div",{children:[e.jsx(k,{children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:c.notes})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Birthday"}),e.jsxs(me,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),c.birthday?F(L(c.birthday),"PPP"):"Set birthday"]})}),e.jsx(he,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:c.birthday?L(c.birthday):void 0,onSelect:async s=>{if(!s)return;const t=s.toISOString(),l={...c};try{const C=await Ge.update(c.id,{birthday:t});P(R=>({...R,birthday:t}));try{await Ft.handleTeamMemberUpdate(c.id,C,l)}catch(R){console.error("Failed to update birthday events:",R)}}catch(C){console.error("Failed to update birthday:",C)}}})})]})]})]})})]}),e.jsx(Jt,{teamMemberId:r,showBreakdown:!0,showYearSelector:!0,onStatsChange:Y}),e.jsxs(U,{children:[e.jsx(K,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Next 1:1 Meeting"]})}),e.jsx(H,{children:se?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Scheduled Date"}),e.jsx("p",{className:"text-gray-900 font-medium",children:F(L(se.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:se.hasCalendarEvent?e.jsxs(q,{variant:"outline",className:"text-green-700 border-green-200 bg-green-50",children:[e.jsx(bs,{className:"h-3 w-3 mr-1"}),"Calendar Event Created"]}):e.jsxs(q,{variant:"outline",className:"text-yellow-700 border-yellow-200 bg-yellow-50",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"}),"No Calendar Event"]})})]}),se.calendarEvent&&e.jsxs("div",{children:[e.jsx(k,{children:"Calendar Event"}),e.jsx("p",{className:"text-sm text-gray-600",children:se.calendarEvent.title})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>{He(se.meetingDate),Ue(!0)},children:[e.jsx(Oe,{className:"h-4 w-4 mr-1"}),"Reschedule"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:it,className:"text-red-600 hover:text-red-700",children:[e.jsx(At,{className:"h-4 w-4 mr-1"}),"Cancel"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsx(y,{variant:"outline",size:"sm",onClick:async()=>{try{console.log("Starting duplicate cleanup...");const s=await Ae.cleanupAllDuplicateEvents();console.log("Cleanup results:",s),alert(`Cleanup completed! Removed ${s.totalCleaned} duplicate events.`),ie()}catch(s){console.error("Cleanup failed:",s),alert("Cleanup failed. Check console for details.")}},className:"text-blue-600 hover:text-blue-700",children:"🧹 Clean Duplicates"})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ee,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No upcoming 1:1 scheduled"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Schedule your next meeting from any 1:1 record"})]})})]}),e.jsxs(U,{children:[e.jsx(K,{children:e.jsx(X,{children:"Quick Stats"})}),e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Last 1:1"}),e.jsx("p",{className:"text-gray-600",children:d[0]?F(L(d[0].date),"PPP"):"No meetings yet"})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Meeting Frequency"}),e.jsx("p",{className:"text-gray-600",children:d.length>1?(()=>{const s=d.filter(l=>l.date).sort((l,C)=>new Date(C.date)-new Date(l.date));if(s.length<2)return"Insufficient data";const t=Math.round((new Date(s[0].date)-new Date(s[1].date))/(1e3*60*60*24));return t<=10?"Weekly":t<=20?"Bi-weekly":t<=35?"Monthly":"Irregular"})():"No pattern yet"})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Open Action Items"}),e.jsx("p",{className:"text-gray-600",children:d.reduce((s,t)=>s+(t.action_items?.filter(l=>l.status!=="completed").length||0),0)})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Agenda Items"}),e.jsxs("p",{className:"text-gray-600",children:[v.length," total, ",v.filter(s=>!s.isDiscussed).length," pending"]})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Total 1:1s"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:d.length}),d.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(since ",F(L(d[d.length-1].date),"MMM yyyy"),")"]})]})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Current Duties"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:p.filter(s=>{const t=new Date,l=new Date(s.start_date),C=new Date(s.end_date);return t>=l&&t<=C}).length}),ne.length>0&&e.jsxs(q,{variant:"destructive",className:"text-xs",children:[ne.length," conflict",ne.length>1?"s":""]})]})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Total Duties"}),e.jsx("p",{className:"text-gray-600",children:p.length})]})]})})]}),e.jsxs(U,{children:[e.jsxs(K,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"Next Agenda Items"]}),e.jsx(Ds,{children:"Items from other meetings where you are tagged"})]}),e.jsxs(H,{children:[v.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(ts,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No agenda items yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You'll see items here when others tag you in their meeting notes"})]}):e.jsx(Je,{agendaItems:v.slice(0,5),teamMembers:g.reduce((s,t)=>(s[t.id]=t,s),{}),onMarkDiscussed:rt,showActions:!0,emptyMessage:"No agenda items found"}),v.length>5&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Showing 5 of ",v.length," items"]})})]})]})]})]})]}),e.jsx(ue,{open:b,onOpenChange:f,children:e.jsxs(je,{className:"sm:max-w-lg",children:[e.jsx(_e,{children:e.jsx(De,{children:"New 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Date"}),e.jsxs(me,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),T.date?F(L(T.date),"PPP"):"Select date"]})}),e.jsx(he,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:T.date?L(T.date):void 0,onSelect:s=>z(t=>({...t,date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Mood"}),e.jsxs(G,{value:T.mood,onValueChange:s=>z(t=>({...t,mood:s})),children:[e.jsx(J,{children:e.jsx(Q,{})}),e.jsxs(Z,{children:[e.jsx(u,{value:"great",children:"Great 😄"}),e.jsx(u,{value:"good",children:"Good 🙂"}),e.jsx(u,{value:"neutral",children:"Neutral 😐"}),e.jsx(u,{value:"concerned",children:"Concerned 😟"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Notes"}),Array.isArray(T.notes)&&T.notes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mb-2",children:T.notes.map((s,t)=>e.jsxs("li",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{children:s.text}),s.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[s.referenced_entity.type==="team_member"&&g.find(l=>l.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="stakeholder"&&D.find(l=>l.id===s.referenced_entity.id)?.name,s.referenced_entity.type==="project"&&w.find(l=>l.id===s.referenced_entity.id)?.name]}),e.jsx(y,{variant:"ghost",size:"xs",className:"ml-2",onClick:()=>z(l=>({...l,notes:l.notes.filter((C,R)=>R!==t)})),children:"Remove"})]},t))}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(be,{className:"flex-1",placeholder:"Note text...",value:re.text,onChange:s=>x(t=>({...t,text:s.target.value}))}),e.jsxs(G,{value:W,onValueChange:s=>{Xe(s),Ee(""),x(t=>({...t,referenced_entity:{type:s,id:""}}))},children:[e.jsx(J,{className:"w-32",children:e.jsx(Q,{placeholder:"No tag"})}),e.jsxs(Z,{children:[e.jsx(u,{value:"none",children:"No tag"}),e.jsx(u,{value:"team_member",children:"Team Members"}),e.jsx(u,{value:"stakeholder",children:"Stakeholders"}),e.jsx(u,{value:"project",children:"Projects"})]})]}),W!=="none"&&e.jsxs(G,{value:fe,onValueChange:s=>{Ee(s),x(t=>({...t,referenced_entity:{type:W,id:s}}))},children:[e.jsx(J,{className:"w-40",children:e.jsx(Q,{placeholder:"Select name"})}),e.jsxs(Z,{children:[W==="team_member"&&g.filter(s=>s.id!==r).map(s=>e.jsx(u,{value:s.id,children:s.name},s.id)),W==="stakeholder"&&D.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id)),W==="project"&&w.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id))]})]}),e.jsx(y,{onClick:()=>{re.text&&(z(s=>({...s,notes:[...Array.isArray(s.notes)?s.notes:[],{text:re.text,referenced_entity:W==="none"?{}:{type:W,id:fe},created_by:r,timestamp:new Date().toISOString()}]})),x({text:"",referenced_entity:{type:"team_member",id:""}}),Xe("none"),Ee(""))},disabled:!re.text||W!=="none"&&!fe,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Next Meeting Date"}),e.jsxs(me,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),T.next_meeting_date?F(L(T.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(he,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:T.next_meeting_date?L(T.next_meeting_date):void 0,onSelect:s=>z(t=>({...t,next_meeting_date:s?.toISOString()}))})})]})]})]}),e.jsxs(as,{children:[e.jsx(y,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(y,{onClick:st,children:"Create Meeting"})]})]})}),e.jsx(ue,{open:j,onOpenChange:_,children:e.jsxs(je,{className:"sm:max-w-lg",children:[e.jsx(_e,{children:e.jsx(De,{children:"Add Action Item"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Description"}),e.jsx(be,{value:oe.description,onChange:s=>ze(t=>({...t,description:s.target.value})),placeholder:"What needs to be done?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Due Date"}),e.jsxs(me,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),oe.due_date?F(L(oe.due_date),"PPP"):"Set due date"]})}),e.jsx(he,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:oe.due_date?L(oe.due_date):void 0,onSelect:s=>ze(t=>({...t,due_date:s?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Link to Task (Optional)"}),e.jsxs(G,{value:oe.linked_task_id,onValueChange:s=>ze(t=>({...t,linked_task_id:s})),children:[e.jsx(J,{children:e.jsx(Q,{placeholder:"Select a task"})}),e.jsxs(Z,{children:[e.jsx(u,{value:null,children:"None"}),A.map(s=>e.jsx(u,{value:s.id,children:s.title},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Link to Project (Optional)"}),e.jsxs(G,{value:oe.linked_project_id,onValueChange:s=>ze(t=>({...t,linked_project_id:s})),children:[e.jsx(J,{children:e.jsx(Q,{placeholder:"Select a project"})}),e.jsxs(Z,{children:[e.jsx(u,{value:null,children:"None"}),w.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs(as,{children:[e.jsx(y,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsx(y,{onClick:tt,children:"Add Action Item"})]})]})}),e.jsx(ue,{open:Xs,onOpenChange:Ue,children:e.jsxs(je,{className:"sm:max-w-lg",children:[e.jsx(_e,{children:e.jsx(De,{children:"Reschedule Next 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Current Date"}),e.jsx("p",{className:"text-sm text-gray-600",children:se&&F(L(se.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"New Date"}),e.jsxs(me,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),ye?F(L(ye),"PPP"):"Select new date"]})}),e.jsx(he,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:ye?L(ye):void 0,onSelect:s=>He(s?.toISOString()||"")})})]})]})]}),e.jsxs(as,{children:[e.jsx(y,{variant:"outline",onClick:()=>{Ue(!1),He("")},children:"Cancel"}),e.jsx(y,{onClick:lt,disabled:!ye,children:"Reschedule Meeting"})]})]})}),e.jsx(ue,{open:Se,onOpenChange:ce,children:e.jsx(je,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:e.jsx(ea,{duty:Te,teamMembers:g,onSave:ct,onCancel:()=>{ce(!1),Ce(null)}})})})]})}export{Na as default};
