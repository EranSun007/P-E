import{j as t,_ as X,aX as Q}from"./chunk-CDfVSsCp.js";import{a as j}from"./chunk-pjYta8vt.js";import{m as J,L as f,I as B,B as C}from"./index-CjGPc2b_.js";import{S as L,a as M,b as O,c as R,d as x,D,e as k,f as $,g as Y}from"./chunk-2Vqr1Avx.js";import{T as V}from"./chunk-BRoLf8OO.js";import{R as W,a as U}from"./chunk-CIxmFPsL.js";import{q as _}from"./chunk-DGzW4aIb.js";const Z={text:(e,s=255)=>!(typeof e!="string"||e.length>s||e.trim().length===0),email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),url:e=>{try{return new URL(e),!0}catch{return!1}},array:(e,s=100)=>!(!Array.isArray(e)||e.length>s),required:e=>e==null?!1:typeof e=="string"?e.trim().length>0:Array.isArray(e)?e.length>0:!0},K="audit_logs",z=()=>{try{return J.getStoredToken()?.username||null}catch(e){return console.warn("Unable to get current user for audit log:",e),null}},ee=()=>{try{const e=localStorage.getItem(K);return e?JSON.parse(e):[]}catch(e){return console.error("Error reading audit logs:",e),[]}},te=e=>{try{localStorage.setItem(K,JSON.stringify(e))}catch(s){console.error("Error saving audit logs:",s)}},I=(e,s,r,n={})=>{const i=z();if(!i){console.warn("Cannot create audit log: no authenticated user");return}const a={id:crypto.randomUUID?crypto.randomUUID():`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:new Date().toISOString(),user:i,action:e,resource:s,resourceId:r,metadata:n,userAgent:navigator.userAgent,ipAddress:"localhost"},l=ee();l.unshift(a),l.length>1e3&&l.splice(1e3),te(l)},S={CREATE:"CREATE",READ:"READ",UPDATE:"UPDATE",DELETE:"DELETE"},A={PERSONAL_FILE_ITEM:"PERSONAL_FILE_ITEM"};function d(e){try{const s=localStorage.getItem(e);return s?JSON.parse(s):[]}catch(s){return console.error(`Error reading data from localStorage key "${e}":`,s),[]}}function b(e,s){try{if(!Z.array(s))throw new Error("Invalid data format - must be an array");localStorage.setItem(e,JSON.stringify(s))}catch(r){throw console.error(`Error saving data to localStorage key "${e}":`,r),r}}function q(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"_"+Date.now().toString(36)+Math.random().toString(36).substr(2,9)}function re(){try{return J.getStoredToken()?.username||null}catch(e){return console.warn("Unable to get current user:",e),null}}function v(e,s,r=null){const n=re();if(!n)throw new Error("Access denied: User not authenticated");if(r&&r.createdBy&&r.createdBy!==n)throw new Error("Access denied: You can only access your own personal file items");return n}const p={entities:{AgendaItem:{async list(){return d("agenda_items")},async get(e){return d("agenda_items").find(r=>r.id===e)||null},async create(e){const s=d("agenda_items"),r={...e,id:q(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:e.status||"pending",priority:e.priority||2,tags:e.tags||[]};return s.unshift(r),b("agenda_items",s),r},async update(e,s){const r=d("agenda_items"),n=r.findIndex(i=>i.id===e);if(n!==-1)return r[n]={...r[n],...s,updatedAt:new Date().toISOString()},b("agenda_items",r),r[n];throw new Error("AgendaItem not found")},async delete(e){let s=d("agenda_items");return s=s.filter(r=>r.id!==e),b("agenda_items",s),!0},async getByTeamMember(e){return d("agenda_items").filter(r=>r.teamMemberId===e)},async getByStatus(e){return d("agenda_items").filter(r=>r.status===e)},async getForNextMeeting(e){return d("agenda_items").filter(r=>r.teamMemberId===e&&r.status==="pending")}},PersonalFileItem:{async list(){const e=v(),r=d("personal_file_items").filter(n=>n.createdBy===e);return I(S.READ,A.PERSONAL_FILE_ITEM,"all",{operation:"list",itemCount:r.length}),r},async get(e){const s=v(),n=d("personal_file_items").find(i=>i.id===e);if(!n)return null;if(n.createdBy!==s)throw new Error("Access denied: You can only access your own personal file items");return I(S.READ,A.PERSONAL_FILE_ITEM,e,{operation:"get",teamMemberId:n.teamMemberId}),n},async create(e){const s=v(),r=d("personal_file_items"),n={...e,id:q(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),createdBy:s,category:e.category||"general",tags:e.tags||[],importance:e.importance||3};return r.unshift(n),b("personal_file_items",r),I(S.CREATE,A.PERSONAL_FILE_ITEM,n.id,{operation:"create",teamMemberId:n.teamMemberId,category:n.category,importance:n.importance}),n},async update(e,s){const r=v(),n=d("personal_file_items"),i=n.findIndex(g=>g.id===e);if(i===-1)throw new Error("PersonalFileItem not found");const a=n[i];if(a.createdBy!==r)throw new Error("Access denied: You can only update your own personal file items");const l={...a,...s,updatedAt:new Date().toISOString(),createdBy:a.createdBy};return n[i]=l,b("personal_file_items",n),I(S.UPDATE,A.PERSONAL_FILE_ITEM,e,{operation:"update",teamMemberId:l.teamMemberId,changes:Object.keys(s)}),l},async delete(e){const s=v();let r=d("personal_file_items");const n=r.find(i=>i.id===e);if(!n)throw new Error("PersonalFileItem not found");if(n.createdBy!==s)throw new Error("Access denied: You can only delete your own personal file items");return r=r.filter(i=>i.id!==e),b("personal_file_items",r),I(S.DELETE,A.PERSONAL_FILE_ITEM,e,{operation:"delete",teamMemberId:n.teamMemberId,category:n.category}),!0},async getByTeamMember(e){const s=v(),n=d("personal_file_items").filter(i=>i.teamMemberId===e&&i.createdBy===s);return I(S.READ,A.PERSONAL_FILE_ITEM,"team_member",{operation:"getByTeamMember",teamMemberId:e,itemCount:n.length}),n},async getByCategory(e){const s=v(),n=d("personal_file_items").filter(i=>i.category===e&&i.createdBy===s);return I(S.READ,A.PERSONAL_FILE_ITEM,"category",{operation:"getByCategory",category:e,itemCount:n.length}),n},async searchByTags(e){if(!Array.isArray(e)||e.length===0)return[];const s=v(),n=d("personal_file_items").filter(i=>i.createdBy===s&&i.tags&&i.tags.some(a=>e.includes(a)));return I(S.READ,A.PERSONAL_FILE_ITEM,"tags",{operation:"searchByTags",tags:e,itemCount:n.length}),n}}}},G={async list(){return p.entities.AgendaItem.list()},async create(e){return p.entities.AgendaItem.create(e)},async update(e,s){return p.entities.AgendaItem.update(e,s)},async delete(e){return p.entities.AgendaItem.delete(e)},async getByTeamMember(e){return p.entities.AgendaItem.getByTeamMember(e)},async getByStatus(e){return p.entities.AgendaItem.getByStatus(e)},async getForNextMeeting(e){return p.entities.AgendaItem.getForNextMeeting(e)}},H={async list(){return p.entities.PersonalFileItem.list()},async create(e){return p.entities.PersonalFileItem.create(e)},async update(e,s){return p.entities.PersonalFileItem.update(e,s)},async delete(e){return p.entities.PersonalFileItem.delete(e)},async getByTeamMember(e){return p.entities.PersonalFileItem.getByTeamMember(e)},async getByCategory(e){return p.entities.PersonalFileItem.getByCategory(e)},async searchByTags(e){return p.entities.PersonalFileItem.searchByTags(e)}},se=({teamMemberId:e,onSubmit:s,initialData:r=null,sourceItem:n=null,onCancel:i})=>{const[a,l]=j.useState({title:"",description:"",priority:"2",tags:""}),[g,w]=j.useState(!1),[m,E]=j.useState({});j.useEffect(()=>{r?l({title:r.title||"",description:r.description||"",priority:r.priority?.toString()||"2",tags:Array.isArray(r.tags)?r.tags.join(", "):""}):n&&l({title:n.title||"",description:n.description||n.text||"",priority:"2",tags:""})},[r,n]);const y=o=>{const{name:c,value:h}=o.target;l(u=>({...u,[c]:h})),m[c]&&E(u=>({...u,[c]:null}))},T=o=>{l(c=>({...c,priority:o}))},N=()=>{const o={};return a.title.trim()||(o.title="Title is required"),E(o),Object.keys(o).length===0},F=async o=>{if(o.preventDefault(),!!N()){w(!0);try{const c=a.tags?a.tags.split(",").map(P=>P.trim()).filter(Boolean):[],h={teamMemberId:e,title:a.title.trim(),description:a.description.trim(),priority:parseInt(a.priority,10),tags:c,status:"pending"};let u;r?.id?(u=await G.update(r.id,h),_.success("Agenda item updated successfully")):(u=await G.create(h),_.success("Agenda item added to next 1:1 meeting")),r||l({title:"",description:"",priority:"2",tags:""}),s&&s(u)}catch(c){console.error("Error saving agenda item:",c),_.error("Failed to save agenda item")}finally{w(!1)}}};return t.jsxs("form",{onSubmit:F,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{htmlFor:"title",children:"Title"}),t.jsx(B,{id:"title",name:"title",value:a.title,onChange:y,placeholder:"Enter agenda item title",className:m.title?"border-red-500":""}),m.title&&t.jsx("p",{className:"text-sm text-red-500",children:m.title})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{htmlFor:"description",children:"Description"}),t.jsx(V,{id:"description",name:"description",value:a.description,onChange:y,placeholder:"Enter details about this agenda item",rows:3})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{children:"Priority"}),t.jsxs(W,{value:a.priority,onValueChange:T,className:"flex space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{value:"1",id:"priority-high"}),t.jsx(f,{htmlFor:"priority-high",children:"High"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{value:"2",id:"priority-medium"}),t.jsx(f,{htmlFor:"priority-medium",children:"Medium"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(U,{value:"3",id:"priority-low"}),t.jsx(f,{htmlFor:"priority-low",children:"Low"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{htmlFor:"tags",children:"Tags (comma separated)"}),t.jsx(B,{id:"tags",name:"tags",value:a.tags,onChange:y,placeholder:"e.g. feedback, project-x, career"})]}),t.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[i&&t.jsx(C,{type:"button",variant:"outline",onClick:i,disabled:g,children:"Cancel"}),t.jsx(C,{type:"submit",disabled:g,children:g?"Saving...":r?"Update Item":"Add to Agenda"})]})]})},ne=({teamMemberId:e,onSubmit:s,initialData:r=null,sourceItem:n=null,onCancel:i})=>{const[a,l]=j.useState({title:"",notes:"",category:"achievement",tags:"",importance:"3"}),[g,w]=j.useState(!1),[m,E]=j.useState({});j.useEffect(()=>{r?l({title:r.title||"",notes:r.notes||"",category:r.category||"achievement",tags:Array.isArray(r.tags)?r.tags.join(", "):"",importance:r.importance?.toString()||"3"}):n&&l({title:n.title||"",notes:n.description||n.text||"",category:"achievement",tags:"",importance:"3"})},[r,n]);const y=o=>{const{name:c,value:h}=o.target;l(u=>({...u,[c]:h})),m[c]&&E(u=>({...u,[c]:null}))},T=(o,c)=>{l(h=>({...h,[o]:c})),m[o]&&E(h=>({...h,[o]:null}))},N=()=>{const o={};return a.title.trim()||(o.title="Title is required"),E(o),Object.keys(o).length===0},F=async o=>{if(o.preventDefault(),!!N()){w(!0);try{const c=a.tags?a.tags.split(",").map(P=>P.trim()).filter(Boolean):[],h={teamMemberId:e,title:a.title.trim(),notes:a.notes.trim(),category:a.category,tags:c,importance:parseInt(a.importance,10),sourceType:n?.type||"manual",sourceId:n?.id||null};let u;r?.id?(u=await H.update(r.id,h),_.success("Personal file item updated successfully")):(u=await H.create(h),_.success("Item saved to personal file")),r||l({title:"",notes:"",category:"achievement",tags:"",importance:"3"}),s&&s(u)}catch(c){console.error("Error saving personal file item:",c),_.error("Failed to save personal file item")}finally{w(!1)}}};return t.jsxs("form",{onSubmit:F,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{htmlFor:"title",children:"Title"}),t.jsx(B,{id:"title",name:"title",value:a.title,onChange:y,placeholder:"Enter a title for this item",className:m.title?"border-red-500":""}),m.title&&t.jsx("p",{className:"text-sm text-red-500",children:m.title})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{htmlFor:"notes",children:"Notes"}),t.jsx(V,{id:"notes",name:"notes",value:a.notes,onChange:y,placeholder:"Enter detailed notes about this item",rows:4})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{htmlFor:"category",children:"Category"}),t.jsxs(L,{value:a.category,onValueChange:o=>T("category",o),children:[t.jsx(M,{id:"category",children:t.jsx(O,{placeholder:"Select a category"})}),t.jsxs(R,{children:[t.jsx(x,{value:"achievement",children:"Achievement"}),t.jsx(x,{value:"feedback",children:"Feedback"}),t.jsx(x,{value:"concern",children:"Concern"}),t.jsx(x,{value:"goal",children:"Goal"}),t.jsx(x,{value:"improvement",children:"Improvement"}),t.jsx(x,{value:"other",children:"Other"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{htmlFor:"importance",children:"Importance"}),t.jsxs(L,{value:a.importance,onValueChange:o=>T("importance",o),children:[t.jsx(M,{id:"importance",children:t.jsx(O,{placeholder:"Select importance level"})}),t.jsxs(R,{children:[t.jsx(x,{value:"1",children:"Low"}),t.jsx(x,{value:"2",children:"Medium-Low"}),t.jsx(x,{value:"3",children:"Medium"}),t.jsx(x,{value:"4",children:"Medium-High"}),t.jsx(x,{value:"5",children:"High"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(f,{htmlFor:"tags",children:"Tags (comma separated)"}),t.jsx(B,{id:"tags",name:"tags",value:a.tags,onChange:y,placeholder:"e.g. leadership, communication, project-x"})]}),t.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[i&&t.jsx(C,{type:"button",variant:"outline",onClick:i,disabled:g,children:"Cancel"}),t.jsx(C,{type:"submit",disabled:g,children:g?"Saving...":r?"Update Item":"Save to Personal File"})]})]})},ue=({teamMemberId:e,teamMemberName:s,sourceItem:r,variant:n="outline",size:i="sm",showAgendaAction:a=!0,showPersonalFileAction:l=!0,onActionComplete:g})=>{const[w,m]=j.useState(!1),[E,y]=j.useState(!1),T=F=>{m(!1),_.success(`Item added to ${s}'s 1:1 agenda`),g&&g("agenda",F)},N=F=>{y(!1),_.success(`Item saved to ${s}'s personal file`),g&&g("personalFile",F)};return!a&&!l?null:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex gap-2",children:[a&&t.jsxs(C,{variant:n,size:i,onClick:()=>m(!0),title:`Add to ${s}'s 1:1 agenda`,children:[t.jsx(X,{className:"h-4 w-4 mr-1"}),"Add to 1:1"]}),l&&t.jsxs(C,{variant:n,size:i,onClick:()=>y(!0),title:`Save to ${s}'s personal file`,children:[t.jsx(Q,{className:"h-4 w-4 mr-1"}),"Save to File"]})]}),t.jsx(D,{open:w,onOpenChange:m,children:t.jsxs(k,{children:[t.jsx($,{children:t.jsxs(Y,{children:["Add to ",s,"'s 1:1 Agenda"]})}),t.jsx(se,{teamMemberId:e,onSubmit:T,onCancel:()=>m(!1),sourceItem:r})]})}),t.jsx(D,{open:E,onOpenChange:y,children:t.jsxs(k,{children:[t.jsx($,{children:t.jsxs(Y,{children:["Save to ",s,"'s Personal File"]})}),t.jsx(ne,{teamMemberId:e,onSubmit:N,onCancel:()=>y(!1),sourceItem:r})]})})]})};export{ue as A};
