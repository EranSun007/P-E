import{j as e,k as qe,aD as de,ap as ke,bu as Le,aL as ot,T as Ke,am as ht,an as mt,D as H,Z as ut,aA as xt,ar as ze,_ as Be,bf as Ve,bv as gt}from"./chunk-BlD_ekKQ.js";import{a as v,k as ft,L as pt}from"./chunk-BKwDNIOR.js";import{G as Pe,M as se,O as q,C as Z,j as W,B as O,N as jt,I as Ee,Q as me,h as K,i as Q,K as Ue,T as yt,t as vt,S as wt,z as _t,E as Nt,F as Ot,m as He,P as ue,r as xe,s as ge,L as b}from"./index-BPpXP9wP.js";import{A as Ze}from"./chunk-CFkj9Kyo.js";import{S as Y,a as z,b as B,c as V,d as y}from"./chunk-DBni0BOz.js";import{E as St}from"./chunk-BHBPFuFx.js";import{B as R,D as Me,a as Ae,b as Ie,c as $e,d as Fe}from"./chunk-CmitwiBI.js";import{b as I,p as A}from"./chunk-P_BNsj9B.js";import{C as fe}from"./chunk-D12Apl6f.js";import{T as Dt,a as bt,b as We,c as pe,d as Et,e as je}from"./chunk-C_wS6JmM.js";class le extends Error{constructor(s,t,r=null){super(s),this.name="CalendarServiceError",this.code=t,this.originalError=r}}class N extends le{constructor(s,t=null){super(s,"VALIDATION_ERROR"),this.field=t}}class ne extends le{constructor(s,t=null,r=null){super(s,"NOT_FOUND"),this.entityType=t,this.entityId=r}}class ye extends le{constructor(s,t=null){super(s,"DUPLICATE_ERROR"),this.duplicateData=t}}class ie extends le{constructor(s,t=null,r=null){super(s,"OPERATION_ERROR",r),this.operation=t}}class ve{static async _retryOperation(s,t={}){const{maxRetries:r=3,baseDelay:c=1e3,maxDelay:l=1e4,backoffMultiplier:i=2,operationName:o="operation",shouldRetry:f=null,onRetry:m=null}=t;let x,j=c;for(let d=1;d<=r;d++)try{const h=await s();return d>1&&console.log(`${o} succeeded on attempt ${d}/${r}`),h}catch(h){if(x=h,!(f?f(h,d):this._isRetryableError(h)))throw console.log(`${o} failed with non-retryable error: ${h.message}`),h;if(d>=r){console.error(`${o} failed after ${r} attempts: ${h.message}`);break}console.warn(`${o} failed on attempt ${d}/${r}: ${h.message}. Retrying in ${j}ms...`),m&&m(h,d,j),await new Promise(U=>setTimeout(U,j));const D=Math.random()*.1*j;j=Math.min(j*i+D,l)}throw new ie(`Operation failed after ${r} attempts: ${x.message}`,o,x)}static _isRetryableError(s){if(s instanceof N||s instanceof ne||s instanceof ye)return!1;const t=s.message?.toLowerCase()||"";return t.includes("permission")||t.includes("unauthorized")||t.includes("forbidden")||t.includes("access denied")||t.includes("quota")||t.includes("limit exceeded")||t.includes("rate limit")||t.includes("malformed")||t.includes("invalid format")||t.includes("bad request")?!1:(t.includes("network")||t.includes("timeout")||t.includes("connection")||t.includes("fetch")||t.includes("server error")||t.includes("service unavailable")||t.includes("internal error"),!0)}static _generateUserFeedback(s,t,r=null,c={}){const l={operation:s,success:t,timestamp:new Date().toISOString(),context:c};if(t)switch(s){case"createOneOnOneMeeting":l.message=`Successfully scheduled 1:1 meeting${c.teamMemberName?` with ${c.teamMemberName}`:""}`,l.type="success";break;case"updateOneOnOneMeeting":l.message="Meeting successfully rescheduled",l.type="success";break;case"deleteOneOnOneMeeting":l.message="Meeting successfully cancelled",l.type="success";break;default:l.message="Calendar operation completed successfully",l.type="success"}else l.error={message:r.message,code:r.code||"UNKNOWN_ERROR",type:r.constructor.name},r instanceof N?(l.message=`Invalid input: ${r.message}`,l.type="validation_error",l.field=r.field):r instanceof ne?(l.message=`Not found: ${r.message}`,l.type="not_found_error"):r instanceof ye?(l.message=`Duplicate meeting: ${r.message}`,l.type="duplicate_error"):(l.message=`Failed to ${s.replace(/([A-Z])/g," $1").toLowerCase()}: ${r.message}`,l.type="error");return l}static generateOneOnOneTitle(s){if(!s||typeof s!="string"||s.trim().length===0)throw new N("Team member name is required and must be a non-empty string","teamMemberName");return`${s.trim()} 1:1`}static _validateDateTime(s,t="dateTime",r=!1,c=5){if(!s)throw new N(`${t} is required`,t);if(typeof s!="string")throw new N(`${t} must be a string`,t);const l=new Date(s);if(isNaN(l.getTime()))throw new N(`Invalid ${t} format. Expected ISO string, received: "${s}"`,t);const i=new Date,o=new Date(i);if(o.setFullYear(o.getFullYear()+2),l>o)throw new N(`${t} cannot be more than 2 years in the future. Provided date: ${l.toISOString()}, maximum allowed: ${o.toISOString()}`,t);if(!r){const f=Math.max(c,1)*60*1e3,m=new Date(i.getTime()-f);if(l<m){const x=i.getTime()-l.getTime(),j=Math.round(x/(60*1e3));throw new N(`${t} cannot be in the past. Provided date: ${l.toISOString()}, current time: ${i.toISOString()} (${j} minutes ago)`,t)}}return l}static async _validateTeamMember(s,t="teamMemberId"){if(!s)throw new N(`${t} is required`,t);if(typeof s!="string")throw new N(`${t} must be a string`,t);let r=null;try{r=await Pe.get(s)}catch(c){throw new ie(`Failed to fetch team member: ${c.message}`,"validateTeamMember",c)}if(!r)throw new ne("Team member not found","TeamMember",s);if(!r.id||!r.name)throw new N("Team member missing required properties (id, name)",t);return r}static async _validateCalendarEvent(s,t=!0,r="eventId"){if(!s)throw new N(`${r} is required`,r);if(typeof s!="string")throw new N(`${r} must be a string`,r);const c=await se.get(s);if(!c)throw new ne("Calendar event not found","CalendarEvent",s);if(t&&c.event_type!=="one_on_one")throw new N("Event is not a 1:1 meeting","eventType");return c}static async _checkForDuplicateEvents(s,t,r=null){if(!s||!t)return null;if(!(t instanceof Date)||isNaN(t.getTime()))return console.warn("Invalid date provided to _checkForDuplicateEvents:",t),null;try{const c=await this.getOneOnOneMeetingsForTeamMember(s);if(!Array.isArray(c))return console.warn("getOneOnOneMeetingsForTeamMember returned non-array:",c),null;const l=t.toDateString();return c.find(o=>{if(!o||typeof o!="object"||r&&o.id===r||!o.start_date)return!1;try{const f=new Date(o.start_date);return isNaN(f.getTime())?!1:f.toDateString()===l}catch(f){return console.warn("Error parsing event date:",o.start_date,f),!1}})||null}catch(c){return console.warn("Error checking for duplicate events:",c),null}}static async _validateOneOnOne(s,t="oneOnOneId"){if(!s)throw new N(`${t} is required`,t);if(typeof s!="string")throw new N(`${t} must be a string`,t);let r=null;try{r=await q.list()}catch(l){throw new ie(`Failed to fetch OneOnOne records: ${l.message}`,"validateOneOnOne",l)}if(!Array.isArray(r))throw new DataError("OneOnOne.list() returned invalid data - expected array","OneOnOne");const c=r.find(l=>!l||typeof l!="object"?!1:l.id===s);if(!c)throw new ne("OneOnOne record not found","OneOnOne",s);return c}static _validateDuration(s,t="durationMinutes"){if(s==null)return 30;if(typeof s!="number")throw new N(`${t} must be a number`,t);if(s<=0)throw new N(`${t} must be greater than 0`,t);if(s>480)throw new N(`${t} cannot exceed 8 hours (480 minutes)`,t);return s}static async validateDataConsistency(s={}){const{fixInconsistencies:t=!1,includeOrphanedEvents:r=!0,includeMissingLinks:c=!0,includeInvalidData:l=!0}=s;try{console.log("Starting comprehensive data consistency validation...");const i={timestamp:new Date().toISOString(),totalEventsChecked:0,totalOneOnOnesChecked:0,inconsistencies:{orphanedEvents:[],missingLinks:[],invalidData:[],duplicateEvents:[],brokenReferences:[]},fixes:{applied:[],failed:[]},summary:{isConsistent:!0,totalIssues:0,fixesApplied:0,fixesFailed:0}},[o,f,m]=await Promise.all([this.getOneOnOneMeetings(),q.list(),Pe.list()]);if(i.totalEventsChecked=o.length,i.totalOneOnOnesChecked=f.length,r){const d=new Set(f.filter(h=>h.next_meeting_calendar_event_id).map(h=>h.next_meeting_calendar_event_id));for(const h of o)!d.has(h.id)&&(!h.linked_entity_id||!f.find(D=>D.id===h.linked_entity_id))&&i.inconsistencies.orphanedEvents.push({eventId:h.id,title:h.title,teamMemberId:h.team_member_id,startDate:h.start_date,issue:"Calendar event not linked to any OneOnOne record"})}if(c)for(const d of f)d.next_meeting_date&&!d.next_meeting_calendar_event_id&&i.inconsistencies.missingLinks.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,nextMeetingDate:d.next_meeting_date,issue:"OneOnOne has next_meeting_date but no calendar event"}),d.next_meeting_calendar_event_id&&(o.find(p=>p.id===d.next_meeting_calendar_event_id)||i.inconsistencies.brokenReferences.push({oneOnOneId:d.id,teamMemberId:d.team_member_id,referencedEventId:d.next_meeting_calendar_event_id,issue:"OneOnOne references non-existent calendar event"}));if(l)for(const d of o){const h=[],p=m.find($=>$.id===d.team_member_id);if(!p)h.push("Team member not found");else{const $=this.generateOneOnOneTitle(p.name);d.title!==$&&h.push(`Title mismatch: expected "${$}", got "${d.title}"`)}d.event_type!=="one_on_one"&&h.push(`Incorrect event type: expected "one_on_one", got "${d.event_type}"`),d.linked_entity_type!=="one_on_one"&&h.push(`Incorrect linked entity type: expected "one_on_one", got "${d.linked_entity_type}"`);const D=new Date(d.start_date),U=new Date(d.end_date);isNaN(D.getTime())||isNaN(U.getTime())?h.push("Invalid date format"):U<=D&&h.push("End date must be after start date"),h.length>0&&i.inconsistencies.invalidData.push({eventId:d.id,title:d.title,teamMemberId:d.team_member_id,issues:h})}const x={};for(const d of o){const h=new Date(d.start_date).toDateString(),p=`${d.team_member_id}-${h}`;x[p]||(x[p]=[]),x[p].push(d)}for(const[d,h]of Object.entries(x))h.length>1&&i.inconsistencies.duplicateEvents.push({key:d,teamMemberId:h[0].team_member_id,date:new Date(h[0].start_date).toDateString(),events:h.map(p=>({id:p.id,title:p.title})),count:h.length});const j=[...i.inconsistencies.orphanedEvents,...i.inconsistencies.missingLinks,...i.inconsistencies.invalidData,...i.inconsistencies.duplicateEvents,...i.inconsistencies.brokenReferences];if(i.summary.totalIssues=j.length,i.summary.isConsistent=j.length===0,t&&j.length>0){console.log(`Attempting to fix ${j.length} inconsistencies...`);for(const d of i.inconsistencies.orphanedEvents)try{await this.deleteOneOnOneMeeting(d.eventId),i.fixes.applied.push({type:"orphaned_event_deleted",eventId:d.eventId,title:d.title})}catch(h){i.fixes.failed.push({type:"orphaned_event_deletion_failed",eventId:d.eventId,error:h.message})}for(const d of i.inconsistencies.brokenReferences)try{await q.update(d.oneOnOneId,{next_meeting_calendar_event_id:null}),i.fixes.applied.push({type:"broken_reference_cleared",oneOnOneId:d.oneOnOneId,referencedEventId:d.referencedEventId})}catch(h){i.fixes.failed.push({type:"broken_reference_fix_failed",oneOnOneId:d.oneOnOneId,error:h.message})}i.summary.fixesApplied=i.fixes.applied.length,i.summary.fixesFailed=i.fixes.failed.length}return console.log("Data consistency validation completed:",{totalIssues:i.summary.totalIssues,isConsistent:i.summary.isConsistent,fixesApplied:i.summary.fixesApplied}),i}catch(i){throw console.error("Error during data consistency validation:",i),new ie(`Data consistency validation failed: ${i.message}`,"validateDataConsistency",i)}}static async createOneOnOneMeeting(s,t,r,c=30){const l="createOneOnOneMeeting";try{if(!s)throw new N("Team member ID is required","teamMemberId");if(!t||typeof t!="string"||t.trim().length===0)throw new N("Team member name is required and must be a non-empty string","teamMemberName");if(!r)throw new N("Date/time is required","dateTime");if(c&&(typeof c!="number"||c<=0))throw new N("Duration must be a positive number","durationMinutes");if(!await Pe.get(s))throw new ne("Team member not found","TeamMember",s);const o=this._validateDateTime(r,"dateTime",!1,5),f=await this.getOneOnOneMeetingsForTeamMember(s),x=(Array.isArray(f)?f:[]).find(p=>{if(!p||typeof p!="object"||!p.start_date)return!1;try{const D=new Date(p.start_date);return isNaN(D.getTime())?!1:D.toDateString()===o.toDateString()}catch(D){return console.warn("Error parsing event date:",p.start_date,D),!1}});if(x)throw new ye(`A 1:1 meeting already exists for ${t} on ${o.toDateString()}`,{existingEventId:x.id,date:o.toDateString()});const j=new Date(o.getTime()+c*60*1e3),d=this.generateOneOnOneTitle(t),h=await this._retryOperation(async()=>await se.create({title:d,description:`1:1 meeting with ${t}`,start_date:o.toISOString(),end_date:j.toISOString(),all_day:!1,location:null,event_type:"one_on_one",team_member_id:s,linked_entity_type:"one_on_one",linked_entity_id:null}),{maxRetries:3,baseDelay:1e3,operationName:`create calendar event for ${t}`,shouldRetry:(p,D)=>p instanceof N&&p.field==="dateTime"&&D>1?!1:this._isRetryableError(p)});return console.log(`Successfully created calendar event: ${d} (${h.id})`),h}catch(i){if(i instanceof le)throw i;const o=new ie(`Failed to create 1:1 meeting calendar event: ${i.message}`,l,i);throw console.error("Error creating 1:1 meeting calendar event:",o),o}}static async updateOneOnOneMeeting(s,t,r=30){const c="updateOneOnOneMeeting";try{if(!s)throw new N("Event ID is required","eventId");if(!t)throw new N("Date/time is required","dateTime");if(r&&(typeof r!="number"||r<=0))throw new N("Duration must be a positive number","durationMinutes");const l=await se.get(s);if(!l)throw new ne("Calendar event not found","CalendarEvent",s);if(l.event_type!=="one_on_one")throw new N("Event is not a 1:1 meeting","eventType");const i=this._validateDateTime(t,"dateTime",!1,5);if(l.team_member_id){const x=(await this.getOneOnOneMeetingsForTeamMember(l.team_member_id)).find(j=>j.id===s?!1:new Date(j.start_date).toDateString()===i.toDateString());if(x)throw new ye(`Another 1:1 meeting already exists on ${i.toDateString()}`,{conflictingEventId:x.id,date:i.toDateString()})}const o=new Date(i.getTime()+r*60*1e3),f=await this._retryOperation(async()=>await se.update(s,{start_date:i.toISOString(),end_date:o.toISOString()}),{maxRetries:3,baseDelay:1e3,operationName:`update calendar event ${s}`,shouldRetry:(m,x)=>m instanceof N&&m.field==="dateTime"&&x>1?!1:this._isRetryableError(m)});return console.log(`Successfully updated calendar event: ${l.title} (${s})`),f}catch(l){if(l instanceof le)throw l;const i=new ie(`Failed to update 1:1 meeting calendar event: ${l.message}`,c,l);throw console.error("Error updating 1:1 meeting calendar event:",i),i}}static async deleteOneOnOneMeeting(s){const t="deleteOneOnOneMeeting";try{if(!s)throw new N("Event ID is required","eventId");const r=await se.get(s);if(!r)throw new ne("Calendar event not found","CalendarEvent",s);if(r.event_type!=="one_on_one")throw new N("Event is not a 1:1 meeting","eventType");return await this._retryOperation(async()=>{await se.delete(s)},3,`delete calendar event ${s}`),console.log(`Successfully deleted calendar event: ${r.title} (${s})`),!0}catch(r){if(r instanceof le)throw r;const c=new ie(`Failed to delete 1:1 meeting calendar event: ${r.message}`,t,r);throw console.error("Error deleting 1:1 meeting calendar event:",c),c}}static async getOneOnOneMeetings(){try{const s=await se.list();return Array.isArray(s)?s.filter(r=>!r||typeof r!="object"?!1:r.event_type==="one_on_one"):(console.warn("CalendarEvent.list() returned non-array:",s),[])}catch(s){throw console.error("Error fetching 1:1 meeting calendar events:",s),s}}static async getOneOnOneMeetingsForTeamMember(s){try{return!s||typeof s!="string"?(console.warn("Invalid teamMemberId provided to getOneOnOneMeetingsForTeamMember:",s),[]):(await this.getOneOnOneMeetings()).filter(c=>!c||typeof c!="object"?!1:c.team_member_id===s)}catch(t){throw console.error(`Error fetching 1:1 meeting calendar events for team member ${s}:`,t),t}}static async linkMeetingToCalendarEvent(s,t){try{if(!s||!t)throw new Error("OneOnOne ID and Calendar Event ID are required");const r=await q.update(s,{next_meeting_calendar_event_id:t});return await se.update(t,{linked_entity_id:s}),r}catch(r){throw console.error("Error linking OneOnOne to CalendarEvent:",r),r}}static async createAndLinkOneOnOneMeeting(s,t,r,c=30){try{const l=await this._validateOneOnOne(s),i=await this._validateTeamMember(t),o=this._validateDateTime(r),f=this._validateDuration(c);if(l.team_member_id!==t)throw new N("Team member ID mismatch between OneOnOne record and provided team member ID","teamMemberId");const m=await this._checkForDuplicateEvents(t,o);if(m)throw new ye(`A 1:1 meeting already exists for ${i.name} on ${o.toDateString()}`,{existingEventId:m.id,date:o.toDateString()});const x=await this.createOneOnOneMeeting(t,i.name,r,f),j=await this.linkMeetingToCalendarEvent(s,x.id);return console.log(`Successfully created and linked 1:1 meeting: ${i.name} (${x.id})`),{calendarEvent:x,oneOnOne:j}}catch(l){throw console.error("Error creating and linking 1:1 meeting:",l),l}}}const kt=({item:g,onComplete:s,onMove:t,onEdit:r,onDelete:c,showActions:l=!0,className:i=""})=>{const o=p=>{switch(p){case 1:return"bg-red-100 text-red-800 border-red-200";case 2:return"bg-yellow-100 text-yellow-800 border-yellow-200";case 3:return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},f=p=>{switch(p){case 1:return"High";case 2:return"Medium";case 3:return"Low";default:return"Medium"}},m=p=>{switch(p){case"pending":return"bg-yellow-100 text-yellow-800";case"discussed":return"bg-green-100 text-green-800";case"moved":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},x=()=>{s&&g.status==="pending"&&s(g)},j=()=>{t&&g.status==="pending"&&t(g)},d=()=>{r&&r(g)},h=()=>{c&&c(g)};return e.jsx(Z,{className:`transition-all hover:shadow-md ${i}`,children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("h4",{className:"font-medium text-foreground leading-tight flex-1 mr-3",children:g.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(R,{variant:"outline",className:o(g.priority),children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),f(g.priority)]}),e.jsxs(R,{variant:g.status==="discussed"?"secondary":"outline",className:m(g.status),children:[g.status==="pending"&&e.jsx(de,{className:"h-3 w-3 mr-1"}),g.status==="discussed"&&e.jsx(ke,{className:"h-3 w-3 mr-1"}),g.status==="moved"&&e.jsx(Le,{className:"h-3 w-3 mr-1"}),g.status.charAt(0).toUpperCase()+g.status.slice(1)]})]})]}),g.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:e.jsx("p",{children:g.description})}),g.tags&&g.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:g.tags.map((p,D)=>e.jsx(R,{variant:"secondary",className:"text-xs",children:p},D))}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created ",I(new Date(g.createdAt),"MMM d, yyyy"),g.updatedAt!==g.createdAt&&e.jsxs("span",{children:[" ‚Ä¢ Updated ",I(new Date(g.updatedAt),"MMM d, yyyy")]})]}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[g.status==="pending"&&s&&e.jsxs(O,{variant:"outline",size:"sm",onClick:x,className:"h-7 px-3 text-xs",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Complete"]}),g.status==="pending"&&t&&e.jsxs(O,{variant:"outline",size:"sm",onClick:j,className:"h-7 px-3 text-xs",children:[e.jsx(Le,{className:"h-3 w-3 mr-1"}),"Move"]}),r&&e.jsxs(O,{variant:"ghost",size:"sm",onClick:d,className:"h-7 px-3 text-xs",children:[e.jsx(ot,{className:"h-3 w-3 mr-1"}),"Edit"]}),c&&e.jsxs(O,{variant:"ghost",size:"sm",onClick:h,className:"h-7 px-3 text-xs text-destructive hover:text-destructive",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Delete"]})]})]})]})})})},Ct=({items:g=[],loading:s=!1,onComplete:t,onMove:r,onEdit:c,onDelete:l,showActions:i=!0,emptyMessage:o="No agenda items found",emptyDescription:f="Agenda items will appear here once they are added."})=>{const[m,x]=v.useState(""),[j,d]=v.useState("createdAt"),[h,p]=v.useState("desc"),[D,U]=v.useState("all"),[$,oe]=v.useState("all"),G=v.useMemo(()=>{let k=g;if(m){const E=m.toLowerCase();k=k.filter(w=>w.title.toLowerCase().includes(E)||w.description&&w.description.toLowerCase().includes(E)||w.tags&&w.tags.some(_=>_.toLowerCase().includes(E)))}return D!=="all"&&(k=k.filter(E=>E.status===D)),$!=="all"&&(k=k.filter(E=>E.priority===parseInt($))),k.sort((E,w)=>{let _,P;switch(j){case"title":_=E.title.toLowerCase(),P=w.title.toLowerCase();break;case"priority":_=E.priority,P=w.priority;break;case"status":_=E.status,P=w.status;break;case"updatedAt":_=new Date(E.updatedAt),P=new Date(w.updatedAt);break;case"createdAt":default:_=new Date(E.createdAt),P=new Date(w.createdAt);break}return h==="asc"?_<P?-1:_>P?1:0:_>P?-1:_<P?1:0}),k},[g,m,j,h,D,$]);return s?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(jt,{}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading agenda items..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ht,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Search agenda items...",value:m,onChange:k=>x(k.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Y,{value:D,onValueChange:U,children:[e.jsxs(z,{className:"w-32",children:[e.jsx(mt,{className:"h-4 w-4 mr-2"}),e.jsx(B,{})]}),e.jsxs(V,{children:[e.jsx(y,{value:"all",children:"All Status"}),e.jsx(y,{value:"pending",children:"Pending"}),e.jsx(y,{value:"discussed",children:"Discussed"}),e.jsx(y,{value:"moved",children:"Moved"})]})]}),e.jsxs(Y,{value:$,onValueChange:oe,children:[e.jsxs(z,{className:"w-32",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),e.jsx(B,{})]}),e.jsxs(V,{children:[e.jsx(y,{value:"all",children:"All Priority"}),e.jsx(y,{value:"1",children:"High"}),e.jsx(y,{value:"2",children:"Medium"}),e.jsx(y,{value:"3",children:"Low"})]})]}),e.jsxs(Y,{value:`${j}-${h}`,onValueChange:k=>{const[E,w]=k.split("-");d(E),p(w)},children:[e.jsxs(z,{className:"w-40",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),e.jsx(B,{})]}),e.jsxs(V,{children:[e.jsx(y,{value:"createdAt-desc",children:"Newest First"}),e.jsx(y,{value:"createdAt-asc",children:"Oldest First"}),e.jsx(y,{value:"updatedAt-desc",children:"Recently Updated"}),e.jsx(y,{value:"priority-asc",children:"Priority: High to Low"}),e.jsx(y,{value:"priority-desc",children:"Priority: Low to High"}),e.jsx(y,{value:"title-asc",children:"Title: A to Z"}),e.jsx(y,{value:"title-desc",children:"Title: Z to A"}),e.jsx(y,{value:"status-asc",children:"Status: A to Z"})]})]})]})]}),g.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",G.length," of ",g.length," agenda items"]}),G.length===0?e.jsx(St,{icon:de,title:g.length===0?o:"No matching items",description:g.length===0?f:"Try adjusting your search or filters"}):e.jsx("div",{className:"space-y-3",children:G.map(k=>e.jsx(kt,{item:k,onComplete:t,onMove:r,onEdit:c,onDelete:l,showActions:i},k.id))})]})},Re=[{id:"vacation",name:"Vacation",value:"vacation",active:!0,color:"#3b82f6",order:1},{id:"sick_day",name:"Sick Day",value:"sick_day",active:!0,color:"#ef4444",order:2},{id:"day_off",name:"Day Off",value:"day_off",active:!0,color:"#10b981",order:3},{id:"personal_leave",name:"Personal Leave",value:"personal_leave",active:!0,color:"#f59e0b",order:4},{id:"training",name:"Training",value:"training",active:!0,color:"#8b5cf6",order:5}];class Ge{static calculateDaysInPeriod(s,t){if(!s||!t)throw new Error("Start date and end date are required");const r=new Date(s),c=new Date(t);if(isNaN(r.getTime())||isNaN(c.getTime()))throw new Error("Invalid date format");if(c<r)throw new Error("End date must be after or equal to start date");const l=c.getTime()-r.getTime();return Math.floor(l/(1e3*60*60*24))+1}static validatePeriod(s,t,r,c,l){const i=[];if(s||i.push("Start date is required"),t||i.push("End date is required"),r||i.push("Reason is required"),!c&&!l&&i.push("Reference (team member or peer) is required"),s){const o=new Date(s);isNaN(o.getTime())&&i.push("Invalid start date format")}if(t){const o=new Date(t);isNaN(o.getTime())&&i.push("Invalid end date format")}if(s&&t){const o=new Date(s),f=new Date(t);!isNaN(o.getTime())&&!isNaN(f.getTime())&&f<o&&i.push("End date must be after or equal to start date")}return r&&(Re.filter(f=>f.active).map(f=>f.value).includes(r)||i.push("Invalid reason type")),{isValid:i.length===0,errors:i}}static async getActivePeriodsForDate(s){if(!s)throw new Error("Date is required");const t=new Date(s);if(isNaN(t.getTime()))throw new Error("Invalid date format");try{return(await me.list()).filter(c=>{const l=new Date(c.start_date),i=new Date(c.end_date);return t>=l&&t<=i})}catch(r){throw new Error(`Failed to get active periods: ${r.message}`)}}static async getYearlyStats(s,t=new Date().getFullYear()){if(!s)throw new Error("Team member ID is required");if(!t||t<1900||t>3e3)throw new Error("Invalid year");try{const c=(await me.list()).filter(m=>m.team_member_id===s),l=`${t}-01-01`,i=`${t}-12-31`;let o=0;const f={};return c.forEach(m=>{const x=m.start_date,j=m.end_date,d=x>l?x:l,h=j<i?j:i;if(d<=h){const p=this.calculateDaysInPeriod(d,h);o+=p,f[m.reason]||(f[m.reason]=0),f[m.reason]+=p}}),{teamMemberId:s,year:t,totalDays:o,reasonBreakdown:f,periods:c.filter(m=>{const x=m.start_date,j=m.end_date,d=x>l?x:l,h=j<i?j:i;return d<=h})}}catch(r){throw new Error(`Failed to get yearly statistics: ${r.message}`)}}static async getYearlyStatsForPeer(s,t=new Date().getFullYear()){if(!s)throw new Error("Peer ID is required");if(!t||t<1900||t>3e3)throw new Error("Invalid year");try{const c=(await me.list()).filter(m=>m.peer_id===s),l=`${t}-01-01`,i=`${t}-12-31`;let o=0;const f={};return c.forEach(m=>{const x=m.start_date,j=m.end_date,d=x>l?x:l,h=j<i?j:i;if(d<=h){const p=this.calculateDaysInPeriod(d,h);o+=p,f[m.reason]||(f[m.reason]=0),f[m.reason]+=p}}),{peerId:s,year:t,totalDays:o,reasonBreakdown:f,periods:c.filter(m=>{const x=m.start_date,j=m.end_date,d=x>l?x:l,h=j<i?j:i;return d<=h})}}catch(r){throw new Error(`Failed to get yearly statistics: ${r.message}`)}}static async checkOverlaps(s,t,r,c=null){if(!s||!t||!r)throw new Error("Team member ID, start date, and end date are required");const l=new Date(t),i=new Date(r);if(isNaN(l.getTime())||isNaN(i.getTime()))throw new Error("Invalid date format");try{return(await me.list()).filter(m=>m.team_member_id===s&&(!c||m.id!==c)).filter(m=>{const x=new Date(m.start_date),j=new Date(m.end_date);return l<=j&&i>=x})}catch(o){throw new Error(`Failed to check overlaps: ${o.message}`)}}static async checkOverlapsForPeer(s,t,r,c=null){if(!s||!t||!r)throw new Error("Peer ID, start date, and end date are required");const l=new Date(t),i=new Date(r);if(isNaN(l.getTime())||isNaN(i.getTime()))throw new Error("Invalid date format");try{return(await me.list()).filter(m=>m.peer_id===s&&(!c||m.id!==c)).filter(m=>{const x=new Date(m.start_date),j=new Date(m.end_date);return l<=j&&i>=x})}catch(o){throw new Error(`Failed to check overlaps: ${o.message}`)}}static async getCurrentStatus(s,t=new Date().toISOString().split("T")[0]){if(!s)throw new Error("Team member ID is required");try{const c=(await this.getActivePeriodsForDate(t)).find(o=>o.team_member_id===s);if(!c)return null;const l=new Date(c.end_date),i=new Date(l);return i.setDate(i.getDate()+1),{...c,returnDate:i.toISOString().split("T")[0],daysRemaining:this.calculateDaysInPeriod(t,c.end_date)}}catch(r){throw new Error(`Failed to get current status: ${r.message}`)}}static async getCurrentStatusForPeer(s,t=new Date().toISOString().split("T")[0]){if(!s)throw new Error("Peer ID is required");try{const c=(await this.getActivePeriodsForDate(t)).find(o=>o.peer_id===s);if(!c)return null;const l=new Date(c.end_date),i=new Date(l);return i.setDate(i.getDate()+1),{...c,returnDate:i.toISOString().split("T")[0],daysRemaining:this.calculateDaysInPeriod(t,c.end_date)}}catch(r){throw new Error(`Failed to get current status: ${r.message}`)}}static getReasonTypes(){return Re.filter(s=>s.active).sort((s,t)=>s.order-t.order)}static getReasonType(s){return Re.find(t=>t.value===s)||null}}const Tt=({peerId:g,year:s,showBreakdown:t=!1,showYearSelector:r=!1,onStatsChange:c,className:l=""})=>{const i=new Date().getFullYear(),[o,f]=v.useState(s||i),[m,x]=v.useState(null),[j,d]=v.useState(!0),[h,p]=v.useState(null),D=v.useMemo(()=>{const w=[];for(let _=0;_<3;_++)w.push(i-_);return w},[i]),U=async w=>{if(!g){x(null),d(!1);return}try{d(!0),p(null);const _=await Ge.getYearlyStatsForPeer(g,w);x(_),c&&c(_)}catch(_){console.error("Failed to load peer out of office stats:",_),p(_.message),x(null)}finally{d(!1)}};v.useEffect(()=>{U(o)},[g,o]);const $=w=>{f(parseInt(w))},oe=w=>Ge.getReasonType(w)||{name:w,color:"#6b7280"},G=v.useMemo(()=>!m||!m.reasonBreakdown?[]:Object.entries(m.reasonBreakdown).map(([w,_])=>({reason:w,days:_,display:oe(w)})).sort((w,_)=>_.days-w.days),[m]);if(j)return e.jsxs(Z,{className:`animate-pulse ${l}`,children:[e.jsx(K,{className:"pb-2",children:e.jsxs(Q,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(W,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]})]});if(h)return e.jsxs(Z,{className:`border-red-200 ${l}`,children:[e.jsx(K,{className:"pb-2",children:e.jsxs(Q,{className:"text-sm font-medium text-red-600 flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Out of Office Days"]})}),e.jsxs(W,{children:[e.jsx("p",{className:"text-sm text-red-600",children:"Failed to load stats"}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>U(o),className:"mt-2",children:"Retry"})]})]});const k=m?.totalDays||0,E=o===i;return e.jsxs(Z,{className:l,children:[e.jsx(K,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Q,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Out of Office Days"]}),r&&e.jsxs(Y,{value:o.toString(),onValueChange:$,children:[e.jsx(z,{className:"w-20 h-8 text-xs",children:e.jsx(B,{})}),e.jsx(V,{children:D.map(w=>e.jsx(y,{value:w.toString(),children:w},w))})]})]})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:k}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[k===1?"day":"days"," in ",o,E&&e.jsx(R,{variant:"secondary",className:"ml-2 text-xs",children:"Current"})]})]}),t&&G.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(ut,{className:"h-3 w-3"}),"Breakdown"]}),e.jsx("div",{className:"space-y-1",children:G.map(({reason:w,days:_,display:P})=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:P.color}}),e.jsx("span",{children:P.name})]}),e.jsxs("span",{className:"font-medium",children:[_," ",_===1?"day":"days"]})]},w))})]}),k===0&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),"No out of office periods in ",o]})]})})]})};function Pt({peerId:g,peerName:s,outOfOfficePeriods:t=[],onAdd:r,onRemove:c}){return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Out-of-Office Management"}),e.jsx("div",{className:"space-y-2",children:t.length===0?e.jsxs("p",{className:"text-gray-500",children:["No out-of-office periods recorded for ",s,"."]}):t.map(l=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{variant:"outline",children:l.status}),e.jsxs("span",{children:[l.start_date," - ",l.end_date]}),l.notes&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",l.notes,")"]}),e.jsx("button",{className:"text-red-500 ml-2",onClick:()=>c(l.id),children:"Remove"})]},l.id))}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:r,children:"Add Out-of-Office"})]})}function Bt(){const[g]=ft(),s=g.get("id"),[t,r]=v.useState(null),[c,l]=v.useState([]),[i,o]=v.useState([]),[f,m]=v.useState([]),[x,j]=v.useState([]),[d,h]=v.useState([]),[p,D]=v.useState([]),[U,$]=v.useState(null),[oe,G]=v.useState(!0),[k,E]=v.useState(!1),[w,_]=v.useState(!1),[P,Qe]=v.useState(null),[J,X]=v.useState({text:"",referenced_entity:{type:"peer",id:""}}),[we,_e]=v.useState(null),[M,ce]=v.useState({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),[ee,Ne]=v.useState({description:"",due_date:"",linked_task_id:"",linked_project_id:"",status:"open"}),[C,Ce]=v.useState("none"),[ae,he]=v.useState(""),[Je,Oe]=v.useState(null),[F,Te]=v.useState(null),[Xe,Se]=v.useState(!1),[re,De]=v.useState("");v.useState(()=>{try{return JSON.parse(localStorage.getItem("discussedNotes")||"{}")}catch{return{}}}),v.useEffect(()=>{s&&te()},[s]);const te=async()=>{G(!0);try{const n=await Ue.get(s);r(n);const u=(await q.list()).filter(L=>L.peer_id===s);l(u);try{const L=await Ze.getAgendaItemsForPeer?.(s)||[];o(L)}catch(L){console.error("Error loading agenda items:",L),o([])}const S=await yt.list(),T=await vt.list();m(S),j(T),h(await Ue.list()),D(await wt.list()),await et(u)}catch(n){console.error("Error loading peer data:",n)}finally{G(!1)}},et=async n=>{try{const a=n.filter(u=>u.next_meeting_date).sort((u,S)=>new Date(u.next_meeting_date)-new Date(S.next_meeting_date));if(a.length>0){const u=a[0];let S=null;if(u.next_meeting_calendar_event_id)try{S=(await ve.getOneOnOneMeetingsForPeer?.(s))?.find(L=>L.id===u.next_meeting_calendar_event_id)}catch(T){console.error("Error loading calendar event:",T)}Te({oneOnOne:u,calendarEvent:S,hasCalendarEvent:!!S,meetingDate:u.next_meeting_date})}else Te(null)}catch(a){console.error("Error loading next meeting info:",a),Te(null)}},tt=async()=>{try{const n=await q.create({...M,notes:Array.isArray(M.notes)?M.notes:[],peer_id:s});if(M.next_meeting_date&&t)try{const a=await ve.createAndLinkOneOnOneMeetingForPeer?.(n.id,s,M.next_meeting_date);console.log("Calendar event created successfully:",a?.calendarEvent)}catch(a){console.error("Error creating calendar event:",a)}E(!1),ce({date:new Date().toISOString(),notes:"",mood:"good",topics_discussed:[],next_meeting_date:"",action_items:[]}),te()}catch(n){console.error("Error creating 1:1 meeting:",n)}},st=async()=>{if(P)try{const n={...P,action_items:[...P.action_items||[],ee]};await q.update(P.id,n),_(!1),te()}catch(n){console.error("Error adding action item:",n)}},nt=async n=>{if(!J.text)return;let a=null;C!=="none"&&ae&&(a={type:C,id:ae});const u=c.find(L=>L.id===n);if(!u)return;const S={text:J.text,referenced_entity:a,created_by:s,timestamp:new Date().toISOString()},T=Array.isArray(u.notes)?[...u.notes,S]:[S];await q.update(n,{...u,notes:T}),X({text:"",referenced_entity:{type:"peer",id:""}}),_e(null),te()},Ye=async(n,a,u)=>{try{const S=c.find(L=>L.id===n);if(!S)return;const T=[...S.action_items];T[a]={...T[a],status:u},await q.update(n,{...S,action_items:T}),te()}catch(S){console.error("Error updating action item status:",S)}},at=async n=>{try{try{await ve.unlinkCalendarEventFromOneOnOne?.(n)}catch(a){console.error("Error deleting associated calendar event:",a)}await q.delete(n),te()}catch(a){console.error("Error deleting meeting:",a)}},rt=async n=>{try{await Ze.markAgendaItemDiscussed?.(n.meetingId,n.timestamp)&&te()}catch(a){console.error("Error marking agenda item as discussed:",a)}},be=async(n,a)=>{try{const u=c.find(T=>T.id===n);if(!u)return;const S={...u,next_meeting_date:a};if(await q.update(n,S),a&&t)try{await ve.updateOneOnOneCalendarEventForPeer?.(n,a),console.log("Calendar event updated successfully for meeting:",n)}catch(T){console.error("Error updating calendar event:",T)}else if(!a&&u.next_meeting_calendar_event_id)try{await ve.unlinkCalendarEventFromOneOnOne?.(n),console.log("Calendar event removed for meeting:",n)}catch(T){console.error("Error removing calendar event:",T)}te()}catch(u){console.error("Error updating next meeting date:",u)}},it=async()=>{if(!(!F||!re))try{await be(F.oneOnOne.id,re),Se(!1),De("")}catch(n){console.error("Error rescheduling meeting:",n)}},lt=async()=>{if(F)try{await be(F.oneOnOne.id,"")}catch(n){console.error("Error canceling meeting:",n)}};if(oe)return e.jsx("div",{className:"p-6",children:"Loading..."});if(!t)return e.jsx("div",{className:"p-6",children:"Peer not found"});const ct=n=>({open:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[n]||"bg-gray-100 text-gray-800",dt=n=>({great:"üòÑ",good:"üôÇ",neutral:"üòê",concerned:"üòü"})[n]||"üòê";return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(pt,{to:"/peers",children:e.jsxs(O,{variant:"ghost",children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Back to Peers"]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_t,{className:"h-16 w-16",children:t.avatar?e.jsx(Nt,{src:t.avatar,alt:t.name}):e.jsx(Ot,{children:t.name.split(" ").map(n=>n[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:t.name}),e.jsx("p",{className:"text-gray-500",children:t.role||t.title})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(Z,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Q,{children:"1:1 Meetings"}),e.jsxs(O,{onClick:()=>E(!0),children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"New 1:1"]})]})}),e.jsx(W,{children:c.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Be,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"No 1:1 meetings recorded yet"})]}):e.jsx("div",{className:"space-y-6",children:c.sort((n,a)=>new Date(a.date)-new Date(n.date)).map(n=>e.jsxs(Z,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[I(A(n.date),"PPP"),e.jsx("span",{className:"text-xl",children:dt(n.mood)})]}),e.jsx(He,{className:"flex items-center gap-2",children:Je===n.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Next meeting:"}),e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(O,{variant:"outline",size:"sm",className:"h-8 text-xs",children:[e.jsx(H,{className:"mr-1 h-3 w-3"}),n.next_meeting_date?I(A(n.next_meeting_date),"MMM d"):"Select date"]})}),e.jsx(ge,{className:"w-auto p-0",children:e.jsx(fe,{mode:"single",selected:n.next_meeting_date?A(n.next_meeting_date):void 0,onSelect:a=>{const u=a?.toISOString()||"";be(n.id,u),Oe(null)}})})]}),e.jsx(O,{variant:"ghost",size:"sm",className:"h-8 px-2",onClick:()=>Oe(null),children:"Cancel"}),n.next_meeting_date&&e.jsx(O,{variant:"ghost",size:"sm",className:"h-8 px-2 text-red-500",onClick:()=>{be(n.id,""),Oe(null)},children:"Clear"})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Next meeting: ",n.next_meeting_date?I(A(n.next_meeting_date),"PPP"):"Not scheduled"]}),e.jsx(O,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>Oe(n.id),children:"Edit"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>{Qe(n),_(!0)},children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Add Action Item"]}),e.jsx(O,{variant:"ghost",size:"icon",onClick:()=>at(n.id),title:"Delete meeting",children:e.jsx(Ke,{className:"h-5 w-5 text-red-500"})})]})]})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-4",children:[Array.isArray(n.notes)&&n.notes.filter(a=>!a.referenced_entity||!a.referenced_entity.id||String(a.referenced_entity.id)!==String(s)).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),e.jsx("ul",{className:"list-disc pl-5",children:n.notes.filter(a=>!a.referenced_entity||!a.referenced_entity.id||String(a.referenced_entity.id)!==String(s)).map((a,u)=>e.jsxs("li",{className:"mb-1",children:[e.jsx("span",{children:a.text}),a.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[a.referenced_entity.type==="peer"&&d.find(S=>String(S.id)===String(a.referenced_entity.id))?.name,a.referenced_entity.type==="stakeholder"&&p.find(S=>String(S.id)===String(a.referenced_entity.id))?.name,a.referenced_entity.type==="project"&&x.find(S=>String(S.id)===String(a.referenced_entity.id))?.name]})]},u))})]}),e.jsxs("div",{className:"mt-2 flex gap-2 items-end",children:[e.jsx(Ee,{className:"flex-1",placeholder:"Note text...",value:we===n.id?J.text:"",onChange:a=>{_e(n.id),X(u=>({...u,text:a.target.value}))}}),e.jsxs(Y,{value:we===n.id?C:"none",onValueChange:a=>{_e(n.id),Ce(a),he(""),X(u=>({...u,referenced_entity:a==="none"?null:{type:a,id:""}}))},children:[e.jsx(z,{className:"w-32",children:e.jsx(B,{placeholder:"No tag"})}),e.jsxs(V,{children:[e.jsx(y,{value:"none",children:"No tag"}),e.jsx(y,{value:"peer",children:"Peers"}),e.jsx(y,{value:"stakeholder",children:"Stakeholders"}),e.jsx(y,{value:"project",children:"Projects"})]})]}),C!=="none"&&we===n.id&&e.jsxs(Y,{value:ae,onValueChange:a=>{he(a),X(u=>({...u,referenced_entity:{type:C,id:a}}))},children:[e.jsx(z,{className:"w-40",children:e.jsx(B,{placeholder:"Select name"})}),e.jsxs(V,{children:[C==="peer"&&d.filter(a=>a.id.toString()!==s?.toString()).map(a=>e.jsx(y,{value:a.id,children:a.name},a.id)),C==="stakeholder"&&p.map(a=>e.jsx(y,{value:a.id,children:a.name},a.id)),C==="project"&&x.map(a=>e.jsx(y,{value:a.id,children:a.name},a.id))]})]}),e.jsx(O,{onClick:()=>{_e(n.id),nt(n.id)},disabled:!J.text||C!=="none"&&!ae||we!==n.id,children:"Add"})]}),n.topics_discussed?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Topics Discussed"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:n.topics_discussed.map((a,u)=>e.jsx(R,{variant:"secondary",children:a},u))})]}),n.action_items?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Action Items"}),e.jsxs(Dt,{children:[e.jsx(bt,{children:e.jsxs(We,{children:[e.jsx(pe,{children:"Description"}),e.jsx(pe,{children:"Due Date"}),e.jsx(pe,{children:"Status"}),e.jsx(pe,{children:"Links"}),e.jsx(pe,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Et,{children:n.action_items.map((a,u)=>e.jsxs(We,{children:[e.jsx(je,{children:a.description}),e.jsx(je,{children:a.due_date?I(A(a.due_date),"MMM d, yyyy"):"No due date"}),e.jsx(je,{children:e.jsx(R,{className:ct(a.status),children:a.status})}),e.jsx(je,{children:(a.linked_task_id||a.linked_project_id)&&e.jsxs("div",{className:"flex items-center gap-2",children:[a.linked_task_id&&e.jsxs(R,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"h-3 w-3"}),"Task"]}),a.linked_project_id&&e.jsxs(R,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"h-3 w-3"}),"Project"]})]})}),e.jsx(je,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>Ye(n.id,u,"completed"),disabled:a.status==="completed",children:e.jsx(ke,{className:"h-4 w-4 text-green-500"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>Ye(n.id,u,"in_progress"),disabled:a.status==="in_progress",children:e.jsx(de,{className:"h-4 w-4 text-blue-500"})})]})})]},u))})]})]})]})})]},n.id))})})]}),e.jsx(Pt,{peerId:s,peerName:t?.name})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Z,{children:[e.jsx(K,{children:e.jsx(Q,{children:"Peer Info"})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-4",children:[t.company&&e.jsxs("div",{children:[e.jsx(b,{children:"Company"}),e.jsx("p",{className:"text-gray-600",children:t.company})]}),t.department&&e.jsxs("div",{children:[e.jsx(b,{children:"Department"}),e.jsx("p",{className:"text-gray-600",children:t.department})]}),t.skills?.length>0&&e.jsxs("div",{children:[e.jsx(b,{children:"Skills"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.skills.map((n,a)=>e.jsx(R,{variant:"secondary",children:n},a))})]}),t.notes&&e.jsxs("div",{children:[e.jsx(b,{children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap",children:t.notes})]}),t.contact_info&&e.jsxs("div",{children:[e.jsx(b,{children:"Contact Info"}),e.jsx("p",{className:"text-gray-600",children:t.contact_info})]})]})})]}),e.jsx(Tt,{peerId:s,showBreakdown:!0,showYearSelector:!0,onStatsChange:$}),e.jsxs(Z,{children:[e.jsx(K,{children:e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Next 1:1 Meeting"]})}),e.jsx(W,{children:F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Scheduled Date"}),e.jsx("p",{className:"text-gray-900 font-medium",children:I(A(F.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Status"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:F.hasCalendarEvent?e.jsxs(R,{variant:"outline",className:"text-green-700 border-green-200 bg-green-50",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Calendar Event Created"]}):e.jsxs(R,{variant:"outline",className:"text-yellow-700 border-yellow-200 bg-yellow-50",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"No Calendar Event"]})})]}),F.calendarEvent&&e.jsxs("div",{children:[e.jsx(b,{children:"Calendar Event"}),e.jsx("p",{className:"text-sm text-gray-600",children:F.calendarEvent.title})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>{De(F.meetingDate),Se(!0)},children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Reschedule"]}),e.jsxs(O,{variant:"outline",size:"sm",onClick:lt,className:"text-red-600 hover:text-red-700",children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"Cancel"]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No upcoming 1:1 scheduled"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Schedule your next meeting from any 1:1 record"})]})})]}),e.jsxs(Z,{children:[e.jsx(K,{children:e.jsx(Q,{children:"Quick Stats"})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Last 1:1"}),e.jsx("p",{className:"text-gray-600",children:c[0]?I(A(c[0].date),"PPP"):"No meetings yet"})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Meeting Frequency"}),e.jsx("p",{className:"text-gray-600",children:c.length>1?(()=>{const n=c.filter(u=>u.date).sort((u,S)=>new Date(S.date)-new Date(u.date));if(n.length<2)return"Insufficient data";const a=Math.round((new Date(n[0].date)-new Date(n[1].date))/(1e3*60*60*24));return a<=10?"Weekly":a<=20?"Bi-weekly":a<=35?"Monthly":"Irregular"})():"No pattern yet"})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Open Action Items"}),e.jsx("p",{className:"text-gray-600",children:c.reduce((n,a)=>n+(a.action_items?.filter(u=>u.status!=="completed").length||0),0)})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Agenda Items"}),e.jsxs("p",{className:"text-gray-600",children:[i.length," total, ",i.filter(n=>!n.isDiscussed).length," pending"]})]}),e.jsxs("div",{children:[e.jsx(b,{children:"Total 1:1s"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600",children:c.length}),c.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(since ",I(A(c[c.length-1].date),"MMM yyyy"),")"]})]})]})]})})]}),e.jsxs(Z,{children:[e.jsxs(K,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Next Agenda Items"]}),e.jsx(He,{children:"Items from other meetings where you are tagged"})]}),e.jsxs(W,{children:[i.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(Be,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No agenda items yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You'll see items here when others tag you in their meeting notes"})]}):e.jsx(Ct,{agendaItems:i.slice(0,5),peers:d.reduce((n,a)=>(n[a.id]=a,n),{}),onMarkDiscussed:rt,showActions:!0,emptyMessage:"No agenda items found"}),i.length>5&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Showing 5 of ",i.length," items"]})})]})]})]})]})]}),e.jsx(Me,{open:k,onOpenChange:E,children:e.jsxs(Ae,{className:"sm:max-w-lg",children:[e.jsx(Ie,{children:e.jsx($e,{children:"New 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Date"}),e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),M.date?I(A(M.date),"PPP"):"Select date"]})}),e.jsx(ge,{className:"w-auto p-0",children:e.jsx(fe,{mode:"single",selected:M.date?A(M.date):void 0,onSelect:n=>ce(a=>({...a,date:n?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Mood"}),e.jsxs(Y,{value:M.mood,onValueChange:n=>ce(a=>({...a,mood:n})),children:[e.jsx(z,{children:e.jsx(B,{})}),e.jsxs(V,{children:[e.jsx(y,{value:"great",children:"Great üòÑ"}),e.jsx(y,{value:"good",children:"Good üôÇ"}),e.jsx(y,{value:"neutral",children:"Neutral üòê"}),e.jsx(y,{value:"concerned",children:"Concerned üòü"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Notes"}),Array.isArray(M.notes)&&M.notes.length>0&&e.jsx("ul",{className:"list-disc pl-5 mb-2",children:M.notes.map((n,a)=>e.jsxs("li",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{children:n.text}),n.referenced_entity?.id&&e.jsxs("span",{className:"ml-2 text-xs bg-gray-200 rounded px-2 py-0.5",children:[n.referenced_entity.type==="peer"&&d.find(u=>u.id===n.referenced_entity.id)?.name,n.referenced_entity.type==="stakeholder"&&p.find(u=>u.id===n.referenced_entity.id)?.name,n.referenced_entity.type==="project"&&x.find(u=>u.id===n.referenced_entity.id)?.name]}),e.jsx(O,{variant:"ghost",size:"xs",className:"ml-2",onClick:()=>ce(u=>({...u,notes:u.notes.filter((S,T)=>T!==a)})),children:"Remove"})]},a))}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(Ee,{className:"flex-1",placeholder:"Note text...",value:J.text,onChange:n=>X(a=>({...a,text:n.target.value}))}),e.jsxs(Y,{value:C,onValueChange:n=>{Ce(n),he(""),X(a=>({...a,referenced_entity:{type:n,id:""}}))},children:[e.jsx(z,{className:"w-32",children:e.jsx(B,{placeholder:"No tag"})}),e.jsxs(V,{children:[e.jsx(y,{value:"none",children:"No tag"}),e.jsx(y,{value:"peer",children:"Peers"}),e.jsx(y,{value:"stakeholder",children:"Stakeholders"}),e.jsx(y,{value:"project",children:"Projects"})]})]}),C!=="none"&&e.jsxs(Y,{value:ae,onValueChange:n=>{he(n),X(a=>({...a,referenced_entity:{type:C,id:n}}))},children:[e.jsx(z,{className:"w-40",children:e.jsx(B,{placeholder:"Select name"})}),e.jsxs(V,{children:[C==="peer"&&d.filter(n=>n.id!==s).map(n=>e.jsx(y,{value:n.id,children:n.name},n.id)),C==="stakeholder"&&p.map(n=>e.jsx(y,{value:n.id,children:n.name},n.id)),C==="project"&&x.map(n=>e.jsx(y,{value:n.id,children:n.name},n.id))]})]}),e.jsx(O,{onClick:()=>{J.text&&(ce(n=>({...n,notes:[...Array.isArray(n.notes)?n.notes:[],{text:J.text,referenced_entity:C==="none"?{}:{type:C,id:ae},created_by:s,timestamp:new Date().toISOString()}]})),X({text:"",referenced_entity:{type:"peer",id:""}}),Ce("none"),he(""))},disabled:!J.text||C!=="none"&&!ae,children:"Add"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Next Meeting Date"}),e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),M.next_meeting_date?I(A(M.next_meeting_date),"PPP"):"Schedule next meeting"]})}),e.jsx(ge,{className:"w-auto p-0",children:e.jsx(fe,{mode:"single",selected:M.next_meeting_date?A(M.next_meeting_date):void 0,onSelect:n=>ce(a=>({...a,next_meeting_date:n?.toISOString()}))})})]})]})]}),e.jsxs(Fe,{children:[e.jsx(O,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),e.jsx(O,{onClick:tt,children:"Create Meeting"})]})]})}),e.jsx(Me,{open:w,onOpenChange:_,children:e.jsxs(Ae,{className:"sm:max-w-lg",children:[e.jsx(Ie,{children:e.jsx($e,{children:"Add Action Item"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Description"}),e.jsx(Ee,{value:ee.description,onChange:n=>Ne(a=>({...a,description:n.target.value})),placeholder:"What needs to be done?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Due Date"}),e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),ee.due_date?I(A(ee.due_date),"PPP"):"Set due date"]})}),e.jsx(ge,{className:"w-auto p-0",children:e.jsx(fe,{mode:"single",selected:ee.due_date?A(ee.due_date):void 0,onSelect:n=>Ne(a=>({...a,due_date:n?.toISOString()}))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Link to Task (Optional)"}),e.jsxs(Y,{value:ee.linked_task_id,onValueChange:n=>Ne(a=>({...a,linked_task_id:n})),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"Select a task"})}),e.jsxs(V,{children:[e.jsx(y,{value:null,children:"None"}),f.map(n=>e.jsx(y,{value:n.id,children:n.title},n.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Link to Project (Optional)"}),e.jsxs(Y,{value:ee.linked_project_id,onValueChange:n=>Ne(a=>({...a,linked_project_id:n})),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"Select a project"})}),e.jsxs(V,{children:[e.jsx(y,{value:null,children:"None"}),x.map(n=>e.jsx(y,{value:n.id,children:n.name},n.id))]})]})]})]}),e.jsxs(Fe,{children:[e.jsx(O,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsx(O,{onClick:st,children:"Add Action Item"})]})]})}),e.jsx(Me,{open:Xe,onOpenChange:Se,children:e.jsxs(Ae,{className:"sm:max-w-lg",children:[e.jsx(Ie,{children:e.jsx($e,{children:"Reschedule Next 1:1 Meeting"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Current Date"}),e.jsx("p",{className:"text-sm text-gray-600",children:F&&I(A(F.meetingDate),"PPP 'at' p")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"New Date"}),e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),re?I(A(re),"PPP"):"Select new date"]})}),e.jsx(ge,{className:"w-auto p-0",children:e.jsx(fe,{mode:"single",selected:re?A(re):void 0,onSelect:n=>De(n?.toISOString()||"")})})]})]})]}),e.jsxs(Fe,{children:[e.jsx(O,{variant:"outline",onClick:()=>{Se(!1),De("")},children:"Cancel"}),e.jsx(O,{onClick:it,disabled:!re,children:"Reschedule Meeting"})]})]})})]})}export{Bt as default};
