import{j as e,T as X,ao as Z,ap as I,aq as q,S as z,N as H,i as je,J as ye,Y as we,a0 as fe}from"./chunk-8WlaufA8.js";import{a as t}from"./chunk-pjYta8vt.js";import{g as ee,i as se,j as re,k as ae,h as te,A as L,a as M,b as E,L as m,I as h,l as be,B as u,n as R,o as g}from"./index-BK5E59O8.js";import{T as Ne,a as ve,b as Ce,c as ke}from"./chunk-BtUKRQ1H.js";import{T as De,a as Te,b as U,c as f,d as Pe,e as b}from"./chunk-B-BuOqLK.js";import{B as G,D as Y,a as Q,b as V,c as J,e as W,d as _}from"./chunk-Cg2ZZDgQ.js";import{D as Se,a as Ae,b as Fe,d as K}from"./chunk-DvQYMAQ6.js";import"./chunk-BQPSriyy.js";function Le(){const[n,x]=t.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[N,d]=t.useState(null),[l,v]=t.useState(null),[c,j]=t.useState(!1),y=(a,i)=>{x(C=>({...C,[a]:i}))},p=async a=>{if(a.preventDefault(),d(null),v(null),n.newPassword!==n.confirmPassword){d("New passwords do not match.");return}if(n.newPassword.length<8){d("New password must be at least 8 characters long.");return}j(!0);try{const i=R.getStoredToken();if(!i){d("You must be logged in to change your password."),j(!1);return}await R.changePassword(i.username,n.currentPassword,n.newPassword),v("Password changed successfully."),x({currentPassword:"",newPassword:"",confirmPassword:""})}catch(i){d(i.message||"Failed to change password. Please try again.")}finally{j(!1)}};return e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsx(re,{children:"Change Password"}),e.jsx(ae,{children:"Update your password here. After changing, you will be logged out and will need to log in again with the new password."})]}),e.jsxs("form",{onSubmit:p,children:[e.jsxs(te,{className:"space-y-4",children:[N&&e.jsxs(L,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(M,{children:"Error"}),e.jsx(E,{children:N})]}),l&&e.jsxs(L,{variant:"default",children:[e.jsx(M,{children:"Success"}),e.jsx(E,{children:l})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"currentPassword",children:"Current Password"}),e.jsx(h,{id:"currentPassword",type:"password",value:n.currentPassword,onChange:a=>y("currentPassword",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"newPassword",children:"New Password"}),e.jsx(h,{id:"newPassword",type:"password",value:n.newPassword,onChange:a=>y("newPassword",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(h,{id:"confirmPassword",type:"password",value:n.confirmPassword,onChange:a=>y("confirmPassword",a.target.value),required:!0})]})]}),e.jsx(be,{children:e.jsxs(u,{type:"submit",disabled:c,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),c?"Saving...":"Save Changes"]})})]})]})}function He(){const[n,x]=t.useState([]),[N,d]=t.useState(!0),[l,v]=t.useState("priorities"),[c,j]=t.useState(""),[y,p]=t.useState(!1),[a,i]=t.useState(null),[C,k]=t.useState(null),[ne,D]=t.useState(!1),[P,O]=t.useState(null),[o,S]=t.useState({type:"priority",name:"",description:"",color:"",order:0,default:!1}),A={priorities:"priority",taskTypes:"taskType",tags:"tag",statuses:"status"};t.useEffect(()=>{l!=="account"&&F()},[l]);const F=async()=>{d(!0),k(null);try{const s=await g.list();if(s.length===0){await le();const r=await g.list();x(r)}else x(s)}catch(s){console.error("Failed to load attributes:",s),k("Failed to load task attributes. Please try again.")}finally{d(!1)}},le=async()=>{const s=[{type:"priority",name:"low",description:"Low priority tasks",color:"blue",order:1,default:!0},{type:"priority",name:"medium",description:"Medium priority tasks",color:"yellow",order:2,default:!0},{type:"priority",name:"high",description:"High priority tasks",color:"orange",order:3,default:!0},{type:"priority",name:"urgent",description:"Urgent priority tasks",color:"red",order:4,default:!0},{type:"taskType",name:"generic",description:"Generic tasks",color:"gray",order:1,default:!0},{type:"taskType",name:"meeting",description:"Meeting tasks",color:"blue",order:2,default:!0},{type:"taskType",name:"metric",description:"Metric tracking tasks",color:"green",order:3,default:!0},{type:"taskType",name:"action",description:"Action items",color:"purple",order:4,default:!0},{type:"status",name:"backlog",description:"Backlog tasks",color:"gray",order:1,default:!0},{type:"status",name:"todo",description:"To-do tasks",color:"blue",order:2,default:!0},{type:"status",name:"in_progress",description:"In-progress tasks",color:"yellow",order:3,default:!0},{type:"status",name:"blocked",description:"Blocked tasks",color:"red",order:4,default:!0},{type:"status",name:"done",description:"Completed tasks",color:"green",order:5,default:!0},{type:"tag",name:"design",description:"Design-related tasks",color:"purple",order:1,default:!0},{type:"tag",name:"development",description:"Development tasks",color:"blue",order:2,default:!0},{type:"tag",name:"research",description:"Research tasks",color:"green",order:3,default:!0},{type:"tag",name:"planning",description:"Planning tasks",color:"yellow",order:4,default:!0}];await g.bulkCreate(s)},oe=s=>({blue:"bg-blue-100 text-blue-800 border-blue-200",green:"bg-green-100 text-green-800 border-green-200",red:"bg-red-100 text-red-800 border-red-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",purple:"bg-purple-100 text-purple-800 border-purple-200",orange:"bg-orange-100 text-orange-800 border-orange-200",pink:"bg-pink-100 text-pink-800 border-pink-200",indigo:"bg-indigo-100 text-indigo-800 border-indigo-200",gray:"bg-gray-100 text-gray-800 border-gray-200"})[s]||"bg-gray-100 text-gray-800 border-gray-200",ie=s=>{switch(s){case"priority":return e.jsx(I,{className:"h-4 w-4"});case"taskType":return e.jsx(q,{className:"h-4 w-4"});case"tag":return e.jsx(H,{className:"h-4 w-4"});case"status":return e.jsx(z,{className:"h-4 w-4"});default:return null}},de=s=>{v(s)},$=n.filter(s=>s.type!==A[l]?!1:c?s.name.toLowerCase().includes(c.toLowerCase())||s.description&&s.description.toLowerCase().includes(c.toLowerCase()):!0).sort((s,r)=>s.order-r.order),ce=()=>{S({type:A[l],name:"",description:"",color:"blue",order:ue(),default:!1}),i(null),p(!0)},ue=()=>{const s=n.filter(w=>w.type===A[l]);return s.length===0?1:Math.max(...s.map(w=>w.order||0))+1},pe=s=>{S({type:s.type,name:s.name||"",description:s.description||"",color:s.color||"blue",order:s.order||0,default:s.default||!1}),i(s),p(!0)},me=s=>{O(s),D(!0)},he=async()=>{if(P)try{await g.delete(P.id),await F(),D(!1),O(null)}catch(s){console.error("Failed to delete attribute:",s),k("Failed to delete attribute. Please try again.")}},T=(s,r)=>{S(w=>({...w,[s]:r}))},ge=async()=>{try{a?await g.update(a.id,o):await g.create(o),p(!1),await F()}catch(s){console.error("Failed to save attribute:",s),k("Failed to save attribute. Please try again.")}},B=[{id:"priorities",label:"Priorities",icon:I},{id:"taskTypes",label:"Task Types",icon:q},{id:"statuses",label:"Statuses",icon:z},{id:"tags",label:"Tags",icon:H},{id:"account",label:"Account",icon:je}],xe=[{id:"blue",name:"Blue"},{id:"green",name:"Green"},{id:"red",name:"Red"},{id:"yellow",name:"Yellow"},{id:"purple",name:"Purple"},{id:"orange",name:"Orange"},{id:"pink",name:"Pink"},{id:"indigo",name:"Indigo"},{id:"gray",name:"Gray"}];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Settings"}),e.jsxs(Ne,{defaultValue:"priorities",value:l,onValueChange:de,className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx(ve,{className:"bg-gray-100",children:B.map(s=>e.jsxs(Ce,{value:s.id,className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{children:s.label})]},s.id))}),l!=="account"&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(h,{placeholder:`Search ${l}...`,value:c,onChange:s=>j(s.target.value),className:"pl-9"})]}),e.jsxs(u,{onClick:ce,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Add New"]})]})]}),C&&e.jsxs(L,{variant:"destructive",className:"mb-6",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(M,{children:"Error"}),e.jsx(E,{children:C})]}),B.map(s=>e.jsx(ke,{value:s.id,className:"space-y-4",children:s.id!=="account"?e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-5 w-5"}),s.label]}),e.jsxs(ae,{children:["Manage ",s.label.toLowerCase()," for your tasks"]})]}),e.jsx(te,{children:N?e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading attributes..."})]}):$.length===0?e.jsx("div",{className:"text-center p-8 border border-dashed rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:c?`No ${s.label.toLowerCase()} found matching your search`:`No ${s.label.toLowerCase()} found. Add your first one!`})}):e.jsxs(De,{children:[e.jsx(Te,{children:e.jsxs(U,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Description"}),e.jsx(f,{children:"Color"}),e.jsx(f,{children:"Order"}),e.jsx(f,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Pe,{children:$.map(r=>e.jsxs(U,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",className:oe(r.color),children:[ie(r.type),e.jsx("span",{className:"ml-1",children:r.name})]}),r.default&&e.jsx(G,{variant:"outline",className:"text-xs",children:"Default"})]})}),e.jsx(b,{children:r.description||"-"}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${r.color?`bg-${r.color}-500`:"bg-gray-300"}`}),e.jsx("span",{className:"capitalize",children:r.color||"None"})]})}),e.jsx(b,{children:r.order}),e.jsx(b,{children:e.jsxs(Se,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(u,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})]})}),e.jsxs(Fe,{align:"end",children:[e.jsx(K,{onClick:()=>pe(r),children:"Edit"}),e.jsx(K,{className:"text-red-600",onClick:()=>me(r),children:"Delete"})]})]})})]},r.id))})]})})]}):e.jsx(Le,{})},s.id))]})]}),e.jsx(Y,{open:y,onOpenChange:p,children:e.jsxs(Q,{className:"sm:max-w-md",children:[e.jsxs(V,{children:[e.jsx(J,{children:a?`Edit ${o.type}`:`Create new ${o.type}`}),e.jsx(W,{children:a?`Edit the details for this ${o.type}`:`Add a new ${o.type} for your tasks`})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Name"}),e.jsx(h,{id:"name",value:o.name,onChange:s=>T("name",s.target.value),placeholder:`Enter ${o.type} name`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(h,{id:"description",value:o.description,onChange:s=>T("description",s.target.value),placeholder:"Optional description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Color"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:xe.map(s=>e.jsxs(u,{type:"button",variant:o.color===s.id?"default":"outline",className:"justify-start",onClick:()=>T("color",s.id),children:[e.jsx("div",{className:`w-4 h-4 rounded-full bg-${s.id}-500 mr-2`}),s.name]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"order",children:"Display Order"}),e.jsx(h,{id:"order",type:"number",min:"1",value:o.order,onChange:s=>T("order",parseInt(s.target.value))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Lower numbers appear first in lists"})]})]}),e.jsxs(_,{children:[e.jsx(u,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(u,{onClick:ge,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),a?"Update":"Create"]})]})]})}),e.jsx(Y,{open:ne,onOpenChange:D,children:e.jsxs(Q,{className:"sm:max-w-md",children:[e.jsxs(V,{children:[e.jsx(J,{children:"Confirm Deletion"}),e.jsxs(W,{children:["Are you sure you want to delete ",P?.name,"? This action cannot be undone."]})]}),e.jsxs(_,{className:"mt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsxs(u,{variant:"destructive",onClick:he,children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]})}export{He as default};
