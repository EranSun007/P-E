import{j as e,J as pe,X as Y,Y as Z,bh as ge,b6 as K,n as je,d as fe}from"./chunk-8WlaufA8.js";import{a as l}from"./chunk-pjYta8vt.js";import{I as ye}from"./chunk-KzYfAQy1.js";import{c as E,S as ee,e as se,I as C,B as k,g as W,i as J,j as Q,h as X,l as ve,P as be,E as Ne,L as ke}from"./index-BK5E59O8.js";import{T as H}from"./chunk-DSRmHbBO.js";import{S as A,a as _,b as M,c as P,d}from"./chunk-DktN3Kjy.js";import{P as ae,a as te,b as re,C as Ce}from"./chunk-N38jzkpe.js";import{_ as p,f as we}from"./chunk-BQPSriyy.js";import{B as Se}from"./chunk-Cg2ZZDgQ.js";import{s as w}from"./chunk-BdHZTqfh.js";import{T as Ae}from"./chunk-UjCvYLMJ.js";const ne=l.forwardRef(({className:t,...a},n)=>e.jsx(p,{ref:n,className:E("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...a}));ne.displayName=p.displayName;const le=l.forwardRef(({className:t,...a},n)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(pe,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(p.Input,{ref:n,className:E("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...a})]}));le.displayName=p.Input.displayName;const _e=l.forwardRef(({className:t,...a},n)=>e.jsx(p.List,{ref:n,className:E("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...a}));_e.displayName=p.List.displayName;const ce=l.forwardRef((t,a)=>e.jsx(p.Empty,{ref:a,className:"py-6 text-center text-sm",...t}));ce.displayName=p.Empty.displayName;const O=l.forwardRef(({className:t,...a},n)=>e.jsx(p.Group,{ref:n,className:E("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...a}));O.displayName=p.Group.displayName;const Me=l.forwardRef(({className:t,...a},n)=>e.jsx(p.Separator,{ref:n,className:E("-mx-1 h-px bg-border",t),...a}));Me.displayName=p.Separator.displayName;const z=l.forwardRef(({className:t,...a},n)=>e.jsx(p.Item,{ref:n,className:E("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...a}));z.displayName=p.Item.displayName;function Pe({metadata:t={},onChange:a}){const n={location:"",participants:[],agenda:[],...t},[m,u]=l.useState([]),[b,F]=l.useState([]),[j,N]=l.useState([]),[f,c]=l.useState(!1),[y,L]=l.useState("");l.useEffect(()=>{Array.isArray(n.agenda)&&L(n.agenda.join(`
`))},[]),l.useEffect(()=>{N(w(t?.participants))},[t]),l.useEffect(()=>{T()},[]);const T=async()=>{try{const[r,h]=await Promise.all([ee.list().catch(()=>[]),se.list().catch(()=>[])]);u(w(r)),F(w(h))}catch(r){console.error("Error loading participants:",r),u([]),F([])}},S=(r,h)=>{a({...n,[r]:h})},V=r=>{const h=r.target.value;L(h);const v=h.split(`
`).map(I=>I.trim()).filter(Boolean);S("agenda",v)},q=r=>{if(!j.includes(r)){const h=[...j,r];N(h),S("participants",h)}c(!1)},R=r=>{const h=j.filter(v=>v!==r);N(h),S("participants",h)};return e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("h3",{className:"font-medium text-lg mb-4",children:"Meeting Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Location"}),e.jsx(C,{value:n.location||"",onChange:r=>S("location",r.target.value),placeholder:"Meeting location or link"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Participants"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1 p-1 border rounded-md min-h-10",children:w(j).map(r=>e.jsxs(Se,{variant:"secondary",className:"flex items-center gap-1",children:[r,e.jsx("button",{type:"button",onClick:()=>R(r),className:"ml-1 rounded-full hover:bg-gray-200 p-0.5",children:e.jsx(Y,{className:"h-3 w-3"})})]},r))}),e.jsxs(ae,{open:f,onOpenChange:c,children:[e.jsx(te,{asChild:!0,children:e.jsxs(k,{variant:"outline",size:"sm",className:"w-full justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Add participants"]}),e.jsx(ge,{className:"h-4 w-4 opacity-50"})]})}),e.jsx(re,{className:"p-0",align:"start",children:e.jsxs(ne,{children:[e.jsx(le,{placeholder:"Search participants..."}),e.jsx(ce,{children:"No participants found."}),w(b).length>0&&e.jsx(O,{heading:"Team Members",children:w(b).map(r=>e.jsxs(z,{onSelect:()=>q(r.name),children:[e.jsx(K,{className:`mr-2 h-4 w-4 ${j.includes(r.name)?"opacity-100":"opacity-0"}`}),r.name]},r.id))}),w(m).length>0&&e.jsx(O,{heading:"Stakeholder Groups",children:w(m).map(r=>e.jsxs(z,{onSelect:()=>q(r.name),children:[e.jsx(K,{className:`mr-2 h-4 w-4 ${j.includes(r.name)?"opacity-100":"opacity-0"}`}),r.name]},r.id))})]})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Agenda Items"}),e.jsx(H,{value:y,onChange:V,placeholder:"Enter agenda items (one per line)",className:"h-24"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter each agenda item on a new line"})]})]})]})}function Ee({metadata:t={},onChange:a}){const n=(m,u)=>{a({...t,[m]:u})};return e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("h3",{className:"font-medium text-lg mb-4",children:"Metric Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"KPI Name"}),e.jsx(C,{value:t.kpi_name||"",onChange:m=>n("kpi_name",m.target.value),placeholder:"e.g. Monthly Active Users"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Current Value"}),e.jsx(C,{value:t.current_value||"",onChange:m=>n("current_value",m.target.value),placeholder:"Current metric value"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Value"}),e.jsx(C,{value:t.target_value||"",onChange:m=>n("target_value",m.target.value),placeholder:"Target metric value"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Measurement Frequency"}),e.jsxs(A,{value:t.measurement_frequency||"",onValueChange:m=>n("measurement_frequency",m),children:[e.jsx(_,{children:e.jsx(M,{placeholder:"Select frequency"})}),e.jsxs(P,{children:[e.jsx(d,{value:"daily",children:"Daily"}),e.jsx(d,{value:"weekly",children:"Weekly"}),e.jsx(d,{value:"biweekly",children:"Bi-weekly"}),e.jsx(d,{value:"monthly",children:"Monthly"}),e.jsx(d,{value:"quarterly",children:"Quarterly"})]})]})]})]})]})}function Ie({metadata:t={},onChange:a}){const n=(u,b)=>{a({...t,[u]:b})},m=u=>{n("dependencies",u.split(",").map(b=>b.trim()).filter(Boolean))};return e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("h3",{className:"font-medium text-lg mb-4",children:"Action Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Expected Outcome"}),e.jsx(H,{value:t.outcome||"",onChange:u=>n("outcome",u.target.value),placeholder:"What should be accomplished by this action item",className:"h-24"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dependencies"}),e.jsx(C,{value:t.dependencies?.join(", ")||"",onChange:u=>m(u.target.value),placeholder:"Comma-separated list of dependencies"})]})]})]})}function ze({onCreateTask:t,initialTaskData:a=null}){const[n,m]=l.useState(""),[u,b]=l.useState(!1),[F,j]=l.useState(!!a),N={title:"",description:"",type:"generic",status:"todo",priority:"medium",project:"",due_date:"",assignee:"",estimated_hours:"",actual_hours:"",stakeholders:[],tags:[],strategic:!1,reminders:[],subtasks:[],metadata:{meeting:{participants:[],agenda:[],location:""},metric:{kpi_name:"",current_value:"",target_value:"",measurement_frequency:""},action:{outcome:"",dependencies:[]}}};let f={...N};a&&(f={...f,...a},f.stakeholders=Array.isArray(a.stakeholders)?[...a.stakeholders]:[],f.tags=Array.isArray(a.tags)?[...a.tags]:[],f.reminders=Array.isArray(a.reminders)?[...a.reminders]:[],f.subtasks=Array.isArray(a.subtasks)?[...a.subtasks]:[],f.metadata={...N.metadata,...a.metadata||{}},a.metadata?.meeting&&(f.metadata.meeting={...N.metadata.meeting,...a.metadata.meeting,participants:Array.isArray(a.metadata.meeting.participants)?[...a.metadata.meeting.participants]:[],agenda:Array.isArray(a.metadata.meeting.agenda)?[...a.metadata.meeting.agenda]:[]}),a.metadata?.action?.dependencies&&(f.metadata.action.dependencies=Array.isArray(a.metadata.action.dependencies)?[...a.metadata.action.dependencies]:[]));const[c,y]=l.useState(f),[L,T]=l.useState([]),[S,V]=l.useState([]),[q,R]=l.useState([]),[r,h]=l.useState([]),[v,I]=l.useState(""),[ie,B]=l.useState(""),[G,D]=l.useState("");l.useEffect(()=>{const s=async()=>{try{const x=await be.list();T(x||[])}catch(x){console.error("Error loading projects:",x),T([])}},i=async()=>{try{const x=await ee.list();V(x||[])}catch(x){console.error("Error loading stakeholders:",x),V([])}},o=async()=>{try{const[x,xe]=await Promise.all([se.list(),Ne.list()]);R(x||[]),h(xe||[])}catch{R([]),h([])}};s(),i(),o()},[]),l.useEffect(()=>{a&&a.assignee&&typeof a.assignee=="object"?(I(a.assignee.type),B(a.assignee.id)):(I(""),B(""))},[a]);const U=async()=>{if(n.trim()){b(!0);try{const s=await ye(),i={...s,stakeholders:Array.isArray(s.stakeholders)?s.stakeholders:[],tags:Array.isArray(s.tags)?s.tags:[],metadata:{...s.metadata||{},meeting:{...s.metadata?.meeting||{},participants:Array.isArray(s.metadata?.meeting?.participants)?s.metadata.meeting.participants:[],agenda:Array.isArray(s.metadata?.meeting?.agenda)?s.metadata.meeting.agenda:[]}}},o={...N,...i};y(o),j(!0)}catch(s){console.error("Error processing natural language input:",s),y({...N,title:n}),j(!0)}finally{b(!1)}}},de=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),U())},g=(s,i)=>{if(s==="tags"||s==="stakeholders"||s==="reminders"){const o=Array.isArray(i)?i:[];y(x=>({...x,[s]:o}))}else y(o=>({...o,[s]:i}))},oe=s=>{s.preventDefault(),t(c),m(""),y({title:"",description:"",type:"generic",status:"todo",priority:"medium",project:"",due_date:"",assignee:"",estimated_hours:"",actual_hours:"",stakeholders:[],tags:[],strategic:!1,reminders:[],subtasks:[],metadata:{meeting:{participants:[],agenda:[],location:""},metric:{kpi_name:"",current_value:"",target_value:"",measurement_frequency:""},action:{outcome:"",dependencies:[]}}}),j(!1)},me=()=>{const s=c.metadata||{};switch(c.type){case"meeting":return e.jsx(Pe,{metadata:s.meeting||{participants:[],agenda:[],location:""},onChange:i=>y(o=>({...o,metadata:{...o.metadata,meeting:i}}))});case"metric":return e.jsx(Ee,{metadata:s.metric||{},onChange:i=>y(o=>({...o,metadata:{...o.metadata,metric:i}}))});case"action":return e.jsx(Ie,{metadata:s.action||{},onChange:i=>y(o=>({...o,metadata:{...o.metadata,action:i}}))});default:return null}},$=()=>{G.trim()&&(y(s=>({...s,subtasks:[...Array.isArray(s.subtasks)?s.subtasks:[],{title:G.trim(),done:!1}]})),D(""))},ue=s=>{y(i=>({...i,subtasks:i.subtasks.filter((o,x)=>x!==s)}))},he=()=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(ke,{children:"Subtasks"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:G,onChange:s=>D(s.target.value),placeholder:"Add a subtask",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),$())}}),e.jsx(k,{type:"button",onClick:$,children:e.jsx(Z,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2 mt-2",children:Array.isArray(c.subtasks)&&c.subtasks.map((s,i)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"flex-1 text-sm",children:s.title}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>ue(i),children:e.jsx(Y,{className:"h-4 w-4"})})]},i))})]});return e.jsx("div",{className:"w-full",children:F?e.jsxs(W,{children:[e.jsx(J,{children:e.jsx(Q,{children:a?"Edit Task":"Task Details"})}),e.jsx(X,{children:e.jsxs("form",{onSubmit:oe,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Title"}),e.jsx(C,{value:c.title,onChange:s=>g("title",s.target.value),placeholder:"Task title",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx(H,{value:c.description||"",onChange:s=>g("description",s.target.value),placeholder:"Task description",className:"h-20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Task Type"}),e.jsxs(A,{value:c.type,onValueChange:s=>g("type",s),children:[e.jsx(_,{children:e.jsx(M,{placeholder:"Select type"})}),e.jsxs(P,{children:[e.jsx(d,{value:"generic",children:"Generic"}),e.jsx(d,{value:"meeting",children:"Meeting"}),e.jsx(d,{value:"metric",children:"Metric"}),e.jsx(d,{value:"action",children:"Action"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Priority"}),e.jsxs(A,{value:c.priority,onValueChange:s=>g("priority",s),children:[e.jsx(_,{children:e.jsx(M,{placeholder:"Select priority"})}),e.jsxs(P,{children:[e.jsx(d,{value:"low",children:"Low"}),e.jsx(d,{value:"medium",children:"Medium"}),e.jsx(d,{value:"high",children:"High"}),e.jsx(d,{value:"urgent",children:"Urgent"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Project"}),e.jsxs(A,{value:c.project||"",onValueChange:s=>g("project",s),children:[e.jsx(_,{children:e.jsx(M,{placeholder:"Select project"})}),e.jsxs(P,{children:[e.jsx(d,{value:null,children:"No Project"}),L.map(s=>e.jsx(d,{value:s.name,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Due Date & Time"}),e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),c.due_date?we(new Date(c.due_date),"PPP p"):e.jsx("span",{children:"Pick a date & time"})]})}),e.jsx(re,{className:"w-auto p-0",children:e.jsx(Ce,{mode:"single",selected:c.due_date?new Date(c.due_date):void 0,onSelect:s=>{if(s){const i=new Date(s),o=new Date;i.setHours(o.getHours()),i.setMinutes(o.getMinutes()),g("due_date",i.toISOString())}}})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Assignee Type"}),e.jsxs(A,{value:v,onValueChange:s=>{I(s),B(""),g("assignee","")},children:[e.jsx(_,{children:e.jsx(M,{placeholder:"Select type"})}),e.jsxs(P,{children:[e.jsx(d,{value:"stakeholder",children:"Stakeholder"}),e.jsx(d,{value:"member",children:"Team Member"}),e.jsx(d,{value:"peer",children:"Peer"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Assignee"}),e.jsxs(A,{value:ie,onValueChange:s=>{B(s),g("assignee",s?{type:v,id:s}:"")},disabled:!v,children:[e.jsx(_,{children:e.jsx(M,{placeholder:v?"Select assignee":"Select type first"})}),e.jsxs(P,{children:[v==="stakeholder"&&S.map(s=>e.jsx(d,{value:s.id,children:s.name},s.id)),v==="member"&&q.map(s=>e.jsx(d,{value:s.id,children:s.name},s.id)),v==="peer"&&r.map(s=>e.jsx(d,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Strategic"}),e.jsxs(k,{type:"button",variant:c.strategic?"default":"outline",className:"w-full justify-start",onClick:()=>g("strategic",!c.strategic),children:[c.strategic&&e.jsx(K,{className:"mr-2 h-4 w-4"}),c.strategic?"Strategic Task":"Tactical Task"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Estimated Hours"}),e.jsx(C,{type:"number",step:"0.5",min:"0",value:c.estimated_hours||"",onChange:s=>g("estimated_hours",s.target.value),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Actual Hours"}),e.jsx(C,{type:"number",step:"0.5",min:"0",value:c.actual_hours||"",onChange:s=>g("actual_hours",s.target.value),placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tags"}),e.jsx(Ae,{value:Array.isArray(c.tags)?c.tags:[],onChange:s=>g("tags",s),placeholder:"Add tags to categorize your task"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Stakeholders"}),e.jsxs(A,{value:(c.stakeholders||[])[0]||"",onValueChange:s=>{g("stakeholders",s?[s]:[])},children:[e.jsx(_,{children:e.jsx(M,{placeholder:"Select a stakeholder"})}),e.jsxs(P,{children:[e.jsx(d,{value:null,children:"None"}),S.map(s=>e.jsxs(d,{value:s.name,children:[s.name," ",s.role&&`(${s.role})`]},s.id))]})]})]})]}),he(),me(),e.jsx(ve,{className:"px-0 pt-4",children:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>{a?t(null):j(!1)},children:"Cancel"}),e.jsx(k,{type:"submit",children:a?"Update Task":"Create Task"})]})})]})})]}):e.jsxs(W,{children:[e.jsx(J,{children:e.jsx(Q,{children:"Create New Task"})}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(H,{placeholder:"Enter task naturally: 'Schedule quarterly review meeting with design team next Tuesday at 2pm'",value:n,onChange:s=>m(s.target.value),onKeyDown:de,className:"h-24",disabled:u})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(k,{variant:"outline",onClick:()=>j(!0),children:"Enter Details Manually"}),e.jsx(k,{onClick:U,disabled:!n.trim()||u,className:"relative",children:u?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Create Task"})]})]})})]})})}export{ze as default};
