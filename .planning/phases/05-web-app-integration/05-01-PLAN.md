---
phase: 05-web-app-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/apiClient.js
  - src/api/entities.js
  - src/pages/JiraIssues.jsx
  - src/pages/index.jsx
  - src/pages/Layout.jsx
autonomous: true

must_haves:
  truths:
    - "Jira Issues page lists all synced issues from backend"
    - "User can filter issues by status, assignee, and sprint"
    - "User can search issues by key or summary"
    - "Clicking an issue key opens Jira in new tab"
    - "Sync status indicator shows data freshness"
    - "Page accessible from navigation sidebar"
  artifacts:
    - path: "src/api/apiClient.js"
      provides: "JiraIssue and JiraMapping entity clients"
      contains: "JiraIssue:"
    - path: "src/api/entities.js"
      provides: "Exported JiraIssue and JiraMapping entities"
      contains: "export const JiraIssue"
    - path: "src/pages/JiraIssues.jsx"
      provides: "Main Jira Issues page component"
      contains: "export default function JiraIssuesPage"
    - path: "src/pages/index.jsx"
      provides: "Route registration for /Jira path"
      contains: "JiraIssues"
    - path: "src/pages/Layout.jsx"
      provides: "Navigation item for Jira Issues"
      contains: "Jira"
  key_links:
    - from: "src/pages/JiraIssues.jsx"
      to: "src/api/entities.js"
      via: "import { JiraIssue } from @/api/entities"
      pattern: "import.*JiraIssue.*from.*entities"
    - from: "src/api/entities.js"
      to: "src/api/apiClient.js"
      via: "apiClient.entities.JiraIssue"
      pattern: "apiClient.entities.JiraIssue"
    - from: "src/pages/index.jsx"
      to: "src/pages/JiraIssues.jsx"
      via: "lazy(() => import('./JiraIssues'))"
      pattern: "lazy.*JiraIssues"
---

<objective>
Create the Jira Issues page with API client integration, filtering, and navigation.

Purpose: Users can view and filter all synced Jira issues directly in the P&E Manager web app without switching to Jira.
Output: Functional JiraIssues page with entity client, routing, navigation, filtering by status/assignee/sprint, and sync status display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-web-app-integration/05-RESEARCH.md

# Key existing files to modify
@src/api/apiClient.js
@src/api/entities.js
@src/pages/index.jsx
@src/pages/Layout.jsx

# Reference patterns
@src/pages/GitHubRepos.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add JiraIssue and JiraMapping entity clients to apiClient.js</name>
  <files>src/api/apiClient.js</files>
  <action>
Add two new entity clients to the `entities` object in apiClient.js.

1. Create JiraIssue client with custom methods (add before the comment "// Additional entities"):

```javascript
JiraIssue: {
  ...createEntityClient('/jira-issues'),

  // Get all issues with optional filters
  async listWithFilters(filters = {}) {
    const params = new URLSearchParams();
    if (filters.status) params.append('status', filters.status);
    if (filters.assignee) params.append('assignee', filters.assignee);
    if (filters.sprint) params.append('sprint', filters.sprint);
    const queryString = params.toString();
    const url = `${API_BASE_URL}/jira-issues${queryString ? '?' + queryString : ''}`;
    return fetchWithAuth(url);
  },

  // Get unique filter options (statuses, assignees, sprints)
  async getFilterOptions() {
    return fetchWithAuth(`${API_BASE_URL}/jira-issues/filters`);
  },

  // Get sync status (last synced timestamp, issue count)
  async getSyncStatus() {
    return fetchWithAuth(`${API_BASE_URL}/jira-issues/status`);
  }
},

JiraMapping: createEntityClient('/jira-mappings'),
```

2. Place these before the "// Additional entities" comment, after TimeOff.

Note: The backend API endpoints already exist from Phase 1 (/api/jira-issues, /api/jira-issues/filters, /api/jira-issues/status, /api/jira-mappings).
  </action>
  <verify>
Open src/api/apiClient.js and confirm JiraIssue and JiraMapping are in the entities object.
Start dev server: `npm run dev`
Test in browser console: `apiClient.entities.JiraIssue.list()` should return array (may be empty).
  </verify>
  <done>JiraIssue entity client has list, listWithFilters, getFilterOptions, getSyncStatus methods. JiraMapping has standard CRUD.</done>
</task>

<task type="auto">
  <name>Task 2: Export JiraIssue and JiraMapping from entities.js</name>
  <files>src/api/entities.js</files>
  <action>
Add exports for the new Jira entities at the bottom of entities.js, following the GitHub pattern.

Add after the GitHub export block:

```javascript
// Jira Integration API (only available with API mode)
export const JiraIssue = USE_API ? apiClient.entities.JiraIssue : {
  list: async () => { throw new Error('Jira integration not available in local mode'); },
  listWithFilters: async () => { throw new Error('Jira integration not available in local mode'); },
  getFilterOptions: async () => { throw new Error('Jira integration not available in local mode'); },
  getSyncStatus: async () => { throw new Error('Jira integration not available in local mode'); },
  get: async () => { throw new Error('Jira integration not available in local mode'); },
  create: async () => { throw new Error('Jira integration not available in local mode'); },
  update: async () => { throw new Error('Jira integration not available in local mode'); },
  delete: async () => { throw new Error('Jira integration not available in local mode'); },
};

export const JiraMapping = USE_API ? apiClient.entities.JiraMapping : {
  list: async () => { throw new Error('Jira mapping not available in local mode'); },
  get: async () => { throw new Error('Jira mapping not available in local mode'); },
  create: async () => { throw new Error('Jira mapping not available in local mode'); },
  update: async () => { throw new Error('Jira mapping not available in local mode'); },
  delete: async () => { throw new Error('Jira mapping not available in local mode'); },
};
```
  </action>
  <verify>
In browser console with dev server running:
```javascript
import { JiraIssue, JiraMapping } from '/src/api/entities.js';
console.log(JiraIssue); // Should show object with methods
```
  </verify>
  <done>JiraIssue and JiraMapping exported from entities.js with local mode fallbacks that throw helpful errors.</done>
</task>

<task type="auto">
  <name>Task 3: Create JiraIssues page component with filtering and sync status</name>
  <files>src/pages/JiraIssues.jsx</files>
  <action>
Create a new file `src/pages/JiraIssues.jsx` following the GitHubRepos.jsx pattern.

The page should include:

1. **State management:**
   - loading, error states
   - issues array
   - syncStatus (last_synced_at, issue_count)
   - filters: { status: [], assignee: [], sprint: null, search: '' }
   - filterOptions: { statuses: [], assignees: [], sprints: [] }

2. **Data loading:**
   - useEffect to load issues, filter options, and sync status on mount
   - Reload when filters change

3. **Header section:**
   - Title: "Jira Issues" with Bug icon (from lucide-react)
   - Subtitle: "View synced Jira issues from your team"
   - Sync status indicator showing last sync time (use formatTimeAgo pattern from GitHubRepos)

4. **Summary cards (4 cards):**
   - Total Issues (count)
   - In Progress (blue)
   - Done (green)
   - Total Points (purple)

5. **Filter bar:**
   - Search input (filters by issue_key or summary)
   - Status dropdown (checkboxes for multiple selection)
   - Assignee dropdown (checkboxes for multiple selection)
   - Sprint select (single selection)
   - Clear filters button (only show if filters active)

6. **Issues table:**
   - Columns: Issue Key (link to Jira), Summary, Status (badge), Assignee, Points, Sprint
   - Issue key should link to issue.url with target="_blank" rel="noopener noreferrer"
   - Status badge colors: Done=green, In Progress=blue, To Do=gray
   - Empty state when no issues

7. **Imports needed:**
   ```javascript
   import { useState, useEffect, useMemo } from "react";
   import { JiraIssue } from "@/api/entities";
   import {
     Bug, RefreshCw, Search, Filter, X, Clock, Loader2, ExternalLink
   } from "lucide-react";
   import { Card, CardContent } from "@/components/ui/card";
   import { Input } from "@/components/ui/input";
   import { Button } from "@/components/ui/button";
   import { Badge } from "@/components/ui/badge";
   import { Alert, AlertDescription } from "@/components/ui/alert";
   import {
     Table, TableBody, TableCell, TableHead, TableHeader, TableRow
   } from "@/components/ui/table";
   import {
     DropdownMenu, DropdownMenuTrigger, DropdownMenuContent,
     DropdownMenuCheckboxItem, DropdownMenuSeparator
   } from "@/components/ui/dropdown-menu";
   import {
     Select, SelectContent, SelectItem, SelectTrigger, SelectValue
   } from "@/components/ui/select";
   ```

8. **Client-side filtering:**
   - Filter loaded issues by search term (case-insensitive match on issue_key or summary)
   - Use useMemo for filtered issues to avoid recalculating on every render

Export as default: `export default function JiraIssuesPage() { ... }`
  </action>
  <verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:5173/Jira
3. Page should load (may show empty state or "no issues" if no data synced)
4. Filters should appear and be interactive
5. If issues exist, table should display them with links to Jira
  </verify>
  <done>JiraIssues page component renders issues table with filtering by status/assignee/sprint/search, summary cards, and sync status indicator.</done>
</task>

<task type="auto">
  <name>Task 4: Register route and add navigation item</name>
  <files>src/pages/index.jsx, src/pages/Layout.jsx</files>
  <action>
**In src/pages/index.jsx:**

1. Add lazy import after GitHubRepos:
```javascript
const JiraIssues = lazy(() => retryImport(() => import(/* webpackChunkName: "pages-jira-issues" */ "./JiraIssues"), 3, 1000));
```

2. Add to PAGES object after GitHubRepos:
```javascript
JiraIssues: JiraIssues,
```

3. Add Route after the GitHub route:
```javascript
<Route path="/Jira" element={<JiraIssues />} />
```

**In src/pages/Layout.jsx:**

1. Import Bug icon from lucide-react (add to existing imports):
```javascript
import {
  // ... existing imports
  Bug,
} from "lucide-react";
```

2. Add navigation item to peopleNavigation array after the GitHub item:
```javascript
{
  name: "Jira",
  icon: Bug,
  href: createPageUrl("Jira"),
  current: currentPageName === "JiraIssues"
}
```

Note: The href uses "Jira" (the route path) while current checks "JiraIssues" (the page name in PAGES object).
  </action>
  <verify>
1. Start dev server: `npm run dev`
2. In sidebar, "Jira" item should appear after "GitHub"
3. Click "Jira" - should navigate to /Jira and load JiraIssues page
4. Jira nav item should be highlighted when on /Jira page
  </verify>
  <done>Route registered at /Jira, navigation item added to sidebar with Bug icon, page loads via lazy loading.</done>
</task>

</tasks>

<verification>
Phase 5 Plan 01 success criteria verified:

1. **Jira Issues page lists all synced issues:**
   - Navigate to /Jira, issues table shows data from backend

2. **Filtering works (status, assignee, sprint):**
   - Click filter dropdowns, select options, table updates

3. **Search works:**
   - Type in search box, table filters by issue_key or summary

4. **External links work:**
   - Click issue key, opens Jira in new tab

5. **Sync status shows data freshness:**
   - Header shows "Last synced: Xm ago" or similar

6. **Navigation works:**
   - Sidebar has "Jira" item, clicking navigates to page

```bash
# Quick verification commands
npm run dev
# Open http://localhost:5173/Jira
# Check sidebar has Jira item
# Check page loads without errors
# Check filters are interactive
```
</verification>

<success_criteria>
- [ ] JiraIssue and JiraMapping entities in apiClient.js with custom methods
- [ ] JiraIssue and JiraMapping exported from entities.js
- [ ] JiraIssues.jsx page component exists and renders
- [ ] Summary cards show issue counts
- [ ] Filter bar has search, status, assignee, sprint controls
- [ ] Issues table shows data with external links
- [ ] Sync status indicator shows last sync time
- [ ] Route registered at /Jira in index.jsx
- [ ] Navigation item with Bug icon in Layout.jsx
- [ ] Page accessible from sidebar navigation
</success_criteria>

<output>
After completion, create `.planning/phases/05-web-app-integration/05-01-SUMMARY.md`
</output>
