---
phase: 22-team-status-page
plan: 02
type: execute
wave: 2
depends_on: ["22-01"]
files_modified:
  - src/utils/healthCalculation.js
  - src/components/team-status/MetricsBanner.jsx
  - src/components/team-status/MemberCard.jsx
  - src/components/team-status/TimelineNav.jsx
  - src/components/team-status/TeamHealthBadge.jsx
  - src/pages/TeamStatus.jsx
autonomous: true

must_haves:
  truths:
    - "User sees aggregate metrics banner (Completed / Blockers / Velocity)"
    - "User sees member cards with health indicator borders"
    - "User can expand member card to see full summary"
    - "User can navigate between weeks using prev/next arrows"
    - "Health indicators show correct color based on blockers and activity"
  artifacts:
    - path: "src/utils/healthCalculation.js"
      provides: "Health status calculation logic"
      exports: ["calculateHealth"]
    - path: "src/components/team-status/MetricsBanner.jsx"
      provides: "Aggregate team metrics display"
      min_lines: 30
    - path: "src/components/team-status/MemberCard.jsx"
      provides: "Collapsible member summary card"
      min_lines: 60
    - path: "src/components/team-status/TimelineNav.jsx"
      provides: "Week navigation with sprint formatting"
      min_lines: 40
  key_links:
    - from: "src/components/team-status/MemberCard.jsx"
      to: "healthCalculation.js"
      via: "calculateHealth import"
      pattern: "import.*calculateHealth"
    - from: "src/pages/TeamStatus.jsx"
      to: "team-status components"
      via: "component imports"
      pattern: "import.*team-status"
---

<objective>
Build the UI components for Team Status dashboard: metrics banner, collapsible member cards with health indicators, and timeline navigation.

Purpose: Complete the Team Status page with interactive components that display team health, member summaries, and allow browsing weekly history.
Output: Fully functional Team Status dashboard matching phase context decisions.
</objective>

<execution_context>
@/Users/i306072/.claude/get-shit-done/workflows/execute-plan.md
@/Users/i306072/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-team-status-page/22-CONTEXT.md
@.planning/phases/22-team-status-page/22-RESEARCH.md
@.planning/phases/22-team-status-page/22-01-SUMMARY.md
@src/contexts/TeamStatusContext.jsx
@src/pages/TeamStatus.jsx
@src/utils/releaseCycles.js
@src/components/ui/card.jsx
@src/components/ui/collapsible.jsx
@src/components/ui/badge.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Health Calculation Utility and Core Components</name>
  <files>
    src/utils/healthCalculation.js
    src/components/team-status/MetricsBanner.jsx
    src/components/team-status/MemberCard.jsx
    src/components/team-status/TeamHealthBadge.jsx
  </files>
  <action>
Create the health calculation utility and core dashboard components.

**healthCalculation.js - Health status logic:**
```javascript
/**
 * Calculate health status from summary data
 * @param {Object} summary - Member summary with metrics
 * @returns {Object} { status: 'green'|'yellow'|'red', reasoning: string }
 */
export function calculateHealth(summary) {
  const {
    blockerCount = 0,
    completedCount = 0,
    lastUpdateDays = 0,
    itemCount = 0
  } = summary;

  // Red conditions (critical)
  if (blockerCount >= 2) {
    return {
      status: 'red',
      reasoning: `${blockerCount} blockers - immediate attention needed`
    };
  }

  if (lastUpdateDays > 3) {
    return {
      status: 'red',
      reasoning: `No updates in ${lastUpdateDays} days`
    };
  }

  // Yellow conditions (warning)
  if (blockerCount === 1) {
    return {
      status: 'yellow',
      reasoning: '1 blocker - monitor progress'
    };
  }

  if (completedCount === 0 && itemCount > 0 && lastUpdateDays > 1) {
    return {
      status: 'yellow',
      reasoning: 'Low activity, no completed items'
    };
  }

  // Green (healthy)
  const reasonText = completedCount > 0
    ? `${completedCount} items completed, on track`
    : 'No blockers, steady progress';

  return {
    status: 'green',
    reasoning: reasonText
  };
}

/**
 * Get Tailwind border color class for health status
 * @param {string} status - Health status
 * @returns {string} Tailwind class
 */
export function getHealthBorderClass(status) {
  const colors = {
    green: 'border-l-green-500',
    yellow: 'border-l-yellow-500',
    red: 'border-l-red-500'
  };
  return colors[status] || colors.green;
}

/**
 * Get text color class for health status
 * @param {string} status - Health status
 * @returns {string} Tailwind class
 */
export function getHealthTextClass(status) {
  const colors = {
    green: 'text-green-700 border-green-500',
    yellow: 'text-yellow-700 border-yellow-500',
    red: 'text-red-700 border-red-500'
  };
  return colors[status] || colors.green;
}
```

**MetricsBanner.jsx - Aggregate team metrics:**
```javascript
import { Card, CardContent } from '@/components/ui/card';
import { CheckCircle2, AlertTriangle, TrendingUp } from 'lucide-react';

export function MetricsBanner({ summaries = [] }) {
  // Calculate aggregate metrics
  const metrics = summaries.reduce((acc, summary) => ({
    completed: acc.completed + (summary.completedCount || 0),
    blockers: acc.blockers + (summary.blockerCount || 0),
    velocity: acc.velocity + (summary.completedCount || 0) // Simple count
  }), { completed: 0, blockers: 0, velocity: 0 });

  return (
    <Card>
      <CardContent className="py-4">
        <div className="grid grid-cols-3 divide-x">
          <div className="text-center px-4">
            <div className="flex items-center justify-center gap-2 mb-1">
              <CheckCircle2 className="h-4 w-4 text-green-600" />
              <span className="text-2xl font-bold">{metrics.completed}</span>
            </div>
            <div className="text-sm text-muted-foreground">Completed</div>
          </div>

          <div className="text-center px-4">
            <div className="flex items-center justify-center gap-2 mb-1">
              <AlertTriangle className={`h-4 w-4 ${metrics.blockers > 0 ? 'text-red-600' : 'text-muted-foreground'}`} />
              <span className="text-2xl font-bold">{metrics.blockers}</span>
            </div>
            <div className="text-sm text-muted-foreground">Blockers</div>
          </div>

          <div className="text-center px-4">
            <div className="flex items-center justify-center gap-2 mb-1">
              <TrendingUp className="h-4 w-4 text-blue-600" />
              <span className="text-2xl font-bold">{metrics.velocity}</span>
            </div>
            <div className="text-sm text-muted-foreground">Velocity</div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

**MemberCard.jsx - Collapsible member summary:**
```javascript
import { useState, useMemo } from 'react';
import { Collapsible, CollapsibleTrigger, CollapsibleContent } from '@/components/ui/collapsible';
import { Card } from '@/components/ui/card';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';
import { ChevronDown } from 'lucide-react';
import { calculateHealth, getHealthBorderClass } from '@/utils/healthCalculation';

export function MemberCard({ member, summary }) {
  const [isOpen, setIsOpen] = useState(false);

  // Memoize health calculation
  const health = useMemo(() => calculateHealth(summary), [summary]);
  const borderColor = getHealthBorderClass(health.status);

  // Get member initials from name
  const initials = member?.name
    ? member.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)
    : '??';

  return (
    <Collapsible open={isOpen} onOpenChange={setIsOpen}>
      <Card className={`border-l-4 ${borderColor} hover:shadow-md transition-shadow`}>
        <CollapsibleTrigger className="w-full text-left p-4 flex items-center gap-3">
          {/* Avatar */}
          <Avatar className="h-10 w-10">
            <AvatarFallback className="text-sm">{initials}</AvatarFallback>
          </Avatar>

          {/* Name and 1-line summary */}
          <div className="flex-1 min-w-0">
            <div className="font-medium">{member?.name || 'Unknown'}</div>
            <div className="text-sm text-muted-foreground truncate">
              {summary.oneLine || 'No updates this week'}
            </div>
          </div>

          {/* Metric badges */}
          <div className="flex gap-2 flex-shrink-0">
            {summary.completedCount > 0 && (
              <Badge variant="secondary" className="text-xs">
                {summary.completedCount} done
              </Badge>
            )}
            {summary.blockerCount > 0 && (
              <Badge variant="destructive" className="text-xs">
                {summary.blockerCount} blocker{summary.blockerCount > 1 ? 's' : ''}
              </Badge>
            )}
          </div>

          {/* Expand icon */}
          <ChevronDown
            className={`h-4 w-4 text-muted-foreground transition-transform flex-shrink-0 ${isOpen ? 'rotate-180' : ''}`}
          />
        </CollapsibleTrigger>

        <CollapsibleContent className="px-4 pb-4 space-y-3">
          {/* Full summary with all items */}
          {summary.items && summary.items.length > 0 && (
            <div className="text-sm space-y-2 pl-13">
              {summary.items.map((item, idx) => (
                <div key={item.id || idx} className="flex items-start gap-2">
                  <span className="text-muted-foreground">-</span>
                  <span>{item.text}</span>
                </div>
              ))}
            </div>
          )}

          {/* Health reasoning */}
          <div className="text-xs text-muted-foreground pt-2 border-t pl-13">
            <span className="font-medium">Status:</span> {health.reasoning}
          </div>
        </CollapsibleContent>
      </Card>
    </Collapsible>
  );
}
```

**TeamHealthBadge.jsx - Team health count breakdown:**
```javascript
import { Badge } from '@/components/ui/badge';
import { calculateHealth, getHealthTextClass } from '@/utils/healthCalculation';

export function TeamHealthBadge({ summaries = [] }) {
  // Count health statuses
  const healthCounts = summaries.reduce((acc, summary) => {
    const health = calculateHealth(summary);
    acc[health.status] = (acc[health.status] || 0) + 1;
    return acc;
  }, {});

  if (summaries.length === 0) {
    return null;
  }

  return (
    <div className="flex items-center gap-2 text-sm">
      {healthCounts.green > 0 && (
        <Badge variant="outline" className={getHealthTextClass('green')}>
          {healthCounts.green} green
        </Badge>
      )}
      {healthCounts.yellow > 0 && (
        <Badge variant="outline" className={getHealthTextClass('yellow')}>
          {healthCounts.yellow} yellow
        </Badge>
      )}
      {healthCounts.red > 0 && (
        <Badge variant="outline" className={getHealthTextClass('red')}>
          {healthCounts.red} red
        </Badge>
      )}
    </div>
  );
}
```
  </action>
  <verify>
```bash
# Check files exist
ls -la src/utils/healthCalculation.js
ls -la src/components/team-status/

# Verify exports
grep -n "export function calculateHealth" src/utils/healthCalculation.js
grep -n "export function MetricsBanner" src/components/team-status/MetricsBanner.jsx
grep -n "export function MemberCard" src/components/team-status/MemberCard.jsx
```
  </verify>
  <done>
Health calculation utility created with status determination logic. MetricsBanner shows aggregate metrics. MemberCard is collapsible with health border. TeamHealthBadge shows count breakdown.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TimelineNav and Wire Components to Page</name>
  <files>
    src/components/team-status/TimelineNav.jsx
    src/pages/TeamStatus.jsx
  </files>
  <action>
Create timeline navigation and integrate all components into the TeamStatus page.

**TimelineNav.jsx - Week navigation:**
```javascript
import { Button } from '@/components/ui/button';
import { ChevronLeft, ChevronRight, Calendar } from 'lucide-react';
import { getSprintById, formatDateRange } from '@/utils/releaseCycles';
import { format } from 'date-fns';

export function TimelineNav({ currentWeek, availableSprints = [], onWeekChange }) {
  const sprint = currentWeek ? getSprintById(currentWeek) : null;

  // Find current position in available sprints
  const currentIndex = availableSprints.findIndex(s => s.id === currentWeek);
  const hasPrev = currentIndex > 0;
  const hasNext = currentIndex < availableSprints.length - 1;

  const goPrev = () => {
    if (hasPrev) onWeekChange(availableSprints[currentIndex - 1].id);
  };

  const goNext = () => {
    if (hasNext) onWeekChange(availableSprints[currentIndex + 1].id);
  };

  if (!sprint) {
    return (
      <div className="flex items-center gap-4 text-muted-foreground">
        <Calendar className="h-4 w-4" />
        <span>Select a week</span>
      </div>
    );
  }

  // Calculate week label (relative within cycle)
  // Sprint 'a' = Weeks 1-2, Sprint 'b' = Weeks 3-4
  const cycleNum = parseInt(sprint.cycleId.slice(2));
  const sprintLabel = sprint.label; // 'a' or 'b'
  const weekRange = sprintLabel === 'a' ? '1-2' : '3-4';

  return (
    <div className="flex items-center gap-4">
      <Button
        variant="outline"
        size="icon"
        onClick={goPrev}
        disabled={!hasPrev}
        aria-label="Previous week"
      >
        <ChevronLeft className="h-4 w-4" />
      </Button>

      <div className="text-center min-w-[220px]">
        <div className="font-medium flex items-center justify-center gap-2">
          <Calendar className="h-4 w-4 text-muted-foreground" />
          <span>Weeks {weekRange} - Sprint {sprint.id}</span>
        </div>
        <div className="text-sm text-muted-foreground">
          {format(sprint.startDate, 'MMM d')} - {format(sprint.endDate, 'MMM d, yyyy')}
        </div>
      </div>

      <Button
        variant="outline"
        size="icon"
        onClick={goNext}
        disabled={!hasNext}
        aria-label="Next week"
      >
        <ChevronRight className="h-4 w-4" />
      </Button>
    </div>
  );
}
```

**TeamStatus.jsx - Complete page with all components:**
Replace the existing TeamStatus.jsx with the full implementation:

```javascript
import { TeamStatusProvider, useTeamStatus, TEAM_DEPARTMENTS } from '@/contexts/TeamStatusContext';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Users, Loader2 } from 'lucide-react';
import { MetricsBanner } from '@/components/team-status/MetricsBanner';
import { MemberCard } from '@/components/team-status/MemberCard';
import { TimelineNav } from '@/components/team-status/TimelineNav';
import { TeamHealthBadge } from '@/components/team-status/TeamHealthBadge';

function TeamStatusContent() {
  const {
    summaries,
    currentTeam,
    setCurrentTeam,
    currentWeek,
    setCurrentWeek,
    availableSprints,
    loading,
    error
  } = useTeamStatus();

  return (
    <div className="space-y-6">
      {/* Page Header */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold">Team Status</h1>
          <p className="text-muted-foreground">Weekly health and progress summaries</p>
        </div>

        {/* Timeline Navigation */}
        <TimelineNav
          currentWeek={currentWeek}
          availableSprints={availableSprints}
          onWeekChange={setCurrentWeek}
        />
      </div>

      {/* Team Tabs with Health Badge */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <Tabs value={currentTeam} onValueChange={setCurrentTeam}>
          <TabsList>
            {TEAM_DEPARTMENTS.map(dept => (
              <TabsTrigger key={dept.id} value={dept.id}>
                {dept.label}
              </TabsTrigger>
            ))}
          </TabsList>
        </Tabs>

        {/* Team Health Summary */}
        {!loading && summaries.length > 0 && (
          <TeamHealthBadge summaries={summaries} />
        )}
      </div>

      {/* Loading State */}
      {loading && (
        <Card>
          <CardContent className="py-12 text-center">
            <Loader2 className="h-8 w-8 mx-auto animate-spin text-muted-foreground" />
            <p className="mt-4 text-muted-foreground">Loading team summaries...</p>
          </CardContent>
        </Card>
      )}

      {/* Error State */}
      {error && !loading && (
        <Card className="border-destructive">
          <CardContent className="py-8 text-center">
            <p className="text-destructive">Failed to load summaries: {error}</p>
          </CardContent>
        </Card>
      )}

      {/* Empty State */}
      {!loading && !error && summaries.length === 0 && (
        <Card>
          <CardContent className="py-12 text-center">
            <Users className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground mb-2">No team summaries for this week</p>
            <p className="text-sm text-muted-foreground">
              Data will appear once daily summaries are stored via MCP
            </p>
          </CardContent>
        </Card>
      )}

      {/* Dashboard Content */}
      {!loading && !error && summaries.length > 0 && (
        <div className="space-y-6">
          {/* Aggregate Metrics Banner */}
          <MetricsBanner summaries={summaries} />

          {/* Member Cards */}
          <div className="space-y-3">
            <h2 className="text-lg font-semibold">Team Members</h2>
            <div className="grid gap-3">
              {summaries.map((summary, idx) => (
                <MemberCard
                  key={summary.memberId || idx}
                  member={summary.member || { name: summary.memberName || `Member ${idx + 1}` }}
                  summary={summary}
                />
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

export default function TeamStatus() {
  return (
    <TeamStatusProvider>
      <TeamStatusContent />
    </TeamStatusProvider>
  );
}
```

**Create components directory:**
```bash
mkdir -p src/components/team-status
```
  </action>
  <verify>
```bash
# Check all components exist
ls -la src/components/team-status/

# Verify imports work (no syntax errors)
npm run build 2>&1 | head -30

# Check page renders (dev server test)
npm run dev &
sleep 5
curl -s http://localhost:5173/teamstatus | grep -q "root" && echo "Page renders"
```
  </verify>
  <done>
TimelineNav allows browsing between sprints. TeamStatus page displays MetricsBanner above member cards. MemberCard shows health border and expands to show details. All components wired together with proper state management.
  </done>
</task>

</tasks>

<verification>
1. Health calculation returns correct status (green/yellow/red) based on blockers and activity
2. MetricsBanner shows aggregate completed/blockers/velocity counts
3. MemberCard displays health border color and expands on click
4. TimelineNav prev/next buttons work and are disabled at boundaries
5. TeamHealthBadge shows correct count breakdown
6. Page displays all components when summaries exist
7. Empty state shows when no summaries
</verification>

<success_criteria>
- Health indicators match specification (2+ blockers = red, 1 blocker = yellow, etc.)
- Metrics banner shows team totals in 3-column layout
- Member cards are collapsible with colored left border
- Timeline navigation allows browsing 4 weeks of history
- All UI matches phase context decisions (team tabs, compact cards, weekly view)
</success_criteria>

<output>
After completion, create `.planning/phases/22-team-status-page/22-02-SUMMARY.md`
</output>
