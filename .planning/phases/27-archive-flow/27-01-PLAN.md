---
phase: 27-archive-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/sync/ArchiveModal.jsx
  - src/components/sync/ArchivedItemCard.jsx
  - src/pages/TeamSync.jsx
autonomous: true

must_haves:
  truths:
    - "User sees Archive button with badge count in TeamSync header"
    - "Clicking Archive button opens modal with archived items list"
    - "User can filter archived items by date range"
    - "User can restore archived item back to active Kanban board"
  artifacts:
    - path: "src/components/sync/ArchiveModal.jsx"
      provides: "Archive modal with date filters and scrollable list"
      min_lines: 60
    - path: "src/components/sync/ArchivedItemCard.jsx"
      provides: "Card component for archived item display with restore action"
      min_lines: 30
    - path: "src/pages/TeamSync.jsx"
      provides: "Archive button with badge in header"
      contains: "Archive"
  key_links:
    - from: "src/pages/TeamSync.jsx"
      to: "src/components/sync/ArchiveModal.jsx"
      via: "import and render"
      pattern: "ArchiveModal"
    - from: "src/components/sync/ArchiveModal.jsx"
      to: "SyncContext"
      via: "useSync hook"
      pattern: "loadArchivedItems|restoreItem|archivedItems"
---

<objective>
Create archive modal UI with date filtering and restore functionality.

Purpose: Enable users to view and restore archived TeamSync items through a modal interface with date range filtering.
Output: Archive button with badge in TeamSync header, ArchiveModal component, ArchivedItemCard component.
</objective>

<execution_context>
@/Users/i306072/.claude/get-shit-done/workflows/execute-plan.md
@/Users/i306072/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-archive-flow/27-RESEARCH.md

Key patterns from existing code:
@src/contexts/SyncContext.jsx (lines 34-36, 154-186 - archivedItems state, loadArchivedItems, restoreItem)
@src/components/sync/SyncItemModal.jsx (dialog pattern, imports)
@src/pages/TeamSync.jsx (current header layout)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ArchivedItemCard component</name>
  <files>src/components/sync/ArchivedItemCard.jsx</files>
  <action>
Create a card component for displaying archived sync items with restore action.

Requirements:
1. Display item name as title
2. Display description (truncated with line-clamp-2)
3. Show category badge using CATEGORIES constant from SyncContext
4. Show team_department badge
5. Show archived date formatted with date-fns (format: "MMM d, yyyy")
6. Include "Restore" button with ArchiveRestore icon from lucide-react
7. Call onRestore(item.id) when restore clicked

Use existing UI components:
- Card, CardHeader, CardTitle, CardDescription from @/components/ui/card
- Button from @/components/ui/button
- Badge from @/components/ui/badge

Pattern to follow from SyncItemModal:
```jsx
import { format, parseISO } from 'date-fns';
import { CATEGORIES } from '@/contexts/SyncContext';
```

Styling: Use flex layout with justify-between for title/restore button alignment.
  </action>
  <verify>
File exists with proper imports and exports. ESLint passes.
```bash
cat src/components/sync/ArchivedItemCard.jsx
npm run lint -- --no-warn-ignored src/components/sync/ArchivedItemCard.jsx
```
  </verify>
  <done>ArchivedItemCard component renders item details with category/team badges, archived date, and restore button</done>
</task>

<task type="auto">
  <name>Task 2: Create ArchiveModal component</name>
  <files>src/components/sync/ArchiveModal.jsx</files>
  <action>
Create a modal dialog for displaying archived items with date filtering.

Requirements:
1. Accept props: open, onOpenChange (standard Dialog pattern)
2. Use Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription from @/components/ui/dialog
3. Date filter section with two native date inputs (from_date, to_date)
4. Lazy-load archived items via loadArchivedItems when modal opens
5. Show loading state while fetching
6. Empty state: "No archived items found" when list is empty
7. Scrollable list (max-h-[60vh] overflow-y-auto) of ArchivedItemCard components
8. Show item count in DialogDescription (e.g., "Showing 23 archived items")

State management:
- fromDate, toDate state for filters (empty string default)
- loading state for fetch indicator
- Use useSync() hook: loadArchivedItems, archivedItems, restoreItem

useEffect pattern for lazy-load:
```jsx
useEffect(() => {
  if (open) {
    setLoading(true);
    loadArchivedItems({ from_date: fromDate, to_date: toDate })
      .finally(() => setLoading(false));
  }
}, [open, fromDate, toDate, loadArchivedItems]);
```

Debounce consideration: Date inputs trigger on change. Consider 300ms debounce for filter changes if needed, but initial implementation can be immediate.

Handle restore:
- Create handleRestore(id) that calls restoreItem(id)
- Optimistic removal handled by SyncContext
  </action>
  <verify>
File exists with proper imports. ESLint passes.
```bash
cat src/components/sync/ArchiveModal.jsx
npm run lint -- --no-warn-ignored src/components/sync/ArchiveModal.jsx
```
  </verify>
  <done>ArchiveModal renders with date filters, loading state, empty state, and scrollable list of ArchivedItemCards</done>
</task>

<task type="auto">
  <name>Task 3: Add Archive button to TeamSync header</name>
  <files>src/pages/TeamSync.jsx</files>
  <action>
Add Archive button with badge count to TeamSync page header.

Requirements:
1. Import Archive icon from lucide-react
2. Import Badge from @/components/ui/badge
3. Import ArchiveModal from @/components/sync/ArchiveModal
4. Add archivedCount to useSync() destructure
5. Add archiveModalOpen state (useState false)
6. Add Archive button between page title and TeamDepartmentTabs

Button placement in header (update the flex container):
```jsx
<div className="flex items-center justify-between">
  <div>
    <h1 className="text-2xl font-bold text-gray-900">Team Sync</h1>
    <p className="text-gray-500 mt-1">Track team goals, blockers, and dependencies</p>
  </div>
  <div className="flex items-center gap-2">
    <Button
      variant="outline"
      onClick={() => setArchiveModalOpen(true)}
    >
      <Archive className="h-4 w-4 mr-2" />
      Archive
      {archivedCount > 0 && (
        <Badge variant="secondary" className="ml-2">
          {archivedCount}
        </Badge>
      )}
    </Button>
    <TeamDepartmentTabs value={currentTeam} onValueChange={setCurrentTeam} />
    <Button onClick={handleCreateClick}>
      <Plus className="h-4 w-4 mr-1" />
      Add
    </Button>
  </div>
</div>
```

Add ArchiveModal at end of component:
```jsx
<ArchiveModal
  open={archiveModalOpen}
  onOpenChange={setArchiveModalOpen}
/>
```
  </action>
  <verify>
File compiles. Archive button visible in header.
```bash
npm run lint -- --no-warn-ignored src/pages/TeamSync.jsx
npm run build:client 2>&1 | head -20
```

Manual verification: Run dev server and navigate to TeamSync page.
  </verify>
  <done>TeamSync header shows Archive button with badge count. Clicking opens ArchiveModal.</done>
</task>

</tasks>

<verification>
1. Archive button visible in TeamSync header with badge showing count when > 0
2. Clicking Archive button opens modal
3. Modal shows date filter inputs (From Date, To Date)
4. Archived items load on modal open
5. Changing date filters reloads items
6. Each archived item shows name, description, category badge, team badge, archived date
7. Restore button on each item returns it to active Kanban board
8. Empty state displays when no archived items match filter
</verification>

<success_criteria>
- ArchivedItemCard.jsx: 30+ lines, exports ArchivedItemCard, uses Badge/Card/Button components
- ArchiveModal.jsx: 60+ lines, exports ArchiveModal, uses Dialog primitives, date inputs, ArchivedItemCard
- TeamSync.jsx: Imports Archive icon, Badge, ArchiveModal; adds archiveModalOpen state; renders Archive button with badge
- All files pass ESLint
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/27-archive-flow/27-01-SUMMARY.md`
</output>
