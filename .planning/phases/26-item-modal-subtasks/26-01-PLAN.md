---
phase: 26-item-modal-subtasks
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/sync/SyncItemModal.jsx
  - src/pages/TeamSync.jsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Clicking a Kanban card opens modal showing item details in view mode"
    - "Create button in page header opens modal in edit mode with defaults"
    - "Modal shows category dropdown with Goals/Blockers/Dependencies/Emphasis options"
    - "Modal shows team department dropdown with All Teams/Metering/Reporting options"
    - "Modal shows sync status dropdown with New/In Progress/Resolved/Blocked options"
    - "Modal shows team member assignment dropdown populated from team_members"
    - "Modal shows sprint dropdown with current and future sprints"
  artifacts:
    - path: "src/components/sync/SyncItemModal.jsx"
      provides: "Modal component with view/edit modes and form fields"
      exports: ["SyncItemModal"]
      min_lines: 200
    - path: "src/pages/TeamSync.jsx"
      provides: "Page integrates modal with card clicks and create button"
      contains: "SyncItemModal"
  key_links:
    - from: "src/pages/TeamSync.jsx"
      to: "SyncItemModal"
      via: "useState for selectedItem and modalOpen"
      pattern: "useState.*selectedItem"
    - from: "src/components/sync/SyncItemModal.jsx"
      to: "@/contexts/SyncContext"
      via: "useSync hook"
      pattern: "useSync\\(\\)"
    - from: "src/components/sync/SyncItemModal.jsx"
      to: "@/contexts/AppContext"
      via: "useContext for teamMembers"
      pattern: "teamMembers"
---

<objective>
Create the SyncItemModal component with view/edit modes and all form field dropdowns for sync items.

Purpose: Enable users to view sync item details and edit them via a modal interface, fulfilling requirements UI-05 through UI-11.

Output: SyncItemModal.jsx component integrated into TeamSync page with working card click handlers and create button.
</objective>

<execution_context>
@/Users/i306072/.claude/get-shit-done/workflows/execute-plan.md
@/Users/i306072/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/26-item-modal-subtasks/26-CONTEXT.md
@.planning/phases/26-item-modal-subtasks/26-RESEARCH.md
@.planning/phases/25-frontend-foundation/25-02-SUMMARY.md

@src/contexts/SyncContext.jsx
@src/contexts/AppContext.jsx
@src/pages/TeamSync.jsx
@src/components/sync/SyncItemCard.jsx
@src/components/team/GoalFormDialog.jsx
@src/utils/releaseCycles.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SyncItemModal component</name>
  <files>src/components/sync/SyncItemModal.jsx</files>
  <action>
Create SyncItemModal.jsx following GoalFormDialog.jsx pattern with these specifics:

**Modal Structure:**
- Use Dialog from @/components/ui/dialog with className="sm:max-w-[600px]"
- Implement view/edit modes via useState - view mode shows read-only fields with Edit button, edit mode shows form inputs
- Reset to view mode when opening existing item (via useEffect on [open, item?.id])
- Start in edit mode when creating new item (item is null)

**Props:**
- open: boolean - controls dialog visibility
- onOpenChange: (open: boolean) => void - dialog state change handler
- item: object | null - existing sync item to view/edit, or null for create
- onSave: (data: object) => Promise<void> - save callback
- onDelete: (id: string) => Promise<void> - delete callback (optional)

**Form State:**
- useState for formData object with fields: name, category, team_department, sync_status, assigned_to, sprint_id, description
- useState for hasChanges boolean (track if user modified anything)
- useState for errors object (inline validation)
- useState for isSubmitting boolean (disable button during save)
- useState for mode: 'view' | 'edit'

**Form Fields (in edit mode):**
1. Name input (required) - use Input component with validation error display
2. Category dropdown - use Select with CATEGORIES from SyncContext
3. Team Department dropdown - use Select with TEAM_DEPARTMENTS from SyncContext
4. Sync Status dropdown - use Select with SYNC_STATUSES from SyncContext
5. Assigned To dropdown - use Select populated from teamMembers via useContext(AppContext)
6. Sprint dropdown - use Select populated from getCurrentCycle() + listSprints() from releaseCycles.js (show current + 2 more cycles worth)
7. Description textarea - optional, use Textarea component

**Default Values for New Items:**
- name: ''
- category: first item from CATEGORIES ('goal')
- team_department: currentTeam from useSync() (pre-select based on tab)
- sync_status: 'not_started'
- assigned_to: null
- sprint_id: getCurrentCycle().currentSprint.id
- description: ''

**View Mode Display:**
- Show item name as DialogTitle
- Display all fields as read-only text with labels
- Include Edit button in DialogFooter to switch to edit mode

**Edit Mode Features:**
- Inline validation: Show "Title is required" under name if empty on submit
- Disable Save button when isSubmitting, show "Saving..." text
- Cancel button calls handleClose

**handleClose Logic:**
- If hasChanges is true, show AlertDialog confirmation ("You have unsaved changes. Discard?")
- If confirmed or no changes, call onOpenChange(false)

**handleSave Logic:**
- Validate required fields (name, category, team_department)
- Set isSubmitting true
- Call await onSave(formData)
- In finally block: set isSubmitting false, call onOpenChange(false)

**Imports:**
- Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription from @/components/ui/dialog
- AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle from @/components/ui/alert-dialog
- Button from @/components/ui/button
- Input from @/components/ui/input
- Label from @/components/ui/label
- Textarea from @/components/ui/textarea
- Select, SelectContent, SelectItem, SelectTrigger, SelectValue from @/components/ui/select
- useState, useEffect, useContext from react
- AppContext from @/contexts/AppContext
- useSync, CATEGORIES, TEAM_DEPARTMENTS, SYNC_STATUSES from @/contexts/SyncContext
- getCurrentCycle, listSprints, formatSprintLabel from @/utils/releaseCycles
  </action>
  <verify>
File exists and exports SyncItemModal. Check imports are correct:
grep -l "export.*SyncItemModal" src/components/sync/SyncItemModal.jsx
  </verify>
  <done>
SyncItemModal component exists with view/edit modes, all 7 form fields (name, category, team_department, sync_status, assigned_to, sprint_id, description), validation, and unsaved changes confirmation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate modal into TeamSync page</name>
  <files>src/pages/TeamSync.jsx</files>
  <action>
Update TeamSync.jsx to integrate SyncItemModal:

**Add State:**
- useState for selectedItem (null | object) - item to view/edit
- useState for modalOpen (boolean) - controls modal visibility

**Update handleItemClick:**
Replace console.log with:
- setSelectedItem(item)
- setModalOpen(true)

**Add handleCreateClick:**
- setSelectedItem(null)
- setModalOpen(true)

**Add handleSave callback:**
```jsx
const handleSave = async (data) => {
  if (selectedItem) {
    await updateItem(selectedItem.id, data);
  } else {
    await createItem(data);
  }
};
```

**Add handleDelete callback:**
```jsx
const handleDelete = async (id) => {
  await deleteItem(id);
  setModalOpen(false);
};
```

**Add handleModalClose:**
```jsx
const handleModalClose = (open) => {
  setModalOpen(open);
  if (!open) {
    setSelectedItem(null);
  }
};
```

**Update useSync destructuring:**
Add createItem, updateItem, deleteItem to existing destructuring

**Add Create Button:**
In the page header div, add after TeamDepartmentTabs:
```jsx
<Button onClick={handleCreateClick} className="ml-4">
  <Plus className="h-4 w-4 mr-1" />
  Add
</Button>
```

**Add Modal to JSX:**
After KanbanBoard component:
```jsx
<SyncItemModal
  open={modalOpen}
  onOpenChange={handleModalClose}
  item={selectedItem}
  onSave={handleSave}
  onDelete={selectedItem ? handleDelete : undefined}
/>
```

**Add Imports:**
- SyncItemModal from @/components/sync/SyncItemModal
- Button from @/components/ui/button
- Plus from lucide-react
  </action>
  <verify>
Build succeeds and TeamSync page renders:
npm run build:client 2>&1 | tail -20
  </verify>
  <done>
TeamSync page has working create button, card click opens modal, modal saves/updates items via SyncContext.
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build:client` completes without errors
2. Modal renders: Open TeamSync page, click a card, modal appears with item data
3. Create flow: Click Add button, modal opens in edit mode with defaults
4. All dropdowns populated: Category, Team, Status, Assignee, Sprint all have options
5. Save works: Edit item, save, modal closes, item updated in Kanban board
6. Validation works: Try to save with empty name, see error message
</verification>

<success_criteria>
- UI-05: Clicking card opens detail/edit modal
- UI-06: Create button opens modal for new sync item
- UI-07: Modal includes category dropdown (Goals, Blockers, Dependencies, Emphasis)
- UI-08: Modal includes team department dropdown (Metering, Reporting, Both)
- UI-09: Modal includes sync status dropdown (New, In Progress, Resolved, Blocked)
- UI-10: Modal includes team member assignment dropdown (from existing team_members)
- UI-11: Modal includes sprint dropdown (from releaseCycles.js)
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/26-item-modal-subtasks/26-01-SUMMARY.md`
</output>
