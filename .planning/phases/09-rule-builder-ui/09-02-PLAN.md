---
phase: 09-rule-builder-ui
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/capture/RuleBuilderDialog.jsx
  - src/components/capture/PresetTemplates.js
autonomous: true

must_haves:
  truths:
    - "User can select from preset templates (Jenkins, Grafana, Concourse, Dynatrace)"
    - "Template selection populates form fields with pre-configured selectors"
    - "User can customize template values before saving"
    - "User understands how to test selectors (via extension popup)"
  artifacts:
    - path: "src/components/capture/PresetTemplates.js"
      provides: "Preset rule templates for common sites"
      exports: ["PRESET_TEMPLATES"]
    - path: "src/components/capture/RuleBuilderDialog.jsx"
      provides: "Template dropdown and test instructions"
      contains: "PRESET_TEMPLATES"
  key_links:
    - from: "src/components/capture/RuleBuilderDialog.jsx"
      to: "PresetTemplates.js"
      via: "import"
      pattern: "import.*PRESET_TEMPLATES.*from"
---

<objective>
Add preset templates for common sites and selector testing guidance

Purpose: Jump-start rule creation with pre-configured templates for Jenkins, Grafana, Concourse, Dynatrace (RULE-05, RULE-06)
Output: PresetTemplates constants file, template dropdown in RuleBuilderDialog, test instructions
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-rule-builder-ui/09-RESEARCH.md
@.planning/phases/09-rule-builder-ui/09-01-SUMMARY.md (once created by Plan 01)

# Files to update
@src/components/capture/RuleBuilderDialog.jsx (created in Plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PresetTemplates constants file</name>
  <files>
    src/components/capture/PresetTemplates.js
  </files>
  <action>
    Create PresetTemplates.js with template configurations for Jenkins, Grafana, Concourse, and Dynatrace.

    ```javascript
    /**
     * Preset templates for common CI/CD and monitoring tools
     * These populate the RuleBuilderDialog form to jump-start rule creation
     *
     * Note: Selectors are generic starting points. Users should customize
     * based on their specific instance's DOM structure.
     */

    export const PRESET_TEMPLATES = {
      jenkins: {
        name: 'Jenkins Build Status',
        url_pattern: '*jenkins*',
        description: 'Extract build status from Jenkins job pages',
        selectors: [
          {
            field_name: 'job_name',
            selector: '#main-panel h1',
            type: 'text',
            required: true
          },
          {
            field_name: 'build_status',
            selector: '#buildHistory .build-row:first-child .build-status-icon__wrapper',
            type: 'attribute',
            attribute: 'title',
            required: true
          },
          {
            field_name: 'build_number',
            selector: '#buildHistory .build-row:first-child .build-link',
            type: 'text',
            required: false
          },
          {
            field_name: 'build_url',
            selector: '#buildHistory .build-row:first-child .build-link',
            type: 'href',
            required: false
          }
        ]
      },

      grafana: {
        name: 'Grafana Dashboard',
        url_pattern: '*grafana*',
        description: 'Extract dashboard info from Grafana',
        selectors: [
          {
            field_name: 'dashboard_title',
            selector: '[data-testid="data-testid dashboard-scene-title"], .navbar-page-btn',
            type: 'text',
            required: true
          },
          {
            field_name: 'dashboard_url',
            selector: 'link[rel="canonical"]',
            type: 'href',
            required: false
          }
        ]
      },

      concourse: {
        name: 'Concourse Pipeline',
        url_pattern: '*concourse*',
        description: 'Extract pipeline status from Concourse CI',
        selectors: [
          {
            field_name: 'pipeline_name',
            selector: '.pipeline-name, [data-pipeline-name]',
            type: 'text',
            required: true
          },
          {
            field_name: 'job_name',
            selector: '.job-name, .build-header__job-name',
            type: 'text',
            required: false
          },
          {
            field_name: 'build_status',
            selector: '.build-header, [class*="status"]',
            type: 'attribute',
            attribute: 'class',
            required: false
          },
          {
            field_name: 'build_number',
            selector: '.build-header__build-name, .build-number',
            type: 'text',
            required: false
          }
        ]
      },

      dynatrace: {
        name: 'Dynatrace Problem',
        url_pattern: '*dynatrace*',
        description: 'Extract problem details from Dynatrace',
        selectors: [
          {
            field_name: 'problem_title',
            selector: '[data-testid="problem-title"], .problem-title',
            type: 'text',
            required: true
          },
          {
            field_name: 'severity',
            selector: '[data-testid="problem-severity"], .severity',
            type: 'text',
            required: false
          },
          {
            field_name: 'affected_entities',
            selector: '[data-testid="affected-entities"], .affected-entity-count',
            type: 'text',
            required: false
          },
          {
            field_name: 'status',
            selector: '[data-testid="problem-status"], .problem-status',
            type: 'text',
            required: false
          }
        ]
      }
    };

    // Template keys for dropdown
    export const TEMPLATE_OPTIONS = [
      { value: 'jenkins', label: 'Jenkins Build Status' },
      { value: 'grafana', label: 'Grafana Dashboard' },
      { value: 'concourse', label: 'Concourse Pipeline' },
      { value: 'dynatrace', label: 'Dynatrace Problem' },
    ];
    ```

    Note: These selectors are generic starting points. Real-world instances may have different DOM structures. The goal is to save users time by providing a reasonable starting point that they can customize.
  </action>
  <verify>
    File exists at src/components/capture/PresetTemplates.js with PRESET_TEMPLATES and TEMPLATE_OPTIONS exports
  </verify>
  <done>
    PresetTemplates.js exports template configurations for 4 common tools
  </done>
</task>

<task type="auto">
  <name>Task 2: Add template dropdown and test instructions to RuleBuilderDialog</name>
  <files>
    src/components/capture/RuleBuilderDialog.jsx
  </files>
  <action>
    Update RuleBuilderDialog.jsx to include:
    1. Template dropdown that populates form
    2. Test instructions alert
    3. Info text about selectors

    Add imports:
    ```javascript
    import { PRESET_TEMPLATES, TEMPLATE_OPTIONS } from './PresetTemplates';
    import { Info, TestTube } from "lucide-react";
    ```

    Add template application function:
    ```javascript
    const applyTemplate = (templateKey) => {
      if (!templateKey || templateKey === 'none') return;

      const template = PRESET_TEMPLATES[templateKey];
      if (!template) return;

      setFormData({
        name: template.name,
        url_pattern: template.url_pattern,
        enabled: true
      });
      setSelectors([...template.selectors]);
    };
    ```

    Add to the form (after DialogHeader, before name input):
    ```jsx
    {/* Template Selection - only show for new rules */}
    {!rule && (
      <div className="space-y-2 mb-4 p-3 bg-blue-50 rounded-lg border border-blue-100">
        <Label className="text-sm font-medium text-blue-800">
          Start from Template (Optional)
        </Label>
        <Select onValueChange={applyTemplate}>
          <SelectTrigger className="bg-white">
            <SelectValue placeholder="Select a preset template..." />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="none">No template</SelectItem>
            {TEMPLATE_OPTIONS.map(opt => (
              <SelectItem key={opt.value} value={opt.value}>
                {opt.label}
              </SelectItem>
            ))}
          </SelectContent>
        </Select>
        <p className="text-xs text-blue-600">
          Templates provide starting selectors. Customize them for your specific site.
        </p>
      </div>
    )}
    ```

    Add test instructions (after selectors section, before footer):
    ```jsx
    {/* Testing Instructions */}
    <Alert className="bg-amber-50 border-amber-200">
      <TestTube className="h-4 w-4 text-amber-600" />
      <AlertDescription className="text-amber-800 text-sm">
        <strong>To test your selectors:</strong>
        <ol className="list-decimal ml-4 mt-1 space-y-1">
          <li>Save this rule first</li>
          <li>Navigate to a page matching the URL pattern</li>
          <li>Click the P&E extension icon</li>
          <li>Click "Capture This Page" to test extraction</li>
          <li>Check Capture Inbox for results</li>
        </ol>
      </AlertDescription>
    </Alert>
    ```

    Add CSS selector help text (near selector input):
    ```jsx
    <p className="text-xs text-gray-500">
      CSS selector (e.g., ".class", "#id", "[data-attr]")
    </p>
    ```
  </action>
  <verify>
    1. `npm run dev` - no errors
    2. Open /CaptureRules, click "Add Rule"
    3. Template dropdown visible with Jenkins, Grafana, Concourse, Dynatrace options
    4. Select Jenkins - form populates with name, URL pattern, and selectors
    5. Test instructions alert visible below selectors
  </verify>
  <done>
    Template dropdown populates form, test instructions guide user to extension workflow
  </done>
</task>

</tasks>

<verification>
1. Start dev server: `npm run dev`
2. Navigate to /CaptureRules
3. Click "Add Rule"
4. Verify template dropdown appears with 4 options
5. Select "Jenkins Build Status" - form populates:
   - Name: "Jenkins Build Status"
   - URL Pattern: "*jenkins*"
   - Selectors: job_name, build_status, build_number, build_url
6. Verify test instructions alert visible
7. Modify template values (change name, add selector) - works normally
8. Save rule - rule created with customized values
9. Edit existing rule - template dropdown not shown (as expected)
</verification>

<success_criteria>
- PRESET_TEMPLATES contains 4 tool configurations (Jenkins, Grafana, Concourse, Dynatrace)
- Each template has name, url_pattern, and selectors array
- Template dropdown only shows for new rules (not edit mode)
- Selecting template populates form fields and selectors
- User can customize template values before saving
- Test instructions provide clear steps for testing via extension
- Help text explains CSS selector format
</success_criteria>

<output>
After completion, create `.planning/phases/09-rule-builder-ui/09-02-SUMMARY.md`
</output>
