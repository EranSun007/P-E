---
phase: 31-navigation-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useCollapsedFolders.js
  - src/components/navigation/CollapsibleFolder.jsx
autonomous: true

must_haves:
  truths:
    - "Folder expand/collapse state persists across page reloads"
    - "People and Product modes have separate collapse states"
    - "CollapsibleFolder renders folder header with chevron and nested items"
    - "Chevron icon rotates smoothly when folder expands/collapses"
  artifacts:
    - path: "src/hooks/useCollapsedFolders.js"
      provides: "localStorage persistence hook for folder collapse state"
      exports: ["useCollapsedFolders"]
    - path: "src/components/navigation/CollapsibleFolder.jsx"
      provides: "Radix Collapsible wrapper with chevron animation"
      exports: ["CollapsibleFolder"]
  key_links:
    - from: "src/hooks/useCollapsedFolders.js"
      to: "localStorage"
      via: "pe_manager_nav_collapsed_folders_{mode} key"
      pattern: "localStorage\\.(get|set)Item"
    - from: "src/components/navigation/CollapsibleFolder.jsx"
      to: "src/hooks/useCollapsedFolders.js"
      via: "useCollapsedFolders import"
      pattern: "useCollapsedFolders"
---

<objective>
Create the foundational components for collapsible folder navigation: a localStorage persistence hook and the CollapsibleFolder component with Radix Collapsible.

Purpose: These building blocks enable Layout.jsx to render collapsible folder groups with persistent state across sessions.
Output: useCollapsedFolders hook and CollapsibleFolder component ready for HierarchicalNavigation integration.
</objective>

<execution_context>
@/Users/i306072/.claude/get-shit-done/workflows/execute-plan.md
@/Users/i306072/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-navigation-integration/31-RESEARCH.md

# Relevant source files
@src/contexts/NavigationContext.jsx
@src/contexts/AppModeContext.jsx
@src/components/ui/collapsible.jsx
@src/pages/Layout.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useCollapsedFolders Hook</name>
  <files>src/hooks/useCollapsedFolders.js</files>
  <action>
Create a new hook at src/hooks/useCollapsedFolders.js that manages folder collapse state with localStorage persistence.

Implementation:
1. Import useState, useEffect from 'react'
2. Import useAppMode from '@/contexts/AppModeContext'
3. Define storage key prefix: 'pe_manager_nav_collapsed_folders'
4. Create useCollapsedFolders function that:
   - Gets currentMode from useAppMode ('people' or 'product')
   - Computes storageKey as `${STORAGE_KEY_PREFIX}_${currentMode}`
   - Initialize collapsedFolders state from localStorage (empty array if none)
   - useEffect to persist collapsedFolders to localStorage when state changes
   - Wrap localStorage operations in try-catch (handle QuotaExceededError)
   - Return { isCollapsed, toggleFolder } functions:
     - isCollapsed(folderId): returns true if folderId is in collapsedFolders array
     - toggleFolder(folderId): adds or removes folderId from collapsedFolders array

Key details:
- Store array of collapsed folder IDs (not expanded) - collapsed is opt-in
- Separate storage keys for people/product modes
- Handle localStorage errors gracefully (don't crash, just log)
- State initializer reads from localStorage only on mount

Follow the pattern from 31-RESEARCH.md "Complete useCollapsedFolders Hook" example.
  </action>
  <verify>
1. File exists at src/hooks/useCollapsedFolders.js
2. Exports useCollapsedFolders function
3. No syntax errors: `npm run lint -- src/hooks/useCollapsedFolders.js`
  </verify>
  <done>
Hook exports useCollapsedFolders with isCollapsed and toggleFolder functions, uses mode-specific localStorage keys.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CollapsibleFolder Component</name>
  <files>src/components/navigation/CollapsibleFolder.jsx</files>
  <action>
Create CollapsibleFolder component at src/components/navigation/CollapsibleFolder.jsx that wraps Radix Collapsible with proper styling.

Implementation:
1. Import Collapsible, CollapsibleTrigger, CollapsibleContent from '@/components/ui/collapsible'
2. Import ChevronDown from 'lucide-react'
3. Import cn from '@/lib/utils'
4. Import useCollapsedFolders from '@/hooks/useCollapsedFolders'

Component props:
- folder: { id, name, order }
- children: React nodes (the nested menu items)
- isProductMode: boolean (for theming)

Component structure:
```jsx
<Collapsible open={isOpen} onOpenChange={() => toggleFolder(folder.id)}>
  <CollapsibleTrigger>
    <ChevronDown /> {/* with rotation animation */}
    <span>{folder.name}</span>
  </CollapsibleTrigger>
  <CollapsibleContent>
    {children}
  </CollapsibleContent>
</Collapsible>
```

Styling details:
- CollapsibleTrigger: flex items-center, w-full, px-4 py-2, text-sm font-medium, rounded-md
- Theme-aware colors:
  - Product mode: text-gray-400 hover:bg-gray-800 hover:text-white
  - People mode: text-gray-600 hover:bg-gray-100
- ChevronDown: h-4 w-4, mr-2, transition-transform duration-200
  - Rotation: rotate-0 when open, -rotate-90 when closed
- CollapsibleContent: pl-6 (indent nested items)

Export the component as named export: export function CollapsibleFolder
  </action>
  <verify>
1. File exists at src/components/navigation/CollapsibleFolder.jsx
2. Exports CollapsibleFolder function
3. No syntax errors: `npm run lint -- src/components/navigation/CollapsibleFolder.jsx`
4. Imports resolve correctly (check for missing dependencies)
  </verify>
  <done>
CollapsibleFolder component renders folder header with rotating chevron, nested items in CollapsibleContent, controlled by useCollapsedFolders hook.
  </done>
</task>

</tasks>

<verification>
1. Both files exist with proper exports
2. No lint errors in either file
3. Hook uses mode-specific localStorage keys
4. Component uses Radix Collapsible with controlled open state
5. Chevron has transition-transform for smooth rotation
</verification>

<success_criteria>
- useCollapsedFolders hook persists state to localStorage with mode-specific keys
- CollapsibleFolder renders Radix Collapsible with chevron rotation animation
- Both components follow existing codebase patterns (cn utility, theme-aware styling)
- No runtime errors when imported (verified via lint)
</success_criteria>

<output>
After completion, create `.planning/phases/31-navigation-integration/31-01-SUMMARY.md`
</output>
