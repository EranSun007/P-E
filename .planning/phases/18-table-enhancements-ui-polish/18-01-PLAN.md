---
phase: 18-table-enhancements-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/bugs/AgingBugsTable.jsx
autonomous: true

must_haves:
  truths:
    - "Aging bugs table displays colored dot before age value based on thresholds"
    - "Bugs older than 14 days show coral dot, 7-14 days show amber dot, under 7 days show sage dot"
    - "Component column appears after Priority column with badge-styled display"
    - "Clicking any column header sorts the table by that column"
    - "Active sort column shows direction indicator (ChevronUp/ChevronDown)"
    - "Inactive sortable columns show neutral sort icon (ArrowUpDown)"
  artifacts:
    - path: "src/components/bugs/AgingBugsTable.jsx"
      provides: "Sortable table with age indicators and component column"
      exports: ["AgingBugsTable"]
  key_links:
    - from: "AgingBugsTable"
      to: "date-fns differenceInDays"
      via: "age threshold calculation"
      pattern: "differenceInDays.*new Date"
    - from: "AgingBugsTable sortedBugs"
      to: "sortBy, sortOrder state"
      via: "useMemo dependency"
      pattern: "useMemo.*sortBy.*sortOrder"
---

<objective>
Enhance AgingBugsTable with visual age indicators, component column, and sortable columns.

Purpose: Improve bug triage experience by making age severity instantly visible and allowing flexible data exploration through sorting.

Output: Enhanced AgingBugsTable.jsx with:
- Colored dot age indicators (coral >14d, amber 7-14d, sage <7d)
- Component column with badge styling
- All columns sortable with visual direction indicators
</objective>

<execution_context>
@/Users/i306072/.claude/get-shit-done/workflows/execute-plan.md
@/Users/i306072/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/18-table-enhancements-ui-polish/18-CONTEXT.md
@.planning/phases/18-table-enhancements-ui-polish/18-RESEARCH.md

# Source files
@src/components/bugs/AgingBugsTable.jsx
@src/components/agenda/AgendaItemList.jsx (sorting pattern reference)
@src/components/ui/badge.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add age indicator component and constants</name>
  <files>src/components/bugs/AgingBugsTable.jsx</files>
  <action>
Add age threshold constants and AgeIndicator component at the top of AgingBugsTable.jsx:

1. Define AGE_COLORS constant with softer muted palette:
   - critical: '#E07A5F' (coral) for >14 days
   - warning: '#D4A574' (amber) for 7-14 days
   - healthy: '#81B29A' (sage) for <7 days

2. Create AgeIndicator inline component that:
   - Accepts daysOld prop (number)
   - Returns colored dot (h-2 w-2 rounded-full) + days text
   - Uses differenceInDays from date-fns (already imported via formatDistanceToNow)
   - Format: "dot + space + N days" (e.g., "â— 15 days")

3. Add import for differenceInDays from date-fns.

Implementation pattern (from RESEARCH.md):
```jsx
const AGE_COLORS = {
  critical: '#E07A5F', // coral - >14 days
  warning: '#D4A574',  // amber - 7-14 days
  healthy: '#81B29A',  // sage - <7 days
};

function AgeIndicator({ daysOld }) {
  const getColor = () => {
    if (daysOld > 14) return AGE_COLORS.critical;
    if (daysOld >= 7) return AGE_COLORS.warning;
    return AGE_COLORS.healthy;
  };

  return (
    <span className="flex items-center gap-2">
      <span
        className="h-2 w-2 rounded-full"
        style={{ backgroundColor: getColor() }}
      />
      <span>{daysOld} days</span>
    </span>
  );
}
```
  </action>
  <verify>Component renders without errors when viewing BugDashboard with uploaded data</verify>
  <done>AGE_COLORS constant defined, AgeIndicator component created, differenceInDays imported</done>
</task>

<task type="auto">
  <name>Task 2: Add sorting state and sortable headers</name>
  <files>src/components/bugs/AgingBugsTable.jsx</files>
  <action>
Add sorting functionality following the pattern from AgendaItemList.jsx:

1. Add imports at top:
   - useState, useMemo from 'react'
   - ChevronUp, ChevronDown, ArrowUpDown from 'lucide-react'

2. Add sorting state inside AgingBugsTable component:
   - sortBy: string, default 'age' (most useful default for aging bugs)
   - sortOrder: 'asc' | 'desc', default 'desc' (oldest bugs first)

3. Create handleSort function:
   - If clicking same column: toggle sortOrder (asc <-> desc)
   - If clicking different column: set sortBy to that column, sortOrder to 'asc'

4. Create SortableHeader inline component:
   - Props: column (string), label (string), sortBy, sortOrder, onSort, className (optional)
   - Renders TableHead with cursor-pointer, select-none, hover:bg-muted/50
   - Content: flex container with label + sort icon
   - Icon logic:
     - If active (sortBy === column): ChevronUp (asc) or ChevronDown (desc)
     - If inactive: ArrowUpDown with text-muted-foreground
   - Add accessibility: role="button", tabIndex={0}, onKeyDown for Enter/Space

5. Replace static TableHead elements with SortableHeader for all columns:
   - key, summary, priority, component (new), age, status, assignee

Column sort keys:
- key: 'key' (string compare on bug_key)
- summary: 'summary' (string compare)
- priority: 'priority' (string compare, "Very High" > "High")
- component: 'component' (string compare)
- age: 'age' (date compare on created_date - older = larger)
- status: 'status' (string compare)
- assignee: 'assignee' (string compare)
  </action>
  <verify>Table headers are clickable and show hover state</verify>
  <done>Sorting state added, SortableHeader component created, all headers replaced</done>
</task>

<task type="auto">
  <name>Task 3: Implement sorted bugs with useMemo and add component column</name>
  <files>src/components/bugs/AgingBugsTable.jsx</files>
  <action>
1. Update the agingBugs filtering to use useMemo and add sorting:

```jsx
const sortedBugs = useMemo(() => {
  // First filter to VH/High priority bugs that are still open
  const filtered = bugs
    .filter(
      (bug) =>
        ['Very High', 'High'].includes(bug.priority) &&
        OPEN_STATUSES.includes(bug.status)
    )
    .slice(0, 20);

  // Then sort based on current sort state
  return [...filtered].sort((a, b) => {
    let aVal, bVal;
    switch (sortBy) {
      case 'key':
        aVal = a.bug_key.toLowerCase();
        bVal = b.bug_key.toLowerCase();
        break;
      case 'summary':
        aVal = a.summary.toLowerCase();
        bVal = b.summary.toLowerCase();
        break;
      case 'priority':
        // "Very High" should sort before "High"
        aVal = a.priority === 'Very High' ? 0 : 1;
        bVal = b.priority === 'Very High' ? 0 : 1;
        break;
      case 'component':
        aVal = (a.component || '').toLowerCase();
        bVal = (b.component || '').toLowerCase();
        break;
      case 'age':
        // Older bugs (earlier created_date) should have higher age value
        aVal = new Date(a.created_date);
        bVal = new Date(b.created_date);
        // Invert for age: earlier date = older = should be "larger" for desc
        [aVal, bVal] = [bVal, aVal];
        break;
      case 'status':
        aVal = a.status.toLowerCase();
        bVal = b.status.toLowerCase();
        break;
      case 'assignee':
        aVal = (a.assignee || 'zzz').toLowerCase(); // Unassigned last
        bVal = (b.assignee || 'zzz').toLowerCase();
        break;
      default:
        return 0;
    }

    if (sortOrder === 'asc') {
      return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
    }
    return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
  });
}, [bugs, sortBy, sortOrder]);
```

2. Replace `agingBugs` variable with `sortedBugs` throughout:
   - In empty state check: `sortedBugs.length === 0`
   - In header count: `({sortedBugs.length} open VH/High bugs)`
   - In map: `sortedBugs.map((bug) => ...)`

3. Add Component column to the table:
   - After Priority column, before Age column
   - Header: SortableHeader with column="component", label="Component"
   - Cell: Badge component with secondary variant showing bug.component
   - Handle missing component: show "Unknown" in muted style

4. Update Age cell to use AgeIndicator:
   - Calculate daysOld using differenceInDays(new Date(), new Date(bug.created_date))
   - Replace formatDistanceToNow with AgeIndicator component

Table column order (with widths):
1. Key (w-[120px])
2. Summary (no width - flex)
3. Priority (w-[100px])
4. Component (w-[140px]) - NEW
5. Age (w-[100px])
6. Status (w-[120px])
7. Assignee (w-[150px])
  </action>
  <verify>
Run dev server: `npm run dev`
Navigate to Bug Dashboard with uploaded data
Verify:
1. Table shows component column with badge styling
2. Age column shows colored dots (coral/amber/sage based on days)
3. Clicking column headers sorts the table
4. Sort direction icons update correctly
5. Default sort is by age descending (oldest first)
  </verify>
  <done>
1. sortedBugs useMemo correctly sorts based on sortBy/sortOrder state
2. Component column displays with Badge component
3. Age column uses AgeIndicator with coral/amber/sage dots
4. All 7 columns are sortable with working direction indicators
  </done>
</task>

</tasks>

<verification>
1. Visual check: Age indicators show correct colors
   - Bug >14 days old: coral dot (#E07A5F)
   - Bug 7-14 days old: amber dot (#D4A574)
   - Bug <7 days old: sage dot (#81B29A)

2. Component column verification:
   - Column appears between Priority and Age
   - Shows component name in badge style
   - Missing components show "Unknown"

3. Sorting verification:
   - Click each column header - table reorders
   - Click same header again - sort direction reverses
   - Active column shows ChevronUp (asc) or ChevronDown (desc)
   - Inactive columns show ArrowUpDown icon

4. No regressions:
   - Bug key links still work (open in JIRA)
   - Table still filters to VH/High priority only
   - Table still limited to 20 bugs max
</verification>

<success_criteria>
1. Age column displays colored dot (coral/amber/sage) before "N days" text
2. Component column shows between Priority and Age with Badge styling
3. All 7 columns clickable and sortable
4. Sort direction indicators visible and accurate
5. Default sort: age descending (oldest bugs first)
6. No console errors, no visual regressions
</success_criteria>

<output>
After completion, create `.planning/phases/18-table-enhancements-ui-polish/18-01-SUMMARY.md`
</output>
