---
phase: 18-table-enhancements-ui-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/bugs/WeeklyInflowChart.jsx
  - src/pages/BugDashboard.jsx
autonomous: true

must_haves:
  truths:
    - "Weekly inflow trend chart appears when user has 2+ weeks of uploaded data"
    - "Chart shows bug inflow rate per week as a bar chart"
    - "Filter dropdowns have descriptive labels (Filter by Component, Filter by Week)"
    - "Component filter shows badge with selected component name when not 'All'"
    - "Badge is hidden when component filter is set to 'All Components'"
  artifacts:
    - path: "src/components/bugs/WeeklyInflowChart.jsx"
      provides: "Weekly bug inflow trend visualization"
      exports: ["WeeklyInflowChart"]
    - path: "src/pages/BugDashboard.jsx"
      provides: "Enhanced filter UI with labels and badges"
  key_links:
    - from: "WeeklyInflowChart"
      to: "apiClient.bugs.getKPIHistory"
      via: "data fetching"
      pattern: "getKPIHistory.*bug_inflow_rate"
    - from: "BugDashboard filter badge"
      to: "selectedComponent state"
      via: "conditional rendering"
      pattern: "selectedComponent.*!==.*all"
---

<objective>
Add weekly inflow trend chart and polish filter UI with clear labels and active state badges.

Purpose: Help users visualize bug inflow trends over time and make filter state immediately visible.

Output:
- New WeeklyInflowChart.jsx component showing bar chart of weekly bug inflow
- Enhanced BugDashboard.jsx with descriptive filter labels and component badge indicator
</objective>

<execution_context>
@/Users/i306072/.claude/get-shit-done/workflows/execute-plan.md
@/Users/i306072/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/18-table-enhancements-ui-polish/18-CONTEXT.md
@.planning/phases/18-table-enhancements-ui-polish/18-RESEARCH.md

# Source files
@src/pages/BugDashboard.jsx
@src/components/bugs/KPITrendChart.jsx (chart pattern reference)
@src/components/bugs/MTTRBarChart.jsx (bar chart reference)
@src/api/apiClient.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WeeklyInflowChart component</name>
  <files>src/components/bugs/WeeklyInflowChart.jsx</files>
  <action>
Create new WeeklyInflowChart.jsx component following patterns from KPITrendChart.jsx and MTTRBarChart.jsx:

1. File structure:
```jsx
// src/components/bugs/WeeklyInflowChart.jsx
// Bar chart showing weekly bug inflow trend

import { useState, useEffect } from 'react';
import {
  ResponsiveContainer,
  BarChart,
  Bar,
  XAxis,
  YAxis,
  Tooltip,
  Cell,
} from 'recharts';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Loader2 } from 'lucide-react';
import { format } from 'date-fns';
import { apiClient } from '@/api/apiClient';
```

2. Component props:
   - component: string | null - optional component filter

3. Fetch data using existing KPI history API:
   - Call apiClient.bugs.getKPIHistory(12, component) to get last 12 weeks
   - Extract bug_inflow_rate from each week's kpi_data
   - Transform into chart data: { weekEnding, value, label }
   - Sort by date ascending (oldest first on left)

4. Render conditions:
   - Show loading spinner while fetching
   - Show "No data available" if no history
   - Show "Upload more data to see trends" if only 1 week
   - Show bar chart if 2+ weeks of data

5. Bar chart configuration:
   - X-axis: weekEnding formatted as "MMM d"
   - Y-axis: inflow rate values
   - Bar fill: Use primary color (#3b82f6) to match existing charts
   - Tooltip: Show exact value and week date

6. Card styling:
   - Title: "Weekly Bug Inflow"
   - Match sizing/styling of MTTRBarChart

Implementation:
```jsx
export function WeeklyInflowChart({ component = null }) {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function fetchData() {
      try {
        setLoading(true);
        const history = await apiClient.bugs.getKPIHistory(12, component);

        const transformed = history
          .map(record => ({
            weekEnding: record.week_ending,
            value: record.kpi_data?.bug_inflow_rate ?? null,
            label: format(new Date(record.week_ending), 'MMM d'),
          }))
          .filter(record => record.value !== null)
          .sort((a, b) => new Date(a.weekEnding) - new Date(b.weekEnding));

        setData(transformed);
        setError(null);
      } catch (err) {
        console.error('Failed to fetch weekly inflow data:', err);
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }
    fetchData();
  }, [component]);

  // Only show chart if we have 2+ weeks of data
  const showChart = data.length >= 2;

  return (
    <Card>
      <CardHeader>
        <CardTitle>Weekly Bug Inflow</CardTitle>
      </CardHeader>
      <CardContent>
        {loading ? (
          <div className="h-64 flex items-center justify-center">
            <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
          </div>
        ) : error ? (
          <div className="h-64 flex items-center justify-center text-destructive">
            {error}
          </div>
        ) : !showChart ? (
          <div className="h-64 flex items-center justify-center text-muted-foreground">
            Upload more weeks of data to see inflow trends
          </div>
        ) : (
          <div className="h-64">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={data} margin={{ left: 10, right: 10, top: 10, bottom: 10 }}>
                <XAxis
                  dataKey="label"
                  tick={{ fontSize: 12 }}
                />
                <YAxis tick={{ fontSize: 12 }} width={40} />
                <Tooltip
                  content={({ active, payload }) => {
                    if (!active || !payload?.length) return null;
                    const d = payload[0].payload;
                    return (
                      <div className="bg-background border border-border rounded-md p-3 shadow-md">
                        <p className="text-sm font-medium">
                          Week of {format(new Date(d.weekEnding), 'MMM d, yyyy')}
                        </p>
                        <p className="text-sm text-muted-foreground">
                          Inflow: <span className="font-semibold text-foreground">{d.value}</span> bugs
                        </p>
                      </div>
                    );
                  }}
                />
                <Bar dataKey="value" fill="#3b82f6" radius={[4, 4, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
          </div>
        )}
      </CardContent>
    </Card>
  );
}

export default WeeklyInflowChart;
```
  </action>
  <verify>File created at src/components/bugs/WeeklyInflowChart.jsx with no syntax errors</verify>
  <done>WeeklyInflowChart component created with bar chart, loading states, and 2+ week requirement</done>
</task>

<task type="auto">
  <name>Task 2: Add WeeklyInflowChart to BugDashboard and polish filter labels</name>
  <files>src/pages/BugDashboard.jsx</files>
  <action>
1. Import WeeklyInflowChart at top of BugDashboard.jsx:
```jsx
import { WeeklyInflowChart } from '@/components/bugs/WeeklyInflowChart';
```

2. Import Badge component for filter indicator:
```jsx
import { Badge } from '@/components/ui/badge';
```

3. Add WeeklyInflowChart to the dashboard layout:
   - Place it in the charts row grid (make it 3 columns: MTTR, Category, Weekly Inflow)
   - Update grid from `grid-cols-1 lg:grid-cols-2` to `grid-cols-1 md:grid-cols-2 lg:grid-cols-3`
   - Add WeeklyInflowChart as third item with component prop

4. Update Sprint filter dropdown with descriptive label:
   - Keep current functionality
   - Add label text before SelectValue (optional - sprint already has clear context)

5. Update Week filter dropdown with descriptive label:
   - Change placeholder from "Select week" to more descriptive
   - Optionally add inline label

6. Update Component filter dropdown with descriptive label:
   - Add "Filter by Component:" as a label
   - Can be inline text before SelectValue or use a separate label element

Filter label approaches (choose ONE for consistency):
Option A: Inline label in SelectTrigger (subtle):
```jsx
<SelectTrigger className="w-[220px]">
  <span className="text-muted-foreground text-xs mr-1">Component:</span>
  <SelectValue placeholder="All" />
</SelectTrigger>
```

Option B: Label above dropdown (explicit):
```jsx
<div className="flex flex-col gap-1">
  <label className="text-xs text-muted-foreground">Filter by Component</label>
  <Select ...>...</Select>
</div>
```

Recommendation: Use Option A (inline) for compactness, as filter bar already has multiple dropdowns.

7. Add component badge indicator next to component filter:
   - Show Badge with selected component name when selectedComponent !== 'all'
   - Hide badge when selectedComponent === 'all'
   - Use secondary variant with ability to dismiss (optional)

Implementation for filter badge:
```jsx
{/* Component Filter with Badge */}
<div className="flex items-center gap-2">
  <Select
    value={selectedComponent}
    onValueChange={setSelectedComponent}
    disabled={components.length === 0}
  >
    <SelectTrigger className="w-[220px]">
      <span className="text-xs text-muted-foreground mr-1">Component:</span>
      <SelectValue placeholder="All" />
    </SelectTrigger>
    <SelectContent>
      <SelectItem value="all">All Components</SelectItem>
      {components.map((comp) => (
        <SelectItem key={comp} value={comp}>
          {comp}
        </SelectItem>
      ))}
    </SelectContent>
  </Select>

  {/* Active filter badge */}
  {selectedComponent !== 'all' && (
    <Badge variant="secondary" className="text-xs">
      {selectedComponent}
    </Badge>
  )}
</div>
```
  </action>
  <verify>
Run dev server: `npm run dev`
Navigate to Bug Dashboard
Verify:
1. Weekly Inflow chart appears in charts row (needs 2+ weeks of data)
2. Filter dropdowns have clearer labeling
3. Component badge appears when filtered, hidden when "All"
  </verify>
  <done>
1. WeeklyInflowChart added to charts row in 3-column grid
2. Filter dropdowns have descriptive inline labels
3. Component badge shows when filtered, hidden when "All"
  </done>
</task>

</tasks>

<verification>
1. Weekly Inflow Chart:
   - Shows when 2+ weeks of data uploaded
   - Displays "Upload more weeks..." message with only 1 week
   - Bar chart renders with correct data
   - Tooltip shows week and exact inflow value

2. Filter labels:
   - Component dropdown shows "Component:" prefix
   - Labels are subtle (muted color, small text)
   - Don't interfere with dropdown functionality

3. Component badge:
   - Appears when any component selected (not "All")
   - Hidden when "All Components" selected
   - Shows the component name in badge style
   - Uses secondary variant for subtle appearance

4. Layout:
   - Charts row now shows 3 charts on large screens
   - Responsive: stacks on smaller screens
   - No visual regressions to existing charts
</verification>

<success_criteria>
1. WeeklyInflowChart.jsx created and renders bar chart when 2+ weeks available
2. Chart integrated into BugDashboard charts row (3-column grid)
3. Component filter has descriptive "Component:" label
4. Badge shows selected component name when filtered
5. Badge hidden when filter is "All Components"
6. No console errors, responsive layout maintained
</success_criteria>

<output>
After completion, create `.planning/phases/18-table-enhancements-ui-polish/18-02-SUMMARY.md`
</output>
