---
phase: 29-settings-ui-basic
plan: 02
type: execute
wave: 2
depends_on: ["29-01"]
files_modified:
  - src/components/settings/NavigationSettings.jsx
autonomous: true

must_haves:
  truths:
    - "User can see all menu items in item assignment section"
    - "User can assign an item to a folder via dropdown"
    - "User can remove an item from a folder (move to root)"
    - "Preview shows current folder structure with assigned items"
    - "Item assignments persist after page refresh"
  artifacts:
    - path: "src/components/settings/NavigationSettings.jsx"
      provides: "Item assignment and folder preview functionality"
      contains: "Select"
  key_links:
    - from: "src/components/settings/NavigationSettings.jsx"
      to: "Layout.jsx navigation arrays"
      via: "hardcoded menu items list"
      pattern: "(peopleMenuItems|productMenuItems)"
    - from: "src/components/settings/NavigationSettings.jsx"
      to: "saveConfig"
      via: "context method for item updates"
      pattern: "saveConfig\\("
---

<objective>
Add item assignment dropdown and folder preview to NavigationSettings.

Purpose: Enable users to assign menu items to folders and see a preview of the folder structure. This completes the basic Settings UI for menu clustering before drag-and-drop is added in Phase 30.

Output: Enhanced NavigationSettings with item-to-folder assignment and visual preview.
</objective>

<execution_context>
@/Users/i306072/.claude/get-shit-done/workflows/execute-plan.md
@/Users/i306072/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-settings-ui-basic/29-01-SUMMARY.md
@src/contexts/NavigationContext.jsx
@src/pages/Layout.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define menu items list and add item assignment section</name>
  <files>src/components/settings/NavigationSettings.jsx</files>
  <action>
Add item assignment functionality to NavigationSettings:

1. Define menu items arrays at top of component (match Layout.jsx navigation arrays):

```javascript
// Menu items for People mode (from Layout.jsx)
const PEOPLE_MENU_ITEMS = [
  { id: 'tasks', name: 'Tasks', icon: 'CheckSquare' },
  { id: 'calendar', name: 'Calendar', icon: 'Calendar' },
  { id: 'duties', name: 'Duties', icon: 'CalendarDays' },
  { id: 'projects', name: 'Projects', icon: 'Folders' },
  { id: 'metrics', name: 'Metrics', icon: 'BarChart2' },
  { id: 'team', name: 'Team', icon: 'UserPlus' },
  { id: 'stakeholders', name: 'Stakeholders', icon: 'Users' },
  { id: 'peers', name: 'Peers', icon: 'Users' },
  { id: 'github', name: 'GitHub', icon: 'Github' },
  { id: 'jira', name: 'Jira', icon: 'Bug' },
  { id: 'capture-inbox', name: 'Capture Inbox', icon: 'Inbox' },
  { id: 'capture-rules', name: 'Capture Rules', icon: 'FileCode' },
  { id: 'bug-dashboard', name: 'Bug Dashboard', icon: 'Bug' },
  { id: 'knowledge-search', name: 'Knowledge Search', icon: 'Search' },
  { id: 'team-sync', name: 'Team Sync', icon: 'Users' },
  { id: 'team-status', name: 'Team Status', icon: 'Activity' },
];

// Menu items for Product mode (from Layout.jsx)
const PRODUCT_MENU_ITEMS = [
  { id: 'services', name: 'My Services', icon: 'Server' },
  { id: 'roadmap', name: 'My Roadmap', icon: 'Map' },
  { id: 'backlog', name: 'My Backlog', icon: 'ListTodo' },
  { id: 'analytics', name: 'Usage Analytics', icon: 'TrendingUp' },
  { id: 'feedback', name: 'Customer Feedback', icon: 'MessageSquare' },
  { id: 'releases', name: 'Releases', icon: 'Rocket' },
];
```

2. Get current menu items based on mode:
```javascript
const menuItems = currentMode === 'product' ? PRODUCT_MENU_ITEMS : PEOPLE_MENU_ITEMS;
```

3. Add second Card below folders card for "Menu Item Assignment":
   - CardTitle: "Menu Items"
   - CardDescription: "Assign items to folders or leave at root level"
   - Table with columns: Item Name, Folder Assignment (Select dropdown), Actions

4. For each menu item row:
   - Get current folder assignment from items array: `items.find(i => i.itemId === item.id)?.folderId || null`
   - Show Select dropdown with options:
     - "Root Level" (value: "root" or empty string)
     - Each folder from folders array (value: folder.id, label: folder.name)
   - On change: update items array with new folderId and call saveConfig

5. Import Select components from shadcn:
```javascript
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
```

6. Update the folder table "Items Count" column to actually count items:
```javascript
const itemCount = items.filter(i => i.folderId === folder.id).length;
```
  </action>
  <verify>
NavigationSettings shows:
- Folders section (from Plan 01)
- Menu Items section below with table
- Each item has dropdown with folder options
- Selecting a folder updates items array
  </verify>
  <done>
Item assignment section displays all menu items with folder dropdown. Changing dropdown updates config.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add folder preview section showing structure</name>
  <files>src/components/settings/NavigationSettings.jsx</files>
  <action>
Add visual preview of the folder structure:

1. Add third Card below item assignment for "Preview":
   - CardTitle: "Preview"
   - CardDescription: "See how your navigation will appear"

2. Create preview render logic:
   - Group items by folderId
   - Render folders with their nested items
   - Render root-level items (folderId is null or not in items array)

3. Preview structure (indented list style):
```jsx
<div className="space-y-2">
  {/* Root level items first */}
  {rootItems.map(item => (
    <div key={item.id} className="flex items-center gap-2 py-1 px-2 rounded bg-gray-50">
      <span className="text-sm">{item.name}</span>
    </div>
  ))}

  {/* Folders with their items */}
  {folders.map(folder => (
    <div key={folder.id} className="border rounded-lg p-2">
      <div className="flex items-center gap-2 font-medium text-sm">
        <FolderOpen className="h-4 w-4" />
        {folder.name}
        <Badge variant="secondary" className="text-xs">{getItemsInFolder(folder.id).length}</Badge>
      </div>
      <div className="ml-6 mt-1 space-y-1">
        {getItemsInFolder(folder.id).map(item => (
          <div key={item.id} className="text-sm text-gray-600 py-0.5">
            {item.name}
          </div>
        ))}
        {getItemsInFolder(folder.id).length === 0 && (
          <div className="text-sm text-gray-400 italic">No items</div>
        )}
      </div>
    </div>
  ))}
</div>
```

4. Helper functions needed:
```javascript
// Get root level items (not assigned to any folder)
const getRootItems = () => {
  const assignedItemIds = items.map(i => i.itemId);
  const assignedToFolder = items.filter(i => i.folderId).map(i => i.itemId);
  return menuItems.filter(m => !assignedToFolder.includes(m.id));
};

// Get items in a specific folder
const getItemsInFolder = (folderId) => {
  const itemIds = items.filter(i => i.folderId === folderId).map(i => i.itemId);
  return menuItems.filter(m => itemIds.includes(m.id));
};
```
  </action>
  <verify>
Preview section shows:
- Root level items at top
- Folders with expand icon
- Nested items under each folder
- Empty folders show "No items" message
  </verify>
  <done>
Preview renders current folder structure matching what sidebar will look like.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Reset to Defaults button and test full workflow</name>
  <files>src/components/settings/NavigationSettings.jsx</files>
  <action>
Add reset functionality and verify complete workflow:

1. Add "Reset to Defaults" button in card header or footer:
```jsx
<Button
  variant="outline"
  onClick={handleReset}
  disabled={loading}
>
  <RotateCcw className="h-4 w-4 mr-2" />
  Reset to Defaults
</Button>
```

2. Implement handleReset:
```javascript
const handleReset = async () => {
  if (window.confirm('Reset navigation to defaults? This will remove all folders and item assignments.')) {
    await resetToDefaults();
  }
};
```

3. Import RotateCcw from lucide-react

4. Test complete workflow:
   a. Create folder "DevOps Tools"
   b. Assign "Bug Dashboard", "Jira", "GitHub" to DevOps Tools folder
   c. Verify preview shows folder with 3 items
   d. Verify folder table shows items count = 3
   e. Refresh page - verify everything persists
   f. Move "GitHub" back to Root Level
   g. Verify preview updates
   h. Delete "DevOps Tools" folder
   i. Verify Bug Dashboard and Jira return to root in preview
   j. Click Reset to Defaults
   k. Verify all folders removed and items at root

5. Add loading state handling:
   - Show spinner/disabled state during save operations
   - Disable inputs during loading
  </action>
  <verify>
Complete workflow works:
- Create folder, assign items, preview updates
- Edit folder name, delete folder
- Reset clears all customization
- All operations persist across refresh
- No console errors
  </verify>
  <done>
NavigationSettings fully functional with folder CRUD, item assignment, preview, and reset. Requirements FOLDER-01 through FOLDER-05 complete.
  </done>
</task>

</tasks>

<verification>
Phase 29 Plan 02 verification:

1. Menu Items section shows all items for current mode
2. Each item has folder assignment dropdown
3. Dropdown shows "Root Level" + all folders
4. Changing dropdown updates config immediately
5. Preview section shows folder structure visually
6. Root items listed separately from folder items
7. Folder items nested under folder names
8. Reset to Defaults button works
9. Item count in folder table matches actual assigned items
10. All changes persist after page refresh
</verification>

<success_criteria>
- Item assignment table renders all menu items
- Select dropdown contains root option + all folders
- Selecting folder updates items array and saves
- Preview accurately reflects current configuration
- Preview groups items by folder with visual hierarchy
- Reset to Defaults clears all folders and assignments
- Items count in folder table is accurate
- Full workflow (create folder -> assign items -> preview -> persist) works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/29-settings-ui-basic/29-02-SUMMARY.md`
</output>
